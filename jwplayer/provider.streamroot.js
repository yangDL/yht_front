/**
 * jw7-hlsjs-provider
 * v3.0.4
 * 2016-06-15
 * 
 * Copyright Â© 2016
 */

(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){(function(global){(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Hls=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _hlsjsP2pWrapper=_dereq_("./hlsjs-p2p-wrapper"),_hlsjsP2pWrapper2=_interopRequireDefault(_hlsjsP2pWrapper),_utils=_dereq_("./utils"),_hls=_dereq_("hls.js"),_hls2=_interopRequireDefault(_hls),_lodash=_dereq_("lodash.assigninwith"),_lodash2=_interopRequireDefault(_lodash),_uaParserJs=_dereq_("ua-parser-js"),_uaParserJs2=_interopRequireDefault(_uaParserJs),uaParserResult=(new _uaParserJs2["default"]).getResult(),StreamrootHlsjsBundle=function e(r,s){return _classCallCheck(this,e),new _hlsjsP2pWrapper2["default"](_hls2["default"]).createPlayer(r,s)};(0,_lodash2["default"])(StreamrootHlsjsBundle,_hls2["default"]),(0,_utils.inheritStaticPropertiesReadOnly)(StreamrootHlsjsBundle,_hls2["default"]),StreamrootHlsjsBundle.isSupported=function(){var e="Safari"===uaParserResult.browser.name,r="mobile"===uaParserResult.device.type||"tablet"===uaParserResult.device.type||"console"===uaParserResult.device.type||"Android"===uaParserResult.os.name||"iOS"===uaParserResult.os.name;return _hls2["default"].isSupported()&&!e&&!r},StreamrootHlsjsBundle.getBrowserName=function(){return uaParserResult.browser.name},exports["default"]=StreamrootHlsjsBundle,module.exports=exports["default"]},{"./hlsjs-p2p-wrapper":3,"./utils":10,"hls.js":35,"lodash.assigninwith":49,"ua-parser-js":57}],2:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(e){return"undefined"==typeof e?"undefined":_typeof2(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":"undefined"==typeof e?"undefined":_typeof2(e)},_createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_lodash=_dereq_("lodash.defaults"),_lodash2=_interopRequireDefault(_lodash),_playerInterface=_dereq_("./integration/player-interface"),_playerInterface2=_interopRequireDefault(_playerInterface),_mediaMap=_dereq_("./integration/mapping/media-map"),_mediaMap2=_interopRequireDefault(_mediaMap),_segmentView=_dereq_("./integration/mapping/segment-view"),_segmentView2=_interopRequireDefault(_segmentView),_p2pLoaderGenerator=_dereq_("./integration/p2p-loader-generator"),_p2pLoaderGenerator2=_interopRequireDefault(_p2pLoaderGenerator),HlsjsP2PWrapperPrivate=function(){function e(t,r){if(_classCallCheck(this,e),!r)throw new Error("Constructor needs DI of PeerAgent");this.Hlsjs=t,this.StreamrootPeerAgentModule=r}return _createClass(e,[{key:"createPlayer",value:function(e,t){var r=this,n=this.Hlsjs,o=this.newPlayer(e||{});return o.on(n.Events.MANIFEST_LOADING,function(){r.startSession(o,e,t,o.url)}),o}},{key:"createSRModule",value:function(e,t,r){var n=arguments.length<=3||void 0===arguments[3]?null:arguments[3];e.contentId=n,this.createPeerAgent(e,t,r,null)}},{key:"getConfig",value:function(){return{fLoader:(0,_p2pLoaderGenerator2["default"])(this),maxBufferSize:0,maxBufferLength:30}}},{key:"onDispose",value:function(){this.stopSession()}},{key:"stopSession",value:function(){this.peerAgentModule&&(this.peerAgentModule.dispose(),delete this.peerAgentModule)}},{key:"startSession",value:function(e,t,r,n){var o=this.Hlsjs;if(!r||"object"!==("undefined"==typeof r?"undefined":_typeof(r)))throw new Error("p2pConfig must be a valid config object");var a=e||this.newPlayer(t||{});return this.createPeerAgent(r,e,o.Events,n),a}},{key:"newPlayer",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=this.Hlsjs;if(!t)throw new Error("Can not create Hls.js instance: dependency was not injected");if(e.fLoader)throw new Error("`fLoader` in Hls.js config must not be defined");return new t((0,_lodash2["default"])({},this.getConfig(),e))}},{key:"hasSession",value:function(){return!!this.peerAgentModule}},{key:"createPeerAgent",value:function(e,t,r){var n=arguments.length<=3||void 0===arguments[3]?null:arguments[3],o=this.StreamrootPeerAgentModule,a=o.StreamTypes.HLS,i="v1";if(this.hasSession())throw new Error("Streamroot session already started");var s=n||t.url;if(!s)throw new Error("Hls.js player instance must have valid `url` property or `contentUrl` must be passed");if(!r)throw new Error("Need valid Hls.js Events enumeration");var u=new _playerInterface2["default"](t,r,e,this.onDispose.bind(this)),l=new _mediaMap2["default"](t);this.peerAgentModule=new o(u,s,l,e,_segmentView2["default"],a,i)}},{key:"P2PLoader",get:function(){return(0,_p2pLoaderGenerator2["default"])(this)}}]),e}();exports["default"]=HlsjsP2PWrapperPrivate,module.exports=exports["default"]},{"./integration/mapping/media-map":4,"./integration/mapping/segment-view":5,"./integration/p2p-loader-generator":7,"./integration/player-interface":8,"lodash.defaults":50}],3:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _hlsjsP2pWrapperPrivate=_dereq_("./hlsjs-p2p-wrapper-private"),_hlsjsP2pWrapperPrivate2=_interopRequireDefault(_hlsjsP2pWrapperPrivate),_streamrootP2p=_dereq_("streamroot-p2p"),_streamrootP2p2=_interopRequireDefault(_streamrootP2p),HlsjsP2PWrapper=function e(r){_classCallCheck(this,e);var t=new _hlsjsP2pWrapperPrivate2["default"](r,_streamrootP2p2["default"]);this.createPlayer=t.createPlayer.bind(t),this.createSRModule=t.createSRModule.bind(t),this.P2PLoader=t.P2PLoader};exports["default"]=HlsjsP2PWrapper,module.exports=exports["default"]},{"./hlsjs-p2p-wrapper-private":2,"streamroot-p2p":56}],4:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_segmentView=_dereq_("./segment-view"),_segmentView2=_interopRequireDefault(_segmentView),_trackView=_dereq_("./track-view"),_trackView2=_interopRequireDefault(_trackView),MediaMap=function(){function e(t){_classCallCheck(this,e),this.hls=t}return _createClass(e,[{key:"getSegmentTime",value:function(e){if(void 0===e.time)throw new Error("getSegmentTime: segmentView.time is undefined");return e.time}},{key:"getSegmentList",value:function(e,t,r){var n=this.hls.levels[e.level];if(!n)throw new Error("getSegmentList: level doesn't exist");if(!n.details)return[];for(var i=[],a=n.details.fragments,l=0;l<a.length;l++){var s=a[l];t<=s.start&&s.start<=t+r&&i.push(new _segmentView2["default"]({sn:s.sn,trackView:e,time:s.start}))}return i}},{key:"getNextSegmentView",value:function(e){var t=this.hls.levels[e.trackView.level],r=!1,n=!0,i=!1,a=void 0;try{for(var l,s=t.details.fragments[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var u=l.value;if(r){var o=new _trackView2["default"]({level:u.level});return new _segmentView2["default"]({sn:u.sn,trackView:o,time:u.start})}u.sn===e.sn&&(r=!0)}}catch(f){i=!0,a=f}finally{try{!n&&s["return"]&&s["return"]()}finally{if(i)throw a}}return null}},{key:"getTrackList",value:function(){if(!this.hls.levels)return[];for(var e=[],t=0;t<this.hls.levels.length;t++)e.push(new _trackView2["default"]({level:t}));return e}}]),e}();exports["default"]=MediaMap,module.exports=exports["default"]},{"./segment-view":5,"./track-view":6}],5:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function e(e,r){var t=[],n=!0,i=!1,a=void 0;try{for(var u,l=e[Symbol.iterator]();!(n=(u=l.next()).done)&&(t.push(u.value),!r||t.length!==r);n=!0);}catch(o){i=!0,a=o}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw a}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_trackView=_dereq_("./track-view"),_trackView2=_interopRequireDefault(_trackView),SegmentView=function(){function e(r){_classCallCheck(this,e),this.sn=r.sn,this.trackView=new _trackView2["default"](r.trackView),this.time=r.time}return _createClass(e,null,[{key:"fromArrayBuffer",value:function(r){var t=new Uint32Array(r),n=_slicedToArray(t,2),i=n[0],a=n[1];return new e({trackView:new _trackView2["default"]({level:i}),sn:a})}}]),_createClass(e,[{key:"isEqual",value:function(e){if(!e)return!1;var r=e.sn,t=e.trackView;return this.sn===r&&this.trackView.isEqual(t)}},{key:"isInTrack",value:function(e){return this.trackView.isEqual(e)}},{key:"viewToString",value:function(){return this.trackView.viewToString()+"S"+this.sn}},{key:"toArrayBuffer",value:function(){return new Uint32Array([this.trackView.level,this.sn]).buffer}},{key:"getId",value:function(){return this.sn}}]),e}();exports["default"]=SegmentView,module.exports=exports["default"]},{"./track-view":6}],6:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),TrackView=function(){function e(t){_classCallCheck(this,e),this.level=t.level}return _createClass(e,[{key:"viewToString",value:function(){return"L"+this.level}},{key:"isEqual",value:function(e){return e?e.level===this.level:!1}}]),e}();exports["default"]=TrackView,module.exports=exports["default"]},{}],7:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(t){return t&&t.__esModule?t:{"default":t}}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==("undefined"==typeof e?"undefined":_typeof(e))&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof e?"undefined":_typeof(e)));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,r,o){return r&&t(e.prototype,r),o&&t(e,o),e}}(),_get=function t(e,r,o){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,r);if(void 0===s){var i=Object.getPrototypeOf(e);return null===i?void 0:t(i,r,o)}if("value"in s)return s.value;var n=s.get;if(void 0!==n)return n.call(o)},_segmentView=_dereq_("./mapping/segment-view"),_segmentView2=_interopRequireDefault(_segmentView),_trackView=_dereq_("./mapping/track-view"),_trackView2=_interopRequireDefault(_trackView),_xhrLoader=_dereq_("./xhr-loader"),_xhrLoader2=_interopRequireDefault(_xhrLoader),P2PLoaderGenerator=function(t){return function(e){function r(t){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this));return t&&(e.withCredentials=!(!t.request||!t.request.withCredentials),e.headers=t.request&&t.request.headers?t.request.headers:{}),e}return _inherits(r,e),_createClass(r,[{key:"abort",value:function(){if(this.frag){var t=this.timeoutHandle;this.stats.aborted=!0,this.abortCallback&&this.abortCallback.abort(),t&&window.clearTimeout(t)}else _get(Object.getPrototypeOf(r.prototype),"abort",this).call(this)}},{key:"load",value:function(e,o,s,i,n,a,l,u){var f=arguments.length<=8||void 0===arguments[8]?null:arguments[8],h=arguments.length<=9||void 0===arguments[9]?null:arguments[9];if(h){if(!t.peerAgentModule)throw new Error("Peer agent is not existing yet");this.frag=h,_get(Object.getPrototypeOf(r.prototype),"load",this).call(this,e,o,s,i,n,a,l,u,f)}else _get(Object.getPrototypeOf(r.prototype),"load",this).call(this,e,o,s,i,n,a,l,u,f)}},{key:"loadSuccess",value:function(t){if(!this.stats.aborted){window.clearTimeout(this.timeoutHandle);var e={currentTarget:{response:t}};this.stats.tload=performance.now(),this.onSuccess(e,this.stats)}}},{key:"loadError",value:function(t){t.target.status;this.stats.aborted||(this.stats.retry<this.maxRetry?(window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),this.stats.retry++):(window.clearTimeout(this.timeoutHandle),this.onError(t)))}},{key:"loadInternal",value:function(){if(this.frag){var e=this.headers;if(this.byteRange&&(e.Range="bytes="+this.frag.byteRangeStartOffset+"-"+(this.frag.byteRangeEndOffset-1)),this.stats.tfirst=null,this.stats.loaded=0,this.xhrSetup)throw new Error("xhrSetup setup is not usable with Streamroot version. Please contact Streamroot support");var o=new _trackView2["default"]({level:this.frag.level}),s=new _segmentView2["default"]({sn:this.frag.sn,trackView:o,time:this.frag.start}),i={url:this.url,headers:e,withCredentials:this.withCredentials},n={onSuccess:this.loadSuccess.bind(this),onError:this.loadError.bind(this),onProgress:this.loadprogress.bind(this)};this.abortCallback=t.peerAgentModule.getSegment(i,n,s)}else _get(Object.getPrototypeOf(r.prototype),"loadInternal",this).call(this)}},{key:"loadprogress",value:function(t){if(this.frag){var e=0;if(t.cdnDownloaded&&(e+=t.cdnDownloaded),t.p2pDownloaded&&(e+=t.p2pDownloaded),this.stats.loaded=e,null===this.stats.tfirst){var o=performance.now();if(t.p2pDuration+t.cdnDuration>0&&t.p2pDownloaded>0){var s=t.p2pDuration+t.cdnDuration;this.stats.trequest=o-s,this.stats.tfirst=this.stats.trequest+Math.min(Math.round(s/2),10)}else this.stats.tfirst=o}this.onProgress&&this.onProgress(t,this.stats)}else _get(Object.getPrototypeOf(r.prototype),"loadprogress",this).call(this,t)}}]),r}(_xhrLoader2["default"])};exports["default"]=P2PLoaderGenerator,module.exports=exports["default"]},{"./mapping/segment-view":5,"./mapping/track-view":6,"./xhr-loader":9}],8:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_events=_dereq_("events"),_events2=_interopRequireDefault(_events),_trackView=_dereq_("./mapping/track-view"),_trackView2=_interopRequireDefault(_trackView),PlayerInterface=function(e){function t(e,n,r,i){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this));return o.hls=e,o.liveMinBufferMargin=r.liveMinBufferMargin||10,o.onDispose=i,o.hls.on(n.LEVEL_SWITCH,function(e,t){o.emit("onTrackChange",{video:new _trackView2["default"]({level:t.level})})}),o.hls.on(n.DESTROYING,function(){o.onDispose()}),o}return _inherits(t,e),_createClass(t,[{key:"isLive",value:function(){if(!this.hls.levels)throw new Error("Called isLive before the master playlist was parsed");var e=!0,t=!1,n=void 0;try{for(var r,i=this.hls.levels[Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(o.details)return!!o.details.live}}catch(a){t=!0,n=a}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw n}}throw new Error("Called isLive before any levelplaylist was parsed")}},{key:"getBufferLevelMax",value:function(){var e=void 0,t=void 0;if(this.hls.config.liveSyncDuration?(e="liveSyncDuration",t=this.hls.config.liveSyncDuration-this.liveMinBufferMargin):(e="maxBufferLength",t=this.hls.config.maxBufferLength-this.liveMinBufferMargin),0>t)throw Error("Invalid configuration: hlsjsConfig."+e+" must be greater than p2pConfig.liveMinBufferMargin");return t}},{key:"setBufferMarginLive",value:function(e){this.hls.config.maxBufferSize=0,this.hls.config.maxBufferLength=e+this.liveMinBufferMargin}},{key:"addEventListener",value:function(e,t){"onTrackChange"===e&&this.on(e,t)}},{key:"removeEventListener",value:function(e,t){"onTrackChange"===e&&this.removeListener(e,t)}}]),t}(_events2["default"]);exports["default"]=PlayerInterface,module.exports=exports["default"]},{"./mapping/track-view":6,events:11}],9:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var r=e[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,s,r){return s&&t(e.prototype,s),r&&t(e,r),e}}(),XhrLoader=function(){function t(e){_classCallCheck(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return _createClass(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var t=this.loader,e=this.timeoutHandle;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),e&&window.clearTimeout(e)}},{key:"load",value:function(t,e,s,r,a,n,i,o){var l=arguments.length<=8||void 0===arguments[8]?null:arguments[8],h=arguments.length<=9||void 0===arguments[9]?null:arguments[9];this.url=t,!h||isNaN(h.byteRangeStartOffset)||isNaN(h.byteRangeEndOffset)||(this.byteRange=h.byteRangeStartOffset+"-"+h.byteRangeEndOffset),this.responseType=e,this.onSuccess=s,this.onProgress=l,this.onTimeout=a,this.onError=r,this.stats={trequest:performance.now(),retry:0},this.timeout=n,this.maxRetry=i,this.retryDelay=o,this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),n),this.loadInternal()}},{key:"loadInternal",value:function(){var t=this.loader=new XMLHttpRequest;t.onreadystatechange=this.statechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.open("GET",this.url,!0),this.byteRange&&t.setRequestHeader("Range","bytes="+this.byteRange),t.responseType=this.responseType,this.stats.tfirst=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(t,this.url),t.send()}},{key:"statechange",value:function(t){var e=t.currentTarget,s=e.status,r=this.stats;r.aborted||4!==e.readyState||(s>=200&&300>s?(window.clearTimeout(this.timeoutHandle),r.tload=performance.now(),this.onSuccess(t,r)):r.retry<this.maxRetry?(this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),r.retry++):(window.clearTimeout(this.timeoutHandle),this.onError(t)))}},{key:"loadtimeout",value:function(t){this.onTimeout(t,this.stats)}},{key:"loadprogress",value:function(t){var e=this.stats;null===e.tfirst&&(e.tfirst=performance.now()),e.loaded=t.loaded,this.onProgress&&this.onProgress(t,e)}}]),t}();exports["default"]=XhrLoader,module.exports=exports["default"]},{}],10:[function(_dereq_,module,exports){"use strict";function inheritStaticPropertiesReadOnly(e,t){function r(r){Object.defineProperty(e,r,{get:function(){return t[r]},set:void 0})}var i=!0,n=!1,o=void 0;try{for(var a,l=Object.getOwnPropertyNames(t)[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var c=a.value;-1===["prototype","name","length","caller","arguments","isSupported"].indexOf(c)&&r(c)}}catch(p){n=!0,o=p}finally{try{!i&&l["return"]&&l["return"]()}finally{if(n)throw o}}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.inheritStaticPropertiesReadOnly=inheritStaticPropertiesReadOnly},{}],11:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(e){return"function"==typeof e}function isNumber(e){return"number"==typeof e}function isObject(e){return"object"==typeof e&&null!==e}function isUndefined(e){return void 0===e}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(e){if(!isNumber(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},EventEmitter.prototype.emit=function(e){var t,i,n,s,r,o;if(this._events||(this._events={}),"error"===e&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(i=this._events[e],isUndefined(i))return!1;if(isFunction(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(isObject(i))for(s=Array.prototype.slice.call(arguments,1),o=i.slice(),n=o.length,r=0;n>r;r++)o[r].apply(this,s);return!0},EventEmitter.prototype.addListener=function(e,t){var i;if(!isFunction(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,isFunction(t.listener)?t.listener:t),this._events[e]?isObject(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,isObject(this._events[e])&&!this._events[e].warned&&(i=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners,i&&i>0&&this._events[e].length>i&&(this._events[e].warned=!0,"function"==typeof console.trace)),this},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.once=function(e,t){function i(){this.removeListener(e,i),n||(n=!0,t.apply(this,arguments))}if(!isFunction(t))throw TypeError("listener must be a function");var n=!1;return i.listener=t,this.on(e,i),this},EventEmitter.prototype.removeListener=function(e,t){var i,n,s,r;if(!isFunction(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],s=i.length,n=-1,i===t||isFunction(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(isObject(i)){for(r=s;r-- >0;)if(i[r]===t||i[r].listener&&i[r].listener===t){n=r;break}if(0>n)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],isFunction(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},EventEmitter.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?isFunction(this._events[e])?[this._events[e]]:this._events[e].slice():[]},EventEmitter.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(isFunction(t))return 1;if(t)return t.length}return 0},EventEmitter.listenerCount=function(e,t){return e.listenerCount(t)}},{}],12:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_bufferHelper=_dereq_("../helper/buffer-helper"),_bufferHelper2=_interopRequireDefault(_bufferHelper),_errors=_dereq_("../errors"),_logger=_dereq_("../utils/logger"),AbrController=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2["default"].FRAG_LOADING,_events2["default"].FRAG_LOAD_PROGRESS,_events2["default"].FRAG_LOADED,_events2["default"].ERROR));return r.lastLoadedFragLevel=0,r._autoLevelCapping=-1,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r.abandonRulesCheck.bind(r),r}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.clearTimer(),_eventHandler2["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){this.timer||(this.timer=setInterval(this.onCheck,100)),this.fragCurrent=e.frag}},{key:"onFragLoadProgress",value:function(e){var t=e.stats;void 0===t.aborted&&1===e.frag.loadCounter&&(this.lastfetchduration=(performance.now()-t.trequest)/1e3,this.lastbw=8*t.loaded/this.lastfetchduration)}},{key:"abandonRulesCheck",value:function(){var e=this.hls,t=e.media,r=this.fragCurrent;if(!r.loader||r.loader.stats&&r.loader.stats.aborted)return _logger.logger.warn("frag loader destroy or aborted, disarm abandonRulesCheck"),void this.clearTimer();if(t&&(!t.paused||!t.readyState)&&r.autoLevel&&r.level){var a=performance.now()-r.trequest;if(a>500*r.duration){var n=Math.max(1,1e3*r.loaded/a);r.expectedLen<r.loaded&&(r.expectedLen=r.loaded);var o=t.currentTime,l=(r.expectedLen-r.loaded)/n,i=_bufferHelper2["default"].bufferInfo(t,o,e.config.maxBufferHole).end-o;if(i<2*r.duration&&l>i){var s=void 0,u=void 0;for(u=r.level-1;u>=0&&(s=r.duration*e.levels[u].bitrate/(6.4*n),_logger.logger.log("fragLoadedDelay/bufferStarvationDelay/fragLevelNextLoadedDelay["+u+"] :"+l.toFixed(1)+"/"+i.toFixed(1)+"/"+s.toFixed(1)),!(i>s));u--);l>s&&(u=Math.max(0,u),e.nextLoadLevel=u,_logger.logger.warn("loading too slow, abort fragment loading and switch to level "+u),r.loader.abort(),this.clearTimer(),e.trigger(_events2["default"].FRAG_LOAD_EMERGENCY_ABORTED,{frag:r}))}}}}},{key:"onFragLoaded",value:function(e){this.clearTimer(),this.lastLoadedFragLevel=e.frag.level,this._nextAutoLevel=-1}},{key:"onError",value:function(e){switch(e.details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping=e}},{key:"nextAutoLevel",get:function(){var e,t,r,a=this.lastbw,n=this.hls;if(r=-1===this._autoLevelCapping&&n.levels&&n.levels.length?n.levels.length-1:this._autoLevelCapping,-1!==this._nextAutoLevel)return Math.min(this._nextAutoLevel,r);for(t=0;r>=t;t++)if(e=t<=this.lastLoadedFragLevel?.8*a:.7*a,e<n.levels[t].bitrate)return Math.max(0,t-1);return t-1},set:function(e){this._nextAutoLevel=e}}]),t}(_eventHandler2["default"]);exports["default"]=AbrController},{"../errors":29,"../event-handler":30,"../events":31,"../helper/buffer-helper":32,"../utils/logger":45}],13:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function");
}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),BufferController=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,_events2["default"].MEDIA_ATTACHING,_events2["default"].MEDIA_DETACHING,_events2["default"].BUFFER_RESET,_events2["default"].BUFFER_APPENDING,_events2["default"].BUFFER_CODECS,_events2["default"].BUFFER_EOS,_events2["default"].BUFFER_FLUSHING));return t.onsbue=t.onSBUpdateEnd.bind(t),t.onsbe=t.onSBUpdateError.bind(t),t}return _inherits(r,e),_createClass(r,[{key:"destroy",value:function(){_eventHandler2["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var r=this.media=e.media;if(r){var t=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),t.addEventListener("sourceopen",this.onmso),t.addEventListener("sourceended",this.onmse),t.addEventListener("sourceclose",this.onmsc),r.src=URL.createObjectURL(t)}}},{key:"onMediaDetaching",value:function(){var e=this.mediaSource;if(e){if("open"===e.readyState)try{e.endOfStream()}catch(r){_logger.logger.warn("onMediaDetaching:"+r.message+" while calling endOfStream")}e.removeEventListener("sourceopen",this.onmso),e.removeEventListener("sourceended",this.onmse),e.removeEventListener("sourceclose",this.onmsc),this.media.src="",this.media.removeAttribute("src"),this.mediaSource=null,this.media=null,this.pendingTracks=null,this.sourceBuffer=null}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(_events2["default"].MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function(){_logger.logger.log("media source opened"),this.hls.trigger(_events2["default"].MEDIA_ATTACHED,{media:this.media}),this.mediaSource.removeEventListener("sourceopen",this.onmso);var e=this.pendingTracks;e&&(this.onBufferCodecs(e),this.pendingTracks=null,this.doAppending())}},{key:"onMediaSourceClose",value:function(){_logger.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function(){_logger.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function(){this._needsFlush&&this.doFlush(),this._needsEos&&this.onBufferEos(),this.hls.trigger(_events2["default"].BUFFER_APPENDED),this.doAppending()}},{key:"onSBUpdateError",value:function(e){_logger.logger.error("sourceBuffer error:"+e),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function(){var e=this.sourceBuffer;if(e){for(var r in e){var t=e[r];try{this.mediaSource.removeSourceBuffer(t),t.removeEventListener("updateend",this.onsbue),t.removeEventListener("error",this.onsbe)}catch(n){}}this.sourceBuffer=null}this.flushRange=[],this.appended=0}},{key:"onBufferCodecs",value:function(e){var r=this.mediaSource;if(!r||"open"!==r.readyState)return void(this.pendingTracks=e);if(!this.sourceBuffer){var t={};for(var n in e){var o=e[n],s=o.levelCodec||o.codec,i=o.container+";codecs="+s;_logger.logger.log("creating sourceBuffer with mimeType:"+i);var a=t[n]=r.addSourceBuffer(i);a.addEventListener("updateend",this.onsbue),a.addEventListener("error",this.onsbe)}this.sourceBuffer=t}}},{key:"onBufferAppending",value:function(e){this.segments?this.segments.push(e):this.segments=[e],this.doAppending()}},{key:"onBufferAppendFail",value:function(e){_logger.logger.error("sourceBuffer error:"+e.event),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1,frag:this.fragCurrent})}},{key:"onBufferEos",value:function(){var e=this.sourceBuffer,r=this.mediaSource;r&&"open"===r.readyState&&(e.audio&&e.audio.updating||e.video&&e.video.updating?this._needsEos=!0:(_logger.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment"),r.endOfStream(),this._needsEos=!1))}},{key:"onBufferFlushing",value:function(e){this.flushRange.push({start:e.startOffset,end:e.endOffset}),this.flushBufferCounter=0,this.doFlush()}},{key:"doFlush",value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var r=0,t=this.sourceBuffer;if(t)for(var n in t)r+=t[n].buffered.length;this.appended=r,this.hls.trigger(_events2["default"].BUFFER_FLUSHED)}}},{key:"doAppending",value:function(){var e=this.hls,r=this.sourceBuffer,t=this.segments;if(r){if(this.media.error)return t=[],void _logger.logger.error("trying to append although a media error occured, flush segment and abort");for(var n in r)if(r[n].updating)return;if(t.length){var o=t.shift();try{r[o.type].appendBuffer(o.data),this.appendError=0,this.appended++}catch(s){_logger.logger.error("error while trying to append buffer:"+s.message),t.unshift(o);var i={type:_errors.ErrorTypes.MEDIA_ERROR};if(22!==s.code){if(this.appendError?this.appendError++:this.appendError=1,i.details=_errors.ErrorDetails.BUFFER_APPEND_ERROR,i.frag=this.fragCurrent,this.appendError>e.config.appendErrorMaxRetry)return _logger.logger.log("fail "+e.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t=[],i.fatal=!0,void e.trigger(_events2["default"].ERROR,i);i.fatal=!1,e.trigger(_events2["default"].ERROR,i)}else t=[],i.details=_errors.ErrorDetails.BUFFER_FULL_ERROR,e.trigger(_events2["default"].ERROR,i)}}}}},{key:"flushBuffer",value:function(e,r){var t,n,o,s,i,a;if(this.flushBufferCounter<this.appended&&this.sourceBuffer)for(var u in this.sourceBuffer){if(t=this.sourceBuffer[u],t.updating)return _logger.logger.warn("cannot flush, sb updating in progress"),!1;for(n=0;n<t.buffered.length;n++)if(o=t.buffered.start(n),s=t.buffered.end(n),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&r===Number.POSITIVE_INFINITY?(i=e,a=r):(i=Math.max(o,e),a=Math.min(s,r)),Math.min(a,s)-i>.5)return this.flushBufferCounter++,_logger.logger.log("flush "+u+" ["+i+","+a+"], of ["+o+","+s+"], pos:"+this.media.currentTime),t.remove(i,a),!1}else _logger.logger.warn("abort flushing too many retries");return _logger.logger.log("buffer flushed"),!0}}]),r}(_eventHandler2["default"]);exports["default"]=BufferController},{"../errors":29,"../event-handler":30,"../events":31,"../utils/logger":45}],14:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),CapLevelController=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2["default"].MEDIA_ATTACHING,_events2["default"].MANIFEST_PARSED))}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onMediaAttaching",value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null}},{key:"onManifestParsed",value:function(e){this.hls.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,this.hls.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function(){if(this.media){var e=this.levels?this.levels.length:0;e&&(this.hls.autoLevelCapping=this.getMaxLevel(e-1),this.hls.autoLevelCapping>this.autoLevelCapping&&this.hls.streamController.nextLevelSwitch(),this.autoLevelCapping=this.hls.autoLevelCapping)}}},{key:"getMaxLevel",value:function(e){var t=void 0,i=void 0,n=void 0,r=this.mediaWidth,a=this.mediaHeight,l=0,o=0;for(i=0;e>=i&&(n=this.levels[i],t=i,l=n.width,o=n.height,!(l>=r||o>=a));i++);return t}},{key:"contentScaleFactor",get:function(){var e=1;try{e=window.devicePixelRatio}catch(t){}return e}},{key:"mediaWidth",get:function(){var e=void 0;return this.media&&(e=this.media.width||this.media.clientWidth||this.media.offsetWidth,e*=this.contentScaleFactor),e}},{key:"mediaHeight",get:function(){var e=void 0;return this.media&&(e=this.media.height||this.media.clientHeight||this.media.offsetHeight,e*=this.contentScaleFactor),e}}]),t}(_eventHandler2["default"]);exports["default"]=CapLevelController},{"../event-handler":30,"../events":31}],15:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),LevelController=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2["default"].MANIFEST_LOADED,_events2["default"].LEVEL_LOADED,_events2["default"].ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=r._autoLevelCapping=-1,r}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.timer&&(clearInterval(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function(){this.canload=!0,this.timer&&this.tick()}},{key:"stopLoad",value:function(){this.canload=!1}},{key:"onManifestLoaded",value:function(e){var t,r,l=[],i=[],s={},n=!1,o=!1,a=this.hls;if(e.levels.forEach(function(e){e.videoCodec&&(n=!0),e.audioCodec&&(o=!0);var t=s[e.bitrate];void 0===t?(s[e.bitrate]=l.length,e.url=[e.url],e.urlId=0,l.push(e)):l[t].url.push(e.url)}),n&&o?l.forEach(function(e){e.videoCodec&&i.push(e)}):i=l,i=i.filter(function(e){var t=function(e){return MediaSource.isTypeSupported("audio/mp4;codecs="+e)},r=function(e){return MediaSource.isTypeSupported("video/mp4;codecs="+e)},l=e.audioCodec,i=e.videoCodec;return(!l||t(l))&&(!i||r(i))}),i.length){for(t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i,r=0;r<i.length;r++)if(i[r].bitrate===t){this._firstLevel=r,_logger.logger.log("manifest loaded,"+i.length+" level(s) found, first bitrate:"+t);break}a.trigger(_events2["default"].MANIFEST_PARSED,{levels:this._levels,firstLevel:this._firstLevel,stats:e.stats})}else a.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:a.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function(e){if(e>=0&&e<this._levels.length){this.timer&&(clearInterval(this.timer),this.timer=null),this._level=e,_logger.logger.log("switching to level "+e),this.hls.trigger(_events2["default"].LEVEL_SWITCH,{level:e});var t=this._levels[e];if(void 0===t.details||t.details.live===!0){_logger.logger.log("(re)loading playlist for level "+e);var r=t.urlId;this.hls.trigger(_events2["default"].LEVEL_LOADING,{url:t.url[r],level:e,id:r})}}else this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function(e){if(!e.fatal){var t,r,l=e.details,i=this.hls;switch(l){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:case _errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case _errors.ErrorDetails.KEY_LOAD_ERROR:case _errors.ErrorDetails.KEY_LOAD_TIMEOUT:t=e.frag.level;break;case _errors.ErrorDetails.LEVEL_LOAD_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:t=e.level}if(void 0!==t)if(r=this._levels[t],r.urlId<r.url.length-1)r.urlId++,r.details=void 0,_logger.logger.warn("level controller,"+l+" for level "+t+": switching to redundant stream id "+r.urlId);else{var s=-1===this._manualLevel&&t;s?(_logger.logger.warn("level controller,"+l+": emergency switch-down for next fragment"),i.abrController.nextAutoLevel=0):r&&r.details&&r.details.live?_logger.logger.warn("level controller,"+l+" on live stream, discard"):l!==_errors.ErrorDetails.FRAG_LOAD_ERROR&&l!==_errors.ErrorDetails.FRAG_LOAD_TIMEOUT&&(_logger.logger.error("cannot recover "+l+" error"),this._level=void 0,this.timer&&(clearInterval(this.timer),this.timer=null),e.fatal=!0,i.trigger(_events2["default"].ERROR,e))}}}},{key:"onLevelLoaded",value:function(e){e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"tick",value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e],r=t.urlId;this.hls.trigger(_events2["default"].LEVEL_LOADING,{url:t.url[r],level:e,id:r})}}},{key:"levels",get:function(){return this._levels}},{key:"level",get:function(){return this._level},set:function(e){this._levels&&this._levels.length>e&&(this._level!==e||void 0===this._levels[e].details)&&this.setLevelInternal(e)}},{key:"manualLevel",get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){return void 0===this._startLevel?this._firstLevel:this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.abrController.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.abrController.nextAutoLevel=e)}}]),t}(_eventHandler2["default"]);exports["default"]=LevelController},{"../errors":29,"../event-handler":30,"../events":31,"../utils/logger":45}],16:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),_demuxer=_dereq_("../demux/demuxer"),_demuxer2=_interopRequireDefault(_demuxer),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_logger=_dereq_("../utils/logger"),_binarySearch=_dereq_("../utils/binary-search"),_binarySearch2=_interopRequireDefault(_binarySearch),_bufferHelper=_dereq_("../helper/buffer-helper"),_bufferHelper2=_interopRequireDefault(_bufferHelper),_levelHelper=_dereq_("../helper/level-helper"),_levelHelper2=_interopRequireDefault(_levelHelper),_errors=_dereq_("../errors"),State={STOPPED:"STOPPED",STARTING:"STARTING",IDLE:"IDLE",PAUSED:"PAUSED",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR"},StreamController=function(e){function t(e){_classCallCheck(this,t);var a=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2["default"].MEDIA_ATTACHED,_events2["default"].MEDIA_DETACHING,_events2["default"].MANIFEST_LOADING,_events2["default"].MANIFEST_PARSED,_events2["default"].LEVEL_LOADED,_events2["default"].KEY_LOADED,_events2["default"].FRAG_LOADED,_events2["default"].FRAG_LOAD_EMERGENCY_ABORTED,_events2["default"].FRAG_PARSING_INIT_SEGMENT,_events2["default"].FRAG_PARSING_DATA,_events2["default"].FRAG_PARSED,_events2["default"].ERROR,_events2["default"].BUFFER_APPENDED,_events2["default"].BUFFER_FLUSHED));return a.config=e.config,a.audioCodecSwap=!1,a.ticks=0,a.ontick=a.tick.bind(a),a}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),_eventHandler2["default"].prototype.destroy.call(this),this.state=State.STOPPED}},{key:"startLoad",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];if(this.levels){var t=this.media,a=this.lastCurrentTime;this.stopLoad(),this.demuxer=new _demuxer2["default"](this.hls),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,t&&a?(_logger.logger.log("configure startPosition @"+a),this.lastPaused||(_logger.logger.log("resuming video"),t.play()),this.state=State.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=State.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else _logger.logger.warn("cannot start loading as manifest not parsed yet"),this.state=State.STOPPED}},{key:"stopLoad",value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=State.STOPPED}},{key:"tick",value:function(){this.ticks++,1===this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function(){var e,t,a,r=this,i=this.hls,s=i.config;switch(this.state){case State.ERROR:case State.PAUSED:break;case State.STARTING:this.startLevel=i.startLevel,-1===this.startLevel&&(this.startLevel=0,this.fragBitrateTest=!0),this.level=i.nextLoadLevel=this.startLevel,this.state=State.WAITING_LEVEL,this.loadedmetadata=!1;break;case State.IDLE:if(!this.media&&(this.startFragRequested||!s.startFragPrefetch))break;e=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition,t=this.startFragRequested===!1?this.startLevel:i.nextLoadLevel;var n,o=_bufferHelper2["default"].bufferInfo(this.media,e,s.maxBufferHole),l=o.len,d=o.end,g=this.fragPrevious;if(this.levels[t].hasOwnProperty("bitrate")?(n=Math.max(8*s.maxBufferSize/this.levels[t].bitrate,s.maxBufferLength),n=Math.min(n,s.maxMaxBufferLength)):n=s.maxBufferLength,n>l){if(i.nextLoadLevel=t,this.level=t,a=this.levels[t].details,"undefined"==typeof a||a.live&&this.levelLastLoaded!==t){this.state=State.WAITING_LEVEL;break}var f=a.fragments,h=f.length,u=f[0].start,c=f[h-1].start+f[h-1].duration,v=void 0;if(a.live){var _=void 0!==s.liveMaxLatencyDuration?s.liveMaxLatencyDuration:s.liveMaxLatencyDurationCount*a.targetduration;if(d<Math.max(u,c-_)){var E=void 0!==s.liveSyncDuration?s.liveSyncDuration:s.liveSyncDurationCount*a.targetduration;this.seekAfterBuffered=u+Math.max(0,a.totalduration-E),_logger.logger.log("buffer end: "+d+" is located too far from the end of live sliding playlist, media position will be reseted to: "+this.seekAfterBuffered.toFixed(3)),d=this.seekAfterBuffered}if(a.PTSKnown&&d>c)break;if(this.startFragRequested&&!a.PTSKnown){if(g){var S=g.sn+1;S>=a.startSN&&S<=a.endSN&&(v=f[S-a.startSN],_logger.logger.log("live playlist, switching playlist, load frag with next SN: "+v.sn))}v||(v=f[Math.min(h-1,Math.round(h/2))],_logger.logger.log("live playlist, switching playlist, unknown, load middle frag : "+v.sn))}}else u>d&&(v=f[0]);if(v||!function(){var e=void 0,t=s.maxFragLookUpTolerance;c>d?(d>c-t&&(t=0),e=_binarySearch2["default"].search(f,function(e){return e.start+e.duration-t<=d?1:e.start-t>d?-1:0})):e=f[h-1],e&&(v=e,u=e.start,g&&v.level===g.level&&v.sn===g.sn&&(v.sn<a.endSN?(v=f[v.sn+1-a.startSN],_logger.logger.log("SN just loaded, load next one: "+v.sn)):(a.live||(r.hls.trigger(_events2["default"].BUFFER_EOS),r.state=State.ENDED),v=null)))}(),v)if(null!=v.decryptdata.uri&&null==v.decryptdata.key)_logger.logger.log("Loading key for "+v.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t),this.state=State.KEY_LOADING,i.trigger(_events2["default"].KEY_LOADING,{frag:v});else{if(_logger.logger.log("Loading "+v.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+t+", currentTime:"+e+",bufferEnd:"+d.toFixed(3)),v.autoLevel=i.autoLevelEnabled,this.levels.length>1&&(v.expectedLen=Math.round(v.duration*this.levels[t].bitrate/8),v.trequest=performance.now()),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,v.loadCounter){v.loadCounter++;var R=s.fragLoadingLoopThreshold;if(v.loadCounter>R&&Math.abs(this.fragLoadIdx-v.loadIdx)<R)return void i.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:v})}else v.loadCounter=1;v.loadIdx=this.fragLoadIdx,this.fragCurrent=v,this.startFragRequested=!0,i.trigger(_events2["default"].FRAG_LOADING,{frag:v}),this.state=State.FRAG_LOADING}}break;case State.WAITING_LEVEL:t=this.levels[this.level],t&&t.details&&(this.state=State.IDLE);break;case State.FRAG_LOADING_WAITING_RETRY:var L=performance.now(),m=this.retryDate,p=this.media,D=p&&p.seeking;(!m||L>=m||D)&&(_logger.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=State.IDLE);break;case State.STOPPED:case State.FRAG_LOADING:case State.PARSING:case State.PARSED:case State.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"getBufferRange",value:function(e){var t,a,r=this.bufferRange;if(r)for(t=r.length-1;t>=0;t--)if(a=r[t],e>=a.start&&e<=a.end)return a;return null}},{key:"followingBufferRange",value:function(e){return e?this.getBufferRange(e.end+.5):null}},{key:"isBuffered",value:function(e){var t=this.media;if(t)for(var a=t.buffered,r=0;r<a.length;r++)if(e>=a.start(r)&&e<=a.end(r))return!0;return!1}},{key:"_checkFragmentChanged",value:function(){var e,t,a=this.media;if(a&&a.seeking===!1&&(t=a.currentTime,t>a.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),this.isBuffered(t)?e=this.getBufferRange(t):this.isBuffered(t+.1)&&(e=this.getBufferRange(t+.1)),e)){var r=e.frag;r!==this.fragPlaying&&(this.fragPlaying=r,this.hls.trigger(_events2["default"].FRAG_CHANGED,{frag:r}))}}},{key:"immediateLevelSwitch",value:function(){_logger.logger.log("immediateLevelSwitch"),this.immediateSwitch||(this.immediateSwitch=!0,this.previouslyPaused=this.media.paused,this.media.pause());var e=this.fragCurrent;e&&e.loader&&e.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=State.PAUSED,this.hls.trigger(_events2["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY})}},{key:"immediateLevelSwitchEnd",value:function(){this.immediateSwitch=!1;var e=this.media;e&&e.readyState&&(e.currentTime-=1e-4,this.previouslyPaused||e.play())}},{key:"nextLevelSwitch",value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,a=void 0,r=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,a=this.getBufferRange(e.currentTime),a&&a.start>1&&(this.state=State.PAUSED,this.hls.trigger(_events2["default"].BUFFER_FLUSHING,{startOffset:0,endOffset:a.start-1})),e.paused)t=0;else{var i=this.hls.nextLoadLevel,s=this.levels[i],n=this.fragLastKbps;t=n&&this.fragCurrent?this.fragCurrent.duration*s.bitrate/(1e3*n)+1:0}if(r=this.getBufferRange(e.currentTime+t),r&&(r=this.followingBufferRange(r))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.state=State.PAUSED,this.hls.trigger(_events2["default"].BUFFER_FLUSHING,{startOffset:r.start,endOffset:Number.POSITIVE_INFINITY})}}}},{key:"onMediaAttached",value:function(e){var t=this.media=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener("seeking",this.onvseeking),t.addEventListener("seeked",this.onvseeked),t.addEventListener("ended",this.onvended),this.levels&&this.config.autoStartLoad&&this.hls.startLoad()}},{key:"onMediaDetaching",value:function(){var e=this.media;e&&e.ended&&(_logger.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("seeked",this.onvseeked),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function(){if(this.state===State.FRAG_LOADING){if(0===_bufferHelper2["default"].bufferInfo(this.media,this.media.currentTime,this.config.maxBufferHole).len){_logger.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load");var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.state=State.IDLE}}else this.state===State.ENDED&&(this.state=State.IDLE);this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()}},{key:"onMediaSeeked",value:function(){this.tick()}},{key:"onMediaEnded",value:function(){_logger.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function(){_logger.logger.log("trigger BUFFER_RESET"),this.hls.trigger(_events2["default"].BUFFER_RESET),this.bufferRange=[],this.stalled=!1}},{key:"onManifestParsed",value:function(e){var t,a=!1,r=!1;e.levels.forEach(function(e){t=e.audioCodec,t&&(-1!==t.indexOf("mp4a.40.2")&&(a=!0),-1!==t.indexOf("mp4a.40.5")&&(r=!0))}),this.audioCodecSwitch=a&&r,this.audioCodecSwitch&&_logger.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1,this.config.autoStartLoad&&this.hls.startLoad()}},{key:"onLevelLoaded",value:function(e){var t=e.details,a=e.level,r=this.levels[a],i=t.totalduration,s=0;if(_logger.logger.log("level "+a+" loaded ["+t.startSN+","+t.endSN+"],duration:"+i),this.levelLastLoaded=a,t.live){var n=r.details;n?(_levelHelper2["default"].mergeDetails(n,t),s=t.fragments[0].start,t.PTSKnown?_logger.logger.log("live playlist sliding:"+s.toFixed(3)):_logger.logger.log("live playlist - outdated PTS, unknown sliding")):(t.PTSKnown=!1,_logger.logger.log("live playlist - first load, unknown sliding"))}else t.PTSKnown=!1;if(r.details=t,this.hls.trigger(_events2["default"].LEVEL_UPDATED,{details:t,level:a}),this.startFragRequested===!1){if(t.live){var o=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;this.startPosition=Math.max(0,s+i-o)}this.nextLoadPosition=this.startPosition}this.state===State.WAITING_LEVEL&&(this.state=State.IDLE),this.tick()}},{key:"onKeyLoaded",value:function(){this.state===State.KEY_LOADING&&(this.state=State.IDLE,this.tick())}},{key:"onFragLoaded",value:function(e){var t=this.fragCurrent;if(this.state===State.FRAG_LOADING&&t&&e.frag.level===t.level&&e.frag.sn===t.sn)if(this.fragBitrateTest===!0)this.state=State.IDLE,this.fragBitrateTest=!1,e.stats.tparsed=e.stats.tbuffered=performance.now(),this.hls.trigger(_events2["default"].FRAG_BUFFERED,{stats:e.stats,frag:t});else{this.state=State.PARSING,this.stats=e.stats;var a=this.levels[this.level],r=a.details,i=r.totalduration,s=t.start,n=t.level,o=t.sn,l=a.audioCodec||this.config.defaultAudioCodec;this.audioCodecSwap&&(_logger.logger.log("swapping playlist audio codec"),void 0===l&&(l=this.lastAudioCodec),l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingAppending=0,_logger.logger.log("Demuxing "+o+" of ["+r.startSN+" ,"+r.endSN+"],level "+n);var d=this.demuxer;d&&d.push(e.payload,l,a.videoCodec,s,t.cc,n,o,i,t.decryptdata)}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function(e){if(this.state===State.PARSING){var t,a,r=e.tracks;if(a=r.audio){var i=this.levels[this.level].audioCodec,s=navigator.userAgent.toLowerCase();i&&this.audioCodecSwap&&(_logger.logger.log("swapping playlist audio codec"),i=-1!==i.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===s.indexOf("firefox")&&(i="mp4a.40.5"),-1!==s.indexOf("android")&&(i="mp4a.40.2",_logger.logger.log("Android: force audio codec to"+i)),a.levelCodec=i}if(a=r.video,a&&(a.levelCodec=this.levels[this.level].videoCodec),e.unique){var n={codec:"",levelCodec:""};for(t in e.tracks)a=r[t],n.container=a.container,n.codec&&(n.codec+=",",n.levelCodec+=","),a.codec&&(n.codec+=a.codec),a.levelCodec&&(n.levelCodec+=a.levelCodec);r={audiovideo:n}}this.hls.trigger(_events2["default"].BUFFER_CODECS,r);for(t in r){a=r[t],_logger.logger.log("track:"+t+",container:"+a.container+",codecs[level/parsed]=["+a.levelCodec+"/"+a.codec+"]");
var o=a.initSegment;o&&(this.pendingAppending++,this.hls.trigger(_events2["default"].BUFFER_APPENDING,{type:t,data:o}))}this.tick()}}},{key:"onFragParsingData",value:function(e){var t=this;if(this.state===State.PARSING){this.tparse2=Date.now();var a=this.levels[this.level],r=this.fragCurrent;_logger.logger.log("parsed "+e.type+",PTS:["+e.startPTS.toFixed(3)+","+e.endPTS.toFixed(3)+"],DTS:["+e.startDTS.toFixed(3)+"/"+e.endDTS.toFixed(3)+"],nb:"+e.nb);var i=_levelHelper2["default"].updateFragPTS(a.details,r.sn,e.startPTS,e.endPTS),s=this.hls;s.trigger(_events2["default"].LEVEL_PTS_UPDATED,{details:a.details,level:this.level,drift:i}),[e.data1,e.data2].forEach(function(a){a&&(t.pendingAppending++,s.trigger(_events2["default"].BUFFER_APPENDING,{type:e.type,data:a}))}),this.nextLoadPosition=e.endPTS,this.bufferRange.push({type:e.type,start:e.startPTS,end:e.endPTS,frag:r}),this.tick()}else _logger.logger.warn("not in PARSING state but "+this.state+", ignoring FRAG_PARSING_DATA event")}},{key:"onFragParsed",value:function(){this.state===State.PARSING&&(this.stats.tparsed=performance.now(),this.state=State.PARSED,this._checkAppendedParsed())}},{key:"onBufferAppended",value:function(){switch(this.state){case State.PARSING:case State.PARSED:this.pendingAppending--,this._checkAppendedParsed()}}},{key:"_checkAppendedParsed",value:function(){if(this.state===State.PARSED&&0===this.pendingAppending){var e=this.fragCurrent,t=this.stats;e&&(this.fragPrevious=e,t.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*t.length/(t.tbuffered-t.tfirst)),this.hls.trigger(_events2["default"].FRAG_BUFFERED,{stats:t,frag:e}),_logger.logger.log("media buffered : "+this.timeRangesToString(this.media.buffered)),this.state=State.IDLE),this.tick()}}},{key:"onError",value:function(e){switch(e.details){case _errors.ErrorDetails.FRAG_LOAD_ERROR:case _errors.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var t=this.fragLoadError;if(t?t++:t=1,t<=this.config.fragLoadingMaxRetry){this.fragLoadError=t,e.frag.loadCounter=0;var a=Math.min(Math.pow(2,t-1)*this.config.fragLoadingRetryDelay,64e3);_logger.logger.warn("mediaController: frag loading failed, retry in "+a+" ms"),this.retryDate=performance.now()+a,this.state=State.FRAG_LOADING_WAITING_RETRY}else _logger.logger.error("mediaController: "+e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.trigger(_events2["default"].ERROR,e),this.state=State.ERROR}break;case _errors.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_ERROR:case _errors.ErrorDetails.LEVEL_LOAD_TIMEOUT:case _errors.ErrorDetails.KEY_LOAD_ERROR:case _errors.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==State.ERROR&&(this.state=e.fatal?State.ERROR:State.IDLE,_logger.logger.warn("mediaController: "+e.details+" while loading frag,switch to "+this.state+" state ..."));break;case _errors.ErrorDetails.BUFFER_FULL_ERROR:this.config.maxMaxBufferLength/=2,_logger.logger.warn("reduce max buffer length to "+this.config.maxMaxBufferLength+"s and trigger a nextLevelSwitch to flush old buffer and fix QuotaExceededError"),this.nextLevelSwitch()}}},{key:"_checkBuffer",value:function(){var e=this.media;if(e){var t=e.readyState;if(t){var a,r,i=this.seekAfterBuffered;if(i)e.duration>=i&&(a=i,this.seekAfterBuffered=void 0);else{r=e.currentTime;var s=this.loadedmetadata;!s&&e.buffered.length&&(this.loadedmetadata=!0,r||r===this.startPosition||(a=this.startPosition))}a&&(r=a,_logger.logger.log("target seek position:"+a));var n=_bufferHelper2["default"].bufferInfo(e,r,0),o=!(e.paused||e.ended||e.seeking||2>t),l=.4,d=r>e.playbackRate*this.lastCurrentTime;if(this.stalled&&d&&(this.stalled=!1,_logger.logger.log("playback not stuck anymore @"+r)),o&&n.len<=l){if(d?(l=0,this.seekHoleNudgeDuration=0):this.stalled?this.seekHoleNudgeDuration+=this.config.SeekHoleNudgeDuration:(this.seekHoleNudgeDuration=0,_logger.logger.log("playback seems stuck @"+r),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1}),this.stalled=!0),n.len<=l){var g=n.nextStart,f=g-r;if(g&&f<this.config.maxSeekHole&&f>0&&!e.seeking){_logger.logger.log("adjust currentTime from "+e.currentTime+" to next buffered @ "+g+" + nudge "+this.seekHoleNudgeDuration);var h=g+this.seekHoleNudgeDuration-e.currentTime;e.currentTime=g+this.seekHoleNudgeDuration,this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:h})}}}else a&&e.currentTime!==a&&(_logger.logger.log("adjust currentTime from "+e.currentTime+" to "+a),e.currentTime=a)}}}},{key:"onFragLoadEmergencyAborted",value:function(){this.state=State.IDLE,this.tick()}},{key:"onBufferFlushed",value:function(){var e,t,a=[];for(t=0;t<this.bufferRange.length;t++)e=this.bufferRange[t],this.isBuffered((e.start+e.end)/2)&&a.push(e);this.bufferRange=a,this.immediateSwitch&&this.immediateLevelSwitchEnd(),this.state=State.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"timeRangesToString",value:function(e){for(var t="",a=e.length,r=0;a>r;r++)t+="["+e.start(r)+","+e.end(r)+"]";return t}},{key:"currentLevel",get:function(){if(this.media){var e=this.getBufferRange(this.media.currentTime);if(e)return e.frag.level}return-1}},{key:"nextBufferRange",get:function(){return this.media?this.followingBufferRange(this.getBufferRange(this.media.currentTime)):null}},{key:"nextLevel",get:function(){var e=this.nextBufferRange;return e?e.frag.level:-1}}]),t}(_eventHandler2["default"]);exports["default"]=StreamController},{"../demux/demuxer":25,"../errors":29,"../event-handler":30,"../events":31,"../helper/buffer-helper":32,"../helper/level-helper":33,"../utils/binary-search":43,"../utils/logger":45}],17:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_cea708Interpreter=_dereq_("../utils/cea-708-interpreter"),_cea708Interpreter2=_interopRequireDefault(_cea708Interpreter),TimelineController=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2["default"].MEDIA_ATTACHING,_events2["default"].MEDIA_DETACHING,_events2["default"].FRAG_PARSING_USERDATA,_events2["default"].MANIFEST_LOADING,_events2["default"].FRAG_LOADED));return r.hls=e,r.config=e.config,r.config.enableCEA708Captions&&(r.cea708Interpreter=new _cea708Interpreter2["default"]),r}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){_eventHandler2["default"].prototype.destroy.call(this)}},{key:"onMediaAttaching",value:function(e){var t=this.media=e.media;this.cea708Interpreter.attach(t)}},{key:"onMediaDetaching",value:function(){this.cea708Interpreter.detach()}},{key:"onManifestLoading",value:function(){this.lastPts=Number.POSITIVE_INFINITY}},{key:"onFragLoaded",value:function(e){var t=e.frag.start;t<=this.lastPts&&this.cea708Interpreter.clear(),this.lastPts=t}},{key:"onFragParsingUserdata",value:function(e){for(var t=0;t<e.samples.length;t++)this.cea708Interpreter.push(e.samples[t].pts,e.samples[t].bytes)}}]),t}(_eventHandler2["default"]);exports["default"]=TimelineController},{"../event-handler":30,"../events":31,"../utils/cea-708-interpreter":44}],18:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),AES=function(){function e(t){_classCallCheck(this,e),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var r,a,s,n,l,o=this._tables[0][4],i=this._tables[1],c=t.length,f=1;if(4!==c&&6!==c&&8!==c)throw new Error("Invalid aes key size="+c);for(n=t.slice(0),l=[],this._key=[n,l],r=c;4*c+28>r;r++)s=n[r-1],(r%c===0||8===c&&r%c===4)&&(s=o[s>>>24]<<24^o[s>>16&255]<<16^o[s>>8&255]<<8^o[255&s],r%c===0&&(s=s<<8^s>>>24^f<<24,f=f<<1^283*(f>>7))),n[r]=n[r-c]^s;for(a=0;r;a++,r--)s=n[3&a?r:r-4],4>=r||4>a?l[a]=s:l[a]=i[0][o[s>>>24]]^i[1][o[s>>16&255]]^i[2][o[s>>8&255]]^i[3][o[255&s]]}return _createClass(e,[{key:"_precompute",value:function(){var e,t,r,a,s,n,l,o,i,c=this._tables[0],f=this._tables[1],u=c[4],h=f[4],_=[],b=[];for(e=0;256>e;e++)b[(_[e]=e<<1^283*(e>>7))^e]=e;for(t=r=0;!u[t];t^=a||1,r=b[r]||1)for(l=r^r<<1^r<<2^r<<3^r<<4,l=l>>8^255&l^99,u[t]=l,h[l]=t,n=_[s=_[a=_[t]]],i=16843009*n^65537*s^257*a^16843008*t,o=257*_[l]^16843008*l,e=0;4>e;e++)c[e][t]=o=o<<24^o>>>8,f[e][l]=i=i<<24^i>>>8;for(e=0;5>e;e++)c[e]=c[e].slice(0),f[e]=f[e].slice(0)}},{key:"decrypt",value:function(e,t,r,a,s,n){var l,o,i,c,f=this._key[1],u=e^f[0],h=a^f[1],_=r^f[2],b=t^f[3],p=f.length/4-2,v=4,y=this._tables[1],k=y[0],C=y[1],d=y[2],w=y[3],g=y[4];for(c=0;p>c;c++)l=k[u>>>24]^C[h>>16&255]^d[_>>8&255]^w[255&b]^f[v],o=k[h>>>24]^C[_>>16&255]^d[b>>8&255]^w[255&u]^f[v+1],i=k[_>>>24]^C[b>>16&255]^d[u>>8&255]^w[255&h]^f[v+2],b=k[b>>>24]^C[u>>16&255]^d[h>>8&255]^w[255&_]^f[v+3],v+=4,u=l,h=o,_=i;for(c=0;4>c;c++)s[(3&-c)+n]=g[u>>>24]<<24^g[h>>16&255]<<16^g[_>>8&255]<<8^g[255&b]^f[v++],l=u,u=h,h=_,_=b,b=l}}]),e}();exports["default"]=AES},{}],19:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_aes=_dereq_("./aes"),_aes2=_interopRequireDefault(_aes),AES128Decrypter=function(){function e(t,r){_classCallCheck(this,e),this.key=t,this.iv=r}return _createClass(e,[{key:"ntoh",value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24}},{key:"doDecrypt",value:function(e,t,r){var n,a,i,o,s,u,h,l,c,y=new Int32Array(e.buffer,e.byteOffset,e.byteLength>>2),f=new _aes2["default"](Array.prototype.slice.call(t)),p=new Uint8Array(e.byteLength),b=new Int32Array(p.buffer);for(n=~~r[0],a=~~r[1],i=~~r[2],o=~~r[3],c=0;c<y.length;c+=4)s=~~this.ntoh(y[c]),u=~~this.ntoh(y[c+1]),h=~~this.ntoh(y[c+2]),l=~~this.ntoh(y[c+3]),f.decrypt(s,u,h,l,b,c),b[c]=this.ntoh(b[c]^n),b[c+1]=this.ntoh(b[c+1]^a),b[c+2]=this.ntoh(b[c+2]^i),b[c+3]=this.ntoh(b[c+3]^o),n=s,a=u,i=h,o=l;return p}},{key:"localDecrypt",value:function(e,t,r,n){var a=this.doDecrypt(e,t,r);n.set(a,e.byteOffset)}},{key:"decrypt",value:function(e){var t=32e3,r=new Int32Array(e),n=new Uint8Array(e.byteLength),a=0,i=this.key,o=this.iv;for(this.localDecrypt(r.subarray(a,a+t),i,o,n),a=t;a<r.length;a+=t)o=new Uint32Array([this.ntoh(r[a-4]),this.ntoh(r[a-3]),this.ntoh(r[a-2]),this.ntoh(r[a-1])]),this.localDecrypt(r.subarray(a,a+t),i,o,n);return n}}]),e}();exports["default"]=AES128Decrypter},{"./aes":18}],20:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),_aes128Decrypter=_dereq_("./aes128-decrypter"),_aes128Decrypter2=_interopRequireDefault(_aes128Decrypter),_errors=_dereq_("../errors"),_logger=_dereq_("../utils/logger"),Decrypter=function(){function e(r){_classCallCheck(this,e),this.hls=r;try{var t=window?window.crypto:crypto;this.subtle=t.subtle||t.webkitSubtle,this.disableWebCrypto=!this.subtle}catch(n){this.disableWebCrypto=!0}}return _createClass(e,[{key:"destroy",value:function(){}},{key:"decrypt",value:function(e,r,t,n){this.disableWebCrypto&&this.hls.config.enableSoftwareAES?this.decryptBySoftware(e,r,t,n):this.decryptByWebCrypto(e,r,t,n)}},{key:"decryptByWebCrypto",value:function(e,r,t,n){var o=this;_logger.logger.log("decrypting by WebCrypto API"),this.subtle.importKey("raw",r,{name:"AES-CBC",length:128},!1,["decrypt"]).then(function(i){o.subtle.decrypt({name:"AES-CBC",iv:t.buffer},i,e).then(n)["catch"](function(i){o.onWebCryptoError(i,e,r,t,n)})})["catch"](function(i){o.onWebCryptoError(i,e,r,t,n)})}},{key:"decryptBySoftware",value:function(e,r,t,n){_logger.logger.log("decrypting by JavaScript Implementation");var o=new DataView(r.buffer),i=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]);o=new DataView(t.buffer);var a=new Uint32Array([o.getUint32(0),o.getUint32(4),o.getUint32(8),o.getUint32(12)]),s=new _aes128Decrypter2["default"](i,a);n(s.decrypt(e).buffer)}},{key:"onWebCryptoError",value:function(e,r,t,n,o){this.hls.config.enableSoftwareAES?(_logger.logger.log("disabling to use WebCrypto API"),this.disableWebCrypto=!0,this.decryptBySoftware(r,t,n,o)):(_logger.logger.error("decrypting error : "+e.message),this.hls.trigger(Event.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message}))}}]),e}();exports["default"]=Decrypter},{"../errors":29,"../utils/logger":45,"./aes128-decrypter":19}],21:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,a){if(!(e instanceof a))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,a){for(var t=0;t<a.length;t++){var r=a[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(a,t,r){return t&&e(a.prototype,t),r&&e(a,r),a}}(),_adts=_dereq_("./adts"),_adts2=_interopRequireDefault(_adts),_logger=_dereq_("../utils/logger"),_id=_dereq_("../demux/id3"),_id2=_interopRequireDefault(_id),AACDemuxer=function(){function e(a,t){_classCallCheck(this,e),this.observer=a,this.remuxerClass=t,this.remuxer=new this.remuxerClass(a),this._aacTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0}}return _createClass(e,[{key:"push",value:function(e,a,t,r,n,u,s,i){var l,o,c,d,f,p,h,m,_,g=this._aacTrack,C=new _id2["default"](e),b=90*C.timeStamp;for(f=C.length,m=e.length;m-1>f&&(255!==e[f]||240!==(240&e[f+1]));f++);for(g.audiosamplerate||(l=_adts2["default"].getAudioConfig(this.observer,e,f,a),g.config=l.config,g.audiosamplerate=l.samplerate,g.channelCount=l.channelCount,g.codec=l.codec,g.duration=i,_logger.logger.log("parsed codec:"+g.codec+",rate:"+l.samplerate+",nb channel:"+l.channelCount)),d=0,c=9216e4/g.audiosamplerate;m>f+5&&(p=1&e[f+1]?7:9,o=(3&e[f+3])<<11|e[f+4]<<3|(224&e[f+5])>>>5,o-=p,o>0&&m>=f+p+o);)for(h=b+d*c,_={unit:e.subarray(f+p,f+p+o),pts:h,dts:h},g.samples.push(_),g.len+=o,f+=o+p,d++;m-1>f&&(255!==e[f]||240!==(240&e[f+1]));f++);this.remuxer.remux(this._aacTrack,{samples:[]},{samples:[{pts:b,dts:b,unit:C.payload}]},{samples:[]},r)}},{key:"destroy",value:function(){}}],[{key:"probe",value:function(e){var a,t,r=new _id2["default"](e);if(r.hasTimeStamp)for(a=r.length,t=e.length;t-1>a;a++)if(255===e[a]&&240===(240&e[a+1]))return!0;return!1}}]),e}();exports["default"]=AACDemuxer},{"../demux/id3":27,"../utils/logger":45,"./adts":22}],22:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var n=0;n<r.length;n++){var a=r[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,n,a){return n&&e(r.prototype,n),a&&e(r,a),r}}(),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),ADTS=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getAudioConfig",value:function(e,r,n,a){var t,o,i,l,s,c=navigator.userAgent.toLowerCase(),u=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return t=((192&r[n+2])>>>6)+1,o=(60&r[n+2])>>>2,o>u.length-1?void e.trigger(Event.ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+o}):(l=(1&r[n+2])<<2,l|=(192&r[n+3])>>>6,_logger.logger.log("manifest codec:"+a+",ADTS data:type:"+t+",sampleingIndex:"+o+"["+u[o]+"Hz],channelConfig:"+l),-1!==c.indexOf("firefox")?o>=6?(t=5,s=new Array(4),i=o-3):(t=2,s=new Array(2),i=o):-1!==c.indexOf("android")?(t=2,s=new Array(2),i=o):(t=5,s=new Array(4),a&&(-1!==a.indexOf("mp4a.40.29")||-1!==a.indexOf("mp4a.40.5"))||!a&&o>=6?i=o-3:((a&&-1!==a.indexOf("mp4a.40.2")&&o>=6&&1===l||!a&&1===l)&&(t=2,s=new Array(2)),i=o)),s[0]=t<<3,s[0]|=(14&o)>>1,s[1]|=(1&o)<<7,s[1]|=l<<3,5===t&&(s[1]|=(14&i)>>1,s[2]=(1&i)<<7,s[2]|=8,s[3]=0),{config:s,samplerate:u[o],channelCount:l,codec:"mp4a.40."+t})}}]),e}();exports["default"]=ADTS},{"../errors":29,"../utils/logger":45}],23:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var u=0;u<r.length;u++){var t=r[u];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}return function(r,u,t){return u&&e(r.prototype,u),t&&e(r,t),r}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_errors=_dereq_("../errors"),_aacdemuxer=_dereq_("../demux/aacdemuxer"),_aacdemuxer2=_interopRequireDefault(_aacdemuxer),_tsdemuxer=_dereq_("../demux/tsdemuxer"),_tsdemuxer2=_interopRequireDefault(_tsdemuxer),_mp4Remuxer=_dereq_("../remux/mp4-remuxer"),_mp4Remuxer2=_interopRequireDefault(_mp4Remuxer),_passthroughRemuxer=_dereq_("../remux/passthrough-remuxer"),_passthroughRemuxer2=_interopRequireDefault(_passthroughRemuxer),DemuxerInline=function(){function e(r,u){_classCallCheck(this,e),this.hls=r,this.typeSupported=u}return _createClass(e,[{key:"destroy",value:function(){var e=this.demuxer;e&&e.destroy()}},{key:"push",value:function(e,r,u,t,a,s,n,i){var o=this.demuxer;if(!o){var l=this.hls;if(_tsdemuxer2["default"].probe(e))o=this.typeSupported.mp2t===!0?new _tsdemuxer2["default"](l,_passthroughRemuxer2["default"]):new _tsdemuxer2["default"](l,_mp4Remuxer2["default"]);else{if(!_aacdemuxer2["default"].probe(e))return void l.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});o=new _aacdemuxer2["default"](l,_mp4Remuxer2["default"])}this.demuxer=o}o.push(e,r,u,t,a,s,n,i)}}]),e}();exports["default"]=DemuxerInline},{"../demux/aacdemuxer":21,"../demux/tsdemuxer":28,"../errors":29,"../events":31,"../remux/mp4-remuxer":40,"../remux/passthrough-remuxer":41}],24:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var _demuxerInline=_dereq_("../demux/demuxer-inline"),_demuxerInline2=_interopRequireDefault(_demuxerInline),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_events3=_dereq_("events"),_events4=_interopRequireDefault(_events3),DemuxerWorker=function(e){var t=new _events4["default"];t.trigger=function(e){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;n>r;r++)a[r-1]=arguments[r];t.emit.apply(t,[e,e].concat(a))},t.off=function(e){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;n>r;r++)a[r-1]=arguments[r];t.removeListener.apply(t,[e].concat(a))},e.addEventListener("message",function(n){var a=n.data;switch(a.cmd){case"init":e.demuxer=new _demuxerInline2["default"](t,a.typeSupported);break;case"demux":e.demuxer.push(new Uint8Array(a.data),a.audioCodec,a.videoCodec,a.timeOffset,a.cc,a.level,a.sn,a.duration)}}),t.on(_events2["default"].FRAG_PARSING_INIT_SEGMENT,function(t,n){e.postMessage({event:t,tracks:n.tracks,unique:n.unique})}),t.on(_events2["default"].FRAG_PARSING_DATA,function(t,n){var a={event:t,type:n.type,startPTS:n.startPTS,endPTS:n.endPTS,startDTS:n.startDTS,endDTS:n.endDTS,data1:n.data1.buffer,data2:n.data2.buffer,nb:n.nb};e.postMessage(a,[a.data1,a.data2])}),t.on(_events2["default"].FRAG_PARSED,function(t){e.postMessage({event:t})}),t.on(_events2["default"].ERROR,function(t,n){e.postMessage({event:t,data:n})}),t.on(_events2["default"].FRAG_PARSING_METADATA,function(t,n){var a={event:t,samples:n.samples};e.postMessage(a)}),t.on(_events2["default"].FRAG_PARSING_USERDATA,function(t,n){var a={event:t,samples:n.samples};e.postMessage(a)})};exports["default"]=DemuxerWorker},{"../demux/demuxer-inline":23,"../events":31,events:11}],25:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,r,s){return r&&e(t.prototype,r),s&&e(t,s),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_demuxerInline=_dereq_("../demux/demuxer-inline"),_demuxerInline2=_interopRequireDefault(_demuxerInline),_demuxerWorker=_dereq_("../demux/demuxer-worker"),_demuxerWorker2=_interopRequireDefault(_demuxerWorker),_logger=_dereq_("../utils/logger"),_decrypter=_dereq_("../crypt/decrypter"),_decrypter2=_interopRequireDefault(_decrypter),Demuxer=function(){function e(t){_classCallCheck(this,e),this.hls=t;var r={mp4:MediaSource.isTypeSupported("video/mp4"),mp2t:t.config.enableMP2TPassThrough&&MediaSource.isTypeSupported("video/mp2t")};if(t.config.enableWorker&&"undefined"!=typeof Worker){_logger.logger.log("demuxing in webworker");try{var s=_dereq_("webworkify");this.w=s(_demuxerWorker2["default"]),this.onwmsg=this.onWorkerMessage.bind(this),this.w.addEventListener("message",this.onwmsg),this.w.postMessage({cmd:"init",typeSupported:r})}catch(i){_logger.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),this.demuxer=new _demuxerInline2["default"](t,r)}}else this.demuxer=new _demuxerInline2["default"](t,r);this.demuxInitialized=!0}return _createClass(e,[{key:"destroy",value:function(){this.w?(this.w.removeEventListener("message",this.onwmsg),this.w.terminate(),this.w=null):(this.demuxer.destroy(),this.demuxer=null),this.decrypter&&(this.decrypter.destroy(),this.decrypter=null)}},{key:"pushDecrypted",value:function(e,t,r,s,i,n,u,a){this.w?this.w.postMessage({cmd:"demux",data:e,audioCodec:t,videoCodec:r,timeOffset:s,cc:i,level:n,sn:u,duration:a},[e]):this.demuxer.push(new Uint8Array(e),t,r,s,i,n,u,a)}},{key:"push",value:function(e,t,r,s,i,n,u,a,l){if(e.byteLength>0&&null!=l&&null!=l.key&&"AES-128"===l.method){null==this.decrypter&&(this.decrypter=new _decrypter2["default"](this.hls));var d=this;this.decrypter.decrypt(e,l.key,l.iv,function(e){d.pushDecrypted(e,t,r,s,i,n,u,a)})}else this.pushDecrypted(e,t,r,s,i,n,u,a)}},{key:"onWorkerMessage",value:function(e){var t=e.data;switch(t.event){case _events2["default"].FRAG_PARSING_INIT_SEGMENT:var r={};r.tracks=t.tracks,r.unique=t.unique,this.hls.trigger(_events2["default"].FRAG_PARSING_INIT_SEGMENT,r);break;case _events2["default"].FRAG_PARSING_DATA:this.hls.trigger(_events2["default"].FRAG_PARSING_DATA,{data1:new Uint8Array(t.data1),data2:new Uint8Array(t.data2),startPTS:t.startPTS,endPTS:t.endPTS,startDTS:t.startDTS,endDTS:t.endDTS,type:t.type,nb:t.nb});break;case _events2["default"].FRAG_PARSING_METADATA:this.hls.trigger(_events2["default"].FRAG_PARSING_METADATA,{samples:t.samples});break;case _events2["default"].FRAG_PARSING_USERDATA:this.hls.trigger(_events2["default"].FRAG_PARSING_USERDATA,{samples:t.samples});break;default:this.hls.trigger(t.event,t.data)}}}]),e}();exports["default"]=Demuxer},{"../crypt/decrypter":20,"../demux/demuxer-inline":23,"../demux/demuxer-worker":24,"../events":31,"../utils/logger":45,webworkify:48}],26:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var a=i[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(i,t,a){return t&&e(i.prototype,t),a&&e(i,a),i}}(),_logger=_dereq_("../utils/logger"),ExpGolomb=function(){function e(i){_classCallCheck(this,e),this.data=i,this.bytesAvailable=this.data.byteLength,this.word=0,this.bitsAvailable=0}return _createClass(e,[{key:"loadWord",value:function(){var e=this.data.byteLength-this.bytesAvailable,i=new Uint8Array(4),t=Math.min(4,this.bytesAvailable);if(0===t)throw new Error("no bytes available");i.set(this.data.subarray(e,e+t)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*t,this.bytesAvailable-=t}},{key:"skipBits",value:function(e){var i;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,i=e>>3,e-=i>>3,this.bytesAvailable-=i,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}},{key:"readBits",value:function(e){var i=Math.min(this.bitsAvailable,e),t=this.word>>>32-i;return e>32&&_logger.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=i,this.bitsAvailable>0?this.word<<=i:this.bytesAvailable>0&&this.loadWord(),i=e-i,i>0?t<<i|this.readBits(i):t}},{key:"skipLZ",value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}},{key:"skipUEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function(){var e=this.skipLZ();return this.readBits(e+1)-1}},{key:"readEG",value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}},{key:"readBoolean",value:function(){return 1===this.readBits(1)}},{key:"readUByte",value:function(){return this.readBits(8)}},{key:"readUShort",value:function(){return this.readBits(16)}},{key:"readUInt",value:function(){return this.readBits(32)}},{key:"skipScalingList",value:function(e){var i,t,a=8,s=8;for(i=0;e>i;i++)0!==s&&(t=this.readEG(),s=(a+t+256)%256),a=0===s?a:s}},{key:"readSPS",value:function(){var e,i,t,a,s,r,h,l,n,o=0,d=0,b=0,u=0,k=1;if(this.readUByte(),e=this.readUByte(),i=this.readBits(5),this.skipBits(3),t=this.readUByte(),this.skipUEG(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var c=this.readUEG();if(3===c&&this.skipBits(1),this.skipUEG(),this.skipUEG(),this.skipBits(1),this.readBoolean())for(l=3!==c?8:12,n=0;l>n;n++)this.readBoolean()&&(6>n?this.skipScalingList(16):this.skipScalingList(64))}this.skipUEG();var v=this.readUEG();if(0===v)this.readUEG();else if(1===v)for(this.skipBits(1),this.skipEG(),this.skipEG(),a=this.readUEG(),n=0;a>n;n++)this.skipEG();if(this.skipUEG(),this.skipBits(1),s=this.readUEG(),r=this.readUEG(),h=this.readBits(1),0===h&&this.skipBits(1),this.skipBits(1),this.readBoolean()&&(o=this.readUEG(),d=this.readUEG(),b=this.readUEG(),u=this.readUEG()),this.readBoolean()&&this.readBoolean()){var f=void 0,y=this.readUByte();switch(y){case 1:f=[1,1];break;case 2:f=[12,11];break;case 3:f=[10,11];break;case 4:f=[16,11];break;case 5:f=[40,33];break;case 6:f=[24,11];break;case 7:f=[20,11];break;case 8:f=[32,11];break;case 9:f=[80,33];break;case 10:f=[18,11];break;case 11:f=[15,11];break;case 12:f=[64,33];break;case 13:f=[160,99];break;case 14:f=[4,3];break;case 15:f=[3,2];break;case 16:f=[2,1];break;case 255:f=[this.readUByte()<<8|this.readUByte(),this.readUByte()<<8|this.readUByte()]}f&&(k=f[0]/f[1])}return{width:Math.ceil((16*(s+1)-2*o-2*d)*k),height:(2-h)*(r+1)*16-(h?2:4)*(b+u)}}},{key:"readSliceType",value:function(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();exports["default"]=ExpGolomb},{"../utils/logger":45}],27:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_logger=_dereq_("../utils/logger"),ID3=function(){function e(t){_classCallCheck(this,e),this._hasTimeStamp=!1;for(var r,a,n,i,o,s,l,u,h=0;;)if(l=this.readUTF(t,h,3),h+=3,"ID3"===l)h+=3,r=127&t[h++],a=127&t[h++],n=127&t[h++],i=127&t[h++],o=(r<<21)+(a<<14)+(n<<7)+i,s=h+o,this._parseID3Frames(t,h,s),h=s;else{if("3DI"!==l)return h-=3,u=h,void(u&&(this.hasTimeStamp||_logger.logger.warn("ID3 tag found, but no timestamp"),this._length=u,this._payload=t.subarray(0,u)));h+=7,_logger.logger.log("3DI footer found, end: "+h)}}return _createClass(e,[{key:"readUTF",value:function(e,t,r){var a="",n=t,i=t+r;do a+=String.fromCharCode(e[n++]);while(i>n);return a}},{key:"_parseID3Frames",value:function(e,t,r){for(var a,n,i,o,s;r>=t+8;)switch(a=this.readUTF(e,t,4),t+=4,n=e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],o=e[t++]<<8+e[t++],i=t,a){case"PRIV":if("com.apple.streaming.transportStreamTimestamp"===this.readUTF(e,t,44)){t+=44,t+=4;var l=1&e[t++];this._hasTimeStamp=!0,s=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,l&&(s+=47721858.84),s=Math.round(s),_logger.logger.trace("ID3 timestamp found: "+s),this._timeStamp=s}}}},{key:"hasTimeStamp",get:function(){return this._hasTimeStamp}},{key:"timeStamp",get:function(){return this._timeStamp}},{key:"length",get:function(){return this._length}},{key:"payload",get:function(){return this._payload}}]),e}();exports["default"]=ID3},{"../utils/logger":45}],28:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");
}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var s=t[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,a,s){return a&&e(t.prototype,a),s&&e(t,s),t}}(),_adts=_dereq_("./adts"),_adts2=_interopRequireDefault(_adts),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_expGolomb=_dereq_("./exp-golomb"),_expGolomb2=_interopRequireDefault(_expGolomb),_logger=_dereq_("../utils/logger"),_errors=_dereq_("../errors"),TSDemuxer=function(){function e(t,a){_classCallCheck(this,e),this.observer=t,this.remuxerClass=a,this.lastCC=0,this.remuxer=new this.remuxerClass(t)}return _createClass(e,[{key:"switchLevel",value:function(){this.pmtParsed=!1,this._pmtId=-1,this.lastAacPTS=null,this.aacOverFlow=null,this._avcTrack={container:"video/mp2t",type:"video",id:-1,sequenceNumber:0,samples:[],len:0,nbNalu:0},this._aacTrack={container:"video/mp2t",type:"audio",id:-1,sequenceNumber:0,samples:[],len:0},this._id3Track={type:"id3",id:-1,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,sequenceNumber:0,samples:[],len:0},this.remuxer.switchLevel()}},{key:"insertDiscontinuity",value:function(){this.switchLevel(),this.remuxer.insertDiscontinuity()}},{key:"push",value:function(e,t,a,s,r,i,n,u){var l,h,o,c,d,p,_,f,g=e.length,v=this.remuxer.passthrough;this.audioCodec=t,this.videoCodec=a,this.timeOffset=s,this._duration=u,this.contiguous=!1,r!==this.lastCC?(_logger.logger.log("discontinuity detected"),this.insertDiscontinuity(),this.lastCC=r):i!==this.lastLevel?(_logger.logger.log("level switch detected"),this.switchLevel(),this.lastLevel=i):n===this.lastSN+1&&(this.contiguous=!0),this.lastSN=n,this.contiguous||(this.aacOverFlow=null);var y=this.pmtParsed,b=this._avcTrack.id,k=this._aacTrack.id,m=this._id3Track.id;for(g-=g%188,c=0;g>c;c+=188)if(71===e[c]){if(d=!!(64&e[c+1]),p=((31&e[c+1])<<8)+e[c+2],_=(48&e[c+3])>>4,_>1){if(f=c+5+e[c+4],f===c+188)continue}else f=c+4;if(y)if(p===b){if(d){if(l&&(this._parseAVCPES(this._parsePES(l)),v&&this._avcTrack.codec&&(-1===k||this._aacTrack.codec)))return void this.remux(e);l={data:[],size:0}}l&&(l.data.push(e.subarray(f,c+188)),l.size+=c+188-f)}else if(p===k){if(d){if(h&&(this._parseAACPES(this._parsePES(h)),v&&this._aacTrack.codec&&(-1===b||this._avcTrack.codec)))return void this.remux(e);h={data:[],size:0}}h&&(h.data.push(e.subarray(f,c+188)),h.size+=c+188-f)}else p===m&&(d&&(o&&this._parseID3PES(this._parsePES(o)),o={data:[],size:0}),o&&(o.data.push(e.subarray(f,c+188)),o.size+=c+188-f));else d&&(f+=e[f]+1),0===p?this._parsePAT(e,f):p===this._pmtId&&(this._parsePMT(e,f),y=this.pmtParsed=!0,b=this._avcTrack.id,k=this._aacTrack.id,m=this._id3Track.id)}else this.observer.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});l&&this._parseAVCPES(this._parsePES(l)),h&&this._parseAACPES(this._parsePES(h)),o&&this._parseID3PES(this._parsePES(o)),this.remux(null)}},{key:"remux",value:function(e){this.remuxer.remux(this._aacTrack,this._avcTrack,this._id3Track,this._txtTrack,this.timeOffset,this.contiguous,e)}},{key:"destroy",value:function(){this.switchLevel(),this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function(e,t){this._pmtId=(31&e[t+10])<<8|e[t+11]}},{key:"_parsePMT",value:function(e,t){var a,s,r,i;for(a=(15&e[t+1])<<8|e[t+2],s=t+3+a-4,r=(15&e[t+10])<<8|e[t+11],t+=12+r;s>t;){switch(i=(31&e[t+1])<<8|e[t+2],e[t]){case 15:this._aacTrack.id=i;break;case 21:this._id3Track.id=i;break;case 27:this._avcTrack.id=i;break;default:_logger.logger.log("unkown stream type:"+e[t])}t+=((15&e[t+3])<<8|e[t+4])+5}}},{key:"_parsePES",value:function(e){var t,a,s,r,i,n,u,l,h,o=0,c=e.data;if(t=c[0],s=(t[0]<<16)+(t[1]<<8)+t[2],1===s){for(r=(t[4]<<8)+t[5],a=t[7],192&a&&(u=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,u>4294967295&&(u-=8589934592),64&a?(l=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,l>4294967295&&(l-=8589934592)):l=u),i=t[8],h=i+9,e.size-=h,n=new Uint8Array(e.size);c.length;){t=c.shift();var d=t.byteLength;if(h){if(h>d){h-=d;continue}t=t.subarray(h),d-=h,h=0}n.set(t,o),o+=d}return{data:n,pts:u,dts:l,len:r}}return null}},{key:"_parseAVCPES",value:function(e){var t,a,s,r,i=this,n=this._avcTrack,u=n.samples,l=this._parseAVCNALu(e.data),h=[],o=!1,c=!1,d=0;if(0===l.length&&u.length>0){var p=u[u.length-1],_=p.units.units[p.units.units.length-1],f=new Uint8Array(_.data.byteLength+e.data.byteLength);f.set(_.data,0),f.set(e.data,_.data.byteLength),_.data=f,p.units.length+=e.data.byteLength,n.len+=e.data.byteLength}e.data=null;var g="";l.forEach(function(a){switch(a.type){case 1:s=!0,o&&(g+="NDR ");break;case 5:s=!0,o&&(g+="IDR "),c=!0;break;case 6:s=!0,o&&(g+="SEI "),t=new _expGolomb2["default"](a.data),t.readUByte();var u=t.readUByte();if(4===u){var l=0;do l=t.readUByte();while(255===l);var p=t.readUByte();if(181===p){var _=t.readUShort();if(49===_){var f=t.readUInt();if(1195456820===f){var v=t.readUByte();if(3===v){var y=t.readUByte(),b=t.readUByte(),k=31&y,m=[y,b];for(r=0;k>r;r++)m.push(t.readUByte()),m.push(t.readUByte()),m.push(t.readUByte());i._txtTrack.samples.push({type:3,pts:e.pts,bytes:m})}}}}}break;case 7:if(s=!0,o&&(g+="SPS "),!n.sps){t=new _expGolomb2["default"](a.data);var T=t.readSPS();n.width=T.width,n.height=T.height,n.sps=[a.data],n.duration=i._duration;var S=a.data.subarray(1,4),A="avc1.";for(r=0;3>r;r++){var P=S[r].toString(16);P.length<2&&(P="0"+P),A+=P}n.codec=A}break;case 8:s=!0,o&&(g+="PPS "),n.pps||(n.pps=[a.data]);break;case 9:s=!1,o&&(g+="AUD ");break;default:s=!1,g+="unknown NAL "+a.type+" "}s&&(h.push(a),d+=a.data.byteLength)}),(o||g.length)&&_logger.logger.log(g),h.length&&(c===!0||n.sps)&&(a={units:{units:h,length:d},pts:e.pts,dts:e.dts,key:c},u.push(a),n.len+=d,n.nbNalu+=h.length)}},{key:"_parseAVCNALu",value:function(e){for(var t,a,s,r,i,n,u=0,l=e.byteLength,h=0,o=[];l>u;)switch(t=e[u++],h){case 0:0===t&&(h=1);break;case 1:h=0===t?2:0;break;case 2:case 3:if(0===t)h=3;else if(1===t&&l>u){if(r=31&e[u],i)s={data:e.subarray(i,u-h-1),type:n},o.push(s);else if(a=u-h-1){var c=this._avcTrack,d=c.samples;if(d.length){var p=d[d.length-1],_=p.units.units,f=_[_.length-1],g=new Uint8Array(f.data.byteLength+a);g.set(f.data,0),g.set(e.subarray(0,a),f.data.byteLength),f.data=g,p.units.length+=a,c.len+=a}}i=u,n=r,h=0}else h=0}return i&&(s={data:e.subarray(i,l),type:n},o.push(s)),o}},{key:"_parseAACPES",value:function(e){var t,a,s,r,i,n,u,l,h,o=this._aacTrack,c=e.data,d=e.pts,p=0,_=this._duration,f=this.audioCodec,g=this.aacOverFlow,v=this.lastAacPTS;if(g){var y=new Uint8Array(g.byteLength+c.byteLength);y.set(g,0),y.set(c,g.byteLength),c=y}for(i=p,l=c.length;l-1>i&&(255!==c[i]||240!==(240&c[i+1]));i++);if(i){var b,k;if(l-1>i?(b="AAC PES did not start with ADTS header,offset:"+i,k=!1):(b="no ADTS header found in AAC PES",k=!0),this.observer.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:k,reason:b}),k)return}if(o.audiosamplerate||(t=_adts2["default"].getAudioConfig(this.observer,c,i,f),o.config=t.config,o.audiosamplerate=t.samplerate,o.channelCount=t.channelCount,o.codec=t.codec,o.duration=_,_logger.logger.log("parsed codec:"+o.codec+",rate:"+t.samplerate+",nb channel:"+t.channelCount)),r=0,s=9216e4/o.audiosamplerate,g&&v){var m=v+s;Math.abs(m-d)>1&&(_logger.logger.log("AAC: align PTS for overlapping frames by "+Math.round((m-d)/90)),d=m)}for(;l>i+5&&(n=1&c[i+1]?7:9,a=(3&c[i+3])<<11|c[i+4]<<3|(224&c[i+5])>>>5,a-=n,a>0&&l>=i+n+a);)for(u=d+r*s,h={unit:c.subarray(i+n,i+n+a),pts:u,dts:u},o.samples.push(h),o.len+=a,i+=a+n,r++;l-1>i&&(255!==c[i]||240!==(240&c[i+1]));i++);g=l>i?c.subarray(i,l):null,this.aacOverFlow=g,this.lastAacPTS=u}},{key:"_parseID3PES",value:function(e){this._id3Track.samples.push(e)}}],[{key:"probe",value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]}}]),e}();exports["default"]=TSDemuxer},{"../errors":29,"../events":31,"../utils/logger":45,"./adts":22,"./exp-golomb":26}],29:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var ErrorTypes=exports.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",OTHER_ERROR:"otherError"},ErrorDetails=exports.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",INTERNAL_EXCEPTION:"internalException"}},{}],30:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},_createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_logger=_dereq_("./utils/logger"),_errors=_dereq_("./errors"),_events=_dereq_("./events"),_events2=_interopRequireDefault(_events),EventHandler=function(){function e(t){_classCallCheck(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var n=arguments.length,r=Array(n>1?n-1:0),i=1;n>i;i++)r[i-1]=arguments[i];this.handledEvents=r,this.useGenericHandler=!0,this.registerListeners()}return _createClass(e,[{key:"destroy",value:function(){this.unregisterListeners()}},{key:"isEventHandler",value:function(){return"object"===_typeof(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function(e,t){this.onEventGeneric(e,t)}},{key:"onEventGeneric",value:function(e,t){var n=function(e,t){var n="on"+e.replace("hls","");if("function"!=typeof this[n])throw new Error("Event "+e+" has no generic handler in this "+this.constructor.name+" class (tried "+n+")");return this[n].bind(this,t)};try{n.call(this,e,t).call()}catch(r){_logger.logger.error("internal error happened while processing "+e+":"+r.message),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.OTHER_ERROR,details:_errors.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:r})}}}]),e}();exports["default"]=EventHandler},{"./errors":29,"./events":31,"./utils/logger":45}],31:[function(_dereq_,module,exports){"use strict";module.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",LEVEL_SWITCH:"hlsLevelSwitch",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded"}},{}],32:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),BufferHelper=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"bufferInfo",value:function(e,t,r){if(e){var n,a=e.buffered,f=[];for(n=0;n<a.length;n++)f.push({start:a.start(n),end:a.end(n)});return this.bufferedInfo(f,t,r)}return{len:0,start:0,end:0,nextStart:void 0}}},{key:"bufferedInfo",value:function(e,t,r){var n,a,f,u,l,s=[];for(e.sort(function(e,t){var r=e.start-t.start;return r?r:t.end-e.end}),l=0;l<e.length;l++){var o=s.length;if(o){var i=s[o-1].end;e[l].start-i<r?e[l].end>i&&(s[o-1].end=e[l].end):s.push(e[l])}else s.push(e[l])}if(s.length&&t<s[0].start)return{len:0,start:t,end:t,nextStart:s[0].start};for(l=0,n=0,a=f=t;l<s.length;l++){var c=s[l].start,d=s[l].end;if(t+r>=c&&d>t)a=c,f=d,n=f-t;else if(c>t+r){u=c;break}}return{len:n,start:a,end:f,nextStart:u}}}]),e}();exports["default"]=BufferHelper},{}],33:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),_logger=_dereq_("../utils/logger"),LevelHelper=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"mergeDetails",value:function(e,r){var a,n=Math.max(e.startSN,r.startSN)-r.startSN,o=Math.min(e.endSN,r.endSN)-r.startSN,s=r.startSN-e.startSN,l=e.fragments,i=r.fragments,u=0;if(n>o)return void(r.PTSKnown=!1);for(var d=n;o>=d;d++){var f=l[s+d],g=i[d];u=f.cc-g.cc,isNaN(f.startPTS)||(g.start=g.startPTS=f.startPTS,g.endPTS=f.endPTS,g.duration=f.duration,a=g)}if(u)for(_logger.logger.log("discontinuity sliding from playlist, take drift into account"),d=0;d<i.length;d++)i[d].cc+=u;if(a)t.updateFragPTS(r,a.sn,a.startPTS,a.endPTS);else if(s>=0&&s<l.length){var c=l[s].start;for(d=0;d<i.length;d++)i[d].start+=c}r.PTSKnown=e.PTSKnown}},{key:"updateFragPTS",value:function(e,r,a,n){var o,s,l,i;if(r<e.startSN||r>e.endSN)return 0;o=r-e.startSN,s=e.fragments,l=s[o],isNaN(l.startPTS)||(a=Math.min(a,l.startPTS),n=Math.max(n,l.endPTS));var u=a-l.start;for(l.start=l.startPTS=a,l.endPTS=n,l.duration=n-a,i=o;i>0;i--)t.updatePTS(s,i,i-1);for(i=o;i<s.length-1;i++)t.updatePTS(s,i,i+1);return e.PTSKnown=!0,u}},{key:"updatePTS",value:function(t,e,r){var a=t[e],n=t[r],o=n.startPTS;isNaN(o)?r>e?n.start=a.start+a.duration:n.start=a.start-n.duration:r>e?(a.duration=o-a.start,a.duration<0&&_logger.logger.error("negative duration computed for frag "+a.sn+",level "+a.level+", there should be some duration drift between playlist and fragment!")):(n.duration=a.start-o,n.duration<0&&_logger.logger.error("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!"))}}]),t}();exports["default"]=LevelHelper},{"../utils/logger":45}],34:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var l=r[t];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}return function(r,t,l){return t&&e(r.prototype,t),l&&e(r,l),r}}(),_events=_dereq_("./events"),_events2=_interopRequireDefault(_events),_errors=_dereq_("./errors"),_playlistLoader=_dereq_("./loader/playlist-loader"),_playlistLoader2=_interopRequireDefault(_playlistLoader),_fragmentLoader=_dereq_("./loader/fragment-loader"),_fragmentLoader2=_interopRequireDefault(_fragmentLoader),_abrController=_dereq_("./controller/abr-controller"),_abrController2=_interopRequireDefault(_abrController),_bufferController=_dereq_("./controller/buffer-controller"),_bufferController2=_interopRequireDefault(_bufferController),_capLevelController=_dereq_("./controller/cap-level-controller"),_capLevelController2=_interopRequireDefault(_capLevelController),_streamController=_dereq_("./controller/stream-controller"),_streamController2=_interopRequireDefault(_streamController),_levelController=_dereq_("./controller/level-controller"),_levelController2=_interopRequireDefault(_levelController),_timelineController=_dereq_("./controller/timeline-controller"),_timelineController2=_interopRequireDefault(_timelineController),_logger=_dereq_("./utils/logger"),_xhrLoader=_dereq_("./utils/xhr-loader"),_xhrLoader2=_interopRequireDefault(_xhrLoader),_events3=_dereq_("events"),_events4=_interopRequireDefault(_events3),_keyLoader=_dereq_("./loader/key-loader"),_keyLoader2=_interopRequireDefault(_keyLoader),Hls=function(){function e(){var r=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];_classCallCheck(this,e);var t=e.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var l in t)l in r||(r[l]=t[l]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,_logger.enableLogs)(r.debug),this.config=r;var o=this.observer=new _events4["default"];o.trigger=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),l=1;r>l;l++)t[l-1]=arguments[l];o.emit.apply(o,[e,e].concat(t))},o.off=function(e){for(var r=arguments.length,t=Array(r>1?r-1:0),l=1;r>l;l++)t[l-1]=arguments[l];o.removeListener.apply(o,[e].concat(t))},this.on=o.on.bind(o),this.off=o.off.bind(o),this.trigger=o.trigger.bind(o),this.playlistLoader=new _playlistLoader2["default"](this),this.fragmentLoader=new _fragmentLoader2["default"](this),this.levelController=new _levelController2["default"](this),this.abrController=new r.abrController(this),this.bufferController=new r.bufferController(this),this.capLevelController=new r.capLevelController(this),this.streamController=new r.streamController(this),this.timelineController=new r.timelineController(this),this.keyLoader=new _keyLoader2["default"](this)}return _createClass(e,null,[{key:"isSupported",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"Events",get:function(){return _events2["default"]}},{key:"ErrorTypes",get:function(){return _errors.ErrorTypes}},{key:"ErrorDetails",get:function(){return _errors.ErrorDetails}},{key:"DefaultConfig",get:function(){return e.defaultConfig||(e.defaultConfig={autoStartLoad:!0,debug:!1,capLevelToPlayerSize:!1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,seekHoleNudgeDuration:.01,stalledInBufferedNudgeThreshold:10,maxFragLookUpTolerance:.2,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,appendErrorMaxRetry:3,loader:_xhrLoader2["default"],fLoader:void 0,pLoader:void 0,abrController:_abrController2["default"],bufferController:_bufferController2["default"],capLevelController:_capLevelController2["default"],streamController:_streamController2["default"],timelineController:_timelineController2["default"],enableCEA708Captions:!0,enableMP2TPassThrough:!1}),e.defaultConfig},set:function(r){e.defaultConfig=r}}]),_createClass(e,[{key:"destroy",value:function(){_logger.logger.log("destroy"),this.trigger(_events2["default"].DESTROYING),this.detachMedia(),this.playlistLoader.destroy(),this.fragmentLoader.destroy(),this.levelController.destroy(),this.abrController.destroy(),this.bufferController.destroy(),this.capLevelController.destroy(),this.streamController.destroy(),this.timelineController.destroy(),this.keyLoader.destroy(),this.url=null,this.observer.removeAllListeners()}},{key:"attachMedia",value:function(e){_logger.logger.log("attachMedia"),this.media=e,this.trigger(_events2["default"].MEDIA_ATTACHING,{media:e})}},{key:"detachMedia",value:function(){_logger.logger.log("detachMedia"),this.trigger(_events2["default"].MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function(e){_logger.logger.log("loadSource:"+e),this.url=e,this.trigger(_events2["default"].MANIFEST_LOADING,{url:e})}},{key:"startLoad",value:function(){var e=arguments.length<=0||void 0===arguments[0]?0:arguments[0];_logger.logger.log("startLoad"),this.levelController.startLoad(),this.streamController.startLoad(e)}},{key:"stopLoad",value:function(){_logger.logger.log("stopLoad"),this.levelController.stopLoad(),this.streamController.stopLoad()}},{key:"swapAudioCodec",value:function(){_logger.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function(){_logger.logger.log("recoverMediaError");var e=this.media;this.detachMedia(),this.attachMedia(e)}},{key:"levels",get:function(){return this.levelController.levels}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){_logger.logger.log("set currentLevel:"+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){_logger.logger.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){_logger.logger.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return this.levelController.firstLevel},set:function(e){_logger.logger.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){_logger.logger.log("set startLevel:"+e),this.levelController.startLevel=e}},{key:"autoLevelCapping",get:function(){return this.abrController.autoLevelCapping},set:function(e){_logger.logger.log("set autoLevelCapping:"+e),this.abrController.autoLevelCapping=e}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}}]),e}();exports["default"]=Hls},{"./controller/abr-controller":12,"./controller/buffer-controller":13,"./controller/cap-level-controller":14,"./controller/level-controller":15,"./controller/stream-controller":16,"./controller/timeline-controller":17,"./errors":29,"./events":31,"./loader/fragment-loader":36,"./loader/key-loader":37,"./loader/playlist-loader":38,"./utils/logger":45,"./utils/xhr-loader":47,events:11}],35:[function(_dereq_,module,exports){"use strict";module.exports=_dereq_("./hls.js")["default"]},{"./hls.js":34}],36:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=_dereq_("../errors"),FragmentLoader=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2["default"].FRAG_LOADING))}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),_eventHandler2["default"].prototype.destroy.call(this)}},{key:"onFragLoading",value:function(e){var t=e.frag;this.frag=t,this.frag.loaded=0;var r=this.hls.config;t.loader=this.loader="undefined"!=typeof r.fLoader?new r.fLoader(r):new r.loader(r),this.loader.load(t.url,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),r.fragLoadingTimeOut,1,0,this.loadprogress.bind(this),t)}},{key:"loadsuccess",value:function(e,t){var r=e.currentTarget.response;t.length=r.byteLength,this.frag.loader=void 0,this.hls.trigger(_events2["default"].FRAG_LOADED,{payload:r,frag:this.frag,stats:t})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(e,t){this.frag.loaded=t.loaded,this.hls.trigger(_events2["default"].FRAG_LOAD_PROGRESS,{frag:this.frag,stats:t})}}]),t}(_eventHandler2["default"]);exports["default"]=FragmentLoader},{"../errors":29,"../event-handler":30,"../events":31}],37:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!=typeof r&&"function"!=typeof r?e:r}function _inherits(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var o=r[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(r,t,o){return t&&e(r.prototype,t),o&&e(r,o),r}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=_dereq_("../errors"),KeyLoader=function(e){function r(e){_classCallCheck(this,r);var t=_possibleConstructorReturn(this,Object.getPrototypeOf(r).call(this,e,_events2["default"].KEY_LOADING));return t.decryptkey=null,t.decrypturl=null,t}return _inherits(r,e),_createClass(r,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),_eventHandler2["default"].prototype.destroy.call(this)}},{key:"onKeyLoading",value:function(e){var r=this.frag=e.frag,t=r.decryptdata,o=t.uri;if(o!==this.decrypturl||null===this.decryptkey){var a=this.hls.config;r.loader=this.loader=new a.loader(a),this.decrypturl=o,this.decryptkey=null,r.loader.load(o,"arraybuffer",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),a.fragLoadingTimeOut,a.fragLoadingMaxRetry,a.fragLoadingRetryDelay,this.loadprogress.bind(this),r)}else this.decryptkey&&(t.key=this.decryptkey,this.hls.trigger(_events2["default"].KEY_LOADED,{frag:r}))}},{key:"loadsuccess",value:function(e){var r=this.frag;this.decryptkey=r.decryptdata.key=new Uint8Array(e.currentTarget.response),r.loader=void 0,this.hls.trigger(_events2["default"].KEY_LOADED,{frag:r})}},{key:"loaderror",value:function(e){this.loader&&this.loader.abort(),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:this.frag,response:e})}},{key:"loadtimeout",value:function(){this.loader&&this.loader.abort(),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:this.frag})}},{key:"loadprogress",value:function(){}}]),r}(_eventHandler2["default"]);exports["default"]=KeyLoader},{"../errors":29,"../event-handler":30,"../events":31}],38:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var l=t[r];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),
Object.defineProperty(e,l.key,l)}}return function(t,r,l){return r&&e(t.prototype,r),l&&e(t,l),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_eventHandler=_dereq_("../event-handler"),_eventHandler2=_interopRequireDefault(_eventHandler),_errors=_dereq_("../errors"),_url=_dereq_("../utils/url"),_url2=_interopRequireDefault(_url),_attrList=_dereq_("../utils/attr-list"),_attrList2=_interopRequireDefault(_attrList),PlaylistLoader=function(e){function t(e){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).call(this,e,_events2["default"].MANIFEST_LOADING,_events2["default"].LEVEL_LOADING))}return _inherits(t,e),_createClass(t,[{key:"destroy",value:function(){this.loader&&(this.loader.destroy(),this.loader=null),this.url=this.id=null,_eventHandler2["default"].prototype.destroy.call(this)}},{key:"onManifestLoading",value:function(e){this.load(e.url,null)}},{key:"onLevelLoading",value:function(e){this.load(e.url,e.level,e.id)}},{key:"load",value:function(e,t,r){var l,a,i,n=this.hls.config;this.url=e,this.id=t,this.id2=r,null===this.id?(l=n.manifestLoadingMaxRetry,a=n.manifestLoadingTimeOut,i=n.manifestLoadingRetryDelay):(l=n.levelLoadingMaxRetry,a=n.levelLoadingTimeOut,i=n.levelLoadingRetryDelay),this.loader="undefined"!=typeof n.pLoader?new n.pLoader(n):new n.loader(n),this.loader.load(e,"",this.loadsuccess.bind(this),this.loaderror.bind(this),this.loadtimeout.bind(this),a,l,i)}},{key:"resolve",value:function(e,t){return _url2["default"].buildAbsoluteURL(t,e)}},{key:"parseMasterPlaylist",value:function(e,t){for(var r=[],l=void 0,a=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g;null!=(l=a.exec(e));){var i={},n=i.attrs=new _attrList2["default"](l[1]);i.url=this.resolve(l[2],t);var s=n.decimalResolution("RESOLUTION");s&&(i.width=s.width,i.height=s.height),i.bitrate=n.decimalInteger("AVERAGE-BANDWIDTH")||n.decimalInteger("BANDWIDTH"),i.name=n.NAME;var o=n.CODECS;if(o){o=o.split(",");for(var u=0;u<o.length;u++){var d=o[u];-1!==d.indexOf("avc1")?i.videoCodec=this.avc1toavcoti(d):i.audioCodec=d}}r.push(i)}return r}},{key:"avc1toavcoti",value:function(e){var t,r=e.split(".");return r.length>2?(t=r.shift()+".",t+=parseInt(r.shift()).toString(16),t+=("000"+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t}},{key:"cloneObj",value:function(e){return JSON.parse(JSON.stringify(e))}},{key:"parseLevelPlaylist",value:function(e,t,r){var l,a,i,n,s=0,o=0,u={url:t,fragments:[],live:!0,startSN:0},d={method:null,key:null,iv:null,uri:null},f=0,E=null,h=null;for(a=/(?:#EXT-X-(MEDIA-SEQUENCE):(\d+))|(?:#EXT-X-(TARGETDURATION):(\d+))|(?:#EXT-X-(KEY):(.*))|(?:#EXT(INF):([\d\.]+)[^\r\n]*([\r\n]+[^#|\r\n]+)?)|(?:#EXT-X-(BYTERANGE):([\d]+[@[\d]*)]*[\r\n]+([^#|\r\n]+)?|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(PROGRAM-DATE-TIME):(.*))/g;null!==(l=a.exec(e));)switch(l.shift(),l=l.filter(function(e){return void 0!==e}),l[0]){case"MEDIA-SEQUENCE":s=u.startSN=parseInt(l[1]);break;case"TARGETDURATION":u.targetduration=parseFloat(l[1]);break;case"ENDLIST":u.live=!1;break;case"DIS":f++;break;case"BYTERANGE":var v=l[1].split("@");n=1===v.length?i:parseInt(v[1]),i=parseInt(v[0])+n,h&&!h.url&&(h.byteRangeStartOffset=n,h.byteRangeEndOffset=i,h.url=this.resolve(l[2],t));break;case"INF":var c=parseFloat(l[1]);if(!isNaN(c)){var _,R=s++;if(d.method&&d.uri&&!d.iv){_=this.cloneObj(d);for(var p=new Uint8Array(16),y=12;16>y;y++)p[y]=R>>8*(15-y)&255;_.iv=p}else _=d;var T=l[2]?this.resolve(l[2],t):null;h={url:T,duration:c,start:o,sn:R,level:r,cc:f,byteRangeStartOffset:n,byteRangeEndOffset:i,decryptdata:_,programDateTime:E},u.fragments.push(h),o+=c,n=null,E=null}break;case"KEY":var O=l[1],g=new _attrList2["default"](O),D=g.enumeratedString("METHOD"),L=g.URI,I=g.hexadecimalInteger("IV");D&&(d={method:null,key:null,iv:null,uri:null},L&&"AES-128"===D&&(d.method=D,d.uri=this.resolve(L,t),d.key=null,d.iv=I));break;case"PROGRAM-DATE-TIME":E=new Date(Date.parse(l[1]))}return h&&!h.url&&(u.fragments.pop(),o-=h.duration),u.totalduration=o,u.endSN=s-1,u}},{key:"loadsuccess",value:function(e,t){var r,l=e.currentTarget,a=l.responseText,i=l.responseURL,n=this.id,s=this.id2,o=this.hls;if(void 0===i&&(i=this.url),t.tload=performance.now(),t.mtime=new Date(l.getResponseHeader("Last-Modified")),0===a.indexOf("#EXTM3U"))if(a.indexOf("#EXTINF:")>0)if(null===this.id)o.trigger(_events2["default"].MANIFEST_LOADED,{levels:[{url:i}],url:i,stats:t});else{var u=this.parseLevelPlaylist(a,i,n);t.tparsed=performance.now(),o.trigger(_events2["default"].LEVEL_LOADED,{details:u,level:n,id:s,stats:t})}else r=this.parseMasterPlaylist(a,i),r.length?o.trigger(_events2["default"].MANIFEST_LOADED,{levels:r,url:i,stats:t}):o.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no level found in manifest"});else o.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:_errors.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:i,reason:"no EXTM3U delimiter"})}},{key:"loaderror",value:function(e){var t,r;null===this.id?(t=_errors.ErrorDetails.MANIFEST_LOAD_ERROR,r=!0):(t=_errors.ErrorDetails.LEVEL_LOAD_ERROR,r=!1),this.loader&&this.loader.abort(),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:t,fatal:r,url:this.url,loader:this.loader,response:e.currentTarget,level:this.id,id:this.id2})}},{key:"loadtimeout",value:function(){var e,t;null===this.id?(e=_errors.ErrorDetails.MANIFEST_LOAD_TIMEOUT,t=!0):(e=_errors.ErrorDetails.LEVEL_LOAD_TIMEOUT,t=!1),this.loader&&this.loader.abort(),this.hls.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.NETWORK_ERROR,details:e,fatal:t,url:this.url,loader:this.loader,level:this.id,id:this.id2})}}]),t}(_eventHandler2["default"]);exports["default"]=PlaylistLoader},{"../errors":29,"../event-handler":30,"../events":31,"../utils/attr-list":42,"../utils/url":46}],39:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),MP4=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"init",value:function(){t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var e;for(e in t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:r};var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=o,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),y=new Uint8Array([97,118,99,49]),i=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,s,i,s,y),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,a))}},{key:"box",value:function(t){for(var e,n=Array.prototype.slice.call(arguments,1),r=8,a=n.length,o=a;a--;)r+=n[a].byteLength;for(e=new Uint8Array(r),e[0]=r>>24&255,e[1]=r>>16&255,e[2]=r>>8&255,e[3]=255&r,e.set(t,4),a=0,r=8;o>a;a++)e.set(n[a],r),r+=n[a].byteLength;return e}},{key:"hdlr",value:function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])}},{key:"mdat",value:function(e){return t.box(t.types.mdat,e)}},{key:"mdhd",value:function(e,n){return n*=e,t.box(t.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24,n>>16&255,n>>8&255,255&n,85,196,0,0]))}},{key:"mdia",value:function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))}},{key:"mfhd",value:function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))}},{key:"minf",value:function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))}},{key:"moof",value:function(e,n,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,n))}},{key:"moov",value:function(e){for(var n=e.length,r=[];n--;)r[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(t.mvex(e)))}},{key:"mvex",value:function(e){for(var n=e.length,r=[];n--;)r[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(r))}},{key:"mvhd",value:function(e,n){n*=e;var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,e>>24&255,e>>16&255,e>>8&255,255&e,n>>24&255,n>>16&255,n>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,r)}},{key:"sdtp",value:function(e){var n,r,a=e.samples||[],o=new Uint8Array(4+a.length);for(r=0;r<a.length;r++)n=a[r].flags,o[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return t.box(t.types.sdtp,o)}},{key:"stbl",value:function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))}},{key:"avc1",value:function(e){var n,r,a,o=[],s=[];for(n=0;n<e.sps.length;n++)r=e.sps[n],a=r.byteLength,o.push(a>>>8&255),o.push(255&a),o=o.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)r=e.pps[n],a=r.byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(r));var y=t.box(t.types.avcC,new Uint8Array([1,o[3],o[4],o[5],255,224|e.sps.length].concat(o).concat([e.pps.length]).concat(s))),i=e.width,u=e.height;return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>8&255,255&i,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),y,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))}},{key:"esds",value:function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function(e){var n=e.audiosamplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))}},{key:"stsd",value:function(e){return"audio"===e.type?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))}},{key:"tkhd",value:function(e){var n=e.id,r=e.duration*e.timescale,a=e.width,o=e.height;return t.box(t.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,o>>8&255,255&o,0,0]))}},{key:"traf",value:function(e,n){var r=t.sdtp(e),a=e.id;return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),t.box(t.types.tfdt,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n])),t.trun(e,r.length+16+16+8+16+8+8),r)}},{key:"trak",value:function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))}},{key:"trex",value:function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function(e,n){var r,a,o,s,y,i,u=e.samples||[],d=u.length,c=12+16*d,p=new Uint8Array(c);for(n+=8+c,p.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;d>r;r++)a=u[r],o=a.duration,s=a.size,y=a.flags,i=a.cts,p.set([o>>>24&255,o>>>16&255,o>>>8&255,255&o,s>>>24&255,s>>>16&255,s>>>8&255,255&s,y.isLeading<<2|y.dependsOn,y.isDependedOn<<6|y.hasRedundancy<<4|y.paddingValue<<1|y.isNonSync,61440&y.degradPrio,15&y.degradPrio,i>>>24&255,i>>>16&255,i>>>8&255,255&i],12+16*r);return t.box(t.types.trun,p)}},{key:"initSegment",value:function(e){t.types||t.init();var n,r=t.moov(e);return n=new Uint8Array(t.FTYP.byteLength+r.byteLength),n.set(t.FTYP),n.set(r,t.FTYP.byteLength),n}}]),t}();exports["default"]=MP4},{}],40:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,s,i){return s&&e(t.prototype,s),i&&e(t,i),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),_logger=_dereq_("../utils/logger"),_mp4Generator=_dereq_("../remux/mp4-generator"),_mp4Generator2=_interopRequireDefault(_mp4Generator),_errors=_dereq_("../errors"),MP4Remuxer=function(){function e(t){_classCallCheck(this,e),this.observer=t,this.ISGenerated=!1,this.PES2MP4SCALEFACTOR=4,this.PES_TIMESCALE=9e4,this.MP4_TIMESCALE=this.PES_TIMESCALE/this.PES2MP4SCALEFACTOR}return _createClass(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){this._initPTS=this._initDTS=this.nextAacPts=this.nextAvcDts=void 0}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,s,i,a,n){this.ISGenerated||this.generateIS(e,t,a),this.ISGenerated&&(t.samples.length&&this.remuxVideo(t,a,n),e.samples.length&&this.remuxAudio(e,a,n)),s.samples.length&&this.remuxID3(s,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(_events2["default"].FRAG_PARSED)}},{key:"generateIS",value:function(e,t,s){var i,a,n=this.observer,r=e.samples,o=t.samples,l=this.PES_TIMESCALE,u={},d={tracks:u,unique:!1},h=void 0===this._initPTS;h&&(i=a=1/0),e.config&&r.length&&(e.timescale=e.audiosamplerate,e.timescale*e.duration>Math.pow(2,32)&&!function(){var t=function s(e,t){return t?s(t,e%t):e};e.timescale=e.audiosamplerate/t(e.audiosamplerate,1024)}(),_logger.logger.log("audio mp4 timescale :"+e.timescale),u.audio={container:"audio/mp4",codec:e.codec,initSegment:_mp4Generator2["default"].initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(i=a=r[0].pts-l*s)),t.sps&&t.pps&&o.length&&(t.timescale=this.MP4_TIMESCALE,u.video={container:"video/mp4",codec:t.codec,initSegment:_mp4Generator2["default"].initSegment([t]),metadata:{width:t.width,height:t.height}},h&&(i=Math.min(i,o[0].pts-l*s),a=Math.min(a,o[0].dts-l*s))),Object.keys(u).length?(n.trigger(_events2["default"].FRAG_PARSING_INIT_SEGMENT,d),this.ISGenerated=!0,h&&(this._initPTS=i,this._initDTS=a)):n.trigger(_events2["default"].ERROR,{type:_errors.ErrorTypes.MEDIA_ERROR,details:_errors.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function(e,t,s){var i,a,n,r,o,l,u,d,h,g,m,p,_,c,f,S=8,v=this.PES_TIMESCALE,A=this.PES2MP4SCALEFACTOR,T=[];for(l=new Uint8Array(e.len+4*e.nbNalu+8),i=new DataView(l.buffer),i.setUint32(0,l.byteLength),l.set(_mp4Generator2["default"].types.mdat,4);e.samples.length;){for(a=e.samples.shift(),r=0;a.units.units.length;)o=a.units.units.shift(),i.setUint32(S,o.data.byteLength),S+=4,l.set(o.data,S),S+=o.data.byteLength,r+=4+o.data.byteLength;if(m=a.pts-this._initDTS,p=a.dts-this._initDTS,p=Math.min(m,p),void 0!==g){_=this._PTSNormalize(m,g),c=this._PTSNormalize(p,g);var P=(c-g)/A;0>=P&&(_logger.logger.log("invalid sample duration at PTS/DTS: "+a.pts+"/"+a.dts+":"+P),P=1),n.duration=P}else{var E=void 0,y=void 0;E=s?this.nextAvcDts:t*v,_=this._PTSNormalize(m,E),c=this._PTSNormalize(p,E),y=Math.round((c-E)/90),s&&y&&(y>1?_logger.logger.log("AVC:"+y+" ms hole between fragments detected,filling it"):-1>y&&_logger.logger.log("AVC:"+-y+" ms overlapping between fragments detected"),c=E,_=Math.max(_-y,c),_logger.logger.log("Video/PTS/DTS adjusted: "+_+"/"+c+",delta:"+y)),d=Math.max(0,_),h=Math.max(0,c)}n={size:r,duration:0,cts:(_-c)/A,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0}},f=n.flags,a.key===!0?(f.dependsOn=2,f.isNonSync=0):(f.dependsOn=1,f.isNonSync=1),T.push(n),g=c}var b=0;T.length>=2&&(b=T[T.length-2].duration,n.duration=b),this.nextAvcDts=c+b*A,e.len=0,e.nbNalu=0,T.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(f=T[0].flags,f.dependsOn=2,f.isNonSync=0),e.samples=T,u=_mp4Generator2["default"].moof(e.sequenceNumber++,h/A,e),e.samples=[],this.observer.trigger(_events2["default"].FRAG_PARSING_DATA,{data1:u,data2:l,startPTS:d/v,endPTS:(_+A*b)/v,startDTS:h/v,endDTS:this.nextAvcDts/v,type:"video",nb:T.length})}},{key:"remuxAudio",value:function(e,t,s){var i,a,n,r,o,l,u,d,h,g,m,p,_,c=8,f=this.PES_TIMESCALE,S=e.timescale,v=f/S,A=1024*e.timescale/e.audiosamplerate,T=[],P=[];for(e.samples.sort(function(e,t){return e.pts-t.pts}),P=e.samples;P.length;){if(a=P.shift(),r=a.unit,g=a.pts-this._initDTS,m=a.dts-this._initDTS,void 0!==h)p=this._PTSNormalize(g,h),_=this._PTSNormalize(m,h),n.duration=(_-h)/v,Math.abs(n.duration-A)>A/10&&_logger.logger.log("invalid AAC sample duration at PTS "+Math.round(g/90)+",should be 1024,found :"+Math.round(n.duration*e.audiosamplerate/e.timescale)),n.duration=A,_=A*v+h;else{var E=void 0,y=void 0;if(E=s?this.nextAacPts:t*f,p=this._PTSNormalize(g,E),_=this._PTSNormalize(m,E),y=Math.round(1e3*(p-E)/f),s&&y){if(y>0)_logger.logger.log(y+" ms hole between AAC samples detected,filling it");else if(-12>y){_logger.logger.log(-y+" ms overlapping between AAC samples detected, drop frame"),e.len-=r.byteLength;continue}p=_=E}if(u=Math.max(0,p),d=Math.max(0,_),!(e.len>0))return;o=new Uint8Array(e.len+8),i=new DataView(o.buffer),i.setUint32(0,o.byteLength),o.set(_mp4Generator2["default"].types.mdat,4)}o.set(r,c),c+=r.byteLength,n={size:r.byteLength,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},T.push(n),h=_}var b=0,M=T.length;M>=2&&(b=T[M-2].duration,n.duration=b),M&&(this.nextAacPts=p+v*b,e.len=0,e.samples=T,l=_mp4Generator2["default"].moof(e.sequenceNumber++,d/v,e),e.samples=[],this.observer.trigger(_events2["default"].FRAG_PARSING_DATA,{data1:l,data2:o,startPTS:u/f,endPTS:this.nextAacPts/f,startDTS:d/f,endDTS:(_+v*b)/f,type:"audio",nb:M}))}},{key:"remuxID3",value:function(e,t){var s,i=e.samples.length;if(i){for(var a=0;i>a;a++)s=e.samples[a],s.pts=(s.pts-this._initPTS)/this.PES_TIMESCALE,s.dts=(s.dts-this._initDTS)/this.PES_TIMESCALE;this.observer.trigger(_events2["default"].FRAG_PARSING_METADATA,{samples:e.samples})}e.samples=[],t=t}},{key:"remuxText",value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var s,i=e.samples.length;if(i){for(var a=0;i>a;a++)s=e.samples[a],s.pts=(s.pts-this._initPTS)/this.PES_TIMESCALE;this.observer.trigger(_events2["default"].FRAG_PARSING_USERDATA,{samples:e.samples})}e.samples=[],t=t}},{key:"_PTSNormalize",value:function(e,t){var s;if(void 0===t)return e;for(s=e>t?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=s;return e}},{key:"passthrough",get:function(){return!1}}]),e}();exports["default"]=MP4Remuxer},{"../errors":29,"../events":31,"../remux/mp4-generator":39,"../utils/logger":45}],41:[function(_dereq_,module,exports){"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),_events=_dereq_("../events"),_events2=_interopRequireDefault(_events),PassThroughRemuxer=function(){function e(t){_classCallCheck(this,e),this.observer=t,this.ISGenerated=!1}return _createClass(e,[{key:"destroy",value:function(){}},{key:"insertDiscontinuity",value:function(){}},{key:"switchLevel",value:function(){this.ISGenerated=!1}},{key:"remux",value:function(e,t,n,r,a,i){var u=this.observer;if(!this.ISGenerated){var o={},s={tracks:o,unique:!0},c=t,l=c.codec;l&&(s.tracks.video={container:c.container,codec:l,metadata:{width:c.width,height:c.height}}),c=e,l=c.codec,l&&(s.tracks.audio={container:c.container,codec:l,metadata:{channelCount:c.channelCount}}),this.ISGenerated=!0,u.trigger(_events2["default"].FRAG_PARSING_INIT_SEGMENT,s)}u.trigger(_events2["default"].FRAG_PARSING_DATA,{data1:i,startPTS:a,startDTS:a,type:"audiovideo",nb:1})}},{key:"passthrough",get:function(){return!0}}]),e}();exports["default"]=PassThroughRemuxer},{"../events":31}],42:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),AttrList=function(){function e(t){_classCallCheck(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r])}return _createClass(e,[{key:"decimalInteger",value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"hexadecimalInteger",value:function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var r=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)r[n]=parseInt(t.slice(2*n,2*n+2),16);return r}return null}},{key:"hexadecimalIntegerAsNumber",value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}},{key:"decimalFloatingPoint",value:function(e){return parseFloat(this[e])}},{key:"enumeratedString",value:function(e){return this[e]}},{key:"decimalResolution",value:function(e){var t=/^(\d+)x(\d+)$/.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}}],[{key:"parseAttrList",value:function(e){for(var t,r=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,n={};null!==(t=r.exec(e));){var a=t[2],i='"';0===a.indexOf(i)&&a.lastIndexOf(i)===a.length-1&&(a=a.slice(1,-1)),n[t[1]]=a}return n}}]),e}();exports["default"]=AttrList},{}],43:[function(_dereq_,module,exports){"use strict";var BinarySearch={search:function(r,e){for(var n=0,l=r.length-1,a=null,u=null;l>=n;){a=(n+l)/2|0,u=r[a];var t=e(u);if(t>0)n=a+1;else{if(!(0>t))return u;l=a-1}}return null}};module.exports=BinarySearch},{}],44:[function(_dereq_,module,exports){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),CEA708Interpreter=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"attach",value:function(e){this.media=e,this.display=[],this.memory=[]}},{key:"detach",value:function(){this.clear()}},{key:"destroy",value:function(){}},{key:"_createCue",value:function(){var e=window.VTTCue||window.TextTrackCue,t=this.cue=new e(-1,-1,"");t.text="",t.pauseOnExit=!1,t.startTime=Number.MAX_VALUE,t.endTime=Number.MAX_VALUE,this.memory.push(t)}},{key:"clear",value:function(){var e=this._textTrack;if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}},{key:"push",value:function(e,t){this.cue||this._createCue();for(var a,r,s,c,i,u=31&t[0],n=2,h=0;u>h;h++)if(a=t[n++],r=127&t[n++],s=127&t[n++],c=0!==(4&a),i=3&a,(0!==r||0!==s)&&c&&0===i){if(32&r||64&r)this.cue.text+=this._fromCharCode(r)+this._fromCharCode(s);else if((17===r||25===r)&&s>=48&&63>=s)switch(s){case 48:this.cue.text+="Â®";break;case 49:this.cue.text+="Â°";break;case 50:this.cue.text+="Â½";break;case 51:this.cue.text+="Â¿";break;case 52:this.cue.text+="â¢";break;case 53:this.cue.text+="Â¢";break;case 54:this.cue.text+="";break;case 55:this.cue.text+="Â£";break;case 56:this.cue.text+="âª";break;case 57:this.cue.text+=" ";break;case 58:this.cue.text+="Ã¨";break;case 59:this.cue.text+="Ã¢";break;case 60:this.cue.text+="Ãª";break;case 61:this.cue.text+="Ã®";break;case 62:this.cue.text+="Ã´";break;case 63:this.cue.text+="Ã»"}if((17===r||25===r)&&s>=32&&47>=s)switch(s){case 32:break;case 33:break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:break;case 42:break;case 43:break;case 44:break;case 45:break;case 46:break;case 47:}if((20===r||28===r)&&s>=32&&47>=s)switch(s){case 32:this._clearActiveCues(e);break;case 33:this.cue.text=this.cue.text.substr(0,this.cue.text.length-1);break;case 34:break;case 35:break;case 36:break;case 37:break;case 38:break;case 39:break;case 40:break;case 41:this._clearActiveCues(e);break;case 42:break;case 43:break;case 44:this._clearActiveCues(e);break;case 45:break;case 46:this._text="";break;case 47:this._flipMemory(e)}if((23===r||31===r)&&s>=33&&35>=s)switch(s){case 33:break;case 34:break;case 35:}}}},{key:"_fromCharCode",value:function(e){switch(e){case 42:return"Ã¡";case 2:return"Ã¡";case 2:return"Ã©";case 4:return"Ã­";case 5:return"Ã³";case 6:return"Ãº";case 3:return"Ã§";case 4:return"Ã·";case 5:return"Ã";case 6:return"Ã±";case 7:return"â";default:return String.fromCharCode(e)}}},{key:"_flipMemory",value:function(e){this._clearActiveCues(e),this._flushCaptions(e)}},{key:"_flushCaptions",value:function(e){this._has708||(this._textTrack=this.media.addTextTrack("captions","English","en"),this._has708=!0);var t=!0,a=!1,r=void 0;try{for(var s,c=this.memory[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var i=s.value;i.startTime=e,this._textTrack.addCue(i),this.display.push(i)}}catch(u){a=!0,r=u}finally{try{!t&&c["return"]&&c["return"]()}finally{if(a)throw r}}this.memory=[],this.cue=null}},{key:"_clearActiveCues",value:function(e){var t=!0,a=!1,r=void 0;try{for(var s,c=this.display[Symbol.iterator]();!(t=(s=c.next()).done);t=!0){var i=s.value;i.endTime=e}}catch(u){a=!0,r=u}finally{try{!t&&c["return"]&&c["return"]()}finally{if(a)throw r}}this.display=[]}},{key:"_clearBufferedCues",value:function(){}}]),e}();exports["default"]=CEA708Interpreter},{}],45:[function(_dereq_,module,exports){"use strict";function noop(){}function formatMsg(o,e){return e="["+o+"] > "+e}function consolePrintFn(o){var e=window.console[o];return e?function(){for(var r=arguments.length,n=Array(r),t=0;r>t;t++)n[t]=arguments[t];n[0]&&(n[0]=formatMsg(o,n[0])),e.apply(window.console,n)}:noop}function exportLoggerFunctions(o){for(var e=arguments.length,r=Array(e>1?e-1:0),n=1;e>n;n++)r[n-1]=arguments[n];r.forEach(function(e){exportedLogger[e]=o[e]?o[e].bind(o):consolePrintFn(e)})}Object.defineProperty(exports,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol?"symbol":typeof o},fakeLogger={trace:noop,debug:noop,log:noop,warn:noop,info:noop,error:noop},exportedLogger=fakeLogger,enableLogs=exports.enableLogs=function(o){if(o===!0||"object"===("undefined"==typeof o?"undefined":_typeof(o))){exportLoggerFunctions(o,"debug","log","info","warn","error");try{exportedLogger.log()}catch(e){exportedLogger=fakeLogger}}else exportedLogger=fakeLogger},logger=exports.logger=exportedLogger},{}],46:[function(_dereq_,module,exports){"use strict";var URLHelper={buildAbsoluteURL:function(e,r){if(r=r.trim(),/^[a-z]+:/i.test(r))return r;var t=null,l=null,u=/^([^#]*)(.*)$/.exec(r);u&&(l=u[2],r=u[1]);var s=/^([^\?]*)(.*)$/.exec(r);s&&(t=s[2],r=s[1]);var a=/^([^#]*)(.*)$/.exec(e);a&&(e=a[1]);var i=/^([^\?]*)(.*)$/.exec(e);i&&(e=i[1]);var n=/^((([a-z]+):)?\/\/[a-z0-9\.\-_~]+(:[0-9]+)?\/)(.*)$/i.exec(e),b=n[3],c=n[1],o=n[5],p=null;return p=/^\/\//.test(r)?b+"://"+URLHelper.buildAbsolutePath("",r.substring(2)):/^\//.test(r)?c+URLHelper.buildAbsolutePath("",r.substring(1)):URLHelper.buildAbsolutePath(c+o,r),t&&(p+=t),l&&(p+=l),p},buildAbsolutePath:function(e,r){for(var t,l,u=r,s="",a=e.replace(/[^\/]*$/,u.replace(/(\/|^)(?:\.?\/+)+/g,"$1")),i=0;l=a.indexOf("/../",i),l>-1;i=l+t)t=/^\/(?:\.\.\/)*/.exec(a.slice(l))[0].length,s=(s+a.substring(i,l)).replace(new RegExp("(?:\\/+[^\\/]*){0,"+(t-1)/3+"}$"),"/");return s+a.substr(i)}};module.exports=URLHelper},{}],47:[function(_dereq_,module,exports){"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function t(t,e){for(var r=0;r<e.length;r++){var s=e[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,r,s){return r&&t(e.prototype,r),s&&t(e,s),e}}(),_logger=_dereq_("../utils/logger"),XhrLoader=function(){function t(e){_classCallCheck(this,t),e&&e.xhrSetup&&(this.xhrSetup=e.xhrSetup)}return _createClass(t,[{key:"destroy",value:function(){this.abort(),this.loader=null}},{key:"abort",value:function(){var t=this.loader,e=this.timeoutHandle;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),e&&window.clearTimeout(e)}},{key:"load",value:function(t,e,r,s,i,o,n,a){var l=arguments.length<=8||void 0===arguments[8]?null:arguments[8],h=arguments.length<=9||void 0===arguments[9]?null:arguments[9];this.url=t,!h||isNaN(h.byteRangeStartOffset)||isNaN(h.byteRangeEndOffset)||(this.byteRange=h.byteRangeStartOffset+"-"+(h.byteRangeEndOffset-1)),this.responseType=e,this.onSuccess=r,this.onProgress=l,this.onTimeout=i,this.onError=s,this.stats={trequest:performance.now(),retry:0},this.timeout=o,this.maxRetry=n,this.retryDelay=a,this.loadInternal()}},{key:"loadInternal",value:function(){var t;t="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest,t.onloadend=this.loadend.bind(this),t.onprogress=this.loadprogress.bind(this),t.open("GET",this.url,!0),this.byteRange&&t.setRequestHeader("Range","bytes="+this.byteRange),t.responseType=this.responseType,this.stats.tfirst=null,this.stats.loaded=0,this.xhrSetup&&this.xhrSetup(t,this.url),this.timeoutHandle=window.setTimeout(this.loadtimeout.bind(this),this.timeout),t.send()}},{key:"loadend",value:function(t){var e=t.currentTarget,r=e.status,s=this.stats;s.aborted||(r>=200&&300>r?(window.clearTimeout(this.timeoutHandle),s.tload=performance.now(),this.onSuccess(t,s)):s.retry<this.maxRetry?(_logger.logger.warn(r+" while loading "+this.url+", retrying in "+this.retryDelay+"..."),this.destroy(),window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,64e3),s.retry++):(window.clearTimeout(this.timeoutHandle),_logger.logger.error(r+" while loading "+this.url),this.onError(t)))}},{key:"loadtimeout",value:function(t){_logger.logger.warn("timeout while loading "+this.url),this.onTimeout(t,this.stats)}},{key:"loadprogress",value:function(t){var e=this.stats;null===e.tfirst&&(e.tfirst=performance.now()),e.loaded=t.loaded,this.onProgress&&this.onProgress(t,e)}}]),t}();exports["default"]=XhrLoader;
},{"../utils/logger":45}],48:[function(_dereq_,module,exports){var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(e,r){for(var t,n=Object.keys(cache),o=0,a=n.length;a>o;o++){var i=n[o],s=cache[i].exports;if(s===e||s&&s["default"]===e){t=i;break}}if(!t){t=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var u={},o=0,a=n.length;a>o;o++){var i=n[o];u[i]=i}sources[t]=[Function(["require","module","exports"],"("+e+")(self)"),u]}var f=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={};c[t]=t,sources[f]=[Function(["require"],"var f = require("+stringify(t)+");(f.default ? f.default : f)(self);"),c];var l="("+bundleFn+")({"+Object.keys(sources).map(function(e){return stringify(e)+":["+sources[e][0]+","+stringify(sources[e][1])+"]"}).join(",")+"},{},["+stringify(f)+"])",d=window.URL||window.webkitURL||window.mozURL||window.msURL,g=new Blob([l],{type:"text/javascript"});if(r&&r.bare)return g;var w=d.createObjectURL(g),v=new Worker(w);return"function"==typeof d.revokeObjectURL&&d.revokeObjectURL(w),v}},{}],49:[function(_dereq_,module,exports){function assignValue(n,t,e){var r=n[t];hasOwnProperty.call(n,t)&&eq(r,e)&&(void 0!==e||t in n)||(n[t]=e)}function baseProperty(n){return function(t){return null==t?void 0:t[n]}}function copyObject(n,t,e,r){e||(e={});for(var o=-1,i=t.length;++o<i;){var u=t[o],c=r?r(e[u],n[u],u,e,n):n[u];assignValue(e,u,c)}return e}function createAssigner(n){return rest(function(t,e){var r=-1,o=e.length,i=o>1?e[o-1]:void 0,u=o>2?e[2]:void 0;for(i=n.length>3&&"function"==typeof i?(o--,i):void 0,u&&isIterateeCall(e[0],e[1],u)&&(i=3>o?void 0:i,o=1),t=Object(t);++r<o;){var c=e[r];c&&n(t,c,r,i)}return t})}function isIndex(n,t){return t=null==t?MAX_SAFE_INTEGER:t,!!t&&("number"==typeof n||reIsUint.test(n))&&n>-1&&n%1==0&&t>n}function isIterateeCall(n,t,e){if(!isObject(e))return!1;var r=typeof t;return("number"==r?isArrayLike(e)&&isIndex(t,e.length):"string"==r&&t in e)?eq(e[t],n):!1}function eq(n,t){return n===t||n!==n&&t!==t}function isArrayLike(n){return null!=n&&isLength(getLength(n))&&!isFunction(n)}function isFunction(n){var t=isObject(n)?objectToString.call(n):"";return t==funcTag||t==genTag}function isLength(n){return"number"==typeof n&&n>-1&&n%1==0&&MAX_SAFE_INTEGER>=n}function isObject(n){var t=typeof n;return!!n&&("object"==t||"function"==t)}var keysIn=_dereq_("lodash.keysin"),rest=_dereq_("lodash.rest"),MAX_SAFE_INTEGER=9007199254740991,funcTag="[object Function]",genTag="[object GeneratorFunction]",reIsUint=/^(?:0|[1-9]\d*)$/,objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,getLength=baseProperty("length"),assignInWith=createAssigner(function(n,t,e,r){copyObject(t,keysIn(t),n,r)});module.exports=assignInWith},{"lodash.keysin":54,"lodash.rest":55}],50:[function(_dereq_,module,exports){function apply(t,e,r){var n=r.length;switch(n){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function assignInDefaults(t,e,r,n){return void 0===t||eq(t,objectProto[r])&&!hasOwnProperty.call(n,r)?e:t}function eq(t,e){return t===e||t!==t&&e!==e}var assignInWith=_dereq_("lodash.assigninwith"),rest=_dereq_("lodash.rest"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,defaults=rest(function(t){return t.push(void 0,assignInDefaults),apply(assignInWith,void 0,t)});module.exports=defaults},{"lodash.assigninwith":51,"lodash.rest":53}],51:[function(_dereq_,module,exports){arguments[4][49][0].apply(exports,arguments)},{dup:49,"lodash.keysin":52,"lodash.rest":53}],52:[function(_dereq_,module,exports){(function(global){function baseTimes(e,t){for(var r=-1,o=Array(e);++r<e;)o[r]=t(r);return o}function checkGlobal(e){return e&&e.Object===Object?e:null}function iteratorToArray(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}function baseKeysIn(e){e=null==e?e:Object(e);var t=[];for(var r in e)t.push(r);return t}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function indexKeys(e){var t=e?e.length:void 0;return isLength(t)&&(isArray(e)||isString(e)||isArguments(e))?baseTimes(t,String):null}function isIndex(e,t){return t=null==t?MAX_SAFE_INTEGER:t,!!t&&("number"==typeof e||reIsUint.test(e))&&e>-1&&e%1==0&&t>e}function isPrototype(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||objectProto;return e===r}function isArguments(e){return isArrayLikeObject(e)&&hasOwnProperty.call(e,"callee")&&(!propertyIsEnumerable.call(e,"callee")||objectToString.call(e)==argsTag)}function isArrayLike(e){return null!=e&&isLength(getLength(e))&&!isFunction(e)}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}function isFunction(e){var t=isObject(e)?objectToString.call(e):"";return t==funcTag||t==genTag}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&MAX_SAFE_INTEGER>=e}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isString(e){return"string"==typeof e||!isArray(e)&&isObjectLike(e)&&objectToString.call(e)==stringTag}function keysIn(e){for(var t=-1,r=isPrototype(e),o=baseKeysIn(e),n=o.length,i=indexKeys(e),c=!!i,s=i||[],l=s.length;++t<n;){var u=o[t];c&&("length"==u||isIndex(u,l))||"constructor"==u&&(r||!hasOwnProperty.call(e,u))||s.push(u)}return s}var MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",stringTag="[object String]",reIsUint=/^(?:0|[1-9]\d*)$/,objectTypes={"function":!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:void 0,freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:void 0,freeGlobal=checkGlobal(freeExports&&freeModule&&"object"==typeof global&&global),freeSelf=checkGlobal(objectTypes[typeof self]&&self),freeWindow=checkGlobal(objectTypes[typeof window]&&window),thisGlobal=checkGlobal(objectTypes[typeof this]&&this),root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")(),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,Reflect=root.Reflect,enumerate=Reflect?Reflect.enumerate:void 0,propertyIsEnumerable=objectProto.propertyIsEnumerable;enumerate&&!propertyIsEnumerable.call({valueOf:1},"valueOf")&&(baseKeysIn=function(e){return iteratorToArray(enumerate(e))});var getLength=baseProperty("length"),isArray=Array.isArray;module.exports=keysIn}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],53:[function(_dereq_,module,exports){function apply(t,e,r){var n=r.length;switch(n){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function rest(t,e){if("function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);return e=nativeMax(void 0===e?t.length-1:toInteger(e),0),function(){for(var r=arguments,n=-1,o=nativeMax(r.length-e,0),i=Array(o);++n<o;)i[n]=r[e+n];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,r[0],i);case 2:return t.call(this,r[0],r[1],i)}var a=Array(e+1);for(n=-1;++n<e;)a[n]=r[n];return a[e]=i,apply(t,this,a)}}function isFunction(t){var e=isObject(t)?objectToString.call(t):"";return e==funcTag||e==genTag}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag}function toFinite(t){if(!t)return 0===t?t:0;if(t=toNumber(t),t===INFINITY||t===-INFINITY){var e=0>t?-1:1;return e*MAX_INTEGER}return t===t?t:0}function toInteger(t){var e=toFinite(t),r=e%1;return e===e?r?e-r:e:0}function toNumber(t){if("number"==typeof t)return t;if(isSymbol(t))return NAN;if(isObject(t)){var e=isFunction(t.valueOf)?t.valueOf():t;t=isObject(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(reTrim,"");var r=reIsBinary.test(t);return r||reIsOctal.test(t)?freeParseInt(t.slice(2),r?2:8):reIsBadHex.test(t)?NAN:+t}var FUNC_ERROR_TEXT="Expected a function",INFINITY=1/0,MAX_INTEGER=1.7976931348623157e308,NAN=NaN,funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max;module.exports=rest},{}],54:[function(_dereq_,module,exports){(function(global){function baseTimes(e,t){for(var r=-1,o=Array(e);++r<e;)o[r]=t(r);return o}function checkGlobal(e){return e&&e.Object===Object?e:null}function iteratorToArray(e){for(var t,r=[];!(t=e.next()).done;)r.push(t.value);return r}function baseKeysIn(e){e=null==e?e:Object(e);var t=[];for(var r in e)t.push(r);return t}function baseProperty(e){return function(t){return null==t?void 0:t[e]}}function indexKeys(e){var t=e?e.length:void 0;return isLength(t)&&(isArray(e)||isString(e)||isArguments(e))?baseTimes(t,String):null}function isIndex(e,t){return t=null==t?MAX_SAFE_INTEGER:t,!!t&&("number"==typeof e||reIsUint.test(e))&&e>-1&&e%1==0&&t>e}function isPrototype(e){var t=e&&e.constructor,r="function"==typeof t&&t.prototype||objectProto;return e===r}function isArguments(e){return isArrayLikeObject(e)&&hasOwnProperty.call(e,"callee")&&(!propertyIsEnumerable.call(e,"callee")||objectToString.call(e)==argsTag)}function isArrayLike(e){return null!=e&&isLength(getLength(e))&&!isFunction(e)}function isArrayLikeObject(e){return isObjectLike(e)&&isArrayLike(e)}function isFunction(e){var t=isObject(e)?objectToString.call(e):"";return t==funcTag||t==genTag}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&MAX_SAFE_INTEGER>=e}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isString(e){return"string"==typeof e||!isArray(e)&&isObjectLike(e)&&objectToString.call(e)==stringTag}function keysIn(e){for(var t=-1,r=isPrototype(e),o=baseKeysIn(e),n=o.length,i=indexKeys(e),c=!!i,s=i||[],l=s.length;++t<n;){var u=o[t];c&&("length"==u||isIndex(u,l))||"constructor"==u&&(r||!hasOwnProperty.call(e,u))||s.push(u)}return s}var MAX_SAFE_INTEGER=9007199254740991,argsTag="[object Arguments]",funcTag="[object Function]",genTag="[object GeneratorFunction]",stringTag="[object String]",reIsUint=/^(?:0|[1-9]\d*)$/,objectTypes={"function":!0,object:!0},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType?exports:void 0,freeModule=objectTypes[typeof module]&&module&&!module.nodeType?module:void 0,freeGlobal=checkGlobal(freeExports&&freeModule&&"object"==typeof global&&global),freeSelf=checkGlobal(objectTypes[typeof self]&&self),freeWindow=checkGlobal(objectTypes[typeof window]&&window),thisGlobal=checkGlobal(objectTypes[typeof this]&&this),root=freeGlobal||freeWindow!==(thisGlobal&&thisGlobal.window)&&freeWindow||freeSelf||thisGlobal||Function("return this")(),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty,objectToString=objectProto.toString,Reflect=root.Reflect,enumerate=Reflect?Reflect.enumerate:void 0,propertyIsEnumerable=objectProto.propertyIsEnumerable;enumerate&&!propertyIsEnumerable.call({valueOf:1},"valueOf")&&(baseKeysIn=function(e){return iteratorToArray(enumerate(e))});var getLength=baseProperty("length"),isArray=Array.isArray;module.exports=keysIn}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],55:[function(_dereq_,module,exports){function apply(t,e,r){var n=r.length;switch(n){case 0:return t.call(e);case 1:return t.call(e,r[0]);case 2:return t.call(e,r[0],r[1]);case 3:return t.call(e,r[0],r[1],r[2])}return t.apply(e,r)}function rest(t,e){if("function"!=typeof t)throw new TypeError(FUNC_ERROR_TEXT);return e=nativeMax(void 0===e?t.length-1:toInteger(e),0),function(){for(var r=arguments,n=-1,o=nativeMax(r.length-e,0),i=Array(o);++n<o;)i[n]=r[e+n];switch(e){case 0:return t.call(this,i);case 1:return t.call(this,r[0],i);case 2:return t.call(this,r[0],r[1],i)}var a=Array(e+1);for(n=-1;++n<e;)a[n]=r[n];return a[e]=i,apply(t,this,a)}}function isFunction(t){var e=isObject(t)?objectToString.call(t):"";return e==funcTag||e==genTag}function isObject(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function isObjectLike(t){return!!t&&"object"==typeof t}function isSymbol(t){return"symbol"==typeof t||isObjectLike(t)&&objectToString.call(t)==symbolTag}function toFinite(t){if(!t)return 0===t?t:0;if(t=toNumber(t),t===INFINITY||t===-INFINITY){var e=0>t?-1:1;return e*MAX_INTEGER}return t===t?t:0}function toInteger(t){var e=toFinite(t),r=e%1;return e===e?r?e-r:e:0}function toNumber(t){if("number"==typeof t)return t;if(isSymbol(t))return NAN;if(isObject(t)){var e=isFunction(t.valueOf)?t.valueOf():t;t=isObject(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(reTrim,"");var r=reIsBinary.test(t);return r||reIsOctal.test(t)?freeParseInt(t.slice(2),r?2:8):reIsBadHex.test(t)?NAN:+t}var FUNC_ERROR_TEXT="Expected a function",INFINITY=1/0,MAX_INTEGER=1.7976931348623157e308,NAN=NaN,funcTag="[object Function]",genTag="[object GeneratorFunction]",symbolTag="[object Symbol]",reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,objectProto=Object.prototype,objectToString=objectProto.toString,nativeMax=Math.max;module.exports=rest},{}],56:[function(_dereq_,module,exports){(function(global){!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,(t.Streamroot||(t.Streamroot={})).Downloader=e()}}(function(){var e;return function t(e,n,r){function o(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof _dereq_&&_dereq_;if(!a&&u)return u(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[s]={exports:{}};e[s][0].call(l.exports,function(t){var n=e[s][1][t];return o(n?n:t)},l,l.exports,t,e,n,r)}return n[s].exports}for(var i="function"==typeof _dereq_&&_dereq_,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t,n){"use strict";function r(e){for(var t=e.from,n=e.to,r=e.step,o=[],i=t;n>i;i+=r)o.push(i);return o.push(n),o}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./js/utils/ObjectHelper"),i={SIGNALING_URL:"wss://sig.streamroot.io/websocket/",ABTEST_DATA_URL:"http://files.streamroot.io/p2p/static/tracker-split.json",TRACKER_URL:"https://tracker.streamroot.io",TRACKER_URL_V3:"https://tracker-beta.streamroot.io",CLIENT_TRACKER_PROTOCOL_VERSION:"2.0.0",CLIENT_TRACKER_PROTOCOL_VERSION_V3:"3.0.0",P2P_PROTOCOL_VERSION:"3.0.0",CHUNK_SIZE:15360,P2P_CACHE_MAX_SIZE:136314880,GETSEGMENTTIME_CACHE_MAX_SIZE:1e3,MAX_DL_REQUEST_SPEED:1e3,TIME_BETWEEN_CHUNK_DL:50,NB_CHUNK_DL_GROUP:10,MAX_CHUNK_BY_SEEDER:300,NB_SEGMENT_P2P_PREBUFFER:6,MAX_SEGMENT_REQUEST_STORE:6,NB_SEGMENT_P2P_SKIP:2,MAX_BUFFER_DURATION:300,MAX_UP_SPEED:600,CHUNK_UP_RETRY_DELAY:10,PEER_CONNECTION_TIMEOUT:5e4,PEER_UP_TIMEOUT:5e3,SEND_HEARTBEAT_INTERVAL:5e3,CHECK_HEARTBEAT_INTERVAL:1e4,MAX_USELESS_COUNT:100,MIN_USEFUL_SPEED:5,MIN_NUMBER_OF_PEERS:8,MAX_NUMBER_OF_PEERS:13,MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE:10,ASK_PEERS_INTERVAL:6e4,SEND_TRACKS_INTERVAL:6e4,CHECK_USELESS_INTERVAL:6e4,SPEED_MONITOR_INTERVAL:1e3,MEAN_SPEED_CALCULATION_INTERVAL:500,CHUNK_TIMEOUT:2500,CHUNK_UP_TIMEOUT:1900,ICECANDIDATES_TIMEOUT:1e3,UP_MAX_BUFFERED_AMOUNT:10,OFFER_DECLINED_TIMEOUT:6e4,PEER_REMOVED_TIMEOUT:9e5,PEER_CONNEXION_ATTEMPT_TIMEOUT:9e5,GEOLOCATION_REQUEST_TIMEOUT:3e3,GEOLOCATION_REQUEST_MAX_RETRY:1,MAX_P2P_PREBUFFERING_TIME:720,RETRY_P2P_START_DL_SEGMENT_DELAY:5e3,ANALYTICS:{KLARA_URL:"https://klara.streamroot.io",ERRORS_URL:"https://errors.streamroot.io",RETRY_NUMBER:3,RETRY_DELAY:1e4,TRAFFIC_INTERVAL_ARRAY:r({from:5e3,to:12e4,step:1e4}),STATS_INTERVAL:12e4,CONTROL_INTERVAL:6e5,ERRORS_BUFFERING_INTERVAL:3e5},RY_TRACK:!0,RY_TRACKER:"srTracker",ABR_DEL_T:30,LIVE:{P2P_CACHE_MAX_SIZE:62914560},ENABLE_TURN:!1,STUNSERVERS:[{urls:"stun:stun.l.google.com:19302"}],TURNSERVERS:[{urls:"turn:23.97.160.254:3478?transport=udp",credential:"streamroot",username:"streamroot"}],ALLOW_P2P:!0,RANGE_REQUEST_ALLOWED:!0,DISPLAY_ERROR:!1,PEER_INSTANT_SPEED_CALCULATION_INTERVAL:100,PEER_INSTANT_SPEED_CALCULATION_WINDOW:1e4,PEER_COMPUTE_RTT_INTERVAL:5e3,USE_SIGNALING_SERVER:!0,SIGNALING_DELAY_STEP:2e3,SIGNALING_DELAY_MAX:3e5,TRACKER_DELAY_MAX:3e5,TRACKER_DELAY_INIT:2e3,LOCKED_RETRY_INTERVAL:30,LOCKED_RETRY_TIMEOUT:500,TIMEOUT_GET_FULL_SEGMENT:500,RETURN_COPY_SEGMENT:!0,DEBUG:!1,DEVICE_INFO:"",ID_CLIENT:"",MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH:300};(0,o.deepFreeze)(i),n["default"]=i,t.exports=n["default"]},{"./js/utils/ObjectHelper":87}],2:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){return e.endsWith("/")?e:e+"/"}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/json/stringify"),s=r(i),a=e("babel-runtime/helpers/classCallCheck"),u=r(a),c=e("babel-runtime/helpers/createClass"),l=r(c),f=e("./MetricSender"),d=r(f),h=Math.random().toString().substring(2),p=Math.random().toString().substring(2),_=Math.random().toString().substring(2);window.Streamroot=window.Streamroot||{},window.Streamroot.klaraToken=window.Streamroot.klaraToken||h+p+_;var m=function(){function e(t,n,r,i,s){(0,u["default"])(this,e),this._serverURL=o(t),this._clientID=n,this._namespace=i,this._content=r,this._conf=s}return(0,l["default"])(e,[{key:"send",value:function(e,t){e.customer=this._clientID,e.content=this._content,e.version="4.0.7",e.token=window.Streamroot.klaraToken;var n=(0,s["default"])(e),r=""+this._serverURL+this._namespace;t&&(r+="/"+t);var o=new d["default"](r,n,this._conf);o.send(n)}}]),e}();n["default"]=m,t.exports=n["default"]},{"./MetricSender":6,"babel-runtime/core-js/json/stringify":106,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],3:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=function a(){(0,i["default"])(this,a),this.open=0,this.match=0,this.offer=0,this.active=0,this.transfer=0,this.denied=0,this.dropped=0,this.timeout=0,this.disconnected=0,this.p2p=0,this.cdn=0};n["default"]=s,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122}],4:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("./TrafficAnalytics"),c=r(u),l=e("./StatsAnalytics"),f=r(l),d=e("../utils/Timers"),h=r(d),p=function(){function e(t,n){var r=this;(0,i["default"])(this,e),this._playerInterface=t,this._trafficIntervalCounter=0,this._conf=n.conf,this._timers=new h["default"],this._trafficAnalytics=new c["default"](this._playerInterface,n),this._statsAnalytics=new f["default"](this._playerInterface,n),this._scheduleTrafficReport(),this._scheduleStatReport(),this._scheduleControlReport(),window.onbeforeunload=function(){r._trafficAnalytics.sendUsage(!0)}}return(0,a["default"])(e,[{key:"dispose",value:function(){this._timers.clearAll()}},{key:"_scheduleTrafficReport",value:function(){var e=this;if(this._trafficIntervalCounter<this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1)this._timers.setTimeout(function(){e._trafficAnalytics.sendUsage(),e._scheduleTrafficReport()},this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._trafficIntervalCounter]),this._trafficIntervalCounter++;else{var t=this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY[this._conf.ANALYTICS.TRAFFIC_INTERVAL_ARRAY.length-1],n=this._trafficAnalytics.sendUsage.bind(this._trafficAnalytics,!1);this._timers.setInterval(n,t)}}},{key:"_scheduleStatReport",value:function(){this._timers.setInterval(this._statsAnalytics.sendStats.bind(this._statsAnalytics),this._conf.ANALYTICS.STATS_INTERVAL)}},{key:"_scheduleControlReport",value:function(){this._timers.setInterval(this._statsAnalytics.sendControl.bind(this._statsAnalytics),this._conf.ANALYTICS.CONTROL_INTERVAL)}}]),e}();n["default"]=p,t.exports=n["default"]},{"../utils/Timers":92,"./StatsAnalytics":7,"./TrafficAnalytics":8,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],5:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("./AnalyticsClient"),c=r(u),l=e("../utils/Timers"),f=r(l),d=function(){function e(t,n){var r=this;(0,i["default"])(this,e),this._conf=n.conf;var o=n.moduleState.content;this._analyticsClient=new c["default"](this._conf.ANALYTICS.ERRORS_URL,this._conf.ID_CLIENT,o,"errors",this._conf),this._timers=new f["default"],this._buffer=[],this._bufferTimeout=null;var s=function(e){if("Script error."!==e.message&&(null===t||e.filename===t)){var n={message:e.message,url:e.filename,line:e.lineno,column:e.colno,count:1};r._buffer.push(n),r._bufferTimeout||r._sendPayload()}};window.addEventListener("error",s),this._errorHandler=s}return(0,a["default"])(e,[{key:"_sendPayload",value:function(){var e={origin:"browser",version:"4.0.7",errors:this._buffer};this._buffer.length?(this._bufferTimeout=this._timers.setTimeout(this._sendPayload.bind(this),this._conf.ANALYTICS.ERRORS_BUFFERING_INTERVAL),this._buffer=[],this._analyticsClient.send(e)):this._bufferTimeout=null}},{key:"dispose",value:function(){window.removeEventListener("error",this._errorHandler)}}]),e}();n["default"]=d,t.exports=n["default"]},{"../utils/Timers":92,"./AnalyticsClient":2,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],6:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(t,n,r){(0,i["default"])(this,e),this._serverURL=t,this._payload=n,this._conf=r,this._retryCount=0}return(0,a["default"])(e,[{key:"_retry",value:function(){this._retryCount<this._conf.ANALYTICS.RETRY_NUMBER&&setTimeout(this.send.bind(this),this._conf.ANALYTICS.RETRY_DELAY)}},{key:"_onLoad",value:function(e){e.target.status>=500&&e.target.status<600&&this._retry()}},{key:"_onError",value:function(){this._retry()}},{key:"send",value:function(){var e=new XMLHttpRequest;e.open("POST",this._serverURL),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.onload=this._onLoad.bind(this),e.onerror=this._onError.bind(this),e.send(this._payload),this._retryCount++}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],7:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("./AnalyticsClient"),c=r(u),l=e("../utils/Delta"),f=function(){function e(t,n){(0,i["default"])(this,e);var r=n.conf,o=n.moduleState;this._status=n.status,this._playerInterface=t,this._analyticsClient=new c["default"](r.ANALYTICS.KLARA_URL,r.ID_CLIENT,o.content,"stats",r),this._analyticsData=n.analyticsData,this._p2pDownloaded=new l.Delta,this._cdnDownloaded=new l.Delta,this._p2pConsumed=new l.Delta,this._cdnConsumed=new l.Delta,this._PP=new l.Delta,this._PC=new l.Delta,this._CP=new l.Delta,this._CC=new l.Delta,this._HP=new l.Delta,this._HD=new l.Delta,this._M=new l.Delta,this._total=new l.Delta,this._open=new l.Delta,this._match=new l.Delta,this._offer=new l.Delta,this._active=new l.Delta,this._transfer=new l.Delta,this._denied=new l.Delta,this._dropped=new l.Delta,this._timeout=new l.Delta,this._disconnected=new l.Delta,this._counterMain=0,this._missedIceCandidate=new l.Delta,this._newPeerConnectionCount=new l.Delta,this._p2pSgtCheckSuccess=new l.Delta,this._p2pSgtCheckFail=new l.Delta,this._hybridSgtCheckSuccess=new l.Delta,this._hybridSgtCheckFail=new l.Delta,this._counterControl=0}return(0,a["default"])(e,[{key:"_getPeerStats",value:function(){return{open:this._open.calcDelta(this._analyticsData.open),match:this._match.calcDelta(this._analyticsData.match),offer:this._offer.calcDelta(this._analyticsData.offer),active:this._active.calcDelta(this._analyticsData.active),transfer:this._transfer.calcDelta(this._analyticsData.transfer),denied:this._denied.calcDelta(this._analyticsData.denied),dropped:this._dropped.calcDelta(this._analyticsData.dropped),timeout:this._timeout.calcDelta(this._analyticsData.timeout),disconnected:this._disconnected.calcDelta(this._analyticsData.disconnected)}}},{key:"_calculateStatsPayload",value:function(){var e=this._status.getConnectedToSignalingServer(),t=this._status.getConnected(),n=this._status.getUpgraded(),r=this._status.getTrackerVersion(),o={PP:this._status.getDataDownloadedTwice_PP(),PC:this._status.getDataDownloadedTwice_PC(),CP:this._status.getDataDownloadedTwice_CP(),CC:this._status.getDataDownloadedTwice_CC(),HP:this._status.getDataDownloadedTwice_HP(),HD:this._status.getDataDownloadedTwice_HD(),M:this._status.getDataDownloadedTwice_M()},i=o.PP+o.PC+o.CP+o.CC+o.HP+o.HD+o.M,s={p2p:this._p2pDownloaded.calcDelta(this._status.getP2PDownloaded()),cdn:this._cdnDownloaded.calcDelta(this._status.getCDNDownloaded()),p2pConsumed:this._p2pConsumed.calcDelta(this._analyticsData.p2p),cdnConsumed:this._cdnConsumed.calcDelta(this._analyticsData.cdn),live:this._playerInterface.isLive(),signalingServerConnected:e,trackerConnected:t,trackerUpgraded:n,trackerVersion:r,multipleDl:{PP:this._PP.calcDelta(o.PP),PC:this._PC.calcDelta(o.PC),CP:this._CP.calcDelta(o.CP),CC:this._CC.calcDelta(o.CC),HP:this._HP.calcDelta(o.HP),HD:this._HD.calcDelta(o.HD),M:this._M.calcDelta(o.M),total:this._total.calcDelta(i)},peers:this._getPeerStats(),counter:this._counterMain};return this._counterMain++,s}},{key:"_calculateControlPayload",value:function(){var e=this._missedIceCandidate.calcDelta(this._status.getMissedIceCandidateCount()),t=this._newPeerConnectionCount.calcDelta(this._status.getNewPeerConnectionCount()),n=e?e/t:0,r=this._p2pSgtCheckSuccess.calcDelta(this._status.getNbRightHashP2P()),o=this._p2pSgtCheckFail.calcDelta(this._status.getNbWrongHashP2P()),i=this._hybridSgtCheckSuccess.calcDelta(this._status.getNbRightHashDLM()),s=this._hybridSgtCheckFail.calcDelta(this._status.getNbWrongHashDLM()),a={live:this._playerInterface.isLive(),meanMissedIceCandidate:n,p2pSgtCheckSuccess:r,p2pSgtCheckFail:o,hybridSgtCheckSuccess:i,hybridSgtCheckFail:s,counter:this._counterControl};return this._counterControl++,a}},{key:"sendStats",value:function(){var e=this._calculateStatsPayload();this._analyticsClient.send(e)}},{key:"sendControl",value:function(){var e=this._calculateControlPayload();this._analyticsClient.send(e,"control")}}]),e}();n["default"]=f,t.exports=n["default"]},{"../utils/Delta":85,"./AnalyticsClient":2,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],8:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("./AnalyticsClient"),c=r(u),l=e("../utils/Delta"),f=function(){function e(t,n){(0,i["default"])(this,e);var r=n.conf,o=n.analyticsData,s=n.status,a=n.moduleState;this._analyticsClient=new c["default"](r.ANALYTICS.KLARA_URL,r.ID_CLIENT,a.content,"traffic",r),this._playerInterface=t,this._analyticsData=o,this._status=s,this._p2p=new l.Delta,this._cdn=new l.Delta,this._timespan=new l.Delta,this._timespan.calcDelta(Date.now())}return(0,a["default"])(e,[{key:"_calculateUsagePayload",value:function(){var e=this._p2p.calcDelta(this._status.getP2PDownloaded()),t=this._cdn.calcDelta(this._status.getCDNDownloaded()),n=this._timespan.calcDelta(Date.now()),r={live:this._playerInterface.isLive(),cdn:t,p2p:e,timespan:n};return r}},{key:"sendUsage",value:function(e){var t=this._calculateUsagePayload();e&&(t.unload=!0),this._analyticsClient.send(t,"usage")}}]),e}();n["default"]=f,t.exports=n["default"]},{"../utils/Delta":85,"./AnalyticsClient":2,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],9:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./TimedValue"),i=r(o),s=function(e){var t=[],n=e,r=function(){for(var e=-1,r=Date.now(),o=0;o<t.length&&r-t[o].timestamp()>n;o++)e=o;return e},o=function(){var e=r();e>-1&&t.splice(0,e+1)},s=function(e){if(0!==e){o();var n=new i["default"](e);t.push(n)}},a=function(){if(o(),!t.length)return 0;for(var e=0,n=0;n<t.length;n++)e+=t[n].value();return e/t.length};this.addPoint=s,this.compute=a};n["default"]=s,t.exports=n["default"]},{"./TimedValue":10}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){var t=e,n=Date.now();this.timestamp=function(){return n},this.value=function(){return t}};n["default"]=r,t.exports=n["default"]},{}],11:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/typeof"),i=r(o),s=e("babel-runtime/core-js/get-iterator"),a=r(s),u=e("../utils/Timers"),c=r(u),l=(e("../utils/nativeTimers"),function(e,t,n){function r(){var e=p.getSegmentListToDownload().slice(0,d.NB_SEGMENT_P2P_PREBUFFER);if(s()+d.NB_CHUNK_DL_GROUP*d.CHUNK_SIZE/1024<d.MAX_DL_REQUEST_SPEED)for(var t=0;t<d.NB_CHUNK_DL_GROUP;t++)o(e)}function o(e){var t=!0,n=!1,r=void 0;try{for(var o,s=function(){var e=o.value,t=_.getOrCreateSegmentHandler(e),n=t.seeders.getNextSeeder(t.chunkManager.chunkNumber);if(n){var r=function(){var r=t.chunkManager.getNextChunk();return r>=0?(n.requestChunk(e,r),l(),h.setTimeout(function(){t.chunkManager.timeOut(r),n.getHeuristic().incrementNbChunkTimeOut()},d.CHUNK_TIMEOUT),{v:{v:void 0}}):void 0}();if("object"===("undefined"==typeof r?"undefined":(0,i["default"])(r)))return r.v}},u=(0,a["default"])(e);!(t=(o=u.next()).done);t=!0){var c=s();if("object"===("undefined"==typeof c?"undefined":(0,i["default"])(c)))return c.v}}catch(f){n=!0,r=f}finally{try{!t&&u["return"]&&u["return"]()}finally{if(n)throw r}}}function s(){var e=u();return e===!1?m=[]:e>0&&m.splice(0,e),m.length*d.CHUNK_SIZE/1024}function u(){for(var e=Date.now(),t=0;t<m.length;t++)if(e-m[t]<=1e3)return t;return!1}function l(){var e=Date.now();m.push(e)}function f(){h.clearAll()}var d=n.conf,h=new c["default"],p=t,_=e,m=[];h.setInterval(r,d.TIME_BETWEEN_CHUNK_DL),this.addChunkRequest=l,this.dispose=f});n["default"]=l,t.exports=n["default"]},{"../utils/Timers":92,"../utils/nativeTimers":96,"babel-runtime/core-js/get-iterator":104,"babel-runtime/helpers/typeof":128}],12:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./PartialSegment/PartialSegmentP2P"),i=r(o),s=e("eventemitter3"),a=r(s),u=e("./binaryAbstraction/Segment"),c=r(u),l=function(e,t,n,r,o){this._sharedState=o,this._conf=o.conf,this._status=o.status,this._workerHelper=o.workerHelper;var i=new a["default"];this.p2pCache=t,this.dataLocked=!1,this._isEmpty=!0,this._segmentCoord=e,this.downloadStatus=[],this.getEE=function(){return i},this._peerPool=n,
this._segmentInfoMap=r};l.prototype.addSegmentSize=function(e){if(!this.size){this.size=e,this.chunkNumber=Math.ceil(this.size/this._conf.CHUNK_SIZE);for(var t=0;t<this.chunkNumber;t++)this.downloadStatus.push("pending");this.segment=new c["default"](e)}},l.prototype.getChunk=function(e,t){if(this.dataLocked||"downloaded"!==this.downloadStatus[e]&&"CDNdownloaded"!==this.downloadStatus[e])this.dataLocked,t(null);else{var n=this._conf.CHUNK_SIZE,r=e*this._conf.CHUNK_SIZE;r+n>this.size&&(n=this.size-r),this.segment.getBinaryData(r,n,t)}},l.prototype.getNextChunk=function(){var e=this.downloadStatus.indexOf("failed");return 0>e&&(e=this.downloadStatus.indexOf("pending")),e>=0&&(this.downloadStatus[e]="downloading"),e},l.prototype.chunkDownloaded=function(e,t){if(this._isEmpty=!1,"downloaded"===this.downloadStatus[t])this._status.correctP2PDownloaded(e.byteLength,"PP");else if("CDNdownloaded"===this.downloadStatus[t]||this._writeLock)this._status.correctP2PDownloaded(e.byteLength,"CP");else if(this.downloadStatus[t]="downloaded",this._status.setp2pDownloadedNewAnalytics(this._status.getp2pDownloadedNewAnalytics()+e.byteLength),this.segment.setBinaryData(e,t*this._conf.CHUNK_SIZE),this.isSegmentDownloaded()){var n=this.segment,r=this.p2pCache.getSegmentHandler(this._segmentCoord);r.seeders.cleanAfterDownloaded(),this.lockSegmentData(),this._checkHashP2P(n)}},l.prototype.timeOut=function(e){"downloading"===this.downloadStatus[e]&&(this.downloadStatus[e]="failed")},l.prototype.isSegmentDownloaded=function(){if(this.size){for(var e=this.downloadStatus.length-1;e>=0;e--)if("downloaded"!==this.downloadStatus[e]&&"CDNdownloaded"!==this.downloadStatus[e])return!1;return!0}return!1},l.prototype.shouldDownloadSegment=function(){return!(this.isSegmentDownloaded()||this.partialSegment)},l.prototype.getPartialSegment=function(){if(this.size&&!this._isEmpty){var e=this.partialSegment||new i["default"](this._segmentCoord,this.p2pCache,this.segment,this.downloadStatus,this.size,this,this.isSegmentDownloaded(),this._segmentInfoMap,this._sharedState);return this.dataLocked||(this._writeLock=!0,this.partialSegment=e),e}return!1},l.prototype.getIndexLastChunkInARow=function(){for(var e=0;e<this.downloadStatus.length;e++)if("downloaded"!==this.downloadStatus[e]&&"CDNdownloaded"!==this.downloadStatus[e])return e-1;return this.downloadStatus.length-1},l.prototype.storeSegment=function(e){this._isEmpty=!1,this.size||this.addSegmentSize(e.byteLength),this.segment=e,this._updateDownloadStatus()},l.prototype._updateDownloadStatus=function(){var e;e={start:0,end:this.chunkNumber},this.partialSegment&&this.partialSegment.getCDNIndexRange()&&(e=this.partialSegment.getCDNIndexRange());for(var t=e.start;t<e.end;t++){if("downloaded"===this.downloadStatus[t]||"CDNdownloaded"===this.downloadStatus[t]){var n=this._conf.CHUNK_SIZE;t===this.chunkNumber-1&&(n=this.size-(this.chunkNumber-1)*this._conf.CHUNK_SIZE),"downloaded"===this.downloadStatus[t]?this._status.correctP2PDownloaded(n,"PC"):"CDNdownloaded"===this.downloadStatus[t]&&this._status.correctP2PDownloaded(n,"CC")}this.downloadStatus[t]="CDNdownloaded"}},l.prototype.getP2PDownload_CDNDownload=function(){var e=0,t=0;if(this.size){for(var n=0,r=this.downloadStatus.length-1;r>n;n++)"downloaded"===this.downloadStatus[n]?e+=this._conf.CHUNK_SIZE:"CDNdownloaded"===this.downloadStatus[n]&&(t+=this._conf.CHUNK_SIZE);var o=this.size-(this.chunkNumber-1)*this._conf.CHUNK_SIZE;"downloaded"===this.downloadStatus[this.chunkNumber-1]?e+=o:"CDNdownloaded"===this.downloadStatus[this.chunkNumber-1]&&(t+=o)}return{p2pDownloaded:e,cdnDownloaded:t}},l.prototype.lockSegmentData=function(){this.dataLocked=!0},l.prototype.unlockSegmentData=function(){this.dataLocked=!1},l.prototype.removePartialSegment=function(){delete this.partialSegment},l.prototype._checkHashP2P=function(e){var t=this,n=this._segmentInfoMap.getSegmentInfo(this._segmentCoord),r=function(e,r){n.hash===r?(t._status.setNbRightHashP2P(t._status.getNbRightHashP2P()+1),t.segment=new c["default"](e),t.unlockSegmentData(),t._peerPool.broadcastSegmentInfo(n.segmentCoord)):(t._status.setNbWrongHashP2P(t._status.getNbWrongHashP2P()+1),t.p2pCache.removeSegmentHandler(n.segmentCoord),t._status.correctP2PDownloaded(t.size,"HP"))};e.getBinaryData(0,e.byteLength,function(e){t._workerHelper.callHashWorker(e,r)})},n["default"]=l,t.exports=n["default"]},{"./PartialSegment/PartialSegmentP2P":27,"./binaryAbstraction/Segment":43,eventemitter3:255}],13:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){function r(e,t,n,r){var s=o.getSegmentHandler(t).chunkManager;s?s.chunkDownloaded(r,n):i.correctP2PDownloaded(r.byteLength,"M"),e.getHeuristic().incrementNbChunkDownloaded()}var o=e,i=n.status;t.getEE().on("chunkReceived",r)};n["default"]=r,t.exports=n["default"]},{}],14:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UploadQueue"),i=r(o),s=function(e,t,n){function r(e,t,n){var r=Date.now(),i=o.getSegmentHandler(t).chunkManager;i&&i.getChunk(n,function(o){o&&s.add(e,t,n,o,r)})}var o=e,s=new i["default"](n);t.getEE().on("chunkRequested",r)};n["default"]=s,t.exports=n["default"]},{"./UploadQueue":42}],15:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/slicedToArray"),i=r(o),s=e("babel-runtime/core-js/get-iterator"),a=r(s),u=e("babel-runtime/core-js/map"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),f=r(l),d=e("babel-runtime/helpers/createClass"),h=r(d),p=e("../utils/Options"),_=e("../../defaultConf"),m=(r(_),function(){function e(t,n){var r=this;(0,f["default"])(this,e),this._segmentListMap=new c["default"],this._conf=n.conf;var o=t.getTrackList();o.forEach(function(e){r._segmentListMap.set(e,[])})}return(0,h["default"])(e,[{key:"insert",value:function(e){var t=this._getMatchingTrack(e),n=(0,p.unwrap)(this._segmentListMap.get(t));if(0===n.length)n.push(e);else if(n[0].getId()>e.getId())n.unshift(e);else for(var r=n.length;r>0;r--)if(e.getId()>n[r-1].getId()){n.splice(r,0,e);break}var o=n.length;if(o>this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH){var i=n.slice(o-this._conf.MAX_DISTRIBUTED_SEGMENT_LIST_LENGTH);this._segmentListMap.set(t,i)}}},{key:"getSegmentListAfter",value:function(e){var t=this._getMatchingTrack(e),n=(0,p.unwrap)(this._segmentListMap.get(t)),r=n.filter(function(t){return t.getId()>e.getId()});return this._segmentListMap.set(t,r),r}},{key:"_getMatchingTrack",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,s=(0,a["default"])(this._segmentListMap);!(t=(o=s.next()).done);t=!0){var u=(0,i["default"])(o.value,1),c=u[0];if(e.isInTrack(c))return c}}catch(l){n=!0,r=l}finally{try{!t&&s["return"]&&s["return"]()}finally{if(n)throw r}}throw new Error("The segment "+e.viewToString()+" belongs to no track")}}]),e}());n["default"]=m,t.exports=n["default"]},{"../../defaultConf":1,"../utils/Options":88,"babel-runtime/core-js/get-iterator":104,"babel-runtime/core-js/map":107,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/slicedToArray":126}],16:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("../utils/Timers"),c=r(u),l=function(){function e(t){(0,i["default"])(this,e),this._exclusionArray=[],this._timers=new c["default"],this._retentionTime=t}return(0,a["default"])(e,[{key:"add",value:function(e){var t=this;this._exclusionArray.push(e),this._timers.setTimeout(function(){t._exclusionArray.splice(0,1)},this._retentionTime)}},{key:"getExclusionList",value:function(){return this._exclusionArray}},{key:"dispose",value:function(){this._timers.clearAll()}}]),e}();n["default"]=l,t.exports=n["default"]},{"../utils/Timers":92,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],17:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){var t=e,n={},r=[],o=[],i=function(e,n){r.push({eventName:e,fn:n}),t.addEventListener(e,n)},s=function(e,t){o.push({eventName:e,fn:t}),window.addEventListener(e,t)},a=function(){for(var e=0;e<r.length;e++){var n=r[e].eventName,o=r[e].fn;t.removeEventListener(n,o)}r=[]},u=function(){for(var e=0;e<o.length;e++){var t=o[e].eventName,n=o[e].fn;window.removeEventListener(t,n)}o=[]},c=function(){a(),u()},l=function(e){function t(){n[e].arguments=arguments}return n[e]={arguments:void 0,handler:t},t},f=function(e){t.addEventListener(e,l(e))},d=function(e,r){if(!n[e])throw new Error("You are trying to trigger an event that have not been cached before");t.removeEventListener(e,n[e].handler),n[e].arguments&&r.apply(void 0,n[e].arguments)};this.addMediaEventListener=i,this.addWindowEventListener=s,this.removeAllExternalEventListener=c,this.cacheMediaEvent=f,this.triggerCachedEvent=d};n["default"]=r,t.exports=n["default"]},{}],18:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utils/Timers"),i=r(o),s=function(){var e=.3,t=0,n=4e3,r=0,o=0,s=0,a=.5,u=0,c=new i["default"],l=function(){r++},f=function(){o++},d=function(){s++},h=function(){var e,n=o/r;return e=isNaN(n)?t:Math.min(n,1),u=e,e},p=function(){var t;return 0!==r&&(t=(1-e)*a+e*h(),a=t),a},_=function(){r=0,o=0,s=0},m=function(){p(),_()},b=function(){c.setInterval(m,n)},v=function(){c.clearAll()};this.incrementNbChunkRequested=function(){return l()},this.incrementNbChunkDownloaded=function(){return f()},this.incrementNbChunkTimeOut=function(){return d()},this.heurisInst=function(){return h()},this.mean=function(){return p()},this.getNbChunkRequested=function(){return r},this.getHeuristicScore=function(){return a},this.getLastHeuristInst=function(){return u},this.dispose=function(){v()},b()};n["default"]=s,t.exports=n["default"]},{"../utils/Timers":92}],19:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n,r){this.city=e,this.country=t,this.latitude=n,this.longitude=r};n["default"]=r,t.exports=n["default"]},{}],20:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/map"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("../../defaultConf"),f=(r(l),e("../utils/Options")),d=function(){function e(t,n){(0,a["default"])(this,e),this._mediaMap=t,this._conf=n.conf,this._cachedSegmentList=new i["default"],this._cachedSegmentTime=new i["default"]}return(0,c["default"])(e,[{key:"getSegmentList",value:function(e,t,n){var r=this._cachedSegmentList.get(e.viewToString());if(r&&r.beginTime===t&&r.duration===n)return r.cachedSegmentList;var o=this._mediaMap.getSegmentList(e,t,n);return this._cachedSegmentList.set(e.viewToString(),{beginTime:t,cachedSegmentList:o,duration:n}),o}},{key:"getSegmentTime",value:function(e){var t=this._cachedSegmentTime.get(e.viewToString());if(void 0!==t)return t;var n=this._mediaMap.getSegmentTime(e);if(this._cachedSegmentTime.set(e.viewToString(),n),this._cachedSegmentTime.size>this._conf.GETSEGMENTTIME_CACHE_MAX_SIZE){var r=this._cachedSegmentTime.keys(),o=r.next().value,i=(0,f.unwrap)(o);this._cachedSegmentTime["delete"](i)}return n}}]),e}();n["default"]=d,t.exports=n["default"]},{"../../defaultConf":1,"../utils/Options":88,"babel-runtime/core-js/map":107,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],21:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"updateCurrentTracks",value:function(e){var t=e.video;t&&(this._currentVideoTrack=t)}},{key:"getVideoTrackHash",value:function(){return this._currentVideoTrack?this._currentVideoTrack.viewToString():"defaultTrackHash"}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],22:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/slicedToArray"),i=r(o),s=e("babel-runtime/helpers/toConsumableArray"),a=r(s),u=e("babel-runtime/core-js/get-iterator"),c=r(u),l=e("babel-runtime/core-js/map"),f=r(l),d=e("./structures/SegmentHandler"),h=r(d),p=e("../utils/Timers"),_=r(p),m=e("./binaryAbstraction/Segment"),b=r(m),v=function(e,t,n,r){function o(e){var t=E.get(e.viewToString());return t?t:!1}function s(e){var t=!0,n=!1,r=void 0;try{for(var o,i=(0,c["default"])(E.values());!(t=(o=i.next()).done);t=!0){var s=o.value;s.seeders.removeSeeder(e)}}catch(a){n=!0,r=a}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw r}}}function u(e){var t=o(e);return t===!1&&(t=new h["default"](e,this,A,j,r),E.set(t.segmentCoord.viewToString(),t),A.requestHasSegment(e),l()),t}function l(){var e,t=0,n=T()?k.LIVE.P2P_CACHE_MAX_SIZE:k.P2P_CACHE_MAX_SIZE,r=0,o=!0,i=!1,s=void 0;try{for(var a,u=(0,c["default"])(E.values());!(o=(a=u.next()).done);o=!0){var l=a.value;if(l.chunkManager.size&&(t+=l.chunkManager.size),t>n){e=E.size-r;break}r++}}catch(f){i=!0,s=f}finally{try{!o&&u["return"]&&u["return"]()}finally{if(i)throw s}}if(e){var d=E.keys(),h=!0,p=!1,_=void 0;try{for(var m,b=(0,c["default"])(d);!(h=(m=b.next()).done);h=!0){var v=m.value;if(0===e)break;var g=E.get(v);E["delete"](v),j.removeSegmentInfo(g.segmentCoord),e--}}catch(f){p=!0,_=f}finally{try{!h&&b["return"]&&b["return"]()}finally{if(p)throw _}}}}function d(e){E["delete"](e.viewToString())}function p(){var e=0,t=0,n=!0,r=!1,o=void 0;try{for(var i,s=(0,c["default"])(E.values());!(n=(i=s.next()).done);n=!0){var a=i.value,u=a.chunkManager.getP2PDownload_CDNDownload();e+=u.p2pDownloaded,t+=u.cdnDownloaded}}catch(l){r=!0,o=l}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw o}}return S.setCDNDoubleCheck(t),S.setP2PDoubleCheck(e),{p2pDownloaded:e,cdnDownloaded:t}}function m(e,t){var n=u(e),r=n.chunkManager,o=new b["default"](t);r.storeSegment(o),A.broadcastSegmentInfo(e)}function v(e){var t=o(e).chunkManager;return t?t.getPartialSegment():!1}function g(e){return[].concat((0,a["default"])(E)).filter(function(t){var n=(0,i["default"])(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&!r.chunkManager.shouldDownloadSegment()}).map(function(e){var t=(0,i["default"])(e,2),n=(t[0],t[1]);return n.segmentCoord})}function y(){return[].concat((0,a["default"])(E)).map(function(e){var t=(0,i["default"])(e,2),n=(t[0],t[1]);return{segmentcoord:n.segmentCoord,downloadStatusList:n.chunkManager.downloadStatus,seederCount:n.seeders.getLength()}})}function w(e){return[].concat((0,a["default"])(E)).filter(function(t){var n=(0,i["default"])(t,2),r=(n[0],n[1]);return r.segmentCoord.isInTrack(e)&&r.chunkManager.isSegmentDownloaded()}).map(function(e){var t=(0,i["default"])(e,2),n=(t[0],t[1]);return n.segmentCoord})}function C(){P.clearAll(),E=new f["default"]}var k=r.conf,S=r.status,E=new f["default"],T=e,j=n,A=t,P=new _["default"];p(),P.setInterval(p,1e4),this.dispose=C,this.getOrCreateSegmentHandler=u,this.removeSegmentHandler=d,this.doubleCheckP2PDownload_CDNDownload=p,this.fillSegment=m,this.getSegmentHandler=o,this.getPartialSegment=v,this.removePeer=s,this.listSegmentsToSkipForTrack=g,this.listSegmentsDownloadStatus=y,this.listDownloadedSegmentsForTrack=w};n["default"]=v,t.exports=n["default"]},{"../utils/Timers":92,"./binaryAbstraction/Segment":43,"./structures/SegmentHandler":73,"babel-runtime/core-js/get-iterator":104,"babel-runtime/core-js/map":107,"babel-runtime/helpers/slicedToArray":126,"babel-runtime/helpers/toConsumableArray":127}],23:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(t,n,r,o){(0,i["default"])(this,e),this._scheduler=t,this._p2pCache=n,this._segmentInfoMap=r,this._distributedSegmentList=o}return(0,a["default"])(e,[{key:"_onHasSegment",value:function(e,t,n){var r=n.pushed;if(this._segmentInfoMap.addSegmentInfo(t),r&&this._distributedSegmentList.insert(t.segmentCoord),this._scheduler.isSegmentRequested(t.segmentCoord)){var o=this._p2pCache.getOrCreateSegmentHandler(t.segmentCoord);o.chunkManager.addSegmentSize(t.size),o.seeders.insertSeeder(e)}}},{key:"_onPeerDestroyed",value:function(e){this._p2pCache.removePeer(e)}}],[{key:"listenEvents",value:function(t,n,r,o,i){var s=new e(n,r,o,i);t.getEE().on("hasSegment",s._onHasSegment.bind(s)).on("peerDestroyed",s._onPeerDestroyed.bind(s))}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],24:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./PartialSegmentInterface"),_=r(p),m=function(e){function t(e){(0,a["default"])(this,t);var n=(0,f["default"])(this,(0,i["default"])(t).call(this));return n._segmentCoord=e,n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"getUpdatedRange",value:function(e){return e}},{key:"getFullSegment",value:function(e,t){t(e,this._segmentCoord)}},{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(_["default"]);n["default"]=m,t.exports=n["default"]},{"./PartialSegmentInterface":25,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125}],25:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u="Method not implemented",c=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"getUpdatedRange",value:function(e){throw new Error(u)}},{key:"getFullSegment",value:function(e,t,n){throw new Error(u)}},{key:"isComplete",value:function(){throw new Error(u)}},{key:"isLocked",value:function(){throw new Error(u)}},{key:"p2pSpeed",get:function(){throw new Error(u)}},{key:"p2pAmount",get:function(){throw new Error(u)}}]),e}();n["default"]=c,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],26:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./PartialSegmentInterface"),_=r(p),m=e("../structures/SegmentInfo"),b=r(m),v=function(e){function t(e,n,r,o){function s(e,t){function o(o,i){e.response=o;var s=new b["default"](h,o.byteLength,i);r.addSegmentInfo(s),n.fillSegment(h,e.response),c.emit("piece_downloaded_prtl",h),t(e,h)}l.callHashWorker(e.response,o)}(0,a["default"])(this,t);var u=o.status,c=o.eventBus,l=o.workerHelper,d=(0,f["default"])(this,(0,i["default"])(t).call(this)),h=e;return d.getFullSegment=function(e,t){c.emit("CDNSegmentDownloaded",h);var n=e.response;u.increaseCDNDownloadedBy(n.byteLength),s(e,t)},d}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"isComplete",value:function(){return!1}},{key:"isLocked",value:function(){return!1}},{key:"getUpdatedRange",value:function(e){return e}},{key:"p2pSpeed",get:function(){return 0}},{key:"p2pAmount",get:function(){return 0}}]),t}(_["default"]);n["default"]=v,t.exports=n["default"]},{"../structures/SegmentInfo":74,"./PartialSegmentInterface":25,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125}],27:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/define-properties"),i=r(o),s=e("babel-runtime/core-js/object/get-prototype-of"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./PartialSegmentInterface"),_=r(p),m=function(e){function t(e,n,r,o,s,u,l,d,h){function p(e,t,r,o){function i(i,s){t.hash===s?(x.setNbRightHashDLM(x.getNbRightHashDLM()+1),e.response=i,_(e),r(e,M)):(x.setNbWrongHashDLM(x.getNbWrongHashDLM()+1),x.increaseCdnDataDiscardedBy(N),n.removeSegmentHandler(M),x.correctP2PDownloaded(S,"HD"),o(e,M))}I.callHashWorker(e.response,i)}function _(e){j=e.response,n.fillSegment(M,e.response),D.emit("piece_downloaded_prtl",M),u.unlockSegmentData(),u.removePartialSegment()}function m(){S=0;for(var e=0;e<A.length;e++)"downloaded"===A[e]&&(S+=e<A.length-1?P.CHUNK_SIZE:s-(A.length-1)*P.CHUNK_SIZE)}function b(){for(var e=0;e<A.length;e++)if("downloaded"!==A[e]&&"CDNdownloaded"!==A[e])return e}function v(){for(var e=A.length-1;e>=0;e--)if("downloaded"!==A[e]&&"CDNdownloaded"!==A[e])return e+1}function g(e){if(!P.RANGE_REQUEST_ALLOWED)return e;var t,n,r=b(),o=v();return void 0!==r&&void 0!==o?(t=e?e.start+r*P.CHUNK_SIZE:r*P.CHUNK_SIZE,o===A.length&&e?n=e.end:o<A.length&&(n=e?e.start+o*P.CHUNK_SIZE-1:o*P.CHUNK_SIZE-1),k={start:r,end:o},{start:t,end:n}):e?e:void 0}function y(){j=r,A=o.slice(),m(),E=x.getMeanInstantSpeed(),T=l}function w(e){if(void 0===k)throw new Error("assertion: _cdnIndexRange is not defined");if(void 0===j)throw new Error("assertion: _segmentData is not defined");try{j.setBinaryData(e,k.start*P.CHUNK_SIZE)}catch(t){throw new Error("Invalid configuration: The current stream has no range request enabled and the p2p configuration has range request set to true.")}return j}function C(e){x.increaseCDNDownloadedBy(e.byteLength)}(0,c["default"])(this,t);var k,S,E,T,j,A,P=h.conf,x=h.status,D=h.eventBus,I=h.workerHelper,R=(0,f["default"])(this,(0,a["default"])(t).call(this)),M=e,O=d,N=0;return R.getFullSegment=function(e,t,n){if(e.p2pMeanThroughput=x.computeP2PThroughput(),this.isComplete())j.getBinaryData(0,j.byteLength,function(n){e.response=n,u.removePartialSegment(),t(e,null)});else{D.emit("CDNSegmentDownloaded",M);var r=e.response;C(r),N=r.byteLength,w(r).getBinaryData(0,j.byteLength,function(r){if(e.response=r,0!==S){u.lockSegmentData();var o=O.getSegmentInfo(M);p(e,o,t,n)}else _(e),t(e,M)})}},R.getUpdatedRange=g,R.getCDNIndexRange=function(){return k},R.isComplete=function(){return T},R.isLocked=function(){return u.dataLocked},y(),(0,i["default"])(R,{p2pSpeed:{get:function(){return E},set:void 0},p2pAmount:{get:function(){return S},set:void 0}}),R}return(0,h["default"])(t,e),t}(_["default"]);n["default"]=m,t.exports=n["default"]},{"./PartialSegmentInterface":25,"babel-runtime/core-js/object/define-properties":110,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125}],28:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Heuristic"),i=r(o),s=e("../utils/Timers"),a=r(s),u=e("../utils/Cartography"),c=r(u),l=e("../metrics/MovingAverage"),f=r(l),d=e("./structures/SegmentInfo"),h=r(d),p=function(e,t,n,r,o){var s,u,l,d,p,_=o.conf,m=o.status,b=o.analyticsData,v=0,g=0,y=0,w=0,C=Date.now(),k=0,S=0,E=Date.now(),T=t,j=e,A=!1,P=b,x=0,D=0,I=new i["default"],R=this,M=new a["default"],O=0,N=new f["default"](_.PEER_INSTANT_SPEED_CALCULATION_WINDOW),L=function(){return c["default"].getDistanceFromLatitudeLongitude(l,m.getMyLocation().latitude,d,m.getMyLocation().longitude)},U=function(){var e=Date.now(),t=e-C;x=y/1024/(t/1e3),D=w/1024/(t/1e3),y=0,w=0,C=e},B=function(){N.addPoint(v-O),O=v},H=function(){return N.compute()/(_.PEER_INSTANT_SPEED_CALCULATION_INTERVAL/1e3)},q=function(){var e=Date.now(),n=(e-E)/1e3,r=v+g-(k+S);r<_.MIN_USEFUL_SPEED*n&&(t.emit("remove_peer",R,!1),W()),k=v,S=g,E=e},F=function ee(){m.getMyLocation().city?r.sendMessage("info",{bufferLevel:m.getBufferLevel(),city:m.getMyLocation().city,country:m.getMyLocation().country,latitude:m.getMyLocation().latitude,longitude:m.getMyLocation().longitude}):m.getEE().once("location_updated",ee)},z=function(e){r.sendMessage("requestHasSegment",e)},V=function(e,t){var n=t.pushed;r.sendMessage("hasSegment",{segmentInfo:e,pushed:n})},K=function(e,t){r.sendMessage("requestChunk",{segmentCoord:e,id_chunk:t}),I.incrementNbChunkRequested()},G=function(){return I.getNbChunkRequested()<_.MAX_CHUNK_BY_SEEDER},W=function(){M.clearAll(),I.dispose(),r.close()},Y=function(){M.clearAll(),I.dispose(),r.destroy()},X=function(){M.setInterval(U,1e3),M.setInterval(q,_.CHECK_USELESS_INTERVAL),M.setInterval(B,_.PEER_INSTANT_SPEED_CALCULATION_INTERVAL),F(),m.incrementNewPeerConnectionCount(),r.once("disconnected",function(){P.disconnected++,t.emit("remove_peer",R,!1),Y()}),r.on("binarydata_received",Z),r.on("message_received",J)},J=function(e,t){switch(e){case"info":s=t.city,u=t.country,l=t.latitude,d=t.longitude,p=t.bufferLevel,P.active++;break;case"requestHasSegment":T.emit("segmentRequested",R,new n(t));break;case"hasSegment":var r=new n(t.segmentInfo.segmentCoord),o=new h["default"](r,t.segmentInfo.size,t.segmentInfo.hash),i=!!t.pushed;T.emit("hasSegment",R,o,{pushed:i});break;case"requestChunk":T.emit("chunkRequested",R,new n(t.segmentCoord),t.id_chunk);break;default:throw new Error("wrong message sent by peerConnection")}},Z=function(e,n,r){y+=e.byteLength,v+=e.byteLength,m.increaseP2PDownloadedUncorrectedBy(e.byteLength),m.setP2PDownloaded(m.getP2PDownloaded()+e.byteLength),t.emit("chunkReceived",R,r,n,e),$()},Q=function(e,t,n){var o=n.byteLength,i=r.sendBinaryData(n,t,e);return i?(w+=o,g+=o,m.increaseP2PUploadedBy(o),void $()):!1},$=function(){A||(P.transfer++,A=!0)};R.getRtt=r.getRtt.bind(r),R.getDistance=L,R.requestHasSegment=z,R.answerHasSegment=V,R.requestChunk=K,R.sendChunk=Q,R.canBeAskedChunk=G,R.close=W,R.getDataDownloaded=function(){return v},R.getDataUploaded=function(){return g},R.getBufferLevel=function(){return p},R.getId=function(){return j},R.getDlSpeed=function(){return x},R.getUpSpeed=function(){return D},R.getBufferedAmount=r.getBufferedAmount.bind(r),R.getHeuristic=function(){return I},R.getDebugInfos=function(){return{country:u,city:s,bufferLevel:p,dlSpeed:x,upSpeed:D,dataDownloaded:v,dataUploaded:g,rtt:r.getRtt(),distance:L()}},this.getMeanInstantSpeed=H,X()};n["default"]=p,t.exports=n["default"]},{"../metrics/MovingAverage":9,"../utils/Cartography":82,"../utils/Timers":92,"./Heuristic":18,"./structures/SegmentInfo":74}],29:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/get-iterator"),i=r(o),s=e("underscore"),a=r(s),u=e("eventemitter3"),c=r(u),l=e("../utils/Timers"),f=r(l),d=e("./Peer"),h=r(d),p=e("./communication/PeerConnector"),_=r(p),m=e("./ExclusionCollection"),b=r(m),v=function(e,t,n,r){var o,s,u=r.conf,l=r.status,d=r.analyticsData,p=e,m=n,v=!1,g=[],y=this,w=new c["default"],C=new b["default"](u.OFFER_DECLINED_TIMEOUT),k=new b["default"](u.PEER_REMOVED_TIMEOUT),S=new b["default"](u.PEER_CONNEXION_ATTEMPT_TIMEOUT),E=new f["default"],T=function(){E.setInterval(j,u.SPEED_MONITOR_INTERVAL),w.on("remove_peer",I),E.setInterval(P,u.MEAN_SPEED_CALCULATION_INTERVAL),p.getEE().on("tracker_ready",x,y),p.getEE().on("tracker_disconnected",D,y)},j=function(){var e=0,t=0;a["default"].forEach(g,function(n){e+=n.getDlSpeed(),t+=n.getUpSpeed()}),l.setDlSpeed(e),l.setUpSpeed(t),l.computeMaxAndAvgSpeed()},A=function(){var e=0;a["default"].forEach(g,function(t){e+=t.getMeanInstantSpeed()});var t=Math.max(0,l.getp2pDownloadedNewAnalytics()),n=l.getP2PDownloadedUncorrected();return n&&(e*=t/n),e},P=function(){var e=A();l.setMeanInstantSpeed(e)},x=function(){void 0!==s&&s.dispose(),s=new _["default"](l.getMyPeerId(),this,t,r),o||(o=E.setInterval(R,u.ASK_PEERS_INTERVAL)),v||R(),v=!0},D=function(){o&&(E.clearInterval(o),o=void 0)},I=function(e){k.add(e.getId()),d.dropped++,w.emit("peerDestroyed",e),g=a["default"].without(g,e)},R=function(){if(g.length<u.MIN_NUMBER_OF_PEERS){var e=M();l.onPeerUpdateRequest();var t=Date.now();p.askPeers(e,function(e,n){if(null===e){var r=Date.now()-t;l.onPeerUpdateResponse(r);var o=0;n.forEach(function(e){e.peers.forEach(function(e){g.length+o<u.MIN_NUMBER_OF_PEERS&&(s.createPeerConnection(e),o++,d.match++)})})}})}},M=function(){var e,t=[];for(e=0;e<g.length;e++)t.push(g[e].getId());return t=t.concat(k.getExclusionList(),C.getExclusionList(),S.getExclusionList())},O=function(){return g.length>=u.MAX_NUMBER_OF_PEERS},N=function(e){g.forEach(function(t){t.requestHasSegment(e)})},L=function(){g.forEach(function(e){e.close(),w.emit("peerDestroyed",e)}),g=[]},U=function(e,n){if(O())n.destroy();else{var o=new h["default"](e,w,t,n,r);g.push(o),d.open++}},B=function(e){C.add(e),d.denied++},H=function(e){S.add(e),d.timeout++},q=function(e){var t=m.getSegmentInfo(e),n=!0,r=!1,o=void 0;try{for(var s,a=(0,i["default"])(g);!(n=(s=a.next()).done);n=!0){var u=s.value;u.answerHasSegment(t,{pushed:!0})}}catch(c){r=!0,o=c}finally{try{!n&&a["return"]&&a["return"]()}finally{if(r)throw o}}},F=function(){p.dispose(),E.clearAll(),L(),C.dispose(),k.dispose(),S.dispose()};y.getPeerArray=function(){return g},y.getPendingConnectionDebugInfos=function(){return s?s.getPendingConnectionDebugInfos():[]},y.requestHasSegment=N,y.getEE=function(){return w},y.isFull=O,y.addPeerConnection=U,this.offerDeclined=B,this.connectionAttemptTimeout=H,y.broadcastSegmentInfo=q,y.dispose=F,T()};n["default"]=v,t.exports=n["default"]},{"../utils/Timers":92,"./ExclusionCollection":16,"./Peer":28,"./communication/PeerConnector":51,"babel-runtime/core-js/get-iterator":104,eventemitter3:255,underscore:302}],30:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=function a(e,t){(0,i["default"])(this,a),this.cdnDownloaded=t.getCDNDownloaded(),this.p2pDowloaded=t.getP2PDownloaded(),this.p2pUploaded=t.getP2PUploaded(),e?this.peers=e.getPeerArray().length():this.peers=0};n["default"]=s,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122}],31:[function(e,t,n){(function(r){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function i(){var e=window.RTCPeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection;return!(!e||oe.isMobile())}Object.defineProperty(n,"__esModule",{value:!0});var s=e("./structures/CurrentTracks"),a=e("./P2PDownloader"),u=o(a),c=e("./ChunkDownloader"),l=o(c),f=e("./ExternalEventManager"),d=o(f),h=e("./PartialSegment/PartialSegmentNoP2P"),p=o(h),_=e("./PartialSegment/PartialSegmentDisableP2P"),m=o(_),b=e("./display/DisplayInterface"),v=o(b),g=e("./TrackerManagerABTest"),y=o(g),w=e("../analytics/AnalyticsReporter"),C=o(w),k=e("../analytics/ErrorReporter"),S=o(k),E=e("./PeerPool"),T=o(E),j=e("./P2PCache"),A=o(j),P=e("./SegmentUploader"),x=o(P),D=e("./ChunkUploader"),I=o(D),R=e("./ChunkReceivedObserver"),M=o(R),O=e("./schedulers/factory"),N=e("./SegmentInfoMap"),L=o(N),U=e("./DistributedSegmentList"),B=o(U),H=e("../utils/Timers"),q=o(H),F=e("./SRModuleInterface"),z=o(F),V=e("../../../graphs/private/BufferDisplay"),K=(o(V),
e("../../../graphs/private/chunkDisplay")),G=(o(K),e("./expectedInterfaces/SegmentCoordInterface")),W=o(G),Y=e("./expectedInterfaces/MapInterface"),X=o(Y),J=e("./expectedInterfaces/TrackCoordInterface"),Z=o(J),Q=e("../utils/Interface"),$=e("./SharedState"),ee=o($),te=e("../utils/StreamTypes"),ne=e("./PublicStatsAPI"),re=o(ne),oe=e("../utils/uaHelper"),ie=window.document.currentScript&&window.document.currentScript.src?window.document.currentScript.src:null,se=function(e,t,n,r,o,a,c){if("string"!=typeof c||""===c||c.length>10)throw new Error("Unvalid argument in PeerAgent constructor: integration version must be a non-empty string of less than 10 characters");var f=new ee["default"](r,t,c),h=new S["default"](ie,f);(0,Q.checkInterface)(X["default"],n),(0,Q.checkInterface)(W["default"],o.prototype),(0,te.assertStreamType)(a);var _,b,g,w,k,E,j,P,D,R,N,U,H,F,V=new q["default"],K=!1,G=a,Y=function(e){var t=e.audio,n=e.video;t&&(0,Q.checkInterface)(Z["default"],t),n&&(0,Q.checkInterface)(Z["default"],n),f.status.incrementTrackSwitchCount(),F.updateCurrentTracks({audio:t,video:n}),f.moduleState.updateCurrentTracks({video:n})},J=function(){var e=new s.CurrentTracks;F=(0,O.createScheduler)(n,w,k,G,e,f)},$=function(){D&&(H.addMediaEventListener("onTrackChange",Y),R=new L["default"],b=new y["default"](e,f),g=new T["default"](b,o,R,f),w=new A["default"](e.isLive.bind(e),g,R,f),E=new M["default"](w,g,f),j=new x["default"](g,R,w),P=new I["default"](w,g,f),k=new B["default"](n,f),J(),_=new l["default"](w,F,f),U=new C["default"](e,f),H.triggerCachedEvent("onTrackChange",Y),u["default"].listenEvents(g,F,w,R,k),ne()),K=!0},ne=function ce(){!e.areBuffersInitialized||e.areBuffersInitialized()?f.conf.DEBUG&&(N=new v["default"](g,e.isLive.bind(e),f)):V.setTimeout(ce,300)},oe=function(){D=i()&&f.conf.ALLOW_P2P,D&&(H=new d["default"](e),H.cacheMediaEvent("onTrackChange"))},se=function(e){if(!D)throw new Error("P2P is not activated, getP2PData can't be called");var t;return K?t=D?w.getPartialSegment(e)||new p["default"](e,w,R,f):new m["default"](e):($(),t=new m["default"](e)),F.updateTrackEdge(e),t},ae=function(e,t,n){return null!==n&&(0,Q.checkInterface)(W["default"],n),z["default"].getSegment(this,e,t,n,f)},ue=function(){D&&(K&&(H.removeAllExternalEventListener(),U.dispose(),_.dispose(),w.dispose(),V.clearAll(),g.dispose(),N&&N.dispose()),f.dispose()),h.dispose()};oe(),this.getSegment=ae,this.getP2PData=se,this.dispose=ue,this.setMediaElement=function(){},Object.defineProperty(this,"stats",{get:function(){return new re["default"](g,f.status)}})};Object.defineProperty(se,"StreamTypes",{get:function(){return te.StreamTypes}}),n["default"]=se,r.Streamroot=r.Streamroot||{},r.Streamroot.uaHelper=oe,Object.defineProperty(r.Streamroot,"p2pAvailable",{get:function(){return i()}}),t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../../../graphs/private/BufferDisplay":98,"../../../graphs/private/chunkDisplay":100,"../analytics/AnalyticsReporter":4,"../analytics/ErrorReporter":5,"../utils/Interface":86,"../utils/StreamTypes":89,"../utils/Timers":92,"../utils/uaHelper":97,"./ChunkDownloader":11,"./ChunkReceivedObserver":13,"./ChunkUploader":14,"./DistributedSegmentList":15,"./ExternalEventManager":17,"./P2PCache":22,"./P2PDownloader":23,"./PartialSegment/PartialSegmentDisableP2P":24,"./PartialSegment/PartialSegmentNoP2P":26,"./PeerPool":29,"./PublicStatsAPI":30,"./SRModuleInterface":32,"./SegmentInfoMap":34,"./SegmentUploader":35,"./SharedState":36,"./TrackerManagerABTest":40,"./display/DisplayInterface":56,"./expectedInterfaces/MapInterface":57,"./expectedInterfaces/SegmentCoordInterface":58,"./expectedInterfaces/TrackCoordInterface":59,"./schedulers/factory":67,"./structures/CurrentTracks":72}],32:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var o=e("babel-runtime/core-js/object/keys"),i=r(o),s=e("babel-runtime/core-js/object/assign"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),f=r(l),d=e("./httpRequestAbstraction/HttpRequest"),h=r(d),p=e("../utils/nativeCalls"),_=function(){},m=function(){function e(t,n,r,o,i){var s=r.onProgress,a=void 0===s?_:s,u=r.onError,l=void 0===u?_:u,f=r.onSuccess,d=void 0===f?_:f,h=this;(0,c["default"])(this,e),this._request=n,this._handlers={onProgress:a,onError:l,onSuccess:d},this._srModule=t,this._analyticsData=i.analyticsData,this._conf=i.conf,this._conf.RETURN_COPY_SEGMENT&&!function(){var e=h._handlers.onSuccess;h._handlers.onSuccess=function(t,n,r){h._analyticsData.p2p+=n.p2pDownloaded,h._analyticsData.cdn+=t.byteLength-n.p2pDownloaded;var o=t.slice(0);e(o,n,r)}}(),this._stats={cdnDownloaded:0,cdnDuration:0},this._segmentCoord=o}return(0,f["default"])(e,[{key:"getSegment",value:function(){try{null===this._segmentCoord?this._getFullSegmentFromCDN():(this._partialSegment=this._srModule.getP2PData(this._segmentCoord),this._setP2PStats(),this._handlers.onProgress(this._stats,this._request),this._partialSegment.isComplete()?this._getFullP2PSegment():this._getRemainingRangeFromCDN())}catch(e){(0,p.nativeError)(e),this._getFullSegmentFromCDN()}return{abort:this._abort.bind(this)}}},{key:"_abort",value:function(){this._httpRequest&&this._httpRequest.abort(),this._handlers.onSuccess=_}},{key:"_getFullP2PSegment",value:function(){var e=this;this._waitSegmentUnlocked(function(t){t?e._fillSegment(void 0):e._getFullSegmentFromCDN()})}},{key:"_getRemainingRangeFromCDN",value:function(){var e=this,t=this._getRangeFromRequest();this._fallbackRange=t,this._rangeToDownload=this._partialSegment.getUpdatedRange(t),this._downloadFromCDN(this._rangeToDownload,function(t,n){return t?void e._handlers.onError(t,e._request):void e._fillSegment(n)})}},{key:"_downloadFromCDN",value:function(e,t){this._httpRequest=new h["default"]("GET",this._request.url),this._httpRequest.validStatusCodeRange={start:200,end:206},this._setHttpRequestHandlers(t),this._setHttpRequestHeaders(e),this._httpRequest.setWithCredentials(!!this._request.withCredentials),this._httpRequest.send(),this._startDownloadCdn=new Date}},{key:"_setHttpRequestHandlers",value:function(e){var t=this;this._httpRequest.onresponse=function(n,r){return n?void e(n,null):(t._stats.cdnDownloaded=r.byteLength||0,t._stats.cdnDuration=new Date-t._startDownloadCdn,void e(null,r))},this._httpRequest.onprogress=function(e){t._stats.cdnDownloaded=e,t._stats.cdnDuration=new Date-t._startDownloadCdn,t._handlers.onProgress(t._stats,t._request)}}},{key:"_setHttpRequestHeaders",value:function(e){var t={},n=this._request.headers;if(n&&void 0!==n.length)throw new Error("Custom headers object should not have a `length` attribute (you might use the previous API format)");n&&((0,a["default"])(t,n),this._rangeToDownload&&delete t.Range),void 0===t.Range&&e&&(t.Range=this._rangeValue(e)),(0,i["default"])(t).length>0&&this._httpRequest.setHeaders(t)}},{key:"_rangeValue",value:function(e){var t=e.start,n=e.end||"";return"bytes="+t+"-"+n}},{key:"_fillSegment",value:function(e){var t=this,n=!1,r=function(e){return function(r,o){n||(n=!0,e.call(t,r,o))}};try{this._partialSegment.getFullSegment({response:e},r(this._onSuccessAsynchronous),r(this._getFullSegmentFromCDN))}catch(o){return(0,p.nativeError)(o),void this._getFullSegmentFromCDN()}setTimeout(function(){n||(n=!0,t._getFullSegmentFromCDN())},this._conf.TIMEOUT_GET_FULL_SEGMENT)}},{key:"_waitSegmentUnlocked",value:function(e){var t=this;if(!this._partialSegment.isLocked())return void e(!0);var n=0,r=setInterval(function(){return t._partialSegment=t._srModule.getP2PData(t._segmentCoord),t._partialSegment.isLocked()?(n+=t._conf.LOCKED_RETRY_INTERVAL,void(n>t._conf.LOCKED_RETRY_TIMEOUT&&(clearInterval(r),e(!1)))):(clearInterval(r),void e(!0))},this._conf.LOCKED_RETRY_INTERVAL)}},{key:"_getRangeFromRequest",value:function(){var e=this._request.headers;if(e&&void 0!==e.Range){var t=e.Range.split("="),n=t[1].split("-");return{start:parseInt(n[0],10),end:parseInt(n[1],10)}}}},{key:"_getFullSegmentFromCDN",value:function(){var e=this;this._stats={p2pDownloaded:0,p2pDuration:0},this._downloadFromCDN(this._fallbackRange,function(t,n){return t?void e._handlers.onError(t,e._request):void e._handlers.onSuccess(n,e._stats,e._request)})}},{key:"_setP2PStats",value:function(){this._stats.p2pDownloaded=this._partialSegment.p2pAmount,this._stats.p2pDuration=0===this._partialSegment.p2pSpeed?0:Math.round(this._partialSegment.p2pAmount/this._partialSegment.p2pSpeed*1e3)}},{key:"_onSuccessAsynchronous",value:function(e){var t=this;setTimeout(function(){t._handlers.onSuccess(e.response,t._stats,t._request)},0)}}]),e}();t.exports={getSegment:function(e,t,n,r,o){var i=new m(e,t,n,r,o);return i.getSegment()}}},{"../utils/nativeCalls":95,"./httpRequestAbstraction/HttpRequest":60,"babel-runtime/core-js/object/assign":108,"babel-runtime/core-js/object/keys":116,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],33:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("underscore"),i=r(o),s=function(){var e=[],t=0,n=function(t){for(var n=e.length,r=0;n>r;r++)if(e[r]===t){e.splice(r,1);break}n=e.length;for(var o=0;n>o;o++){var i=e[o].getHeuristic().getHeuristicScore(),s=t.getHeuristic().getHeuristicScore();if(s>=i)return void e.splice(o,0,t)}e.push(t)},r=function(t){e=i["default"].reject(e,function(e){return e===t})},o=function(){for(var t=0,n=0;n<e.length;n++)t+=e[n].getHeuristic().getHeuristicScore();return t},s=function(n){var r,i=Math.floor(Math.random()*e.length);switch(t){case 0:if(0!==e.length){r=e[i];for(var s=0;s<e.length;s++)if(e[s].getHeuristic().getNbChunkRequested()/e[s].getHeuristic().getHeuristicScore()<=e[e.length-1].getHeuristic().getNbChunkRequested()/e[e.length-1].getHeuristic().getHeuristicScore()&&e[s].canBeAskedChunk()){r=e[s];break}}break;case 1:if(0!==e.length){r=e[i];for(var a=0;a<e.length;a++)if(Math.random()<=e[a].getHeuristic().getHeuristicScore()&&e[a].canBeAskedChunk()){r=e[a];break}}break;case 2:if(0!==e.length){r=e[i];for(var u=0;u<e.length;u++)if(e[u].getHeuristic().getNbChunkRequested()<=Math.floor(e[u].getHeuristic().getHeuristicScore()/o()*n+1)&&e[u].canBeAskedChunk()){r=e[u];break}}break;case 3:if(0!==e.length){r=e[i];for(var c=0;c<e.length;c++)if(e[c].getHeuristic().getNbChunkRequested()/e[c].getHeuristic().getHeuristicScore()<=e[c+1].getHeuristic().getNbChunkRequested()/e[c+1].getHeuristic().getHeuristicScore()&&e[c].canBeAskedChunk()){r=e[c];break}}break;default:r=!1}return r},a=function(){e=[]};this.getNextSeeder=function(e){return s(e)},this.insertSeeder=function(e){n(e)},this.removeSeeder=function(e){r(e)},this.cleanAfterDownloaded=function(){a()},this.getLength=function(){return e.length}};n["default"]=s,t.exports=n["default"]},{underscore:302}],34:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/map"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=function(){function e(){(0,a["default"])(this,e),this._map=new i["default"]}return(0,c["default"])(e,[{key:"addSegmentInfo",value:function(e){var t=e.segmentCoord.viewToString();this._map.set(t,e)}},{key:"getSegmentInfo",value:function(e){var t=e.viewToString(),n=this._map.get(t);if(!n)throw new Error("segmentInfo not found in the map");return n}},{key:"removeSegmentInfo",value:function(e){var t=e.viewToString();this._map["delete"](t)}}]),e}();n["default"]=l,t.exports=n["default"]},{"babel-runtime/core-js/map":107,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],35:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e,t,n){function r(e,t){var n=s.getSegmentHandler(t).chunkManager;if(n){var r=n.getIndexLastChunkInARow();if(r>-1){var i=o.getSegmentInfo(t);return void e.answerHasSegment(i,{pushed:!1})}}}var o=t,i=e,s=n;i.getEE().on("segmentRequested",r)};n["default"]=r,t.exports=n["default"]},{}],36:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/json/stringify"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("./Status"),f=r(l),d=e("../../defaultConf"),h=r(d),p=e("./ModuleState"),_=r(p),m=e("eventemitter3"),b=r(m),v=e("../analytics/AnalyticsData"),g=r(v),y=e("../security/WorkerHelper"),w=r(y),C=e("../utils/confHelper"),k=r(C),S=e("../utils/ContentId"),E=function(){function e(t,n,r){(0,a["default"])(this,e),this.analyticsData=new g["default"];var o=JSON.parse((0,i["default"])(h["default"]));(0,k["default"])(o,t,r),this.conf=o,this.status=new f["default"](this.conf);var s=(0,S.formatContentId)({contentId:t.contentId,contentUrl:n});this.moduleState=new _["default"],this.moduleState.content=s,this.eventBus=new b["default"],this.workerHelper=new w["default"]}return(0,c["default"])(e,[{key:"dispose",value:function(){this.status.dispose(),this.workerHelper.dispose()}}]),e}();n["default"]=E,t.exports=n["default"]},{"../../defaultConf":1,"../analytics/AnalyticsData":3,"../security/WorkerHelper":76,"../utils/ContentId":84,"../utils/confHelper":94,"./ModuleState":21,"./Status":38,"babel-runtime/core-js/json/stringify":106,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,eventemitter3:255}],37:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){this.transferedChunks=[],this._conf=e};r.prototype.calculateSpeed=function(){var e=this.getIndexTransferOneSecondAgo();return e===!1?this.transferedChunks=[]:e>0&&this.transferedChunks.splice(0,e),this.transferedChunks.length*this._conf.CHUNK_SIZE/1024},r.prototype.getIndexTransferOneSecondAgo=function(){for(var e=Date.now(),t=0;t<this.transferedChunks.length;t++)if(e-this.transferedChunks[t]<=1e3)return t;return!1},r.prototype.addChunkTransfer=function(){var e=Date.now();this.transferedChunks.push(e)},n["default"]=r,t.exports=n["default"]},{}],38:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("eventemitter3"),i=r(o),s=e("../utils/Timers"),a=r(s),u=function(e){var t=!1,n={city:null,country:null,latitude:null,longitude:null},r=void 0,o=0,s=0,u=0,c=0,l=0,f=0,d=0,h=0,p=0,_=0,m=0,b=0,v=0,g=0,y=0,w=[],C=0,k=0,S=0,E=0,T=0,j=0,A=0,P=0,x=0,D=0,I=0,R=0,M=0,O=0,N="",L=0,U=0,B=0,H=0,q=0,F=0,z=0,V=[],K=!1,G=-1,W=0,Y=0,X=this,J=void 0,Z=void 0,Q=void 0,$=new i["default"],ee=void 0,te=new a["default"],ne=function(){var e,t,n,r;o&&(o>u&&(u=o),e=s?(s*Z+o)/(Z+1):o,t=Z?Z+1:1,Z=t,s=e),c&&(c>f&&(f=c),n=l?(l*Q+c)/(Q+1):c,r=Q?Q+1:1,Q=r,l=n)},re=function(){var t,n=w,r=Date.now();for(n.push({p2pDownloaded:h,timeStamp:r}),t=n.length-1;t>=0;t--)r-n[t].timeStamp>1e3*e.ABR_DEL_T&&n.splice(t,1)},oe=function(){var e,t,n,r,o=w;return o.length?(e=o[0],t=o[o.length-1],n=t.p2pDownloaded-e.p2pDownloaded,r=(t.timeStamp-e.timeStamp)/1e3,r>0&&n>0?n/r:0):0},ie=function(){G++},se=function(){F++},ae=function(){return F},ue=function(e){z++,V.push(e)},ce=function(){return z},le=function(){var e=0,t=0;if(V.length>0){for(var n=0;n<V.length;n++)e+=V[n];t=e/V.length}return V=[],t},fe=function(){te.clearAll()};X.getMyPeerId=function(){return r},X.setMyPeerId=function(e){r!==e&&(r=e)},X.getMyLocation=function(){return n},X.setMyLocation=function(e){n=e,$.emit("location_updated",e)},X.getDataDownloadedTwice=function(){return J},X.correctP2PDownloaded=function(e,t){isNaN(e)||("PP"===t?(C+=e,h-=e):"PC"===t?(k+=e,h-=e,h=p-e):"CP"===t?(S+=e,h-=e):"CC"===t?E+=e:"HP"===t?(T+=e,h-=e):"HD"===t?(j+=e,h-=e):"M"===t&&(A+=e,h-=e))},te.setInterval(re.bind(X),1e3),X.getDlSpeed=function(){return o},X.setDlSpeed=function(e){o=e},X.getAvgDlSpeed=function(){return s},X.getMaxDlSpeed=function(){return u},X.getUpSpeed=function(){return c},X.setUpSpeed=function(e){c=e},X.getAvgUpSpeed=function(){return l},X.getMaxUpSpeed=function(){return f},X.getP2PDownloaded=function(){return h},X.setP2PDownloaded=function(e){"number"!=typeof e||isNaN(e)||(h=e)},X.getp2pDownloadedNewAnalytics=function(){return p},X.setp2pDownloadedNewAnalytics=function(e){"number"!=typeof e||isNaN(e)||(p=e)},X.getP2PDownloadedUncorrected=function(){return _},X.increaseP2PDownloadedUncorrectedBy=function(e){_+=e},X.getP2PUploaded=function(){return m},X.increaseP2PUploadedBy=function(e){m+=e},X.getRawDataDownloaded=function(){return b},X.increaseRawDataDownloadedBy=function(e){b+=e},X.getRawDataUploaded=function(){return v},X.increaseRawDataUploadedBy=function(e){v+=e},X.getCDNDownloaded=function(){return g},X.increaseCDNDownloadedBy=function(e){g+=e},X.getCdnCancelled=function(){return y},X.increaseCdnCancelledBy=function(e){y+=e},X.getDataDownloadedTwice_PP=function(){return C},X.getDataDownloadedTwice_PC=function(){return k},X.getDataDownloadedTwice_CP=function(){return S},X.getDataDownloadedTwice_CC=function(){return E},X.getDataDownloadedTwice_HP=function(){return T},X.getDataDownloadedTwice_HD=function(){return j},X.getDataDownloadedTwice_M=function(){return A},X.getCdnDataDiscarded=function(){return P},X.increaseCdnDataDiscardedBy=function(e){P+=e},X.getP2PDoubleCheck=function(){return x},X.setP2PDoubleCheck=function(e){x=e},X.getCDNDoubleCheck=function(){return D},X.setCDNDoubleCheck=function(e){D=e},X.getNbRightHashP2P=function(){return I},X.setNbRightHashP2P=function(e){I=e},X.getNbWrongHashP2P=function(){return R},X.setNbWrongHashP2P=function(e){R=e},X.getNbRightHashDLM=function(){return M},X.setNbRightHashDLM=function(e){M=e},X.getNbWrongHashDLM=function(){return O},X.setNbWrongHashDLM=function(e){O=e},X.getTrackerConnectionCount=function(){return L},X.incrementTrackerConnectionCount=function(){L++},X.getTrackerReconnectionCount=function(){return B},X.incrementTrackerReconnectionCount=function(){B++},X.getTrackerDeconnectionCount=function(){return U},X.incrementTrackerDeconnectionCount=function(){U++},X.incrementNewPeerConnectionCount=function(){Y++},X.getNewPeerConnectionCount=function(){return Y},X.getConnected=function(){return t},X.getUpgraded=function(){return K},X.setTrackerConnectionTime=function(e){H=e},X.getTrackerConnectionTime=function(){return H},X.setTrackerVersion=function(e){N=e},X.getTrackerVersion=function(){return N},X.incrementMissedIceCandidateCount=function(){W++},X.getMissedIceCandidateCount=function(){return W},X.setConnected=function(e){e!==t&&(t=e,$.emit("change:connected"),e===!0&&$.emit("tracker_ready"))},X.setUpgraded=function(){K=!0},X.getEE=function(){return $},X.setConnectedToSignalingServer=function(){q=!0},X.setDisconnectedToSignalingServer=function(){q=!1},X.getConnectedToSignalingServer=function(){return q},X.computeMaxAndAvgSpeed=ne,X.computeP2PThroughput=oe,X.setMeanInstantSpeed=function(e){d=e},X.getMeanInstantSpeed=function(){return d},X.setBufferLevel=function(e){ee=e},X.getBufferLevel=function(){return ee},X.incrementTrackSwitchCount=ie,X.getTrackSwitchCount=function(){return G},X.onPeerUpdateRequest=se,X.getPeerUpdateRequestCount=ae,X.onPeerUpdateResponse=ue,X.getPeerUpdateResponseCount=ce,X.getPeerUpdateAvgResponseTime=le,X.dispose=fe};n["default"]=u,t.exports=n["default"]},{"../utils/Timers":92,eventemitter3:255}],39:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./socketIOAbstraction/SocketIO"),i=r(o),s=e("eventemitter3"),a=r(s),u=e("./Location"),c=r(u),l=e("../utils/Timers"),f=r(l),d=function(e,t){this._conf=t.conf,this._status=t.status,this._moduleState=t.moduleState;var n=new a["default"];this.p2pProtocolVersion="2.0.0",this.client2ClientProtocolVersion=this._conf.P2P_PROTOCOL_VERSION,this._playerInterface=e,this.trackerURL=this._conf.TRACKER_URL,this.connect(),this._timers=new f["default"],this.instantiatedTime=Date.now(),this.getEE=function(){return n}};d.prototype.connect=function(){this.socket||(this.socket=new i["default"](this.trackerURL,"tracker"),this.socket.onconnect=this.onTrackerConnected.bind(this),this.socket.onreconnecting=this.onTrackerReconnecting.bind(this),this.socket.ondisconnect=this.onTrackerDisconnected.bind(this),this.socket.onreconnect=this.onTrackerReconnect.bind(this),this.socket.ongetcurrenttracks=this.onGetCurrentTracks.bind(this),this.socket.connect({protocol_version:this._conf.CLIENT_TRACKER_PROTOCOL_VERSION,client_id:this._conf.ID_CLIENT}))},d.prototype.sockEmit=function(e,t,n){(this._status.getConnected()||"init"===e)&&this.socket.emit(e,t,n)},d.prototype.onTrackerConnected=function(){var e={manifest_url:this._moduleState.content,p2p_protocol:this.client2ClientProtocolVersion,client_id:this._conf.ID_CLIENT};this._playerInterface.isLive()&&(e.buffer_level_max=this._playerInterface.getBufferLevelMax()),this.sockEmit("init",e,this.onTrackerReady.bind(this)),this._status.incrementTrackerConnectionCount(),this._timers.setTimeout(this._inspectUsedTransport.bind(this),15e3)},d.prototype._inspectUsedTransport=function(){"websocket"===this.socket.transportName&&this._status.setUpgraded()},d.prototype.onTrackerReady=function(e,t){if(!e){var n=Date.now()-this.instantiatedTime;this._status.setTrackerConnectionTime(n),this._status.setConnected(!0),this._playerInterface.isLive()&&(this._status.setBufferLevel(t.buffer_level),this._playerInterface.setBufferMarginLive(t.buffer_level)),this._status.setMyPeerId(t.peer_id),this.askGeolocation(this._conf.GEOLOCATION_REQUEST_MAX_RETRY),this.getEE().emit("tracker_ready")}},d.prototype.askGeolocation=function(e){var t=this;this._timers.setTimeout(function(){t.sockEmit("geolocation",void 0,t.makeGeolocationAnswerHandler(e))},this._conf.GEOLOCATION_REQUEST_TIMEOUT)},d.prototype.makeGeolocationAnswerHandler=function(e){var t=this;return function(n,r){if(n)0!==e&&t.askGeolocation(e-1);else{var o=new c["default"](r.city,r.country,r.latitude,r.longitude);t._status.setMyLocation(o)}}},d.prototype.onTrackerReconnecting=function(){this._status.setConnected(!1)},d.prototype.onTrackerDisconnected=function(){!this.socketClosed,this._status.setConnected(!1),this._status.incrementTrackerDeconnectionCount(),this.getEE().emit("tracker_disconnected")},d.prototype.onTrackerReconnect=function(){this._status.incrementTrackerReconnectionCount()},d.prototype.onGetCurrentTracks=function(e){var t={tracks:[{track_hash:this._moduleState.getVideoTrackHash()}]};this._playerInterface.isLive()||(t.time_position=this._moduleState.videoCurrentTime),e(null,t)},d.prototype.askPeers=function(e,t){var n={tracks:[{track_hash:this._moduleState.getVideoTrackHash()}],exclusions:e,peer_number:this._conf.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE};this._playerInterface.isLive()?n.buffer_level=this._status.getBufferLevel():n.time_position=this._moduleState.videoCurrentTime,this.sockEmit("get_peers",n,t)},d.prototype.dispose=function(){this.socketClosed=!0,this._timers.clearAll(),this.socket.close()},n["default"]=d,t.exports=n["default"]},{"../utils/Timers":92,"./Location":19,"./socketIOAbstraction/SocketIO":68,eventemitter3:255}],40:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){4===n.readyState&&t(200===n.status?JSON.parse(n.responseText):null)},n.open("GET",e,!0),n.send(null)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/helpers/classCallCheck"),s=r(i),a=e("babel-runtime/helpers/createClass"),u=r(a),c=e("./TrackerManager"),l=r(c),f=e("./TrackerManagerV3"),d=r(f),h=e("eventemitter3"),p=r(h),_=function(){function e(t,n){(0,s["default"])(this,e),this._sharedState=n,this._conf=n.conf,this._status=n.status,this._ee=new p["default"],this._selectImplementation(t)}return(0,u["default"])(e,[{key:"getEE",value:function(){return this._ee}},{key:"askPeers",value:function(e,t){this._implementation.askPeers(e,t)}},{key:"dispose",value:function(){this._implementation.dispose()}},{key:"_selectImplementation",value:function(e){var t=this;o(this._conf.ABTEST_DATA_URL,function(n){var r=0;null!==n&&void 0!==n[t._conf.ID_CLIENT]&&(r=n[t._conf.ID_CLIENT]),Math.random()<r?(t._implementation=new d["default"](e,t._sharedState),t._status.setTrackerVersion("http")):(t._implementation=new l["default"](e,t._sharedState),t._status.setTrackerVersion("sio")),t._rewireEvents()},0)}},{key:"_rewireEvents",value:function(){var e=this.getEE();this._implementation.getEE().on("tracker_ready",e.emit.bind(e,"tracker_ready")),this._implementation.getEE().on("tracker_disconnected",e.emit.bind(e,"tracker_disconnected"))}}]),e}();n["default"]=_,t.exports=n["default"]},{"./TrackerManager":39,"./TrackerManagerV3":41,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,eventemitter3:255}],41:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=new XMLHttpRequest;r.onreadystatechange=function(){4===r.readyState&&(200===r.status?n(null,JSON.parse(r.responseText)):204===r.status?n(null,null):r.status>0&&n(new Error(r.status+": "+r.responseText),null))},r.onerror=function(){n(new Error("connection error"),null)},void 0!==t?(r.open("POST",e,!0),r.send((0,s["default"])(t))):(r.open("GET",e,!0),r.send(null))}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/json/stringify"),s=r(i),a=e("babel-runtime/helpers/classCallCheck"),u=r(a),c=e("babel-runtime/helpers/createClass"),l=r(c),f=e("eventemitter3"),d=r(f),h=e("./Location"),p=r(h),_=e("../utils/Timers"),m=r(_),b=function(){function e(t,n){(0,u["default"])(this,e),this._conf=n.conf,this._status=n.status,this._moduleState=n.moduleState;var r=new d["default"];this._p2pProtocolVersion=this._conf.P2P_PROTOCOL_VERSION,this._trackerProtocolVersion=this._conf.CLIENT_TRACKER_PROTOCOL_VERSION_V3,this._playerInterface=t,this._connected=!1,this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._trackerURL=e.formatUrl(this._conf.TRACKER_URL_V3),this._timers=new m["default"],this._callQueue=[],this._pending=!1,this.getEE=function(){return r},this._init()}return(0,l["default"])(e,[{key:"askPeers",value:function(e,t){var n=function(e,n){return t(e,[n])},r={tracks:[this._moduleState.getVideoTrackHash()],exclusions:e,peer_number:this._conf.MAX_NUMBER_OF_PEERS_ASKED_BY_GET_PEERS_MESSAGE,current_position:this._moduleState.videoCurrentTime,id:this._peerID};this._sendRequest("peers",r,n,!0)}},{key:"dispose",value:function(){this._disconnect(),this._timers.clearAll()}},{key:"_init",value:function(){var e={content:this._moduleState.content,p2p_protocol:this._p2pProtocolVersion,customer_id:this._conf.ID_CLIENT,is_live:this._playerInterface.isLive()};e.is_live&&(e.buffer_level_max=this._playerInterface.getBufferLevelMax()),this._initStartTime=Date.now(),this._sendRequest("init",e,this._onTrackerReady.bind(this),!0)}},{key:"_onTrackerReady",value:function(e,t){if(!e){var n=Date.now()-this._initStartTime;this._status.incrementTrackerConnectionCount(),this._status.setTrackerConnectionTime(n),this._status.setConnected(!0),this._connected=!0,this._playerInterface.isLive()&&(this._status.setBufferLevel(t.buffer_level),this._playerInterface.setBufferMarginLive(t.buffer_level)),this._peerID=t.peer_id,this._status.setMyPeerId(this._peerID),this._askGeolocation(this._conf.GEOLOCATION_REQUEST_MAX_RETRY),this._timers.setNamedInterval("tracks",this._publishTracks.bind(this),this._conf.SEND_TRACKS_INTERVAL),this.getEE().emit("tracker_ready")}}},{key:"_publishTracks",value:function(){var e={tracks:[this._moduleState.getVideoTrackHash()],id:this._peerID,current_position:this._moduleState.videoCurrentTime};this._sendRequest("tracks",e,function(){},!0)}},{key:"_askGeolocation",value:function(e){var t=this;this._timers.setNamedTimeout("geoloc",function(){t._sendRequest("geo",void 0,t._makeGeolocationAnswerHandler(e),!1)},this._conf.GEOLOCATION_REQUEST_TIMEOUT)}},{key:"_makeGeolocationAnswerHandler",value:function(e){var t=this;return function(n,r){if(n)0!==e&&t._askGeolocation(e-1);else{var o=new p["default"](r.city,r.country,r.latitude,r.longitude);t._status.setMyLocation(o)}}}},{key:"_sendRequest",value:function(e,t,n,r){var i=this,s=function(e,t){if(e&&r)return i._disconnect(),i._schedulReconnect(),void n(e,t);var s=i._callQueue.shift();void 0===s?i._pending=!1:o(s.url,s.data,s.callback),n(e,t)},a=this._trackerURL+e;this._pending?this._callQueue.push({url:a,data:t,callback:s}):(this._pending=!0,o(a,t,s))}},{key:"_disconnect",value:function(){this._timers.clearNamedInterval("tracks"),this._timers.clearNamedTimeout("geoloc"),this._timers.clearNamedTimeout("reconnect"),this._pending=!1,this._callQueue=[],this._connected===!0&&(this._delayReconnection=this._conf.TRACKER_DELAY_INIT,this._status.setConnected(!1),this._connected=!1,o(this._trackerURL+"bye",{id:this._peerID},function(){}),this.getEE().emit("tracker_disconnected"))}},{key:"_schedulReconnect",value:function(){this._timers.setNamedTimeout("reconnect",this._init.bind(this),this._delayReconnection),this._delayReconnection=Math.min(2*this._delayReconnection,this._conf.TRACKER_DELAY_MAX)}}],[{key:"formatUrl",value:function(e){return e.endsWith("/")?e:e+"/"}}]),e}();n["default"]=b,t.exports=n["default"]},{"../utils/Timers":92,"./Location":19,"babel-runtime/core-js/json/stringify":106,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,eventemitter3:255}],42:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("underscore"),i=r(o),s=e("./SpeedCalculator"),a=r(s),u=e("../utils/Timers"),c=r(u),l=e("../utils/Delta"),f=function(e){this._conf=e.conf,this._globalEventBus=e.eventBus,this.queue=[],this.peerTimeouts={},this.saturated=!1,this.uploadSpeedCalculator=new a["default"](this._conf),this.uploadLimitation=this._conf.MAX_UP_SPEED,this._timers=new c["default"]};f.prototype.add=function(e,t,n,r,o){this.queue.push({peer:e,segmentCoord:t,id_chunk:n,chunk:r,timeStamp:o}),this.resetPeerTimeout(e),this.sendChunk()},f.prototype.removeFirstChunk=function(){this.queue.splice(0,1)},f.prototype.getChunkToSend=function(){for(var e=Date.now();this.queue.length>0;){if(e-this.queue[0].timeStamp<this._conf.CHUNK_UP_TIMEOUT)return this.queue[0];this.removeFirstChunk(),this._globalEventBus.emit("uploadSaturated")}},f.prototype.sendChunk=function(e){var t=this.uploadSpeedCalculator.calculateSpeed();if(t<this.uploadLimitation&&(!this.saturated||e)){var n=this.getChunkToSend();if(!n)return void this.unsetSaturated();var r=n.peer.getBufferedAmount();if((0,l.isNumeric)(r)&&r<this._conf.UP_MAX_BUFFERED_AMOUNT){this.uploadSpeedCalculator.addChunkTransfer();try{return n.peer.sendChunk(n.segmentCoord,n.id_chunk,n.chunk),this.removeFirstChunk(),this.resetPeerTimeout(n.peer),this.unsetSaturated(),void(this.uploadLimitation+=5)}catch(o){this.uploadLimitation>this._conf.MAX_UP_SPEED&&(this.uploadLimitation=this._conf.MAX_UP_SPEED),this.uploadLimitation>400?this.uploadLimitation-=200:this.uploadLimitation>100?this.uploadLimitation-=50:this.uploadLimitation=Math.ceil(this.uploadLimitation/2),this.setSaturated()}this.checkPeerTimeout(n.peer)}else this.uploadLimitation>30&&(this.uploadLimitation-=20,this.setSaturated())}this.setSaturated()},f.prototype.checkPeerTimeout=function(e){var t=Date.now();this.peerTimeouts[e.getId()]?t-this.peerTimeouts[e.getId()]>this._conf.PEER_UP_TIMEOUT&&this.clearChunksForPeer(e.getId()):this.peerTimeouts[e.getId()]=t},f.prototype.resetPeerTimeout=function(e){delete this.peerTimeouts[e.getId()]},f.prototype.clearChunksForPeer=function(e){this.queue=i["default"].reject(this.queue,function(t){return t.peer.getId()===e})},f.prototype.setSaturated=function(){if(!this.saturated){this.saturated=!0;var e=this._conf.CHUNK_SIZE/1024/(this._conf.MAX_UP_SPEED/1e3);
void 0===this.sendInterval&&(this.sendInterval=this._timers.setInterval(function(){this.sendChunk(!0)}.bind(this),e))}},f.prototype.unsetSaturated=function(){this.saturated===!0,this.saturated=!1,this.queue.length||(this._timers.clearInterval(this.sendInterval),this.sendInterval=void 0)},f.prototype.dispose=function(){this._timers.clearAll()},n["default"]=f,t.exports=n["default"]},{"../utils/Delta":85,"../utils/Timers":92,"./SpeedCalculator":37,underscore:302}],43:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){return new s["default"](e)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./browser/Segment"),s=r(i),a=e("./mobile/Segment");r(a);n["default"]=o,t.exports=n["default"]},{"./browser/Segment":46,"./mobile/Segment":48}],44:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"getBinaryData",value:function(e,t,n){throw new Error("must be implemented")}},{key:"setBinaryData",value:function(e,t){throw new Error("must be implemented")}},{key:"destroy",value:function(){}},{key:"byteLength",get:function(){return this._byteLength},set:function(e){this._byteLength=e}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],45:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=ArrayBuffer,t.exports=n["default"]},{}],46:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("../SegmentInterface"),_=r(p),m=e("./BinaryData"),b=r(m),v=function(e){function t(e){(0,a["default"])(this,t);var n=(0,f["default"])(this,(0,i["default"])(t).call(this));if("number"==typeof e){var r=e;n._binData=new Uint8Array(r)}else{if(!(e instanceof b["default"]))throw new TypeError("Wrong parameter in Segment Constructor");var o=e;n._binData=new Uint8Array(o)}return n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"getBinaryData",value:function(e,t,n){n(new Uint8Array(this._binData.buffer.slice(e,e+t)).buffer)}},{key:"setBinaryData",value:function(e,t){this._binData.set(new Uint8Array(e),t)}},{key:"byteLength",get:function(){return this._binData.byteLength},set:function(e){throw new TypeError("Should not manually set the byteLength")}}]),t}(_["default"]);n["default"]=v,t.exports=n["default"]},{"../SegmentInterface":44,"./BinaryData":45,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125}],47:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=function a(e,t){if((0,i["default"])(this,a),!(e instanceof String||"number"==typeof t))throw new TypeError("Wrong parameter");this.id=e,this.byteLength=t};n["default"]=s,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122}],48:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return e+"-"+t}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/get-prototype-of"),s=r(i),a=e("babel-runtime/helpers/classCallCheck"),u=r(a),c=e("babel-runtime/helpers/createClass"),l=r(c),f=e("babel-runtime/helpers/possibleConstructorReturn"),d=r(f),h=e("babel-runtime/helpers/inherits"),p=r(h),_=e("../SegmentInterface"),m=r(_),b=e("./BinaryData"),v=r(b),g=e("uuid"),y=r(g),w=e("../../../utils/nativeCalls"),C={},k=function(e){function t(e){(0,u["default"])(this,t);var n=(0,d["default"])(this,(0,s["default"])(t).call(this));if(n.id=n._generateId(),"number"==typeof e)n.byteLength=e,(0,w.nativeCall)("segment_created",{id:n.id,size:e});else{if(!(e instanceof v["default"]))throw new TypeError("Wrong parameter in Segment Constructor");n.byteLength=e.byteLength,(0,w.nativeCall)("segment_created",{id:n.id,binaryDataId:e.id})}return n.callbacks={},n}return(0,p["default"])(t,e),(0,l["default"])(t,[{key:"_generateId",value:function(){return y["default"].v4()}},{key:"getBinaryData",value:function(e,t,n){var r=o(e,t);C[r]=n;var i={segmentId:this.id,offset:e,size:t};(0,w.nativeCall)("get_binary_data",i)}},{key:"setBinaryData",value:function(e,t){if(!(e instanceof v["default"]||"number"==typeof t))throw new TypeError("Wrong parameter");var n={segmentId:this.id,offset:t,binaryDataId:e.id};(0,w.nativeCall)("set_binary_data",n)}},{key:"destroy",value:function(){var e={segmentId:this.id};(0,w.nativeCall)("destroy_segment",e)}}],[{key:"getBinaryDataCallback",value:function(e,t,n,r){var i=o(t,r),s=C[i],a=new v["default"](n,parseInt(r,10));s(a)}}]),t}(m["default"]);n["default"]=k,t.exports=n["default"]},{"../../../utils/nativeCalls":95,"../SegmentInterface":44,"./BinaryData":47,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125,uuid:304}],49:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"sendMessage",value:function(){throw new Error("One should not call sendMessage on a PeerConnection that has already been destroyed")}},{key:"sendBinaryData",value:function(){throw new Error("One should not call sendBinaryData on a PeerConnection that has already been destroyed")}},{key:"getRtt",value:function(){throw new Error("One should not call getRtt on a PeerConnection that has already been destroyed")}},{key:"getBufferedAmount",value:function(){throw new Error("One should not call getBufferedAmount on a PeerConnection that has already been destroyed")}},{key:"destroy",value:function(){throw new Error("One should not call destroy on a PeerConnection that has already been destroyed")}},{key:"close",value:function(){throw new Error("One should not call close on a PeerConnection that has already been destroyed")}},{key:"on",value:function(){throw new Error("One should not call on on a PeerConnection that has already been destroyed")}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],50:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r){function o(){t.onclose=function(){E.emit("disconnected")},t.onerror=function(e){E.emit("disconnected")},t.onmessage=y,w(),j.setInterval(f,k.PEER_COMPUTE_RTT_INTERVAL)}function i(e,n){if("open"===t.readyState){var r=(0,u["default"])({type:e,args:n});C.increaseRawDataUploadedBy(r.length),t.send(r)}else E.emit("disconnected")}function a(e,n,r){var o=(0,_.encodeMetaData)(r,n,e);return"open"===t.readyState?(t.send(o),!0):(E.emit("disconnected"),!1)}function c(){return T}function f(){var t;e&&(navigator.mozGetUserMedia?e.getStats(null,function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];if(void 0!==n.mozRtt){T=n.mozRtt;break}}},function(){}):e.getStats(function(e){var n,r,o=e.result();for(r=0;r<o.length;r++)if(n=o[r],""!==n.stat("googRtt")){t=n.stat("googRtt"),T=parseFloat(t);break}}))}function h(){return t.bufferedAmount}function m(){t.close(),e.close(),this.destroy()}function b(){j.clearAll(),(0,s["default"])(this,new p["default"])}function v(e,t){E.on(e,t)}function g(e,t){E.once(e,t)}function y(e){if(C.increaseRawDataDownloadedBy(e.data.length),S=!0,"string"==typeof e.data){var t=JSON.parse(e.data);switch(t.type){case"heartbeat":break;default:E.emit("message_received",t.type,t.args)}}else{var r=(0,_.parseMetaData)(e.data,n.fromArrayBuffer);E.emit("binarydata_received",r.data,r.id_chunk,r.segmentCoord)}}function w(){j.setInterval(function(){S===!0?S=!1:(E.emit("disconnected"),"open"===t.readyState&&(t.close(),e.close()))},k.CHECK_HEARTBEAT_INTERVAL),j.setInterval(function(){return i("heartbeat")},k.SEND_HEARTBEAT_INTERVAL)}var C=r.status,k=r.conf;this.sendMessage=i,this.sendBinaryData=a,this.getRtt=c,this.getBufferedAmount=h,this.destroy=b,this.close=m,this.on=v,this.once=g;var S=!0,E=new l["default"],T=-1,j=new d["default"];o()}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/object/assign"),s=r(i),a=e("babel-runtime/core-js/json/stringify"),u=r(a),c=e("eventemitter3"),l=r(c),f=e("../../utils/Timers"),d=r(f),h=e("./DestroyedPeerConnection"),p=r(h),_=e("../../utils/ChunkMetadata");n["default"]=o,t.exports=n["default"]},{"../../utils/ChunkMetadata":83,"../../utils/Timers":92,"./DestroyedPeerConnection":49,"babel-runtime/core-js/json/stringify":106,"babel-runtime/core-js/object/assign":108,eventemitter3:255}],51:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r){return new a["default"](e,t,n,r)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./mobile/PeerConnector"),s=(r(i),e("./browser/PeerConnector")),a=r(s);n["default"]=o,t.exports=n["default"]},{"./browser/PeerConnector":53,"./mobile/PeerConnector":55}],52:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/json/stringify"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("underscore"),f=r(l),d=function(){function e(t){(0,a["default"])(this,e),this._conf=t.conf,this._status=t.status,this._init()}return(0,c["default"])(e,[{key:"connect",value:function(e,t){this._url=e,this._id=t,this._createConnection()}},{key:"send",value:function(e){if(this._connection&&this._connection.readyState===WebSocket.OPEN){var t=e.receiver_id+","+(0,i["default"])(f["default"].omit(e,"receiver_id"));this._connection.send(t)}else this._msgBuffer.push(e)}},{key:"on",value:function(e,t){this._handlers[e]=t}},{key:"close",value:function(){this._disposing=!0,this._status.setDisconnectedToSignalingServer(),this._stopReconnectionLoop(),this._connection&&this._connection.close(),void 0!==this._connectionTimeout&&(clearTimeout(this._connectionTimeout),delete this._connectionTimeout),void 0!==this._nextReconnectAttempt&&(clearTimeout(this._nextReconnectAttempt),delete this._nextReconnectAttempt),this._init()}},{key:"_createConnection",value:function(){!this._connection||this._connection.readyState!==WebSocket.CONNECTING&&this._connection.readyState!==WebSocket.OPEN||this.close();var e="4.0.7";this._connection=new WebSocket(this._url+"?id="+this._id+"&p2pVersion="+e+"&client_id="+this._conf.ID_CLIENT);var t=this._connection;this._connectionTimeout=setTimeout(function(){t.close()},1e4),this._handleConnectionSuccess(),this._handleErrorAndClose(),this._handleMessages()}},{key:"_handleErrorAndClose",value:function(){var e=this,t=this._connection,n=function(){t===e._connection&&(e._status.setDisconnectedToSignalingServer(),e._tryReconnect())};this._connection.onerror=n,this._connection.onclose=n}},{key:"_tryReconnect",value:function(){var e=this,t=function(){delete e._nextReconnectAttempt,e._createConnection(),e._updateDelay()};void 0!==this._nextReconnectAttempt||this._disposing||(this._nextReconnectAttempt=setTimeout(t,this._delayReconnection))}},{key:"_updateDelay",value:function(){this._delayReconnection=Math.min(this._delayReconnection+this._conf.SIGNALING_DELAY_STEP,this._conf.SIGNALING_DELAY_MAX)}},{key:"_handleConnectionSuccess",value:function(){var e=this;this._connection.onopen=function(){e._status.setConnectedToSignalingServer(),clearTimeout(e._connectionTimeout),delete e._connectionTimeout,e._stopReconnectionLoop(),e._sendMessagesInBuffer()}}},{key:"_handleMessages",value:function(){var e=this;this._connection.onmessage=function(t){var n=JSON.parse(t.data);if(e._handlers[n.type]){var r=f["default"].omit(n,"type");e._handlers[n.type](r)}}}},{key:"_init",value:function(){this._handlers={},this._delayReconnection=0,this._msgBuffer=[]}},{key:"_stopReconnectionLoop",value:function(){this._delayReconnection=0}},{key:"_sendMessagesInBuffer",value:function(){this._msgBuffer.forEach(this.send.bind(this)),this._msgBuffer=[]}}]),e}();n["default"]=d,t.exports=n["default"]},{"babel-runtime/core-js/json/stringify":106,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,underscore:302}],53:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){}Object.defineProperty(n,"__esModule",{value:!0});var i=e("babel-runtime/core-js/get-iterator"),s=r(i),a=e("babel-runtime/core-js/map"),u=r(a),c=e("babel-runtime/helpers/classCallCheck"),l=r(c),f=e("babel-runtime/helpers/createClass"),d=r(f),h=e("../SignalingClient"),p=r(h),_=e("../PeerConnection"),m=r(_),b=e("../../../utils/WebRTC"),v=r(b),g=e("../../../utils/Bucket"),y=r(g),w=e("../../../utils/Timers"),C=r(w),k=function(){function e(t,n,r,o){(0,l["default"])(this,e),this._sharedState=o,this._conf=o.conf,this._status=o.status,this._signalingClient=new p["default"](o),this._myPeerId=t,this._peerPool=n,this._analyticsData=o.analyticsData,this._signalingClient.connect(this._conf.SIGNALING_URL,t),this._signalingClient.on("webrtc_offer",this._onOffer.bind(this)),this._signalingClient.on("webrtc_answer",this._onAnswer.bind(this)),this._signalingClient.on("webrtc_icecandidate",this._onIceCandidate.bind(this)),this._peerConnectionCollection=new u["default"],this.SegmentCoord=r,this._timers=new C["default"]}return(0,d["default"])(e,[{key:"createPeerConnection",value:function(e){var t=this,n=Math.random().toString().substr(2),r=v["default"].createPeerConnection(this._conf),i=r.createDataChannel("comm",{ordered:!1,maxPacketLifeTime:1e3});i.binaryType="arraybuffer";var s=this._timers.setTimeout(function(){t._onConnexionTimeout(e,n)},this._conf.PEER_CONNECTION_TIMEOUT),a=this._createOpenDataChannelHandler(r,i,s,e,n);i.onopen=a,this._peerConnectionCollection.set(n,{pc:r,connectionTimeout:s,dataChannel:i}),r.createOffer(function(i){r.setLocalDescription(i,function(){var r=v["default"].transformOutgoingSdp(i.sdp),o={type:"webrtc_offer",connexion_id:n,sender_id:t._myPeerId,receiver_id:e,sdp:r};t._signalingClient.send(o)},o)},o),this._manageIceCandidate(r,e,n)}},{key:"_manageIceCandidate",value:function(e,t,n){var r=this._createIceCandidateBucket(this._myPeerId,t,n);e.onicecandidate=function(e){e.candidate&&r.addElement(e.candidate)}}},{key:"_onConnexionRefused",value:function(e,t){var n=this._peerConnectionCollection.get(t),r=n.pc;r.close(),this._peerConnectionCollection["delete"](t),this._peerPool.offerDeclined(e)}},{key:"_onConnexionTimeout",value:function(e,t){var n=this._peerConnectionCollection.get(t),r=n.pc;r.close(),this._peerConnectionCollection["delete"](t),this._peerPool.connectionAttemptTimeout(e)}},{key:"_onOffer",value:function(e){var t=this;this._analyticsData.offer++;var n=e.sender_id,r=e.connexion_id;if(this._peerPool.isFull()){var i={type:"webrtc_answer",connexion_id:r,sender_id:this._myPeerId,receiver_id:n,accepted:!1};return void this._signalingClient.send(i)}var s=v["default"].createPeerConnection(this._conf);this._peerConnectionCollection.set(r,{pc:s}),this._manageIceCandidate(s,n,r);var a={sdp:e.sdp,type:"offer"},u=new v["default"].SessionDescription(a);s.setRemoteDescription(u,function(){s.createAnswer(function(e){s.setLocalDescription(e,function(){e.sdp=v["default"].transformOutgoingSdp(e.sdp);var o={type:"webrtc_answer",connexion_id:r,sender_id:t._myPeerId,receiver_id:n,accepted:!0,sdp:e.sdp};t._signalingClient.send(o)},o)},o)},o);var c=this._timers.setTimeout(function(){t._onConnexionTimeout(n,r)},this._conf.PEER_CONNECTION_TIMEOUT);s.ondatachannel=function(e){var i=e.channel||e;i.binaryType="arraybuffer";var a=t._createOpenDataChannelHandler(s,i,c,n,r);"connecting"===i.readyState?i.onopen=a:a(),i.onerror=o}}},{key:"_createOpenDataChannelHandler",value:function(e,t,n,r,o){var i=this;return function(){if(i._peerConnectionCollection.get(o)){i._peerConnectionCollection["delete"](o),i._timers.clearTimeout(n);var s=new m["default"](e,t,i.SegmentCoord,i._sharedState);i._peerPool.addPeerConnection(r,s)}}}},{key:"_onAnswer",value:function(e){var t=e.sender_id,n=e.connexion_id;if(this._peerConnectionCollection.get(n)){var r=this._peerConnectionCollection.get(n),i=r.pc,s=r.connectionTimeout;if(i)if(e.accepted){var a={sdp:e.sdp,type:"answer"},u=new v["default"].SessionDescription(a);i.setRemoteDescription(u,function(){},o)}else this._timers.clearTimeout(s),this._onConnexionRefused(t,n)}}},{key:"_onIceCandidate",value:function(e){var t=this,n=e.connexion_id;if(this._peerConnectionCollection.get(n)){var r=this._peerConnectionCollection.get(n),o=r.pc;e.icecandidate_array.forEach(function(e){t._addIceCandidate(o,e)})}}},{key:"_addIceCandidate",value:function(e,t){try{e.addIceCandidate(new v["default"].IceCandidate(t))}catch(n){}}},{key:"_createIceCandidateBucket",value:function(e,t,n){var r=this,o=function(o){var i={type:"webrtc_icecandidate",connexion_id:n,sender_id:e,receiver_id:t,icecandidate_array:o};r._signalingClient.send(i)},i=new y["default"](o,this._status.incrementMissedIceCandidateCount,this._conf.ICECANDIDATES_TIMEOUT);return i}},{key:"dispose",value:function(){this._signalingClient.close(),this._timers.clearAll();var e=!0,t=!1,n=void 0;try{for(var r,o=(0,s["default"])(this._peerConnectionCollection.values());!(e=(r=o.next()).done);e=!0){var i=r.value.pc;i.close()}}catch(a){t=!0,n=a}finally{try{!e&&o["return"]&&o["return"]()}finally{if(t)throw n}}}},{key:"getPendingConnectionDebugInfos",value:function(){var e=[],t=!0,n=!1,r=void 0;try{for(var o,i=(0,s["default"])(this._peerConnectionCollection.values());!(t=(o=i.next()).done);t=!0){var a=o.value,u=a.pc,c=u.iceGatheringState,l=u.signalingState,f=u.iceConnectionState,d=a.dataChannel?a.dataChannel.readyState:null;e.push({iceGatheringState:c,signalingState:l,iceConnectionState:f,readyState:d})}}catch(h){n=!0,r=h}finally{try{!t&&i["return"]&&i["return"]()}finally{if(n)throw r}}return e}}]),e}();n["default"]=k,t.exports=n["default"]},{"../../../utils/Bucket":80,"../../../utils/Timers":92,"../../../utils/WebRTC":93,"../PeerConnection":50,"../SignalingClient":52,"babel-runtime/core-js/get-iterator":104,"babel-runtime/core-js/map":107,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],54:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/json/stringify"),i=r(o),s=e("babel-runtime/core-js/object/get-prototype-of"),a=r(s),u=e("babel-runtime/helpers/classCallCheck"),c=r(u),l=e("babel-runtime/helpers/createClass"),f=r(l),d=e("babel-runtime/helpers/possibleConstructorReturn"),h=r(d),p=e("babel-runtime/helpers/inherits"),_=r(p),m=e("eventemitter3"),b=r(m),v=e("../../../utils/nativeCalls"),g=e("../../../utils/Timers"),y=r(g),w=e("../../binaryAbstraction/mobile/BinaryData"),C=r(w),k={},S=function(e){function t(e,n){(0,c["default"])(this,t);var r=(0,h["default"])(this,(0,a["default"])(t).call(this));return r._conf=n,k[e]=r,r.connectionId=e,r._timers=new y["default"],r._manageHeartbeat(),r._isCommunicating=!0,r}return(0,_["default"])(t,e),(0,f["default"])(t,[{key:"sendMessage",value:function(e,t){var n=(0,i["default"])({type:e,args:t}),r={connection_id:this.connectionId,message:n};(0,v.nativeCall)("peer_connection_send_message",r)}},{key:"sendBinaryData",value:function(e,t,n){var r={connection_id:this.connectionId,binary_data_id:e.id,chunk_id:t,segment_coord:n};return(0,v.nativeCall)("peer_connection_send_data",r),!0}},{key:"getRtt",value:function(){return-1}},{key:"getBufferedAmount",value:function(){return 0}},{key:"destroy",value:function(){delete k[this.connectionId],this._timers.clearAll()}},{key:"close",value:function(){(0,v.nativeCall)("peer_connection_close",{connectionId:this.connectionId}),this.destroy()}},{key:"_manageHeartbeat",value:function(){var e=this;this._timers.setInterval(function(){e._isCommunicating===!0?e._isCommunicating=!1:(e.emit("disconnected"),(0,v.nativeCall)("peer_connection_close",{connection_id:e.connectionId}))},this._conf.CHECK_HEARTBEAT_INTERVAL),this._timers.setInterval(function(){return e.sendMessage("heartbeat")},this._conf.SEND_HEARTBEAT_INTERVAL)}}],[{key:"receivedMessage",value:function(e,t){var n=JSON.parse(t);switch(n.type){case"heartbeat":break;default:var r=k[e];r._isCommunicating=!0,r.emit("message_received",n.type,n.args)}}},{key:"receivedData",value:function(e,t,n,r,o){var i=new C["default"](t,parseInt(n,10)),s=k[e];s._isCommunicating=!0,s.emit("binarydata_received",i,r,o)}},{key:"onDisconnect",value:function(e){var t=k[e];t&&t.emit("disconnected")}}]),t}(b["default"]);n["default"]=S,t.exports=n["default"]},{"../../../utils/Timers":92,"../../../utils/nativeCalls":95,"../../binaryAbstraction/mobile/BinaryData":47,"babel-runtime/core-js/json/stringify":106,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125,eventemitter3:255}],55:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("../../../utils/nativeCalls"),c=e("./PeerConnection"),l=r(c),f=void 0,d=function(){function e(t,n,r){(0,i["default"])(this,e),this._conf=r,this.peerId=t,f=n}return(0,a["default"])(e,[{key:"createPeerConnection",value:function(e){var t={peerId:this.peerId,remotePeerId:e};(0,u.nativeCall)("signaling_create_peer_connection",t)}}],[{key:"peerConnectionCallback",value:function(e,t,n){switch(e){case"success":var r=new l["default"](t,this._conf);f.addPeerConnection(n,r);break;case"timeout":f.connectionAttemptTimeout(n);break;case"declined":f.offerDeclined(n);break;default:(0,u.nativeError)("[SIGNALING] bad status")}}}]),e}();n["default"]=d,t.exports=n["default"]},{"../../../utils/nativeCalls":95,"./PeerConnection":54,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],56:[function(e,t,n){(function(e){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(t,n,r){var o=r.status,i=function(){var e,r={download:{p2pDownloaded:o.getP2PDownloaded(),p2pDownloadedNewAnalytics:o.getp2pDownloadedNewAnalytics(),p2pUploaded:o.getP2PUploaded(),cdnDownloaded:o.getCDNDownloaded(),dlSpeed:o.getDlSpeed(),upSpeed:o.getUpSpeed()},peers:{count:0},bufferLevel:o.getBufferLevel(),tracker:{connected:o.getConnected()},trackerConnected:o.getConnected(),sigConnected:o.getConnectedToSignalingServer(),isLive:n()},i=[];for(e=0;e<t.getPeerArray().length;e++){var s=t.getPeerArray()[e];s.getId()&&r.peers.count++,i.push(s.getDebugInfos())}return r.peerList=i,r},s=function(){e.SR_DISPLAY_INTERFACE={getStats:i}};s(),this.dispose=function(){delete window.SR_DISPLAY_INTERFACE}};n["default"]=r,t.exports=n["default"]}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],57:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"getSegmentTime",value:function(e){}},{key:"getSegmentList",value:function(e,t,n){}},{key:"getTrackList",value:function(){}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],58:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"isEqual",value:function(e){return!0}},{key:"viewToString",value:function(){return""}},{key:"toArrayBuffer",value:function(){return new ArrayBuffer(0)}},{key:"isInTrack",value:function(e){return!1}},{key:"getId",value:function(){return 0}}],[{key:"fromArrayBuffer",value:function(t){return new e}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],59:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"viewToString",value:function(){return""}},{key:"isEqual",value:function(e){return!0}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],60:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return new s["default"](e,t)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./browser/HttpRequest"),s=r(i),a=e("./mobile/HttpRequest");r(a);o.progress=function(e,t,n){},o.response=function(e,t,n,r){},n["default"]=o,t.exports=n["default"]},{"./browser/HttpRequest":62,"./mobile/HttpRequest":63}],61:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(){(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"setHeaders",value:function(e){throw new Error("must be implemented")}},{key:"setWithCredentials",value:function(e){throw new Error("must be implemented")}},{key:"send",value:function(){throw arguments.length<=0||void 0===arguments[0]?null:arguments[0],new Error("must be implemented")}},{key:"abort",value:function(){throw new Error("must be implemented")}},{key:"validStatusCodeRange",get:function(){return this._statusCodeRange},set:function(e){this._statusCodeRange=e}},{key:"onresponse",set:function(e){throw new Error("must be implemented")},get:function(){throw new Error("must be implemented")}},{key:"onprogress",set:function(e){throw new Error("must be implemented")},get:function(){throw new Error("must be implemented")}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],62:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/keys"),i=r(o),s=e("babel-runtime/core-js/get-iterator"),a=r(s),u=e("babel-runtime/core-js/object/get-prototype-of"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),f=r(l),d=e("babel-runtime/helpers/createClass"),h=r(d),p=e("babel-runtime/helpers/possibleConstructorReturn"),_=r(p),m=e("babel-runtime/helpers/inherits"),b=r(m),v=e("../HttpRequestInterface"),g=r(v),y=function(e){function t(e,n){(0,f["default"])(this,t);var r=(0,_["default"])(this,(0,c["default"])(t).call(this));return r._xhr=new XMLHttpRequest,r._xhr.open(e,n,!0),r._xhr.responseType="arraybuffer",r}return(0,b["default"])(t,e),(0,h["default"])(t,[{key:"setHeaders",value:function(e){var t=!0,n=!1,r=void 0;try{for(var o,s=(0,a["default"])((0,i["default"])(e));!(t=(o=s.next()).done);t=!0){var u=o.value;this._xhr.setRequestHeader(u,e[u])}}catch(c){n=!0,r=c}finally{try{!t&&s["return"]&&s["return"]()}finally{if(n)throw r}}}},{key:"setWithCredentials",value:function(e){this._xhr.withCredentials=e}},{key:"send",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];this._xhr.send(e)}},{key:"abort",value:function(){this._xhr.abort()}},{key:"onresponse",set:function(e){var t=this;this._onreponseCallback=e,this._xhr.onloadend=function(e){var n=t._xhr.status,r=n>=t.validStatusCodeRange.start&&n<=t.validStatusCodeRange.end;r?t._onreponseCallback(null,t._xhr.response):t._onreponseCallback(e,null)},this._xhr.onerror=function(e){t._onreponseCallback(e,null)}},get:function(){return this._onreponseCallback}},{key:"onprogress",set:function(e){var t=this;this._onprogressCallback=e,this._xhr.onprogress=function(e){t._onprogressCallback(e.loaded,e.total)}},get:function(){return this._onprogressCallback}}]),t}(g["default"]);n["default"]=y,t.exports=n["default"]},{"../HttpRequestInterface":61,"babel-runtime/core-js/get-iterator":104,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/core-js/object/keys":116,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125}],63:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("../HttpRequestInterface"),_=r(p),m=e("uuid"),b=r(m),v=e("../../binaryAbstraction/mobile/BinaryData"),g=r(v),y=e("../../../utils/nativeCalls"),w={},C=function(e){function t(e,n){(0,a["default"])(this,t);var r=(0,f["default"])(this,(0,i["default"])(t).call(this));return r.id=b["default"].v4(),r._method=e,r._url=n,r._withCredentials=!1,r._headers=[],r}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"setHeaders",value:function(e){this._headers=e}},{key:"setWithCredentials",value:function(e){this._withCredentials=e}},{key:"send",value:function(){var e=arguments.length<=0||void 0===arguments[0]?null:arguments[0];w[this.id]=this;var t={id:this.id,method:this._method,url:this._url,headers:this._headers,with_credentials:this._withCredentials,valid_status_code_range:this.validStatusCodeRange};null!==e&&(t.body=e),(0,y.nativeCall)("send_http_request",t)}},{key:"abort",value:function(){}},{key:"onresponse",set:function(e){this._onreponseCallback=e},get:function(){return this._onreponseCallback}},{key:"onprogress",set:function(e){this._onprogressCallback=e},get:function(){return this._onprogressCallback}}],[{key:"progress",value:function(e,t,n){w[e].onprogress(t,n)}},{key:"response",value:function(e,t,n,r){var o=new g["default"](t,parseInt(n,10));w[e].onresponse(r,o)}}]),t}(_["default"]);n["default"]=C,t.exports=n["default"]},{"../../../utils/nativeCalls":95,"../../binaryAbstraction/mobile/BinaryData":47,"../HttpRequestInterface":61,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125,uuid:304}],64:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/array/from"),i=r(o),s=e("babel-runtime/core-js/map"),a=r(s),u=e("babel-runtime/core-js/get-iterator"),c=r(u),l=e("babel-runtime/helpers/classCallCheck"),f=r(l),d=e("babel-runtime/helpers/createClass"),h=r(d),p=e("underscore"),_=r(p),m=e("../structures/TrackEdges"),b=r(m),v=e("../MediaMapCache"),g=r(v),y=e("../../../defaultConf"),w=(r(y),
function(){function e(t,n,r,o,i){(0,f["default"])(this,e),this._conf=i.conf,this._p2pCache=n,this._distributedSegmentList=r,this._currentTracks=o,this._mediaMapCache=new g["default"](t,i),this._edges=new b["default"](this._mediaMapCache,i)}return(0,h["default"])(e,[{key:"updateCurrentTracks",value:function(e){this._currentTracks.update(e)}},{key:"_getSegmentsToDownloadByTrack",value:function(e,t){var n=[],r=void 0;if(r="audio"===t?this._edges.audio:this._edges.video){var o=this._mediaMapCache.getSegmentTime(r),i=this._mediaMapCache.getSegmentList(e,o,this._conf.MAX_BUFFER_DURATION),s=this._distributedSegmentList.getSegmentListAfter(r),a=this._mergeDedupe(i,s),u=this._p2pCache.listSegmentsToSkipForTrack(e);n=this._getDifference(a,u)}return n}},{key:"isSegmentRequested",value:function(e){var t=this.getSegmentListToDownload(),n=!0,r=!1,o=void 0;try{for(var i,s=(0,c["default"])(t);!(n=(i=s.next()).done);n=!0){var a=i.value;if(e.isEqual(a))return!0}}catch(u){r=!0,o=u}finally{try{!n&&s["return"]&&s["return"]()}finally{if(r)throw o}}return!1}},{key:"_getDifference",value:function(e,t){return _["default"].reject(e,function(e){return void 0!==_["default"].find(t,function(t){return e.isEqual(t)})})}},{key:"_mergeDedupe",value:function(e,t){var n=new a["default"],r=!0,o=!1,s=void 0;try{for(var u,l=(0,c["default"])(e);!(r=(u=l.next()).done);r=!0){var f=u.value;n.set(f.viewToString(),f)}}catch(d){o=!0,s=d}finally{try{!r&&l["return"]&&l["return"]()}finally{if(o)throw s}}var h=!0,p=!1,_=void 0;try{for(var m,b=(0,c["default"])(t);!(h=(m=b.next()).done);h=!0){var v=m.value;n.set(v.viewToString(),v)}}catch(d){p=!0,_=d}finally{try{!h&&b["return"]&&b["return"]()}finally{if(p)throw _}}return(0,i["default"])(n.values())}},{key:"getSegmentListToDownload",value:function(){throw new Error("Cannot call abstract method")}},{key:"updateTrackEdge",value:function(e){throw new Error("Cannot call abstract method")}}]),e}());n["default"]=w,t.exports=n["default"]},{"../../../defaultConf":1,"../MediaMapCache":20,"../structures/TrackEdges":75,"babel-runtime/core-js/array/from":103,"babel-runtime/core-js/get-iterator":104,"babel-runtime/core-js/map":107,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,underscore:302}],65:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./AbstractScheduler"),_=r(p),m=function(e){function t(){return(0,a["default"])(this,t),(0,f["default"])(this,(0,i["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.audio;t&&(e=this._getSegmentsToDownloadByTrack(t,"audio"));var n=this._currentTracks.video;return n&&(e=e.concat(this._getSegmentsToDownloadByTrack(n,"video"))),e.sort(function(e,t){return e.getId()-t.getId()})}},{key:"updateTrackEdge",value:function(e){var t=this._findTrack(e);"audio"===t?this._edges.update({audio:e,video:null}):"video"===t&&this._edges.update({audio:null,video:e})}},{key:"_findTrack",value:function(e){var t=this._currentTracks.video;if(t&&e.isInTrack(t))return"video";var n=this._currentTracks.audio;return n&&e.isInTrack(n)?"audio":void 0}}]),t}(_["default"]);n["default"]=m,t.exports=n["default"]},{"./AbstractScheduler":64,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125}],66:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("./AbstractScheduler"),_=r(p),m=function(e){function t(){return(0,a["default"])(this,t),(0,f["default"])(this,(0,i["default"])(t).apply(this,arguments))}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"getSegmentListToDownload",value:function(){var e=[],t=this._currentTracks.video;return t&&(e=this._getSegmentsToDownloadByTrack(t,"video")),e.sort(function(e,t){return e.getId()-t.getId()})}},{key:"updateTrackEdge",value:function(e){this._currentTracks.video&&e.isInTrack(this._currentTracks.video)&&this._edges.update({video:e,audio:null})}}]),t}(_["default"]);n["default"]=m,t.exports=n["default"]},{"./AbstractScheduler":64,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125}],67:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n,r,o,i){return"hls"===r?new s["default"](e,t,n,o,i):new u["default"](e,t,n,o,i)}Object.defineProperty(n,"__esModule",{value:!0}),n.createScheduler=o;var i=e("./HlsScheduler"),s=r(i),a=e("./GenericScheduler"),u=r(a)},{"./GenericScheduler":65,"./HlsScheduler":66}],68:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){return new s["default"](e,t)}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./browser/SocketIO"),s=r(i),a=e("./mobile/SocketIO");r(a);o.emitCallback=function(e,t,n,r){},o.onConnect=function(e){},o.onDisconnect=function(e){},o.onReconnect=function(e){},o.onGetCurrentTracks=function(e,t){},n["default"]=o,t.exports=n["default"]},{"./browser/SocketIO":70,"./mobile/SocketIO":71}],69:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(t){arguments.length<=1||void 0===arguments[1]?null:arguments[1],(0,i["default"])(this,e)}return(0,a["default"])(e,[{key:"connect",value:function(){throw arguments.length<=0||void 0===arguments[0]?{}:arguments[0],new Error("must be implemented")}},{key:"emit",value:function(e,t,n){throw new Error("must be implemented")}},{key:"close",value:function(){throw new Error("must be implemented")}},{key:"transportName",get:function(){throw new Error("must be implemented")}},{key:"onconnect",set:function(e){this._onconnect=e},get:function(){return this._onconnect}},{key:"ondisconnect",set:function(e){this._ondisconnect=e},get:function(){return this._ondisconnect}},{key:"onreconnect",set:function(e){this._onreconnect=e},get:function(){return this._onreconnect}},{key:"onreconnecting",set:function(e){this._onreconnecting=e},get:function(){return this._onreconnecting}},{key:"ongetcurrenttracks",set:function(e){this._ongetcurrenttracks=e},get:function(){return this._ongetcurrenttracks}}]),e}();n["default"]=u,t.exports=n["default"]},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],70:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("../SocketIOInterface"),_=r(p),m=e("socket.io-client"),b=r(m),v=function(e){function t(e){(0,a["default"])(this,t);var n=(0,f["default"])(this,(0,i["default"])(t).call(this));return n._url=e,n}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"connect",value:function(){var e=this,t=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this._socket=b["default"].connect(this._url,{"force new connection":!0,query:t,reconnectionDelay:2e3,reconnectionDelayMax:3e5}),this._socket.on("connect",function(){e.onconnect()}),this._socket.on("disconnect",this.ondisconnect.bind(this)),this._socket.on("reconnecting",this.onreconnecting.bind(this)),this._socket.on("reconnect",this.onreconnect.bind(this)),this._socket.on("get_current_tracks",this.ongetcurrenttracks.bind(this))}},{key:"emit",value:function(e,t,n){void 0===t?this._socket.emit(e,n):this._socket.emit(e,t,n)}},{key:"close",value:function(){this._socket.close()}},{key:"transportName",get:function(){return this._socket.io.engine.transport.name}}]),t}(_["default"]);n["default"]=v,t.exports=n["default"]},{"../SocketIOInterface":69,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125,"socket.io-client":267}],71:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/get-prototype-of"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=e("babel-runtime/helpers/possibleConstructorReturn"),f=r(l),d=e("babel-runtime/helpers/inherits"),h=r(d),p=e("../SocketIOInterface"),_=r(p),m=e("uuid"),b=r(m),v=e("../../../utils/nativeCalls"),g={},y={},w=function(e){function t(e){var n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];(0,a["default"])(this,t);var r=(0,f["default"])(this,(0,i["default"])(t).call(this));return r.id=b["default"].v4(),r._url=e,r._reason=n,r}return(0,h["default"])(t,e),(0,c["default"])(t,[{key:"connect",value:function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];g[this.id]=this;var t={id:this.id,url:this._url,query_params:e};null!==this._reason&&(t.reason=this._reason),(0,v.nativeCall)("socket_io_connect",t)}},{key:"emit",value:function(e,t,n){void 0!==n&&(void 0===y[this.id]&&(y[this.id]={}),y[this.id][e]=n);var r={id:this.id,label:e};void 0!==t&&(r.data=t),(0,v.nativeCall)("socket_io_emit",r)}},{key:"close",value:function(){var e={id:this.id};(0,v.nativeCall)("socket_io_close",e)}},{key:"transportName",get:function(){return"websocket"}}],[{key:"emitCallback",value:function(e,t,n,r){var o=y[e][t];o(n,r),delete y[e][t]}},{key:"onConnect",value:function(e){var t=g[e];void 0!==t.onconnect&&t.onconnect()}},{key:"onDisconnect",value:function(e){var t=g[e];void 0!==t.ondisconnect&&t.ondisconnect()}},{key:"onReconnect",value:function(e){var t=g[e];void 0!==t.onreconnect&&t.onreconnect()}},{key:"onReconnecting",value:function(e){var t=g[e];void 0!==t.onreconnecting&&t.onreconnecting()}},{key:"onGetCurrentTracks",value:function(e,t){var n=g[e];void 0!==n.ongetcurrenttracks&&n.ongetcurrenttracks(t)}}]),t}(_["default"]);n["default"]=w,t.exports=n["default"]},{"../../../utils/nativeCalls":95,"../SocketIOInterface":69,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123,"babel-runtime/helpers/inherits":124,"babel-runtime/helpers/possibleConstructorReturn":125,uuid:304}],72:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0}),n.CurrentTracks=void 0;var o=e("babel-runtime/core-js/object/seal"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u);n.CurrentTracks=function(){function e(){(0,a["default"])(this,e),this.audio=void 0,this.video=void 0,(0,i["default"])(this)}return(0,c["default"])(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(!t&&!n)throw new Error("There must be at least one updated track");this.audio=t||this.audio,this.video=n||this.video}}]),e}()},{"babel-runtime/core-js/object/seal":117,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],73:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/freeze"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("../ChunkManager"),c=r(u),l=e("../Seeders"),f=r(l),d=e("../expectedInterfaces/SegmentCoordInterface"),h=r(d),p=e("../../utils/Interface"),_=function m(e,t,n,r,o){(0,a["default"])(this,m),(0,p.checkInterface)(h["default"],e),this.segmentCoord=e,this.chunkManager=new c["default"](e,t,n,r,o),this.seeders=new f["default"],(0,i["default"])(this)};n["default"]=_,t.exports=n["default"]},{"../../utils/Interface":86,"../ChunkManager":12,"../Seeders":33,"../expectedInterfaces/SegmentCoordInterface":58,"babel-runtime/core-js/object/freeze":112,"babel-runtime/helpers/classCallCheck":122}],74:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/freeze"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("../../utils/Delta"),c=e("../expectedInterfaces/SegmentCoordInterface"),l=r(c),f=e("../../utils/Interface"),d=function h(e,t,n){if((0,a["default"])(this,h),(0,f.checkInterface)(l["default"],e),!(0,u.isNumeric)(t))throw new Error("Invalid value for size");if(!n)throw new Error("No hash");this.segmentCoord=e,this.size=t,this.hash=n,(0,i["default"])(this)};n["default"]=d,t.exports=n["default"]},{"../../utils/Delta":85,"../../utils/Interface":86,"../expectedInterfaces/SegmentCoordInterface":58,"babel-runtime/core-js/object/freeze":112,"babel-runtime/helpers/classCallCheck":122}],75:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/core-js/object/seal"),i=r(o),s=e("babel-runtime/helpers/classCallCheck"),a=r(s),u=e("babel-runtime/helpers/createClass"),c=r(u),l=function(){function e(t,n){(0,a["default"])(this,e),this.audio=void 0,this.video=void 0,this._mediaMapCache=t,this._moduleState=n.moduleState,(0,i["default"])(this)}return(0,c["default"])(e,[{key:"update",value:function(e){var t=e.audio,n=e.video;if(void 0===t&&void 0===n)throw new Error("There must be at least one updated track edge");t&&(this.audio=t),n&&(this.video=n,this._moduleState.videoCurrentTime=this._mediaMapCache.getSegmentTime(n))}}]),e}();n["default"]=l,t.exports=n["default"]},{"babel-runtime/core-js/object/seal":117,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],76:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=e("./browser/callHashWorker"),c=r(u),l=(e("./mobile/callHashWorker"),function(){function e(){(0,i["default"])(this,e),this._disposed=!1}return(0,a["default"])(e,[{key:"callHashWorker",value:function(e,t){var n=this,r=function(){n._disposed||t.apply(void 0,arguments)};return(0,c["default"])(e,r)}},{key:"dispose",value:function(){this._disposed=!0}}]),e}());n["default"]=l,t.exports=n["default"]},{"./browser/callHashWorker":78,"./mobile/callHashWorker":79,"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],77:[function(e,t,n){"use strict";function r(){var e={mul32:function(e,t){var n=65535&t,r=t-n;return(r*e|0)+(n*e|0)|0},hashBytes:function(e,t,n){for(var r=3432918353,o=461845907,i=n,s=-4&t,a=0;s>a;a+=4){var u=255&e[a]|(255&e[a+1])<<8|(255&e[a+2])<<16|(255&e[a+3])<<24;u=this.mul32(u,r),u=(131071&u)<<15|u>>>17,u=this.mul32(u,o),i^=u,i=(524287&i)<<13|i>>>19,i=5*i+3864292196|0}switch(u=0,t%4){case 3:u=(255&e[s+2])<<16;case 2:u|=(255&e[s+1])<<8;case 1:u|=255&e[s],u=this.mul32(u,r),u=(131071&u)<<15|u>>>17,u=this.mul32(u,o),i^=u}return i^=t,i^=i>>>16,i=this.mul32(i,2246822507),i^=i>>>13,i=this.mul32(i,3266489909),i^=i>>>16}};self.onmessage=function(t){var n=new Uint8Array(t.data.segmentData),r=e.hashBytes(n,n.length,0).toString();self.postMessage({segmentData:t.data.segmentData,jobIndex:t.data.jobIndex,hash:r},[t.data.segmentData])}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r,t.exports=n["default"]},{}],78:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=URL.createObjectURL(new Blob(["("+u["default"].toString()+")()"],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t}function i(e){var t=e.data,n=t.jobIndex,r=t.segmentData,o=t.hash,i=c[n];delete c[n],i(r,o)}function s(e,t){var n=c.push(t)-1;l.postMessage({segmentData:e,jobIndex:n},[e])}Object.defineProperty(n,"__esModule",{value:!0});var a=e("./HashWorker"),u=r(a),c=[],l=o();l.onmessage=i,n["default"]=s,t.exports=n["default"]},{"./HashWorker":77}],79:[function(e,t,n){"use strict";function r(e,t){i[e.id]=t,s[e.id]=e,window.webkit.messageHandlers.call_hash_worker.postMessage({binaryDataId:e.id})}function o(e,t){var n=s[e],r=i[e];r(n,t),delete i[e]}Object.defineProperty(n,"__esModule",{value:!0});var i={},s={};n.callHashWorkerMobile=r,n.hasherCallback=o},{}],80:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Timers"),i=r(o),s=function(e,t,n){var r=[],o=!1,s=new i["default"],a=function(e){o?t(e):r.push(e)},u=function(){s.setTimeout(function(){o=!0,e(r),r=[]},n)};u(),this.addElement=a};n["default"]=s,t.exports=n["default"]},{"./Timers":92}],81:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){var t=Math.floor(e/256),n=e%256;return new Uint8Array([n,t])},o=function(e){var t=r(Math.floor(e/65536)),n=r(e%65536);return new Uint8Array([n[0],n[1],t[0],t[1]])};n.uint16ToUint8Array2=r,n.numToUint8Array4=o},{}],82:[function(e,t,n){"use strict";var r=function(e,t,n,r){var o=6371,i=(e-t)*Math.PI/180,s=(n-r)*Math.PI/180,a=e*Math.PI/180,u=t*Math.PI/180,c=Math.sin(i/2)*Math.sin(i/2)+Math.sin(s/2)*Math.sin(s/2)*Math.cos(a)*Math.cos(u),l=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),f=o*l;return f};t.exports={getDistanceFromLatitudeLongitude:r}},{}],83:[function(e,t,n){"use strict";function r(e,t,n){var r=e.toArrayBuffer(),o=(0,i.numToUint8Array4)(t),s=n.byteLength,a=(0,i.uint16ToUint8Array2)(s),u=new Uint8Array(o.byteLength+a.byteLength+s+r.byteLength);return u.set(o,0),u.set(a,4),u.set(new Uint8Array(n),6),u.set(new Uint8Array(r),6+s),u.buffer}function o(e,t){var n=e.slice(0,4),r=e.slice(4,6),o=new Uint16Array(r)[0],i=e.slice(6,6+o),s=e.slice(6+o),a=new Uint32Array(n)[0],u=t(s);return{segmentCoord:u,id_chunk:a,data:i}}Object.defineProperty(n,"__esModule",{value:!0}),n.parseMetaData=n.encodeMetaData=void 0;var i=e("./Bytes");n.encodeMetaData=r,n.parseMetaData=o},{"./Bytes":81}],84:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if("string"!=typeof e||!e.length)throw new TypeError(t)}function i(e){var t=e.contentUrl,n=e.contentId;if(null!==n&&void 0!==n)return o(n,"Unvalid p2pConfig property: contentId needs to be a non-empty string"),n;o(t,"Unvalid PeerAgent constructor argument: contentUrl needs to be a non-empty string");var r=a["default"].parse(t,!0,!0);return r.host+r.pathname}Object.defineProperty(n,"__esModule",{value:!0}),n.formatContentId=void 0;var s=e("url"),a=r(s);n.formatContentId=i},{url:131}],85:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=function(e){return"number"==typeof e&&!isNaN(e)},o=function(){var e=0,t=function(t){var n=t-e;return e=t,n};this.calcDelta=t};n.Delta=o,n.isNumeric=r},{}],86:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){var n=e.prototype,r=!0,o=!1,s=void 0;try{for(var a,u=(0,h["default"])(i(n));!(r=(a=u.next()).done);r=!0){var c=a.value;if((0,f["default"])(t[c])!==(0,f["default"])(n[c])){var l=t.constructor.name;throw new Error("The method "+c+" of "+e.name+" is not defined in "+l)}}}catch(d){o=!0,s=d}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw s}}}function i(e){var t=(0,c["default"])(e).filter(function(e){return"constructor"!==e}),n=Object.prototype;if((0,a["default"])(e)===n)return t;var r=(0,a["default"])(e);return t.concat(i(r))}Object.defineProperty(n,"__esModule",{value:!0}),n._getEveryPropertyNames=n.checkInterface=void 0;var s=e("babel-runtime/core-js/object/get-prototype-of"),a=r(s),u=e("babel-runtime/core-js/object/get-own-property-names"),c=r(u),l=e("babel-runtime/helpers/typeof"),f=r(l),d=e("babel-runtime/core-js/get-iterator"),h=r(d);n.checkInterface=o,n._getEveryPropertyNames=i},{"babel-runtime/core-js/get-iterator":104,"babel-runtime/core-js/object/get-own-property-names":113,"babel-runtime/core-js/object/get-prototype-of":114,"babel-runtime/helpers/typeof":128}],87:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){(0,d["default"])(e),(0,l["default"])(e).forEach(function(t){var n=e[t];null===n||"object"!==("undefined"==typeof n?"undefined":(0,u["default"])(n))||(0,s["default"])(n)||o(n)})}Object.defineProperty(n,"__esModule",{value:!0}),n.deepFreeze=void 0;var i=e("babel-runtime/core-js/object/is-frozen"),s=r(i),a=e("babel-runtime/helpers/typeof"),u=r(a),c=e("babel-runtime/core-js/object/get-own-property-names"),l=r(c),f=e("babel-runtime/core-js/object/freeze"),d=r(f);n.deepFreeze=o},{"babel-runtime/core-js/object/freeze":112,"babel-runtime/core-js/object/get-own-property-names":113,"babel-runtime/core-js/object/is-frozen":115,"babel-runtime/helpers/typeof":128}],88:[function(e,t,n){"use strict";function r(e){if(null===e)throw new Error("Panic! Attempted to unwrap null");if(void 0===e)throw new Error("Panic! Attempted to unwrap undefined");return e}Object.defineProperty(n,"__esModule",{value:!0}),n.unwrap=r},{}],89:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(n,"__esModule",{value:!0}),n.assertStreamType=n.StreamTypes=void 0;var o=e("babel-runtime/core-js/object/values"),i=r(o),s=e("babel-runtime/core-js/object/freeze"),a=r(s),u={HLS:"hls",DASH:"dash",SMOOTH:"smooth"};(0,a["default"])(u);var c=function(e){if(-1===(0,i["default"])(u).indexOf(e))throw new TypeError('"'+e+'" is not a valid value for stream type.')};n.StreamTypes=u,n.assertStreamType=c},{"babel-runtime/core-js/object/freeze":112,"babel-runtime/core-js/object/values":119}],90:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(){var e=URL.createObjectURL(new Blob(["("+h["default"].toString()+")()"],{type:"application/javascript"})),t=new Worker(e);return URL.revokeObjectURL(e),t}function i(e){var t=e.data,n=t.id,r=t.type,o=p[n];"setTimeout"===r&&delete p[n],o&&o()}function s(e,t,n){return m++,p[m]=t,_.postMessage({time:n,id:m,type:e}),m}function a(e,t){delete p[t],_.postMessage({id:t,type:e})}function u(e,t){return s("setTimeout",e,t)}function c(e,t){return s("setInterval",e,t)}function l(e){a("clearTimeout",e)}function f(e){a("clearInterval",e)}Object.defineProperty(n,"__esModule",{value:!0}),n.reliableSetTimeout=u,n.reliableSetInterval=c,n.reliableClearTimeout=l,n.reliableClearInterval=f;var d=e("./TimerWorker"),h=r(d),p={},_=void 0;_=o(),_.onmessage=i;var m=0},{"./TimerWorker":91}],91:[function(e,t,n){"use strict";function r(){function e(e,t){return function(){return self.postMessage({id:e,type:t})}}self.onmessage=function(t){var n=t.data,r=n.type,o=n.id;switch(r){case"setTimeout":var i=n.time;setTimeout(e(o,r),i);break;case"setInterval":var s=n.time;setInterval(e(o,r),s);break;case"clearTimeout":clearTimeout(o);break;case"clearInterval":clearInterval(o)}}}Object.defineProperty(n,"__esModule",{value:!0}),n["default"]=r,t.exports=n["default"]},{}],92:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var o=e("babel-runtime/core-js/map"),i=r(o),s=e("./TimerAbstraction"),a=function(){var e=this,t=[],n=[],r=new i["default"],o=new i["default"],a=function(e,n){var r=(0,s.reliableSetTimeout)(function(){u(r),e()},n);return t.push(r),r},u=function(e){for(var n in t)if(t[n]===e){(0,s.reliableClearTimeout)(e),t.splice(n,1);break}},c=function(e,t){var r=(0,s.reliableSetInterval)(e,t);return n.push(r),r},l=function(e){for(var t in n)if(n[t]===e){(0,s.reliableClearInterval)(e),n.splice(t,1);break}},f=function(e,t,n){if(!r.get(e)){var o=(0,s.reliableSetTimeout)(function(){d(e),t()},n);return r.set(e,o),o}return!1},d=function(e){var t=r.get(e);t&&((0,s.reliableClearTimeout)(t),r["delete"](e))},h=function(e,t,n){if(!o.get(e)){var r=(0,s.reliableSetInterval)(t,n);return o.set(e,r),r}return!1},p=function(e){var t=o.get(e);t&&((0,s.reliableClearInterval)(t),o["delete"](e))},_=function(){t.forEach(function(e){(0,s.reliableClearTimeout)(e)}),t=[],n.forEach(function(e){(0,s.reliableClearInterval)(e)}),n=[],o.forEach(function(e){(0,s.reliableClearInterval)(e)}),o.clear(),r.forEach(function(e){(0,s.reliableClearTimeout)(e)}),r.clear()};e.setTimeout=a,e.clearTimeout=u,e.setInterval=c,e.clearInterval=l,e.clearAll=_,e.setNamedTimeout=f,e.clearNamedTimeout=d,e.setNamedInterval=h,e.clearNamedInterval=p,e._getTimeoutArray=function(){return t},e._getIntervalArray=function(){return n},e._getNamedTimeoutMap=function(){return r},e._getNamedIntervalMap=function(){return o}};t.exports=a},{"./TimerAbstraction":90,"babel-runtime/core-js/map":107}],93:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e){return new a(l(e),{optional:[{DtlsSrtpKeyAgreement:!0}]})}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../defaultConf"),s=(r(i),function(e){return e=e.replace(/b=AS([^\r\n]+\r\n)/g,""),e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:50\r\n"),e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:256\r\n"),e=e.replace(/a=mid:data\r\n/g,"a=mid:data\r\nb=AS:1638400\r\n")}),a=window.RTCPeerConnection||window.webkitRTCPeerConnection,u=window.RTCIceCandidate,c=window.RTCSessionDescription,l=function(e){var t=e.ENABLE_TURN;return t?{iceServers:e.TURNSERVERS.concat(e.STUNSERVERS)}:{iceServers:e.STUNSERVERS}};n["default"]={transformOutgoingSdp:s,createPeerConnection:o,IceCandidate:u,SessionDescription:c},t.exports=n["default"]},{"../../defaultConf":1}],94:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){if(t.cacheSize&&(e.P2P_CACHE_MAX_SIZE=1024*t.cacheSize*1024,e.LIVE.P2P_CACHE_MAX_SIZE=e.P2P_CACHE_MAX_SIZE),void 0!==t.activateP2P&&(e.ALLOW_P2P=!!t.activateP2P),void 0!==t.debug&&(e.DEBUG=!!t.debug),t.signalingUrl&&(e.SIGNALING_URL=t.signalingUrl),t.trackerUrl&&(e.TRACKER_URL=t.trackerUrl),t.analyticsUrl&&(e.ANALYTICS.KLARA_URL=t.analyticsUrl),t.errorsUrl&&(e.ANALYTICS.ERRORS_URL=t.errorsUrl),t.deviceInfo&&(e.DEVICE_INFO=t.deviceInfo),void 0!==t.rangeRequestEnabled&&(e.RANGE_REQUEST_ALLOWED=!!t.rangeRequestEnabled),!t.streamrootKey)throw new Error("There must be a streamrootKey in the P2PConfig object");e.ID_CLIENT=t.streamrootKey,e.P2P_PROTOCOL_VERSION+="-"+n}Object.defineProperty(n,"__esModule",{value:!0});var i=e("../../defaultConf");r(i);n["default"]=o,t.exports=n["default"]},{"../../defaultConf":1}],95:[function(e,t,n){"use strict";function r(e,t){}function o(e){r("log",e)}function i(e){}Object.defineProperty(n,"__esModule",{value:!0}),n.nativeCall=r,n.nativeLog=o,n.nativeError=i},{}],96:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=u["default"].v4();return l[r]=e,(0,c.nativeCall)("set_timer",{timer_id:r,interval:t,repeats:n}),r}function i(e){(0,c.nativeCall)("clear_timer",{timer_id:e})}function s(e){l[e]()}Object.defineProperty(n,"__esModule",{value:!0}),n.clearTimer=n.setTimer=n.timersCallback=void 0;var a=e("uuid"),u=r(a),c=e("./nativeCalls"),l={};n.timersCallback=s,n.setTimer=o,n.clearTimer=i},{"./nativeCalls":95,uuid:304}],97:[function(e,t,n){"use strict";var r=e("ua-parser-js"),o=new r;o.setUA(window.navigator.userAgent);var i=o.getResult();t.exports.isMobile=function(){var e="mobile"===i.device.type||"tablet"===i.device.type||"console"===i.device.type||"Android"===i.os.name||"iOS"===i.os.name;return e},t.exports.uaObject=i},{"ua-parser-js":301}],98:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=document.getElementsByTagName("video");if(1!==r.length)throw new Error("BufferDisplay debug tool requiresa page with a single video");var o=r[0],s=document.createElement("canvas");s.width=o.clientWidth||C;var a=document.getElementById("bufferDisplay");a||(a=document.createElement("div"),document.getElementsByTagName("body")[0].appendChild(a)),a.appendChild(s);var u=i.bind(null,s,o,e,t,n),c=setInterval(u,30),l=function(){clearInterval(c),a.removeChild(s)};return{dispose:l}}function i(e,t,n,r,o){var i=s(n,r);a(e,{video:t,cacheState:i,currentTracks:o})}function s(e,t){var n=t.getTrackList(),r=[],o=!0,i=!1,s=void 0;try{for(var a,u=(0,h["default"])(n);!(o=(a=u.next()).done);o=!0){var c=a.value,l=new _["default"](t),f=e.listDownloadedSegmentsForTrack(c),d=!0,p=!1,m=void 0;try{for(var b,v=(0,h["default"])(f);!(d=(b=v.next()).done);d=!0){var g=b.value;l.addSegmentCoord(g)}}catch(y){p=!0,m=y}finally{try{!d&&v["return"]&&v["return"]()}finally{if(p)throw m}}r.push({vbm:l,coord:c})}}catch(y){i=!0,s=y}finally{try{!o&&u["return"]&&u["return"]()}finally{if(i)throw s}}return r}function a(e,t){var n=t.video,r=t.cacheState,o=t.currentTracks,i=n.buffered,s=n.currentTime,a=e.getContext("2d");e.height=(m+v)*r.length;var d=1/0,p=0,_=!0,C=!1,k=void 0;try{for(var S,E=(0,h["default"])(r);!(_=(S=E.next()).done);_=!0){var T=S.value.vbm;if(T.length){var j=T.start(0),A=T.end(T.length-1);d>j&&(d=j),A>p&&(p=A)}}}catch(P){C=!0,k=P}finally{try{!_&&E["return"]&&E["return"]()}finally{if(C)throw k}}if(i.length){var x=i.start(0),D=i.end(i.length-1);d>x&&(d=x),D>p&&(p=D)}for(var I={min:d,max:p,canvasWidth:e.width},R=0;R<r.length;R++){var M=r[R],T=M.vbm,O=M.coord,N=(m+v)*R,L={scale:I,height:m,yPosition:N,color:g};l(a,L,T);var U=N+m/2;if(c(a,O.viewToString(),U),u(O,o)){var B={scale:I,height:b,yPosition:N+(m-b),color:y};l(a,B,i)}}var H={height:e.height,color:w,scale:I};f(a,H,s)}function u(e,t){return e.isEqual(t.video)||e.isEqual(t.audio)}function c(e,t,n){e.fillStyle="green",e.font=S,e.fillText(t,0,n)}function l(e,t,n){for(var r=t.scale,o=t.height,i=t.yPosition,s=t.color,a=0;a<n.length;a++){var u=E(r,n.start(a)),c=E(r,n.end(a)),l=c-u>1?c-u:1;e.fillStyle=s,e.fillRect(u,i,l,o)}}function f(e,t,n){var r=t.color,o=t.scale,i=t.height,s=E(o,n);e.fillStyle=r,e.fillRect(s,0,1,i),e.fillStyle=r,e.font=S,e.fillText(n.toFixed(3),0,i)}Object.defineProperty(n,"__esModule",{value:!0});var d=e("babel-runtime/core-js/get-iterator"),h=r(d),p=e("./VirtualBufferedManager"),_=r(p),m=30,b=10,v=3,g="#97b9e2",y="#202429",w="#bf0101",C=460,k=60,S="12px Arial",E=function(e,t){var n=e.min,r=e.max,o=e.canvasWidth,i=o-k,s=Math.max(r-n,180);return k+(t-n)*i/s};n["default"]=o,t.exports=n["default"]},{"./VirtualBufferedManager":99,"babel-runtime/core-js/get-iterator":104}],99:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var o=e("babel-runtime/helpers/classCallCheck"),i=r(o),s=e("babel-runtime/helpers/createClass"),a=r(s),u=function(){function e(t){(0,i["default"])(this,e),this._buffered=[],this._mapManager=t}return(0,a["default"])(e,[{key:"start",value:function(e){return e in this._buffered?this._buffered[e].start:0}},{key:"end",value:function(e){return e in this._buffered?this._buffered[e].end:0}},{key:"addSegmentCoord",value:function(e){var t=void 0,n=void 0;try{t=this._mapManager.getSegmentTime(e),n=t+this._mapManager.getSegmentDuration(e)}catch(r){return}if(!this._buffered.length)return void this._buffered.push({start:t,end:n});for(var o=void 0,i=void 0,s=0;s<this._buffered.length;s++){
var a=this._buffered[s],u=this._buffered[s+1]||{start:1/0,end:1/0};if(a.end===t&&n===u.start){a.end=u.end,o=s+1;break}if(a.end===t&&n!==u.start){a.end=n;break}if(a.end!==t&&n===u.start){u.start=t;break}if(a.end<=t&&n<=u.start){i=s+1;break}}void 0!==o&&this._buffered.splice(o,1),void 0!==i&&this._buffered.splice(i,0,{start:t,end:n})}},{key:"length",get:function(){return this._buffered.length}}]),e}();t.exports=u},{"babel-runtime/helpers/classCallCheck":122,"babel-runtime/helpers/createClass":123}],100:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t,n){var r=document.getElementsByTagName("video");if(1!==r.length)throw new Error("BufferDisplay debug tool requiresa page with a single video");var o=r[0],s=document.createElement("canvas"),a=document.getElementById("chunkDisplay");a||(a=document.createElement("div"),document.getElementsByTagName("body")[0].appendChild(a)),a.appendChild(s);var u=i.bind(null,s,e,t,o,n),c=setInterval(u,30),l=function(){clearInterval(c),a.removeChild(s)};return{dispose:l}}function i(e,t,n,r,o){for(var i=n.getTrackList(),a=new b["default"],u=0;u<i.length;u++){var c=i[u];a.set(c,[])}for(var l=t.listSegmentsDownloadStatus(),d=o.getSegmentListToDownload(),h=0;h<l.length;h++)for(var p=l[h],m=p.segmentcoord,v=p.downloadStatusList,g=p.seederCount,y=0;y<i.length;y++){var w=i[y];if(m.isInTrack(w)){var C=f(v);try{for(var k=n.getSegmentTime(m),S=!1,E=0;E<d.length;E++)if(d[E].isEqual(m)){d.splice(E,1),S=!0;break}a.get(w).push({segmentAreas:C,id:m.viewToString(),time:k,length:v.length,seederCount:g,inSchedulerList:S})}catch(T){}}}var j=!0,A=!1,P=void 0;try{for(var x,D=(0,_["default"])(d);!(j=(x=D.next()).done);j=!0){var I=x.value,R=!0,M=!1,O=void 0;try{for(var N,L=(0,_["default"])(i);!(R=(N=L.next()).done);R=!0){var U=N.value;if(I.isInTrack(U)){var B=n.getSegmentTime(I);a.get(U).push({id:I.viewToString(),time:B,seederCount:0,inSchedulerList:!0})}}}catch(H){M=!0,O=H}finally{try{!R&&L["return"]&&L["return"]()}finally{if(M)throw O}}}}catch(H){A=!0,P=H}finally{try{!j&&D["return"]&&D["return"]()}finally{if(A)throw P}}s(e,a,r.currentTime)}function s(e,t,n){e.height=1e3,e.width=A*t.size;var r=void 0,o=e.getContext("2d"),i=0,s=!0,l=!1,f=void 0;try{for(var d,p=(0,_["default"])(t);!(s=(d=p.next()).done);s=!0){var m=(0,h["default"])(d.value,2),b=m[0],v=m[1];r=k,a(o,b,r,i);var g=!0,w=!1,C=void 0;try{for(var S,E=(0,_["default"])(v);!(g=(S=E.next()).done);g=!0){var P=S.value,x=P.id,D=P.time,I=P.segmentAreas,R=P.length,M=P.seederCount,O=P.inSchedulerList;D>n-j&&(r+=T,I&&c(o,I,R,r,i),u(o,{id:x,time:D,seederCount:M,inSchedulerList:O},r,i),r+=y)}}catch(N){w=!0,C=N}finally{try{!g&&E["return"]&&E["return"]()}finally{if(w)throw C}}i++}}catch(N){l=!0,f=N}finally{try{!s&&p["return"]&&p["return"]()}finally{if(l)throw f}}}function a(e,t,n,r){var o=A*r;e.fillStyle=w,e.font=S,e.fillText(t.viewToString(),o,n)}function u(e,t,n,r){var o=t.id,i=t.time,s=t.seederCount,a=t.inSchedulerList,u=A*r;e.fillStyle=C,e.font=a?E:S,e.fillText(o+"  --  "+i.toFixed(1)+" -- "+s,u,n+y)}function c(e,t,n,r,o){var i=A*o,s=0,a=!0,u=!1,c=void 0;try{for(var f,d=(0,_["default"])(t);!(a=(f=d.next()).done);a=!0){var h=f.value,p=(h.end-h.start)*g/n;e.fillStyle=l(h.status),e.fillRect(i+v+s,r,p,y),s+=p}}catch(m){u=!0,c=m}finally{try{!a&&d["return"]&&d["return"]()}finally{if(u)throw c}}t.length||(e.fillStyle="#D490D4",e.fillRect(i+v,r,g,y))}function l(e){switch(e){case"pending":return"gray";case"downloading":return"blue";case"downloaded":return"green";case"CDNdownloaded":return"orange";case"failed":return"red"}}function f(e){for(var t=void 0,n=[],r=0;r<e.length;r++){var o=e[r];if(t===o)n[n.length-1].end++;else{var i={start:r,end:r+1,status:o};t=o,n.push(i)}}return n}Object.defineProperty(n,"__esModule",{value:!0});var d=e("babel-runtime/helpers/slicedToArray"),h=r(d),p=e("babel-runtime/core-js/get-iterator"),_=r(p),m=e("babel-runtime/core-js/map"),b=r(m),v=100,g=100,y=15,w="red",C="black",k=15,S=k+"px Arial",E="bold "+S,T=5,j=10,A=v+g+20;n["default"]=o,t.exports=n["default"]},{"babel-runtime/core-js/get-iterator":104,"babel-runtime/core-js/map":107,"babel-runtime/helpers/slicedToArray":126}],101:[function(e,t,n){function r(e,t,n){function r(e,o){if(r.count<=0)throw new Error("after called too many times");--r.count,e?(i=!0,t(e),t=n):0!==r.count||i||t(null,o)}var i=!1;return n=n||o,r.count=e,0===e?t():r}function o(){}t.exports=r},{}],102:[function(e,t,n){t.exports=function(e,t,n){var r=e.byteLength;if(t=t||0,n=n||r,e.slice)return e.slice(t,n);if(0>t&&(t+=r),0>n&&(n+=r),n>r&&(n=r),t>=r||t>=n||0===r)return new ArrayBuffer(0);for(var o=new Uint8Array(e),i=new Uint8Array(n-t),s=t,a=0;n>s;s++,a++)i[a]=o[s];return i.buffer}},{}],103:[function(e,t,n){t.exports={"default":e("core-js/library/fn/array/from"),__esModule:!0}},{"core-js/library/fn/array/from":135}],104:[function(e,t,n){t.exports={"default":e("core-js/library/fn/get-iterator"),__esModule:!0}},{"core-js/library/fn/get-iterator":136}],105:[function(e,t,n){t.exports={"default":e("core-js/library/fn/is-iterable"),__esModule:!0}},{"core-js/library/fn/is-iterable":137}],106:[function(e,t,n){t.exports={"default":e("core-js/library/fn/json/stringify"),__esModule:!0}},{"core-js/library/fn/json/stringify":138}],107:[function(e,t,n){t.exports={"default":e("core-js/library/fn/map"),__esModule:!0}},{"core-js/library/fn/map":139}],108:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/assign"),__esModule:!0}},{"core-js/library/fn/object/assign":140}],109:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/create"),__esModule:!0}},{"core-js/library/fn/object/create":141}],110:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/define-properties"),__esModule:!0}},{"core-js/library/fn/object/define-properties":142}],111:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/define-property"),__esModule:!0}},{"core-js/library/fn/object/define-property":143}],112:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/freeze"),__esModule:!0}},{"core-js/library/fn/object/freeze":144}],113:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/get-own-property-names"),__esModule:!0}},{"core-js/library/fn/object/get-own-property-names":145}],114:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/get-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/get-prototype-of":146}],115:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/is-frozen"),__esModule:!0}},{"core-js/library/fn/object/is-frozen":147}],116:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/keys"),__esModule:!0}},{"core-js/library/fn/object/keys":148}],117:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/seal"),__esModule:!0}},{"core-js/library/fn/object/seal":149}],118:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/set-prototype-of"),__esModule:!0}},{"core-js/library/fn/object/set-prototype-of":150}],119:[function(e,t,n){t.exports={"default":e("core-js/library/fn/object/values"),__esModule:!0}},{"core-js/library/fn/object/values":151}],120:[function(e,t,n){t.exports={"default":e("core-js/library/fn/symbol"),__esModule:!0}},{"core-js/library/fn/symbol":152}],121:[function(e,t,n){t.exports={"default":e("core-js/library/fn/symbol/iterator"),__esModule:!0}},{"core-js/library/fn/symbol/iterator":153}],122:[function(e,t,n){"use strict";n.__esModule=!0,n["default"]=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},{}],123:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var o=e("../core-js/object/define-property"),i=r(o);n["default"]=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i["default"])(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},{"../core-js/object/define-property":111}],124:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var o=e("../core-js/object/set-prototype-of"),i=r(o),s=e("../core-js/object/create"),a=r(s),u=e("../helpers/typeof"),c=r(u);n["default"]=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+("undefined"==typeof t?"undefined":(0,c["default"])(t)));e.prototype=(0,a["default"])(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(i["default"]?(0,i["default"])(e,t):e.__proto__=t)}},{"../core-js/object/create":109,"../core-js/object/set-prototype-of":118,"../helpers/typeof":128}],125:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var o=e("../helpers/typeof"),i=r(o);n["default"]=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":(0,i["default"])(t))&&"function"!=typeof t?e:t}},{"../helpers/typeof":128}],126:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var o=e("../core-js/is-iterable"),i=r(o),s=e("../core-js/get-iterator"),a=r(s);n["default"]=function(){function e(e,t){var n=[],r=!0,o=!1,i=void 0;try{for(var s,u=(0,a["default"])(e);!(r=(s=u.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(c){o=!0,i=c}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if((0,i["default"])(Object(t)))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}()},{"../core-js/get-iterator":104,"../core-js/is-iterable":105}],127:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var o=e("../core-js/array/from"),i=r(o);n["default"]=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return(0,i["default"])(e)}},{"../core-js/array/from":103}],128:[function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n.__esModule=!0;var o=e("../core-js/symbol/iterator"),i=r(o),s=e("../core-js/symbol"),a=r(s),u="function"==typeof a["default"]&&"symbol"==typeof i["default"]?function(e){return typeof e}:function(e){return e&&"function"==typeof a["default"]&&e.constructor===a["default"]?"symbol":typeof e};n["default"]="function"==typeof a["default"]&&"symbol"===u(i["default"])?function(e){return"undefined"==typeof e?"undefined":u(e)}:function(e){return e&&"function"==typeof a["default"]&&e.constructor===a["default"]?"symbol":"undefined"==typeof e?"undefined":u(e)}},{"../core-js/symbol":120,"../core-js/symbol/iterator":121}],129:[function(e,t,n){function r(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}t.exports=r,r.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},r.prototype.reset=function(){this.attempts=0},r.prototype.setMin=function(e){this.ms=e},r.prototype.setMax=function(e){this.max=e},r.prototype.setJitter=function(e){this.jitter=e}},{}],130:[function(e,t,n){!function(e){"use strict";n.encode=function(t){var n,r=new Uint8Array(t),o=r.length,i="";for(n=0;o>n;n+=3)i+=e[r[n]>>2],i+=e[(3&r[n])<<4|r[n+1]>>4],i+=e[(15&r[n+1])<<2|r[n+2]>>6],i+=e[63&r[n+2]];return o%3===2?i=i.substring(0,i.length-1)+"=":o%3===1&&(i=i.substring(0,i.length-2)+"=="),i},n.decode=function(t){var n,r,o,i,s,a=.75*t.length,u=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var l=new ArrayBuffer(a),f=new Uint8Array(l);for(n=0;u>n;n+=4)r=e.indexOf(t[n]),o=e.indexOf(t[n+1]),i=e.indexOf(t[n+2]),s=e.indexOf(t[n+3]),f[c++]=r<<2|o>>4,f[c++]=(15&o)<<4|i>>2,f[c++]=(3&i)<<6|63&s;return l}}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")},{}],131:[function(e,t,n){function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}function o(e,t,n){if(e&&c(e)&&e instanceof r)return e;var o=new r;return o.parse(e,t,n),o}function i(e){return u(e)&&(e=o(e)),e instanceof r?e.format():r.prototype.format.call(e)}function s(e,t){return o(e,!1,!0).resolve(t)}function a(e,t){return e?o(e,!1,!0).resolveObject(t):t}function u(e){return"string"==typeof e}function c(e){return"object"==typeof e&&null!==e}function l(e){return null===e}function f(e){return null==e}var d=e("punycode");n.parse=o,n.resolve=s,n.resolveObject=a,n.format=i,n.Url=r;var h=/^([a-z0-9.+-]+:)/i,p=/:[0-9]*$/,_=["<",">",'"',"`"," ","\r","\n","	"],m=["{","}","|","\\","^","`"].concat(_),b=["'"].concat(m),v=["%","/","?",";","#"].concat(b),g=["/","?","#"],y=255,w=/^[a-z0-9A-Z_-]{0,63}$/,C=/^([a-z0-9A-Z_-]{0,63})(.*)$/,k={javascript:!0,"javascript:":!0},S={javascript:!0,"javascript:":!0},E={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},T=e("querystring");r.prototype.parse=function(e,t,n){if(!u(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e;r=r.trim();var o=h.exec(r);if(o){o=o[0];var i=o.toLowerCase();this.protocol=i,r=r.substr(o.length)}if(n||o||r.match(/^\/\/[^@\/]+@[^@\/]+/)){var s="//"===r.substr(0,2);!s||o&&S[o]||(r=r.substr(2),this.slashes=!0)}if(!S[o]&&(s||o&&!E[o])){for(var a=-1,c=0;c<g.length;c++){var l=r.indexOf(g[c]);-1!==l&&(-1===a||a>l)&&(a=l)}var f,p;p=-1===a?r.lastIndexOf("@"):r.lastIndexOf("@",a),-1!==p&&(f=r.slice(0,p),r=r.slice(p+1),this.auth=decodeURIComponent(f)),a=-1;for(var c=0;c<v.length;c++){var l=r.indexOf(v[c]);-1!==l&&(-1===a||a>l)&&(a=l)}-1===a&&(a=r.length),this.host=r.slice(0,a),r=r.slice(a),this.parseHost(),this.hostname=this.hostname||"";var _="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!_)for(var m=this.hostname.split(/\./),c=0,j=m.length;j>c;c++){var A=m[c];if(A&&!A.match(w)){for(var P="",x=0,D=A.length;D>x;x++)P+=A.charCodeAt(x)>127?"x":A[x];if(!P.match(w)){var I=m.slice(0,c),R=m.slice(c+1),M=A.match(C);M&&(I.push(M[1]),R.unshift(M[2])),R.length&&(r="/"+R.join(".")+r),this.hostname=I.join(".");break}}}if(this.hostname.length>y?this.hostname="":this.hostname=this.hostname.toLowerCase(),!_){for(var O=this.hostname.split("."),N=[],c=0;c<O.length;++c){var L=O[c];N.push(L.match(/[^A-Za-z0-9_-]/)?"xn--"+d.encode(L):L)}this.hostname=N.join(".")}var U=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+U,this.href+=this.host,_&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==r[0]&&(r="/"+r))}if(!k[i])for(var c=0,j=b.length;j>c;c++){var H=b[c],q=encodeURIComponent(H);q===H&&(q=escape(H)),r=r.split(H).join(q)}var F=r.indexOf("#");-1!==F&&(this.hash=r.substr(F),r=r.slice(0,F));var z=r.indexOf("?");if(-1!==z?(this.search=r.substr(z),this.query=r.substr(z+1),t&&(this.query=T.parse(this.query)),r=r.slice(0,z)):t&&(this.search="",this.query={}),r&&(this.pathname=r),E[i]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){var U=this.pathname||"",L=this.search||"";this.path=U+L}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=encodeURIComponent(e),e=e.replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",o=!1,i="";this.host?o=e+this.host:this.hostname&&(o=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(o+=":"+this.port)),this.query&&c(this.query)&&Object.keys(this.query).length&&(i=T.stringify(this.query));var s=this.search||i&&"?"+i||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||E[t])&&o!==!1?(o="//"+(o||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):o||(o=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),n=n.replace(/[?#]/g,function(e){return encodeURIComponent(e)}),s=s.replace("#","%23"),t+o+n+s+r},r.prototype.resolve=function(e){return this.resolveObject(o(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(u(e)){var t=new r;t.parse(e,!1,!0),e=t}var n=new r;if(Object.keys(this).forEach(function(e){n[e]=this[e]},this),n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol)return Object.keys(e).forEach(function(t){"protocol"!==t&&(n[t]=e[t])}),E[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n;if(e.protocol&&e.protocol!==n.protocol){if(!E[e.protocol])return Object.keys(e).forEach(function(t){n[t]=e[t]}),n.href=n.format(),n;if(n.protocol=e.protocol,e.host||S[e.protocol])n.pathname=e.pathname;else{for(var o=(e.pathname||"").split("/");o.length&&!(e.host=o.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==o[0]&&o.unshift(""),o.length<2&&o.unshift(""),n.pathname=o.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var i=n.pathname||"",s=n.search||"";n.path=i+s}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var a=n.pathname&&"/"===n.pathname.charAt(0),c=e.host||e.pathname&&"/"===e.pathname.charAt(0),d=c||a||n.host&&e.pathname,h=d,p=n.pathname&&n.pathname.split("/")||[],o=e.pathname&&e.pathname.split("/")||[],_=n.protocol&&!E[n.protocol];if(_&&(n.hostname="",n.port=null,n.host&&(""===p[0]?p[0]=n.host:p.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===o[0]?o[0]=e.host:o.unshift(e.host)),e.host=null),d=d&&(""===o[0]||""===p[0])),c)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,p=o;else if(o.length)p||(p=[]),p.pop(),p=p.concat(o),n.search=e.search,n.query=e.query;else if(!f(e.search)){if(_){n.hostname=n.host=p.shift();var m=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;m&&(n.auth=m.shift(),n.host=n.hostname=m.shift())}return n.search=e.search,n.query=e.query,l(n.pathname)&&l(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!p.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var b=p.slice(-1)[0],v=(n.host||e.host)&&("."===b||".."===b)||""===b,g=0,y=p.length;y>=0;y--)b=p[y],"."==b?p.splice(y,1):".."===b?(p.splice(y,1),g++):g&&(p.splice(y,1),g--);if(!d&&!h)for(;g--;g)p.unshift("..");!d||""===p[0]||p[0]&&"/"===p[0].charAt(0)||p.unshift(""),v&&"/"!==p.join("/").substr(-1)&&p.push("");var w=""===p[0]||p[0]&&"/"===p[0].charAt(0);if(_){n.hostname=n.host=w?"":p.length?p.shift():"";var m=n.host&&n.host.indexOf("@")>0?n.host.split("@"):!1;m&&(n.auth=m.shift(),n.host=n.hostname=m.shift())}return d=d||n.host&&p.length,d&&!w&&p.unshift(""),p.length?n.pathname=p.join("/"):(n.pathname=null,n.path=null),l(n.pathname)&&l(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},r.prototype.parseHost=function(){var e=this.host,t=p.exec(e);t&&(t=t[0],":"!==t&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},{punycode:263,querystring:266}],132:[function(e,t,n){var r=[].slice;t.exports=function(e,t){if("string"==typeof t&&(t=e[t]),"function"!=typeof t)throw new Error("bind() requires a function");var n=r.call(arguments,2);return function(){return t.apply(e,n.concat(r.call(arguments)))}}},{}],133:[function(e,t,n){function r(e){return e?o(e):void 0}function o(e){for(var t in r.prototype)e[t]=r.prototype[t];return e}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks[e]=this._callbacks[e]||[]).push(t),this},r.prototype.once=function(e,t){function n(){r.off(e,n),t.apply(this,arguments)}var r=this;return this._callbacks=this._callbacks||{},n.fn=t,this.on(e,n),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1==arguments.length)return delete this._callbacks[e],this;for(var r,o=0;o<n.length;o++)if(r=n[o],r===t||r.fn===t){n.splice(o,1);break}return this},r.prototype.emit=function(e){this._callbacks=this._callbacks||{};var t=[].slice.call(arguments,1),n=this._callbacks[e];if(n){n=n.slice(0);for(var r=0,o=n.length;o>r;++r)n[r].apply(this,t)}return this},r.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks[e]||[]},r.prototype.hasListeners=function(e){return!!this.listeners(e).length}},{}],134:[function(e,t,n){t.exports=function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],135:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/es6.array.from"),t.exports=e("../../modules/_core").Array.from},{"../../modules/_core":168,"../../modules/es6.array.from":233,"../../modules/es6.string.iterator":248}],136:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.get-iterator")},{"../modules/core.get-iterator":231,"../modules/es6.string.iterator":248,"../modules/web.dom.iterable":254}],137:[function(e,t,n){e("../modules/web.dom.iterable"),e("../modules/es6.string.iterator"),t.exports=e("../modules/core.is-iterable")},{"../modules/core.is-iterable":232,"../modules/es6.string.iterator":248,"../modules/web.dom.iterable":254}],138:[function(e,t,n){var r=e("../../modules/_core"),o=r.JSON||(r.JSON={stringify:JSON.stringify});t.exports=function(e){return o.stringify.apply(o,arguments)}},{"../../modules/_core":168}],139:[function(e,t,n){e("../modules/es6.object.to-string"),e("../modules/es6.string.iterator"),e("../modules/web.dom.iterable"),e("../modules/es6.map"),e("../modules/es7.map.to-json"),t.exports=e("../modules/_core").Map},{"../modules/_core":168,"../modules/es6.map":235,"../modules/es6.object.to-string":247,"../modules/es6.string.iterator":248,"../modules/es7.map.to-json":250,"../modules/web.dom.iterable":254}],140:[function(e,t,n){e("../../modules/es6.object.assign"),t.exports=e("../../modules/_core").Object.assign},{"../../modules/_core":168,"../../modules/es6.object.assign":236}],141:[function(e,t,n){e("../../modules/es6.object.create");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.create(e,t)}},{"../../modules/_core":168,"../../modules/es6.object.create":237}],142:[function(e,t,n){e("../../modules/es6.object.define-properties");var r=e("../../modules/_core").Object;t.exports=function(e,t){return r.defineProperties(e,t)}},{"../../modules/_core":168,"../../modules/es6.object.define-properties":238}],143:[function(e,t,n){e("../../modules/es6.object.define-property");var r=e("../../modules/_core").Object;t.exports=function(e,t,n){return r.defineProperty(e,t,n)}},{"../../modules/_core":168,"../../modules/es6.object.define-property":239}],144:[function(e,t,n){e("../../modules/es6.object.freeze"),t.exports=e("../../modules/_core").Object.freeze},{"../../modules/_core":168,"../../modules/es6.object.freeze":240}],145:[function(e,t,n){e("../../modules/es6.object.get-own-property-names");var r=e("../../modules/_core").Object;t.exports=function(e){return r.getOwnPropertyNames(e)}},{"../../modules/_core":168,"../../modules/es6.object.get-own-property-names":241}],146:[function(e,t,n){e("../../modules/es6.object.get-prototype-of"),t.exports=e("../../modules/_core").Object.getPrototypeOf},{"../../modules/_core":168,"../../modules/es6.object.get-prototype-of":242}],147:[function(e,t,n){e("../../modules/es6.object.is-frozen"),t.exports=e("../../modules/_core").Object.isFrozen},{"../../modules/_core":168,"../../modules/es6.object.is-frozen":243}],148:[function(e,t,n){e("../../modules/es6.object.keys"),t.exports=e("../../modules/_core").Object.keys},{"../../modules/_core":168,"../../modules/es6.object.keys":244}],149:[function(e,t,n){e("../../modules/es6.object.seal"),t.exports=e("../../modules/_core").Object.seal},{"../../modules/_core":168,"../../modules/es6.object.seal":245}],150:[function(e,t,n){e("../../modules/es6.object.set-prototype-of"),t.exports=e("../../modules/_core").Object.setPrototypeOf},{"../../modules/_core":168,"../../modules/es6.object.set-prototype-of":246}],151:[function(e,t,n){e("../../modules/es7.object.values"),t.exports=e("../../modules/_core").Object.values},{"../../modules/_core":168,"../../modules/es7.object.values":251}],152:[function(e,t,n){e("../../modules/es6.symbol"),e("../../modules/es6.object.to-string"),e("../../modules/es7.symbol.async-iterator"),e("../../modules/es7.symbol.observable"),t.exports=e("../../modules/_core").Symbol},{"../../modules/_core":168,"../../modules/es6.object.to-string":247,"../../modules/es6.symbol":249,"../../modules/es7.symbol.async-iterator":252,"../../modules/es7.symbol.observable":253}],153:[function(e,t,n){e("../../modules/es6.string.iterator"),e("../../modules/web.dom.iterable"),t.exports=e("../../modules/_wks-ext").f("iterator")},{"../../modules/_wks-ext":228,"../../modules/es6.string.iterator":248,"../../modules/web.dom.iterable":254}],154:[function(e,t,n){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],155:[function(e,t,n){t.exports=function(){}},{}],156:[function(e,t,n){t.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},{}],157:[function(e,t,n){var r=e("./_is-object");t.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},{"./_is-object":187}],158:[function(e,t,n){var r=e("./_for-of");t.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},{"./_for-of":178}],159:[function(e,t,n){var r=e("./_to-iobject"),o=e("./_to-length"),i=e("./_to-index");t.exports=function(e){return function(t,n,s){var a,u=r(t),c=o(u.length),l=i(s,c);if(e&&n!=n){for(;c>l;)if(a=u[l++],a!=a)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},{"./_to-index":220,"./_to-iobject":222,"./_to-length":223}],160:[function(e,t,n){var r=e("./_ctx"),o=e("./_iobject"),i=e("./_to-object"),s=e("./_to-length"),a=e("./_array-species-create");t.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,f=6==e,d=5==e||f,h=t||a;return function(t,a,p){for(var _,m,b=i(t),v=o(b),g=r(a,p,3),y=s(v.length),w=0,C=n?h(t,y):u?h(t,0):void 0;y>w;w++)if((d||w in v)&&(_=v[w],m=g(_,w,b),e))if(n)C[w]=m;else if(m)switch(e){case 3:return!0;case 5:return _;case 6:return w;case 2:C.push(_)}else if(l)return!1;return f?-1:c||l?l:C}}},{"./_array-species-create":162,"./_ctx":170,"./_iobject":184,"./_to-length":223,"./_to-object":224}],161:[function(e,t,n){var r=e("./_is-object"),o=e("./_is-array"),i=e("./_wks")("species");t.exports=function(e){var t;return o(e)&&(t=e.constructor,"function"!=typeof t||t!==Array&&!o(t.prototype)||(t=void 0),r(t)&&(t=t[i],null===t&&(t=void 0))),void 0===t?Array:t}},{"./_is-array":186,"./_is-object":187,"./_wks":229}],162:[function(e,t,n){var r=e("./_array-species-constructor");t.exports=function(e,t){return new(r(e))(t)}},{"./_array-species-constructor":161}],163:[function(e,t,n){var r=e("./_cof"),o=e("./_wks")("toStringTag"),i="Arguments"==r(function(){return arguments}()),s=function(e,t){try{return e[t]}catch(n){}};t.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=s(t=Object(e),o))?n:i?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},{"./_cof":164,"./_wks":229}],164:[function(e,t,n){var r={}.toString;t.exports=function(e){return r.call(e).slice(8,-1)}},{}],165:[function(e,t,n){"use strict";var r=e("./_object-dp").f,o=e("./_object-create"),i=(e("./_hide"),e("./_redefine-all")),s=e("./_ctx"),a=e("./_an-instance"),u=e("./_defined"),c=e("./_for-of"),l=e("./_iter-define"),f=e("./_iter-step"),d=e("./_set-species"),h=e("./_descriptors"),p=e("./_meta").fastKey,_=h?"_s":"size",m=function(e,t){var n,r=p(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};t.exports={getConstructor:function(e,t,n,l){var f=e(function(e,r){a(e,f,t,"_i"),e._i=o(null),e._f=void 0,e._l=void 0,e[_]=0,void 0!=r&&c(r,n,e[l],e)});return i(f.prototype,{clear:function(){for(var e=this,t=e._i,n=e._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete t[n.i];e._f=e._l=void 0,e[_]=0},"delete":function(e){var t=this,n=m(t,e);if(n){var r=n.n,o=n.p;delete t._i[n.i],n.r=!0,o&&(o.n=r),r&&(r.p=o),t._f==n&&(t._f=r),t._l==n&&(t._l=o),t[_]--}return!!n},forEach:function(e){a(this,f,"forEach");for(var t,n=s(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.n:this._f;)for(n(t.v,t.k,this);t&&t.r;)t=t.p},has:function(e){return!!m(this,e)}}),h&&r(f.prototype,"size",{get:function(){return u(this[_])}}),f},def:function(e,t,n){var r,o,i=m(e,t);return i?i.v=n:(e._l=i={i:o=p(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=i),r&&(r.n=i),e[_]++,"F"!==o&&(e._i[o]=i)),e},getEntry:m,setStrong:function(e,t,n){l(e,t,function(e,t){this._t=e,this._k=t,this._l=void 0},function(){for(var e=this,t=e._k,n=e._l;n&&n.r;)n=n.p;return e._t&&(e._l=n=n?n.n:e._t._f)?"keys"==t?f(0,n.k):"values"==t?f(0,n.v):f(0,[n.k,n.v]):(e._t=void 0,f(1))},n?"entries":"values",!n,!0),d(t)}}},{"./_an-instance":156,"./_ctx":170,"./_defined":171,"./_descriptors":172,"./_for-of":178,"./_hide":181,"./_iter-define":190,"./_iter-step":192,"./_meta":196,"./_object-create":198,"./_object-dp":199,"./_redefine-all":212,"./_set-species":215}],166:[function(e,t,n){var r=e("./_classof"),o=e("./_array-from-iterable");t.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return o(this)}}},{"./_array-from-iterable":158,"./_classof":163}],167:[function(e,t,n){"use strict";var r=e("./_global"),o=e("./_export"),i=e("./_meta"),s=e("./_fails"),a=e("./_hide"),u=e("./_redefine-all"),c=e("./_for-of"),l=e("./_an-instance"),f=e("./_is-object"),d=e("./_set-to-string-tag"),h=e("./_object-dp").f,p=e("./_array-methods")(0),_=e("./_descriptors");t.exports=function(e,t,n,m,b,v){var g=r[e],y=g,w=b?"set":"add",C=y&&y.prototype,k={};return _&&"function"==typeof y&&(v||C.forEach&&!s(function(){(new y).entries().next()}))?(y=t(function(t,n){l(t,y,e,"_c"),t._c=new g,void 0!=n&&c(n,b,t[w],t)}),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(e){var t="add"==e||"set"==e;e in C&&(!v||"clear"!=e)&&a(y.prototype,e,function(n,r){if(l(this,y,e),!t&&v&&!f(n))return"get"==e?void 0:!1;var o=this._c[e](0===n?0:n,r);return t?this:o})}),"size"in C&&h(y.prototype,"size",{get:function(){return this._c.size}})):(y=m.getConstructor(t,e,b,w),u(y.prototype,n),i.NEED=!0),d(y,e),k[e]=y,o(o.G+o.W+o.F,k),v||m.setStrong(y,e,b),y}},{"./_an-instance":156,"./_array-methods":160,"./_descriptors":172,"./_export":176,"./_fails":177,"./_for-of":178,"./_global":179,"./_hide":181,"./_is-object":187,"./_meta":196,"./_object-dp":199,"./_redefine-all":212,"./_set-to-string-tag":216}],168:[function(e,t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},{}],169:[function(e,t,n){"use strict";var r=e("./_object-dp"),o=e("./_property-desc");t.exports=function(e,t,n){t in e?r.f(e,t,o(0,n)):e[t]=n}},{"./_object-dp":199,"./_property-desc":211}],170:[function(e,t,n){var r=e("./_a-function");t.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,o){return e.call(t,n,r,o)}}return function(){return e.apply(t,arguments)}}},{"./_a-function":154}],171:[function(e,t,n){t.exports=function(e){if(void 0==e)throw TypeError("Can't call method on  "+e);return e}},{}],172:[function(e,t,n){t.exports=!e("./_fails")(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{"./_fails":177}],173:[function(e,t,n){
var r=e("./_is-object"),o=e("./_global").document,i=r(o)&&r(o.createElement);t.exports=function(e){return i?o.createElement(e):{}}},{"./_global":179,"./_is-object":187}],174:[function(e,t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],175:[function(e,t,n){var r=e("./_object-keys"),o=e("./_object-gops"),i=e("./_object-pie");t.exports=function(e){var t=r(e),n=o.f;if(n)for(var s,a=n(e),u=i.f,c=0;a.length>c;)u.call(e,s=a[c++])&&t.push(s);return t}},{"./_object-gops":204,"./_object-keys":207,"./_object-pie":208}],176:[function(e,t,n){var r=e("./_global"),o=e("./_core"),i=e("./_ctx"),s=e("./_hide"),a="prototype",u=function(e,t,n){var c,l,f,d=e&u.F,h=e&u.G,p=e&u.S,_=e&u.P,m=e&u.B,b=e&u.W,v=h?o:o[t]||(o[t]={}),g=v[a],y=h?r:p?r[t]:(r[t]||{})[a];h&&(n=t);for(c in n)l=!d&&y&&void 0!==y[c],l&&c in v||(f=l?y[c]:n[c],v[c]=h&&"function"!=typeof y[c]?n[c]:m&&l?i(f,r):b&&y[c]==f?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[a]=e[a],t}(f):_&&"function"==typeof f?i(Function.call,f):f,_&&((v.virtual||(v.virtual={}))[c]=f,e&u.R&&g&&!g[c]&&s(g,c,f)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,t.exports=u},{"./_core":168,"./_ctx":170,"./_global":179,"./_hide":181}],177:[function(e,t,n){t.exports=function(e){try{return!!e()}catch(t){return!0}}},{}],178:[function(e,t,n){var r=e("./_ctx"),o=e("./_iter-call"),i=e("./_is-array-iter"),s=e("./_an-object"),a=e("./_to-length"),u=e("./core.get-iterator-method"),c={},l={},n=t.exports=function(e,t,n,f,d){var h,p,_,m,b=d?function(){return e}:u(e),v=r(n,f,t?2:1),g=0;if("function"!=typeof b)throw TypeError(e+" is not iterable!");if(i(b)){for(h=a(e.length);h>g;g++)if(m=t?v(s(p=e[g])[0],p[1]):v(e[g]),m===c||m===l)return m}else for(_=b.call(e);!(p=_.next()).done;)if(m=o(_,v,p.value,t),m===c||m===l)return m};n.BREAK=c,n.RETURN=l},{"./_an-object":157,"./_ctx":170,"./_is-array-iter":185,"./_iter-call":188,"./_to-length":223,"./core.get-iterator-method":230}],179:[function(e,t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},{}],180:[function(e,t,n){var r={}.hasOwnProperty;t.exports=function(e,t){return r.call(e,t)}},{}],181:[function(e,t,n){var r=e("./_object-dp"),o=e("./_property-desc");t.exports=e("./_descriptors")?function(e,t,n){return r.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},{"./_descriptors":172,"./_object-dp":199,"./_property-desc":211}],182:[function(e,t,n){t.exports=e("./_global").document&&document.documentElement},{"./_global":179}],183:[function(e,t,n){t.exports=!e("./_descriptors")&&!e("./_fails")(function(){return 7!=Object.defineProperty(e("./_dom-create")("div"),"a",{get:function(){return 7}}).a})},{"./_descriptors":172,"./_dom-create":173,"./_fails":177}],184:[function(e,t,n){var r=e("./_cof");t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},{"./_cof":164}],185:[function(e,t,n){var r=e("./_iterators"),o=e("./_wks")("iterator"),i=Array.prototype;t.exports=function(e){return void 0!==e&&(r.Array===e||i[o]===e)}},{"./_iterators":193,"./_wks":229}],186:[function(e,t,n){var r=e("./_cof");t.exports=Array.isArray||function(e){return"Array"==r(e)}},{"./_cof":164}],187:[function(e,t,n){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],188:[function(e,t,n){var r=e("./_an-object");t.exports=function(e,t,n,o){try{return o?t(r(n)[0],n[1]):t(n)}catch(i){var s=e["return"];throw void 0!==s&&r(s.call(e)),i}}},{"./_an-object":157}],189:[function(e,t,n){"use strict";var r=e("./_object-create"),o=e("./_property-desc"),i=e("./_set-to-string-tag"),s={};e("./_hide")(s,e("./_wks")("iterator"),function(){return this}),t.exports=function(e,t,n){e.prototype=r(s,{next:o(1,n)}),i(e,t+" Iterator")}},{"./_hide":181,"./_object-create":198,"./_property-desc":211,"./_set-to-string-tag":216,"./_wks":229}],190:[function(e,t,n){"use strict";var r=e("./_library"),o=e("./_export"),i=e("./_redefine"),s=e("./_hide"),a=e("./_has"),u=e("./_iterators"),c=e("./_iter-create"),l=e("./_set-to-string-tag"),f=e("./_object-gpo"),d=e("./_wks")("iterator"),h=!([].keys&&"next"in[].keys()),p="@@iterator",_="keys",m="values",b=function(){return this};t.exports=function(e,t,n,v,g,y,w){c(n,t,v);var C,k,S,E=function(e){if(!h&&e in P)return P[e];switch(e){case _:return function(){return new n(this,e)};case m:return function(){return new n(this,e)}}return function(){return new n(this,e)}},T=t+" Iterator",j=g==m,A=!1,P=e.prototype,x=P[d]||P[p]||g&&P[g],D=x||E(g),I=g?j?E("entries"):D:void 0,R="Array"==t?P.entries||x:x;if(R&&(S=f(R.call(new e)),S!==Object.prototype&&(l(S,T,!0),r||a(S,d)||s(S,d,b))),j&&x&&x.name!==m&&(A=!0,D=function(){return x.call(this)}),r&&!w||!h&&!A&&P[d]||s(P,d,D),u[t]=D,u[T]=b,g)if(C={values:j?D:E(m),keys:y?D:E(_),entries:I},w)for(k in C)k in P||i(P,k,C[k]);else o(o.P+o.F*(h||A),t,C);return C}},{"./_export":176,"./_has":180,"./_hide":181,"./_iter-create":189,"./_iterators":193,"./_library":195,"./_object-gpo":205,"./_redefine":213,"./_set-to-string-tag":216,"./_wks":229}],191:[function(e,t,n){var r=e("./_wks")("iterator"),o=!1;try{var i=[7][r]();i["return"]=function(){o=!0},Array.from(i,function(){throw 2})}catch(s){}t.exports=function(e,t){if(!t&&!o)return!1;var n=!1;try{var i=[7],s=i[r]();s.next=function(){return{done:n=!0}},i[r]=function(){return s},e(i)}catch(a){}return n}},{"./_wks":229}],192:[function(e,t,n){t.exports=function(e,t){return{value:t,done:!!e}}},{}],193:[function(e,t,n){t.exports={}},{}],194:[function(e,t,n){var r=e("./_object-keys"),o=e("./_to-iobject");t.exports=function(e,t){for(var n,i=o(e),s=r(i),a=s.length,u=0;a>u;)if(i[n=s[u++]]===t)return n}},{"./_object-keys":207,"./_to-iobject":222}],195:[function(e,t,n){t.exports=!0},{}],196:[function(e,t,n){var r=e("./_uid")("meta"),o=e("./_is-object"),i=e("./_has"),s=e("./_object-dp").f,a=0,u=Object.isExtensible||function(){return!0},c=!e("./_fails")(function(){return u(Object.preventExtensions({}))}),l=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},f=function(e,t){if(!o(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!i(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},d=function(e,t){if(!i(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},h=function(e){return c&&p.NEED&&u(e)&&!i(e,r)&&l(e),e},p=t.exports={KEY:r,NEED:!1,fastKey:f,getWeak:d,onFreeze:h}},{"./_fails":177,"./_has":180,"./_is-object":187,"./_object-dp":199,"./_uid":226}],197:[function(e,t,n){"use strict";var r=e("./_object-keys"),o=e("./_object-gops"),i=e("./_object-pie"),s=e("./_to-object"),a=e("./_iobject"),u=Object.assign;t.exports=!u||e("./_fails")(function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach(function(e){t[e]=e}),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r})?function(e,t){for(var n=s(e),u=arguments.length,c=1,l=o.f,f=i.f;u>c;)for(var d,h=a(arguments[c++]),p=l?r(h).concat(l(h)):r(h),_=p.length,m=0;_>m;)f.call(h,d=p[m++])&&(n[d]=h[d]);return n}:u},{"./_fails":177,"./_iobject":184,"./_object-gops":204,"./_object-keys":207,"./_object-pie":208,"./_to-object":224}],198:[function(e,t,n){var r=e("./_an-object"),o=e("./_object-dps"),i=e("./_enum-bug-keys"),s=e("./_shared-key")("IE_PROTO"),a=function(){},u="prototype",c=function(){var t,n=e("./_dom-create")("iframe"),r=i.length,o=">";for(n.style.display="none",e("./_html").appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object</script"+o),t.close(),c=t.F;r--;)delete c[u][i[r]];return c()};t.exports=Object.create||function(e,t){var n;return null!==e?(a[u]=r(e),n=new a,a[u]=null,n[s]=e):n=c(),void 0===t?n:o(n,t)}},{"./_an-object":157,"./_dom-create":173,"./_enum-bug-keys":174,"./_html":182,"./_object-dps":200,"./_shared-key":217}],199:[function(e,t,n){var r=e("./_an-object"),o=e("./_ie8-dom-define"),i=e("./_to-primitive"),s=Object.defineProperty;n.f=e("./_descriptors")?Object.defineProperty:function(e,t,n){if(r(e),t=i(t,!0),r(n),o)try{return s(e,t,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},{"./_an-object":157,"./_descriptors":172,"./_ie8-dom-define":183,"./_to-primitive":225}],200:[function(e,t,n){var r=e("./_object-dp"),o=e("./_an-object"),i=e("./_object-keys");t.exports=e("./_descriptors")?Object.defineProperties:function(e,t){o(e);for(var n,s=i(t),a=s.length,u=0;a>u;)r.f(e,n=s[u++],t[n]);return e}},{"./_an-object":157,"./_descriptors":172,"./_object-dp":199,"./_object-keys":207}],201:[function(e,t,n){var r=e("./_object-pie"),o=e("./_property-desc"),i=e("./_to-iobject"),s=e("./_to-primitive"),a=e("./_has"),u=e("./_ie8-dom-define"),c=Object.getOwnPropertyDescriptor;n.f=e("./_descriptors")?c:function(e,t){if(e=i(e),t=s(t,!0),u)try{return c(e,t)}catch(n){}return a(e,t)?o(!r.f.call(e,t),e[t]):void 0}},{"./_descriptors":172,"./_has":180,"./_ie8-dom-define":183,"./_object-pie":208,"./_property-desc":211,"./_to-iobject":222,"./_to-primitive":225}],202:[function(e,t,n){var r=e("./_to-iobject"),o=e("./_object-gopn").f,i={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],a=function(e){try{return o(e)}catch(t){return s.slice()}};t.exports.f=function(e){return s&&"[object Window]"==i.call(e)?a(e):o(r(e))}},{"./_object-gopn":203,"./_to-iobject":222}],203:[function(e,t,n){var r=e("./_object-keys-internal"),o=e("./_enum-bug-keys").concat("length","prototype");n.f=Object.getOwnPropertyNames||function(e){return r(e,o)}},{"./_enum-bug-keys":174,"./_object-keys-internal":206}],204:[function(e,t,n){n.f=Object.getOwnPropertySymbols},{}],205:[function(e,t,n){var r=e("./_has"),o=e("./_to-object"),i=e("./_shared-key")("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=o(e),r(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{"./_has":180,"./_shared-key":217,"./_to-object":224}],206:[function(e,t,n){var r=e("./_has"),o=e("./_to-iobject"),i=e("./_array-includes")(!1),s=e("./_shared-key")("IE_PROTO");t.exports=function(e,t){var n,a=o(e),u=0,c=[];for(n in a)n!=s&&r(a,n)&&c.push(n);for(;t.length>u;)r(a,n=t[u++])&&(~i(c,n)||c.push(n));return c}},{"./_array-includes":159,"./_has":180,"./_shared-key":217,"./_to-iobject":222}],207:[function(e,t,n){var r=e("./_object-keys-internal"),o=e("./_enum-bug-keys");t.exports=Object.keys||function(e){return r(e,o)}},{"./_enum-bug-keys":174,"./_object-keys-internal":206}],208:[function(e,t,n){n.f={}.propertyIsEnumerable},{}],209:[function(e,t,n){var r=e("./_export"),o=e("./_core"),i=e("./_fails");t.exports=function(e,t){var n=(o.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*i(function(){n(1)}),"Object",s)}},{"./_core":168,"./_export":176,"./_fails":177}],210:[function(e,t,n){var r=e("./_object-keys"),o=e("./_to-iobject"),i=e("./_object-pie").f;t.exports=function(e){return function(t){for(var n,s=o(t),a=r(s),u=a.length,c=0,l=[];u>c;)i.call(s,n=a[c++])&&l.push(e?[n,s[n]]:s[n]);return l}}},{"./_object-keys":207,"./_object-pie":208,"./_to-iobject":222}],211:[function(e,t,n){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],212:[function(e,t,n){var r=e("./_hide");t.exports=function(e,t,n){for(var o in t)n&&e[o]?e[o]=t[o]:r(e,o,t[o]);return e}},{"./_hide":181}],213:[function(e,t,n){t.exports=e("./_hide")},{"./_hide":181}],214:[function(e,t,n){var r=e("./_is-object"),o=e("./_an-object"),i=function(e,t){if(o(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,r){try{r=e("./_ctx")(Function.call,e("./_object-gopd").f(Object.prototype,"__proto__").set,2),r(t,[]),n=!(t instanceof Array)}catch(o){n=!0}return function(e,t){return i(e,t),n?e.__proto__=t:r(e,t),e}}({},!1):void 0),check:i}},{"./_an-object":157,"./_ctx":170,"./_is-object":187,"./_object-gopd":201}],215:[function(e,t,n){"use strict";var r=e("./_global"),o=e("./_core"),i=e("./_object-dp"),s=e("./_descriptors"),a=e("./_wks")("species");t.exports=function(e){var t="function"==typeof o[e]?o[e]:r[e];s&&t&&!t[a]&&i.f(t,a,{configurable:!0,get:function(){return this}})}},{"./_core":168,"./_descriptors":172,"./_global":179,"./_object-dp":199,"./_wks":229}],216:[function(e,t,n){var r=e("./_object-dp").f,o=e("./_has"),i=e("./_wks")("toStringTag");t.exports=function(e,t,n){e&&!o(e=n?e:e.prototype,i)&&r(e,i,{configurable:!0,value:t})}},{"./_has":180,"./_object-dp":199,"./_wks":229}],217:[function(e,t,n){var r=e("./_shared")("keys"),o=e("./_uid");t.exports=function(e){return r[e]||(r[e]=o(e))}},{"./_shared":218,"./_uid":226}],218:[function(e,t,n){var r=e("./_global"),o="__core-js_shared__",i=r[o]||(r[o]={});t.exports=function(e){return i[e]||(i[e]={})}},{"./_global":179}],219:[function(e,t,n){var r=e("./_to-integer"),o=e("./_defined");t.exports=function(e){return function(t,n){var i,s,a=String(o(t)),u=r(n),c=a.length;return 0>u||u>=c?e?"":void 0:(i=a.charCodeAt(u),55296>i||i>56319||u+1===c||(s=a.charCodeAt(u+1))<56320||s>57343?e?a.charAt(u):i:e?a.slice(u,u+2):(i-55296<<10)+(s-56320)+65536)}}},{"./_defined":171,"./_to-integer":221}],220:[function(e,t,n){var r=e("./_to-integer"),o=Math.max,i=Math.min;t.exports=function(e,t){return e=r(e),0>e?o(e+t,0):i(e,t)}},{"./_to-integer":221}],221:[function(e,t,n){var r=Math.ceil,o=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?o:r)(e)}},{}],222:[function(e,t,n){var r=e("./_iobject"),o=e("./_defined");t.exports=function(e){return r(o(e))}},{"./_defined":171,"./_iobject":184}],223:[function(e,t,n){var r=e("./_to-integer"),o=Math.min;t.exports=function(e){return e>0?o(r(e),9007199254740991):0}},{"./_to-integer":221}],224:[function(e,t,n){var r=e("./_defined");t.exports=function(e){return Object(r(e))}},{"./_defined":171}],225:[function(e,t,n){var r=e("./_is-object");t.exports=function(e,t){if(!r(e))return e;var n,o;if(t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;if("function"==typeof(n=e.valueOf)&&!r(o=n.call(e)))return o;if(!t&&"function"==typeof(n=e.toString)&&!r(o=n.call(e)))return o;throw TypeError("Can't convert object to primitive value")}},{"./_is-object":187}],226:[function(e,t,n){var r=0,o=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++r+o).toString(36))}},{}],227:[function(e,t,n){var r=e("./_global"),o=e("./_core"),i=e("./_library"),s=e("./_wks-ext"),a=e("./_object-dp").f;t.exports=function(e){var t=o.Symbol||(o.Symbol=i?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},{"./_core":168,"./_global":179,"./_library":195,"./_object-dp":199,"./_wks-ext":228}],228:[function(e,t,n){n.f=e("./_wks")},{"./_wks":229}],229:[function(e,t,n){var r=e("./_shared")("wks"),o=e("./_uid"),i=e("./_global").Symbol,s="function"==typeof i,a=t.exports=function(e){return r[e]||(r[e]=s&&i[e]||(s?i:o)("Symbol."+e))};a.store=r},{"./_global":179,"./_shared":218,"./_uid":226}],230:[function(e,t,n){var r=e("./_classof"),o=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").getIteratorMethod=function(e){return void 0!=e?e[o]||e["@@iterator"]||i[r(e)]:void 0}},{"./_classof":163,"./_core":168,"./_iterators":193,"./_wks":229}],231:[function(e,t,n){var r=e("./_an-object"),o=e("./core.get-iterator-method");t.exports=e("./_core").getIterator=function(e){var t=o(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},{"./_an-object":157,"./_core":168,"./core.get-iterator-method":230}],232:[function(e,t,n){var r=e("./_classof"),o=e("./_wks")("iterator"),i=e("./_iterators");t.exports=e("./_core").isIterable=function(e){var t=Object(e);return void 0!==t[o]||"@@iterator"in t||i.hasOwnProperty(r(t))}},{"./_classof":163,"./_core":168,"./_iterators":193,"./_wks":229}],233:[function(e,t,n){"use strict";var r=e("./_ctx"),o=e("./_export"),i=e("./_to-object"),s=e("./_iter-call"),a=e("./_is-array-iter"),u=e("./_to-length"),c=e("./_create-property"),l=e("./core.get-iterator-method");o(o.S+o.F*!e("./_iter-detect")(function(e){Array.from(e)}),"Array",{from:function(e){var t,n,o,f,d=i(e),h="function"==typeof this?this:Array,p=arguments.length,_=p>1?arguments[1]:void 0,m=void 0!==_,b=0,v=l(d);if(m&&(_=r(_,p>2?arguments[2]:void 0,2)),void 0==v||h==Array&&a(v))for(t=u(d.length),n=new h(t);t>b;b++)c(n,b,m?_(d[b],b):d[b]);else for(f=v.call(d),n=new h;!(o=f.next()).done;b++)c(n,b,m?s(f,_,[o.value,b],!0):o.value);return n.length=b,n}})},{"./_create-property":169,"./_ctx":170,"./_export":176,"./_is-array-iter":185,"./_iter-call":188,"./_iter-detect":191,"./_to-length":223,"./_to-object":224,"./core.get-iterator-method":230}],234:[function(e,t,n){"use strict";var r=e("./_add-to-unscopables"),o=e("./_iter-step"),i=e("./_iterators"),s=e("./_to-iobject");t.exports=e("./_iter-define")(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,o(1)):"keys"==t?o(0,n):"values"==t?o(0,e[n]):o(0,[n,e[n]])},"values"),i.Arguments=i.Array,r("keys"),r("values"),r("entries")},{"./_add-to-unscopables":155,"./_iter-define":190,"./_iter-step":192,"./_iterators":193,"./_to-iobject":222}],235:[function(e,t,n){"use strict";var r=e("./_collection-strong");t.exports=e("./_collection")("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=r.getEntry(this,e);return t&&t.v},set:function(e,t){return r.def(this,0===e?0:e,t)}},r,!0)},{"./_collection":167,"./_collection-strong":165}],236:[function(e,t,n){var r=e("./_export");r(r.S+r.F,"Object",{assign:e("./_object-assign")})},{"./_export":176,"./_object-assign":197}],237:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{create:e("./_object-create")})},{"./_export":176,"./_object-create":198}],238:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperties:e("./_object-dps")})},{"./_descriptors":172,"./_export":176,"./_object-dps":200}],239:[function(e,t,n){var r=e("./_export");r(r.S+r.F*!e("./_descriptors"),"Object",{defineProperty:e("./_object-dp").f})},{"./_descriptors":172,"./_export":176,"./_object-dp":199}],240:[function(e,t,n){var r=e("./_is-object"),o=e("./_meta").onFreeze;e("./_object-sap")("freeze",function(e){return function(t){return e&&r(t)?e(o(t)):t}})},{"./_is-object":187,"./_meta":196,"./_object-sap":209}],241:[function(e,t,n){e("./_object-sap")("getOwnPropertyNames",function(){return e("./_object-gopn-ext").f})},{"./_object-gopn-ext":202,"./_object-sap":209}],242:[function(e,t,n){var r=e("./_to-object"),o=e("./_object-gpo");e("./_object-sap")("getPrototypeOf",function(){return function(e){return o(r(e))}})},{"./_object-gpo":205,"./_object-sap":209,"./_to-object":224}],243:[function(e,t,n){var r=e("./_is-object");e("./_object-sap")("isFrozen",function(e){return function(t){return r(t)?e?e(t):!1:!0}})},{"./_is-object":187,"./_object-sap":209}],244:[function(e,t,n){var r=e("./_to-object"),o=e("./_object-keys");e("./_object-sap")("keys",function(){return function(e){return o(r(e))}})},{"./_object-keys":207,"./_object-sap":209,"./_to-object":224}],245:[function(e,t,n){var r=e("./_is-object"),o=e("./_meta").onFreeze;e("./_object-sap")("seal",function(e){return function(t){return e&&r(t)?e(o(t)):t}})},{"./_is-object":187,"./_meta":196,"./_object-sap":209}],246:[function(e,t,n){var r=e("./_export");r(r.S,"Object",{setPrototypeOf:e("./_set-proto").set})},{"./_export":176,"./_set-proto":214}],247:[function(e,t,n){},{}],248:[function(e,t,n){"use strict";var r=e("./_string-at")(!0);e("./_iter-define")(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})})},{"./_iter-define":190,"./_string-at":219}],249:[function(e,t,n){"use strict";var r=e("./_global"),o=e("./_has"),i=e("./_descriptors"),s=e("./_export"),a=e("./_redefine"),u=e("./_meta").KEY,c=e("./_fails"),l=e("./_shared"),f=e("./_set-to-string-tag"),d=e("./_uid"),h=e("./_wks"),p=e("./_wks-ext"),_=e("./_wks-define"),m=e("./_keyof"),b=e("./_enum-keys"),v=e("./_is-array"),g=e("./_an-object"),y=e("./_to-iobject"),w=e("./_to-primitive"),C=e("./_property-desc"),k=e("./_object-create"),S=e("./_object-gopn-ext"),E=e("./_object-gopd"),T=e("./_object-dp"),j=e("./_object-keys"),A=E.f,P=T.f,x=S.f,D=r.Symbol,I=r.JSON,R=I&&I.stringify,M="prototype",O=h("_hidden"),N=h("toPrimitive"),L={}.propertyIsEnumerable,U=l("symbol-registry"),B=l("symbols"),H=l("op-symbols"),q=Object[M],F="function"==typeof D,z=r.QObject,V=!z||!z[M]||!z[M].findChild,K=i&&c(function(){return 7!=k(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(e,t,n){var r=A(q,t);r&&delete q[t],P(e,t,n),r&&e!==q&&P(q,t,r)}:P,G=function(e){var t=B[e]=k(D[M]);return t._k=e,t},W=F&&"symbol"==typeof D.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof D},Y=function(e,t,n){return e===q&&Y(H,t,n),g(e),t=w(t,!0),g(n),o(B,t)?(n.enumerable?(o(e,O)&&e[O][t]&&(e[O][t]=!1),n=k(n,{enumerable:C(0,!1)})):(o(e,O)||P(e,O,C(1,{})),e[O][t]=!0),K(e,t,n)):P(e,t,n)},X=function(e,t){g(e);for(var n,r=b(t=y(t)),o=0,i=r.length;i>o;)Y(e,n=r[o++],t[n]);return e},J=function(e,t){return void 0===t?k(e):X(k(e),t)},Z=function(e){var t=L.call(this,e=w(e,!0));return this===q&&o(B,e)&&!o(H,e)?!1:t||!o(this,e)||!o(B,e)||o(this,O)&&this[O][e]?t:!0},Q=function(e,t){if(e=y(e),t=w(t,!0),e!==q||!o(B,t)||o(H,t)){var n=A(e,t);return!n||!o(B,t)||o(e,O)&&e[O][t]||(n.enumerable=!0),n}},$=function(e){for(var t,n=x(y(e)),r=[],i=0;n.length>i;)o(B,t=n[i++])||t==O||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===q,r=x(n?H:y(e)),i=[],s=0;r.length>s;)o(B,t=r[s++])&&(n?o(q,t):!0)&&i.push(B[t]);return i};F||(D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor!");var e=d(arguments.length>0?arguments[0]:void 0),t=function(n){this===q&&t.call(H,n),o(this,O)&&o(this[O],e)&&(this[O][e]=!1),K(this,e,C(1,n))};return i&&V&&K(q,e,{configurable:!0,set:t}),G(e)},a(D[M],"toString",function(){return this._k}),E.f=Q,T.f=Y,e("./_object-gopn").f=S.f=$,e("./_object-pie").f=Z,e("./_object-gops").f=ee,i&&!e("./_library")&&a(q,"propertyIsEnumerable",Z,!0),p.f=function(e){return G(h(e))}),s(s.G+s.W+s.F*!F,{Symbol:D});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)h(te[ne++]);for(var te=j(h.store),ne=0;te.length>ne;)_(te[ne++]);s(s.S+s.F*!F,"Symbol",{"for":function(e){return o(U,e+="")?U[e]:U[e]=D(e)},keyFor:function(e){if(W(e))return m(U,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){V=!0},useSimple:function(){V=!1}}),s(s.S+s.F*!F,"Object",{create:J,defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Q,getOwnPropertyNames:$,getOwnPropertySymbols:ee}),I&&s(s.S+s.F*(!F||c(function(){var e=D();return"[null]"!=R([e])||"{}"!=R({a:e})||"{}"!=R(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!W(e)){for(var t,n,r=[e],o=1;arguments.length>o;)r.push(arguments[o++]);return t=r[1],"function"==typeof t&&(n=t),!n&&v(t)||(t=function(e,t){return n&&(t=n.call(this,e,t)),W(t)?void 0:t}),r[1]=t,R.apply(I,r)}}}),D[M][N]||e("./_hide")(D[M],N,D[M].valueOf),f(D,"Symbol"),f(Math,"Math",!0),f(r.JSON,"JSON",!0)},{"./_an-object":157,"./_descriptors":172,"./_enum-keys":175,"./_export":176,"./_fails":177,"./_global":179,"./_has":180,"./_hide":181,"./_is-array":186,"./_keyof":194,"./_library":195,"./_meta":196,"./_object-create":198,"./_object-dp":199,"./_object-gopd":201,"./_object-gopn":203,"./_object-gopn-ext":202,"./_object-gops":204,"./_object-keys":207,"./_object-pie":208,"./_property-desc":211,"./_redefine":213,"./_set-to-string-tag":216,"./_shared":218,"./_to-iobject":222,"./_to-primitive":225,"./_uid":226,"./_wks":229,"./_wks-define":227,"./_wks-ext":228}],250:[function(e,t,n){var r=e("./_export");r(r.P+r.R,"Map",{toJSON:e("./_collection-to-json")("Map")})},{"./_collection-to-json":166,"./_export":176}],251:[function(e,t,n){var r=e("./_export"),o=e("./_object-to-array")(!1);r(r.S,"Object",{values:function(e){return o(e)}})},{"./_export":176,"./_object-to-array":210}],252:[function(e,t,n){e("./_wks-define")("asyncIterator")},{"./_wks-define":227}],253:[function(e,t,n){e("./_wks-define")("observable")},{"./_wks-define":227}],254:[function(e,t,n){e("./es6.array.iterator");for(var r=e("./_global"),o=e("./_hide"),i=e("./_iterators"),s=e("./_wks")("toStringTag"),a=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],u=0;5>u;u++){var c=a[u],l=r[c],f=l&&l.prototype;f&&!f[s]&&o(f,s,c),i[c]=i.Array}},{"./_global":179,"./_hide":181,"./_iterators":193,"./_wks":229,"./es6.array.iterator":234}],255:[function(e,t,n){"use strict";function r(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(){}o.prototype._events=void 0,o.prototype.listeners=function(e){if(!this._events||!this._events[e])return[];if(this._events[e].fn)return[this._events[e].fn];for(var t=0,n=this._events[e].length,r=new Array(n);n>t;t++)r[t]=this._events[e][t].fn;return r},o.prototype.emit=function(e,t,n,r,o,i){if(!this._events||!this._events[e])return!1;var s,a,u=this._events[e],c=arguments.length;if("function"==typeof u.fn){switch(u.once&&this.removeListener(e,u.fn,!0),c){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,r),!0;case 5:return u.fn.call(u.context,t,n,r,o),!0;case 6:return u.fn.call(u.context,t,n,r,o,i),!0}for(a=1,s=new Array(c-1);c>a;a++)s[a-1]=arguments[a];u.fn.apply(u.context,s)}else{var l,f=u.length;for(a=0;f>a;a++)switch(u[a].once&&this.removeListener(e,u[a].fn,!0),c){case 1:u[a].fn.call(u[a].context);break;case 2:u[a].fn.call(u[a].context,t);break;case 3:u[a].fn.call(u[a].context,t,n);break;default:if(!s)for(l=1,s=new Array(c-1);c>l;l++)s[l-1]=arguments[l];u[a].fn.apply(u[a].context,s)}}return!0},o.prototype.on=function(e,t,n){var o=new r(t,n||this);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],o]:this._events[e].push(o):this._events[e]=o,this},o.prototype.once=function(e,t,n){var o=new r(t,n||this,!0);return this._events||(this._events={}),this._events[e]?this._events[e].fn?this._events[e]=[this._events[e],o]:this._events[e].push(o):this._events[e]=o,this},o.prototype.removeListener=function(e,t,n){if(!this._events||!this._events[e])return this;var r=this._events[e],o=[];if(t&&(r.fn&&(r.fn!==t||n&&!r.once)&&o.push(r),!r.fn))for(var i=0,s=r.length;s>i;i++)(r[i].fn!==t||n&&!r[i].once)&&o.push(r[i]);return o.length?this._events[e]=1===o.length?o[0]:o:delete this._events[e],this},o.prototype.removeAllListeners=function(e){return this._events?(e?delete this._events[e]:this._events={},this):this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prototype.setMaxListeners=function(){return this},o.EventEmitter=o,o.EventEmitter2=o,o.EventEmitter3=o,t.exports=o},{}],256:[function(e,t,n){t.exports=function(){return this}()},{}],257:[function(e,t,n){var r=[].indexOf;t.exports=function(e,t){if(r)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},{}],258:[function(e,t,n){t.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},{}],259:[function(t,n,r){!function(t){function n(e){if(n[e]!==s)return n[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=n("json-stringify")&&n("json-parse");else{var r,o='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var i=l.stringify,u="function"==typeof i&&f;if(u){(r=function(){return 1}).toJSON=r;try{u="0"===i(0)&&"0"===i(new Number)&&'""'==i(new String)&&i(a)===s&&i(s)===s&&i()===s&&"1"===i(r)&&"[1]"==i([r])&&"[null]"==i([s])&&"null"==i(null)&&"[null,null,null]"==i([s,a,null])&&i({a:[r,!0,!1,null,"\x00\b\n\f\r	"]})==o&&"1"===i(null,r)&&"[\n 1,\n 2\n]"==i([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==i(new Date(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==i(new Date(864e13))&&'"-000001-01-01T00:00:00.000Z"'==i(new Date(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==i(new Date(-1))}catch(c){u=!1}}t=u}if("json-parse"==e){var d=l.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){r=d(o);var h=5==r.a.length&&1===r.a[0];if(h){try{h=!d('"	"')}catch(c){}if(h)try{h=1!==d("01")}catch(c){}if(h)try{h=1!==d("1.")}catch(c){}}}}catch(c){h=!1}t=h}}return n[e]=!!t}var o,i,s,a={}.toString,u="function"==typeof e&&e.amd,c="object"==typeof JSON&&JSON,l="object"==typeof r&&r&&!r.nodeType&&r;l&&c?(l.stringify=c.stringify,l.parse=c.parse):l=t.JSON=c||{};var f=new Date(-0xc782b5b800cec);try{f=-109252==f.getUTCFullYear()&&0===f.getUTCMonth()&&1===f.getUTCDate()&&10==f.getUTCHours()&&37==f.getUTCMinutes()&&6==f.getUTCSeconds()&&708==f.getUTCMilliseconds()}catch(d){}if(!n("json")){var h="[object Function]",p="[object Date]",_="[object Number]",m="[object String]",b="[object Array]",v="[object Boolean]",g=n("bug-string-char-index");if(!f)var y=Math.floor,w=[0,31,59,90,120,151,181,212,243,273,304,334],C=function(e,t){return w[t]+365*(e-1970)+y((e-1969+(t=+(t>1)))/4)-y((e-1901+t)/100)+y((e-1601+t)/400)};(o={}.hasOwnProperty)||(o=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=a?o=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,o=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,o.call(this,e)});var k={"boolean":1,number:1,string:1,undefined:1},S=function(e,t){var n=typeof e[t];return"object"==n?!!e[t]:!k[n]};if(i=function(e,t){var n,r,s,u=0;(n=function(){this.valueOf=0}).prototype.valueOf=0,r=new n;for(s in r)o.call(r,s)&&u++;return n=r=null,u?i=2==u?function(e,t){var n,r={},i=a.call(e)==h;for(n in e)i&&"prototype"==n||o.call(r,n)||!(r[n]=1)||!o.call(e,n)||t(n)}:function(e,t){var n,r,i=a.call(e)==h;for(n in e)i&&"prototype"==n||!o.call(e,n)||(r="constructor"===n)||t(n);(r||o.call(e,n="constructor"))&&t(n)}:(r=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],i=function(e,t){var n,i,s=a.call(e)==h,u=!s&&"function"!=typeof e.constructor&&S(e,"hasOwnProperty")?e.hasOwnProperty:o;for(n in e)s&&"prototype"==n||!u.call(e,n)||t(n);for(i=r.length;n=r[--i];u.call(e,n)&&t(n));}),i(e,t)},!n("json-stringify")){var E={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},T="000000",j=function(e,t){return(T+(t||0)).slice(-e)},A="\\u00",P=function(e){var t,n='"',r=0,o=e.length,i=o>10&&g;for(i&&(t=e.split(""));o>r;r++){var s=e.charCodeAt(r);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:n+=E[s];break;default:if(32>s){n+=A+j(2,s.toString(16));break}n+=i?t[r]:g?e.charAt(r):e[r]}}return n+'"'},x=function(e,t,n,r,u,c,l){var f,d,h,g,w,k,S,E,T,A,D,I,R,M,O,N;try{f=t[e]}catch(L){}if("object"==typeof f&&f)if(d=a.call(f),d!=p||o.call(f,"toJSON"))"function"==typeof f.toJSON&&(d!=_&&d!=m&&d!=b||o.call(f,"toJSON"))&&(f=f.toJSON(e));else if(f>-1/0&&1/0>f){if(C){for(w=y(f/864e5),h=y(w/365.2425)+1970-1;C(h+1,0)<=w;h++);for(g=y((w-C(h,0))/30.42);C(h,g+1)<=w;g++);w=1+w-C(h,g),k=(f%864e5+864e5)%864e5,S=y(k/36e5)%24,E=y(k/6e4)%60,T=y(k/1e3)%60,A=k%1e3}else h=f.getUTCFullYear(),g=f.getUTCMonth(),w=f.getUTCDate(),S=f.getUTCHours(),E=f.getUTCMinutes(),T=f.getUTCSeconds(),A=f.getUTCMilliseconds();f=(0>=h||h>=1e4?(0>h?"-":"+")+j(6,0>h?-h:h):j(4,h))+"-"+j(2,g+1)+"-"+j(2,w)+"T"+j(2,S)+":"+j(2,E)+":"+j(2,T)+"."+j(3,A)+"Z"}else f=null;if(n&&(f=n.call(t,e,f)),null===f)return"null";if(d=a.call(f),d==v)return""+f;if(d==_)return f>-1/0&&1/0>f?""+f:"null";
if(d==m)return P(""+f);if("object"==typeof f){for(M=l.length;M--;)if(l[M]===f)throw TypeError();if(l.push(f),D=[],O=c,c+=u,d==b){for(R=0,M=f.length;M>R;R++)I=x(R,f,n,r,u,c,l),D.push(I===s?"null":I);N=D.length?u?"[\n"+c+D.join(",\n"+c)+"\n"+O+"]":"["+D.join(",")+"]":"[]"}else i(r||f,function(e){var t=x(e,f,n,r,u,c,l);t!==s&&D.push(P(e)+":"+(u?" ":"")+t)}),N=D.length?u?"{\n"+c+D.join(",\n"+c)+"\n"+O+"}":"{"+D.join(",")+"}":"{}";return l.pop(),N}};l.stringify=function(e,t,n){var r,o,i,s;if("function"==typeof t||"object"==typeof t&&t)if((s=a.call(t))==h)o=t;else if(s==b){i={};for(var u,c=0,l=t.length;l>c;u=t[c++],s=a.call(u),(s==m||s==_)&&(i[u]=1));}if(n)if((s=a.call(n))==_){if((n-=n%1)>0)for(r="",n>10&&(n=10);r.length<n;r+=" ");}else s==m&&(r=n.length<=10?n:n.slice(0,10));return x("",(u={},u[""]=e,u),o,i,r,"",[])}}if(!n("json-parse")){var D,I,R=String.fromCharCode,M={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},O=function(){throw D=I=null,SyntaxError()},N=function(){for(var e,t,n,r,o,i=I,s=i.length;s>D;)switch(o=i.charCodeAt(D)){case 9:case 10:case 13:case 32:D++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=g?i.charAt(D):i[D],D++,e;case 34:for(e="@",D++;s>D;)if(o=i.charCodeAt(D),32>o)O();else if(92==o)switch(o=i.charCodeAt(++D)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=M[o],D++;break;case 117:for(t=++D,n=D+4;n>D;D++)o=i.charCodeAt(D),o>=48&&57>=o||o>=97&&102>=o||o>=65&&70>=o||O();e+=R("0x"+i.slice(t,D));break;default:O()}else{if(34==o)break;for(o=i.charCodeAt(D),t=D;o>=32&&92!=o&&34!=o;)o=i.charCodeAt(++D);e+=i.slice(t,D)}if(34==i.charCodeAt(D))return D++,e;O();default:if(t=D,45==o&&(r=!0,o=i.charCodeAt(++D)),o>=48&&57>=o){for(48==o&&(o=i.charCodeAt(D+1),o>=48&&57>=o)&&O(),r=!1;s>D&&(o=i.charCodeAt(D),o>=48&&57>=o);D++);if(46==i.charCodeAt(D)){for(n=++D;s>n&&(o=i.charCodeAt(n),o>=48&&57>=o);n++);n==D&&O(),D=n}if(o=i.charCodeAt(D),101==o||69==o){for(o=i.charCodeAt(++D),43!=o&&45!=o||D++,n=D;s>n&&(o=i.charCodeAt(n),o>=48&&57>=o);n++);n==D&&O(),D=n}return+i.slice(t,D)}if(r&&O(),"true"==i.slice(D,D+4))return D+=4,!0;if("false"==i.slice(D,D+5))return D+=5,!1;if("null"==i.slice(D,D+4))return D+=4,null;O()}return"$"},L=function(e){var t,n;if("$"==e&&O(),"string"==typeof e){if("@"==(g?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=N(),"]"!=e;n||(n=!0))n&&(","==e?(e=N(),"]"==e&&O()):O()),","==e&&O(),t.push(L(e));return t}if("{"==e){for(t={};e=N(),"}"!=e;n||(n=!0))n&&(","==e?(e=N(),"}"==e&&O()):O()),","!=e&&"string"==typeof e&&"@"==(g?e.charAt(0):e[0])&&":"==N()||O(),t[e.slice(1)]=L(N());return t}O()}return e},U=function(e,t,n){var r=B(e,t,n);r===s?delete e[t]:e[t]=r},B=function(e,t,n){var r,o=e[t];if("object"==typeof o&&o)if(a.call(o)==b)for(r=o.length;r--;)U(o,r,n);else i(o,function(e){U(o,e,n)});return n.call(e,t,o)};l.parse=function(e,t){var n,r;return D=0,I=""+e,n=L(N()),"$"!=N()&&O(),D=I=null,t&&a.call(t)==h?B((r={},r[""]=n,r),"",t):n}}}u&&e(function(){return l})}(this)},{}],260:[function(e,t,n){var r=Object.prototype.hasOwnProperty;n.keys=Object.keys||function(e){var t=[];for(var n in e)r.call(e,n)&&t.push(n);return t},n.values=function(e){var t=[];for(var n in e)r.call(e,n)&&t.push(e[n]);return t},n.merge=function(e,t){for(var n in t)r.call(t,n)&&(e[n]=t[n]);return e},n.length=function(e){return n.keys(e).length},n.isEmpty=function(e){return 0==n.length(e)}},{}],261:[function(e,t,n){(function(e){var n=/^[\],:{}\s]*$/,r=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,o=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,i=/(?:^|:|,)(?:\s*\[)+/g,s=/^\s+/,a=/\s+$/;t.exports=function(t){return"string"==typeof t&&t?(t=t.replace(s,"").replace(a,""),e.JSON&&JSON.parse?JSON.parse(t):n.test(t.replace(r,"@").replace(o,"]").replace(i,""))?new Function("return "+t)():void 0):null}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],262:[function(e,t,n){n.encode=function(e){var t="";for(var n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t},n.decode=function(e){for(var t={},n=e.split("&"),r=0,o=n.length;o>r;r++){var i=n[r].split("=");t[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}return t}},{}],263:[function(t,n,r){(function(t){!function(o){function i(e){throw new RangeError(M[e])}function s(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function a(e,t){var n=e.split("@"),r="";n.length>1&&(r=n[0]+"@",e=n[1]),e=e.replace(R,".");var o=e.split("."),i=s(o,t).join(".");return r+i}function u(e){for(var t,n,r=[],o=0,i=e.length;i>o;)t=e.charCodeAt(o++),t>=55296&&56319>=t&&i>o?(n=e.charCodeAt(o++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--)):r.push(t);return r}function c(e){return s(e,function(e){var t="";return e>65535&&(e-=65536,t+=L(e>>>10&1023|55296),e=56320|1023&e),t+=L(e)}).join("")}function l(e){return 10>e-48?e-22:26>e-65?e-65:26>e-97?e-97:k}function f(e,t){return e+22+75*(26>e)-((0!=t)<<5)}function d(e,t,n){var r=0;for(e=n?N(e/j):e>>1,e+=N(e/t);e>O*E>>1;r+=k)e=N(e/O);return N(r+(O+1)*e/(e+T))}function h(e){var t,n,r,o,s,a,u,f,h,p,_=[],m=e.length,b=0,v=P,g=A;for(n=e.lastIndexOf(x),0>n&&(n=0),r=0;n>r;++r)e.charCodeAt(r)>=128&&i("not-basic"),_.push(e.charCodeAt(r));for(o=n>0?n+1:0;m>o;){for(s=b,a=1,u=k;o>=m&&i("invalid-input"),f=l(e.charCodeAt(o++)),(f>=k||f>N((C-b)/a))&&i("overflow"),b+=f*a,h=g>=u?S:u>=g+E?E:u-g,!(h>f);u+=k)p=k-h,a>N(C/p)&&i("overflow"),a*=p;t=_.length+1,g=d(b-s,t,0==s),N(b/t)>C-v&&i("overflow"),v+=N(b/t),b%=t,_.splice(b++,0,v)}return c(_)}function p(e){var t,n,r,o,s,a,c,l,h,p,_,m,b,v,g,y=[];for(e=u(e),m=e.length,t=P,n=0,s=A,a=0;m>a;++a)_=e[a],128>_&&y.push(L(_));for(r=o=y.length,o&&y.push(x);m>r;){for(c=C,a=0;m>a;++a)_=e[a],_>=t&&c>_&&(c=_);for(b=r+1,c-t>N((C-n)/b)&&i("overflow"),n+=(c-t)*b,t=c,a=0;m>a;++a)if(_=e[a],t>_&&++n>C&&i("overflow"),_==t){for(l=n,h=k;p=s>=h?S:h>=s+E?E:h-s,!(p>l);h+=k)g=l-p,v=k-p,y.push(L(f(p+g%v,0))),l=N(g/v);y.push(L(f(l,0))),s=d(n,b,r==o),n=0,++r}++n,++t}return y.join("")}function _(e){return a(e,function(e){return D.test(e)?h(e.slice(4).toLowerCase()):e})}function m(e){return a(e,function(e){return I.test(e)?"xn--"+p(e):e})}var b="object"==typeof r&&r&&!r.nodeType&&r,v="object"==typeof n&&n&&!n.nodeType&&n,g="object"==typeof t&&t;g.global!==g&&g.window!==g&&g.self!==g||(o=g);var y,w,C=2147483647,k=36,S=1,E=26,T=38,j=700,A=72,P=128,x="-",D=/^xn--/,I=/[^\x20-\x7E]/,R=/[\x2E\u3002\uFF0E\uFF61]/g,M={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},O=k-S,N=Math.floor,L=String.fromCharCode;if(y={version:"1.4.1",ucs2:{decode:u,encode:c},decode:h,encode:p,toASCII:m,toUnicode:_},"function"==typeof e&&"object"==typeof e.amd&&e.amd)e("punycode",function(){return y});else if(b&&v)if(n.exports==b)v.exports=y;else for(w in y)y.hasOwnProperty(w)&&(b[w]=y[w]);else o.punycode=y}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],264:[function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.exports=function(e,t,n,i){t=t||"&",n=n||"=";var s={};if("string"!=typeof e||0===e.length)return s;var a=/\+/g;e=e.split(t);var u=1e3;i&&"number"==typeof i.maxKeys&&(u=i.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;c>l;++l){var f,d,h,p,_=e[l].replace(a,"%20"),m=_.indexOf(n);m>=0?(f=_.substr(0,m),d=_.substr(m+1)):(f=_,d=""),h=decodeURIComponent(f),p=decodeURIComponent(d),r(s,h)?o(s[h])?s[h].push(p):s[h]=[s[h],p]:s[h]=p}return s};var o=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{}],265:[function(e,t,n){"use strict";function r(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var o=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};t.exports=function(e,t,n,a){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?r(s(e),function(s){var a=encodeURIComponent(o(s))+n;return i(e[s])?r(e[s],function(e){return a+encodeURIComponent(o(e))}).join(t):a+encodeURIComponent(o(e[s]))}).join(t):a?encodeURIComponent(o(a))+n+encodeURIComponent(o(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},s=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},{}],266:[function(e,t,n){"use strict";n.decode=n.parse=e("./decode"),n.encode=n.stringify=e("./encode")},{"./decode":264,"./encode":265}],267:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":268}],268:[function(e,t,n){function r(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var n,r=o(e),i=r.source,c=r.id;return t.forceNew||t["force new connection"]||!1===t.multiplex?(a("ignoring socket cache for %s",i),n=s(i,t)):(u[c]||(a("new io instance for %s",i),u[c]=s(i,t)),n=u[c]),n.socket(r.path)}var o=e("./url"),i=e("socket.io-parser"),s=e("./manager"),a=e("debug")("socket.io-client");t.exports=n=r;var u=n.managers={};n.protocol=i.protocol,n.connect=r,n.Manager=e("./manager"),n.Socket=e("./socket")},{"./manager":269,"./socket":271,"./url":272,debug:274,"socket.io-parser":297}],269:[function(e,t,n){function r(e,t){return this instanceof r?(e&&"object"==typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.nsps={},this.subs=[],this.opts=t,this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(t.randomizationFactor||.5),this.backoff=new d({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this.readyState="closed",this.uri=e,this.connected=[],this.encoding=!1,this.packetBuffer=[],this.encoder=new a.Encoder,this.decoder=new a.Decoder,this.autoConnect=t.autoConnect!==!1,void(this.autoConnect&&this.open())):new r(e,t)}var o=(e("./url"),e("engine.io-client")),i=e("./socket"),s=e("component-emitter"),a=e("socket.io-parser"),u=e("./on"),c=e("component-bind"),l=(e("object-component"),e("debug")("socket.io-client:manager")),f=e("indexof"),d=e("backo2");t.exports=r,r.prototype.emitAll=function(){this.emit.apply(this,arguments);for(var e in this.nsps)this.nsps[e].emit.apply(this.nsps[e],arguments)},r.prototype.updateSocketIds=function(){for(var e in this.nsps)this.nsps[e].id=this.engine.id},s(r.prototype),r.prototype.reconnection=function(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection},r.prototype.reconnectionAttempts=function(e){return arguments.length?(this._reconnectionAttempts=e,this):this._reconnectionAttempts},r.prototype.reconnectionDelay=function(e){return arguments.length?(this._reconnectionDelay=e,this.backoff&&this.backoff.setMin(e),this):this._reconnectionDelay},r.prototype.randomizationFactor=function(e){return arguments.length?(this._randomizationFactor=e,this.backoff&&this.backoff.setJitter(e),this):this._randomizationFactor},r.prototype.reconnectionDelayMax=function(e){return arguments.length?(this._reconnectionDelayMax=e,this.backoff&&this.backoff.setMax(e),this):this._reconnectionDelayMax},r.prototype.timeout=function(e){return arguments.length?(this._timeout=e,this):this._timeout},r.prototype.maybeReconnectOnOpen=function(){!this.reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()},r.prototype.open=r.prototype.connect=function(e){if(l("readyState %s",this.readyState),~this.readyState.indexOf("open"))return this;l("opening %s",this.uri),this.engine=o(this.uri,this.opts);var t=this.engine,n=this;this.readyState="opening",this.skipReconnect=!1;var r=u(t,"open",function(){n.onopen(),e&&e()}),i=u(t,"error",function(t){if(l("connect_error"),n.cleanup(),n.readyState="closed",n.emitAll("connect_error",t),e){var r=new Error("Connection error");r.data=t,e(r)}else n.maybeReconnectOnOpen()});if(!1!==this._timeout){var s=this._timeout;l("connect attempt will timeout after %d",s);var a=setTimeout(function(){l("connect attempt timed out after %d",s),r.destroy(),t.close(),t.emit("error","timeout"),n.emitAll("connect_timeout",s)},s);this.subs.push({destroy:function(){clearTimeout(a)}})}return this.subs.push(r),this.subs.push(i),this},r.prototype.onopen=function(){l("open"),this.cleanup(),this.readyState="open",this.emit("open");var e=this.engine;this.subs.push(u(e,"data",c(this,"ondata"))),this.subs.push(u(this.decoder,"decoded",c(this,"ondecoded"))),this.subs.push(u(e,"error",c(this,"onerror"))),this.subs.push(u(e,"close",c(this,"onclose")))},r.prototype.ondata=function(e){this.decoder.add(e)},r.prototype.ondecoded=function(e){this.emit("packet",e)},r.prototype.onerror=function(e){l("error",e),this.emitAll("error",e)},r.prototype.socket=function(e){var t=this.nsps[e];if(!t){t=new i(this,e),this.nsps[e]=t;var n=this;t.on("connect",function(){t.id=n.engine.id,~f(n.connected,t)||n.connected.push(t)})}return t},r.prototype.destroy=function(e){var t=f(this.connected,e);~t&&this.connected.splice(t,1),this.connected.length||this.close()},r.prototype.packet=function(e){l("writing packet %j",e);var t=this;t.encoding?t.packetBuffer.push(e):(t.encoding=!0,this.encoder.encode(e,function(e){for(var n=0;n<e.length;n++)t.engine.write(e[n]);t.encoding=!1,t.processPacketQueue()}))},r.prototype.processPacketQueue=function(){if(this.packetBuffer.length>0&&!this.encoding){var e=this.packetBuffer.shift();this.packet(e)}},r.prototype.cleanup=function(){for(var e;e=this.subs.shift();)e.destroy();this.packetBuffer=[],this.encoding=!1,this.decoder.destroy()},r.prototype.close=r.prototype.disconnect=function(){this.skipReconnect=!0,this.backoff.reset(),this.readyState="closed",this.engine&&this.engine.close()},r.prototype.onclose=function(e){l("close"),this.cleanup(),this.backoff.reset(),this.readyState="closed",this.emit("close",e),this._reconnection&&!this.skipReconnect&&this.reconnect()},r.prototype.reconnect=function(){if(this.reconnecting||this.skipReconnect)return this;var e=this;if(this.backoff.attempts>=this._reconnectionAttempts)l("reconnect failed"),this.backoff.reset(),this.emitAll("reconnect_failed"),this.reconnecting=!1;else{var t=this.backoff.duration();l("will wait %dms before reconnect attempt",t),this.reconnecting=!0;var n=setTimeout(function(){e.skipReconnect||(l("attempting reconnect"),e.emitAll("reconnect_attempt",e.backoff.attempts),e.emitAll("reconnecting",e.backoff.attempts),e.skipReconnect||e.open(function(t){t?(l("reconnect attempt error"),e.reconnecting=!1,e.reconnect(),e.emitAll("reconnect_error",t.data)):(l("reconnect success"),e.onreconnect())}))},t);this.subs.push({destroy:function(){clearTimeout(n)}})}},r.prototype.onreconnect=function(){var e=this.backoff.attempts;this.reconnecting=!1,this.backoff.reset(),this.updateSocketIds(),this.emitAll("reconnect",e)}},{"./on":270,"./socket":271,"./url":272,backo2:129,"component-bind":132,"component-emitter":133,debug:274,"engine.io-client":275,indexof:257,"object-component":260,"socket.io-parser":297}],270:[function(e,t,n){function r(e,t,n){return e.on(t,n),{destroy:function(){e.removeListener(t,n)}}}t.exports=r},{}],271:[function(e,t,n){function r(e,t){this.io=e,this.nsp=t,this.json=this,this.ids=0,this.acks={},this.io.autoConnect&&this.open(),this.receiveBuffer=[],this.sendBuffer=[],this.connected=!1,this.disconnected=!0}var o=e("socket.io-parser"),i=e("component-emitter"),s=e("to-array"),a=e("./on"),u=e("component-bind"),c=e("debug")("socket.io-client:socket"),l=e("has-binary");t.exports=n=r;var f={connect:1,connect_error:1,connect_timeout:1,disconnect:1,error:1,reconnect:1,reconnect_attempt:1,reconnect_failed:1,reconnect_error:1,reconnecting:1},d=i.prototype.emit;i(r.prototype),r.prototype.subEvents=function(){if(!this.subs){var e=this.io;this.subs=[a(e,"open",u(this,"onopen")),a(e,"packet",u(this,"onpacket")),a(e,"close",u(this,"onclose"))]}},r.prototype.open=r.prototype.connect=function(){return this.connected?this:(this.subEvents(),this.io.open(),"open"==this.io.readyState&&this.onopen(),this)},r.prototype.send=function(){var e=s(arguments);return e.unshift("message"),this.emit.apply(this,e),this},r.prototype.emit=function(e){if(f.hasOwnProperty(e))return d.apply(this,arguments),this;var t=s(arguments),n=o.EVENT;l(t)&&(n=o.BINARY_EVENT);var r={type:n,data:t};return"function"==typeof t[t.length-1]&&(c("emitting packet with ack id %d",this.ids),this.acks[this.ids]=t.pop(),r.id=this.ids++),this.connected?this.packet(r):this.sendBuffer.push(r),this},r.prototype.packet=function(e){e.nsp=this.nsp,this.io.packet(e)},r.prototype.onopen=function(){c("transport is open - connecting"),"/"!=this.nsp&&this.packet({type:o.CONNECT})},r.prototype.onclose=function(e){c("close (%s)",e),this.connected=!1,this.disconnected=!0,delete this.id,this.emit("disconnect",e)},r.prototype.onpacket=function(e){if(e.nsp==this.nsp)switch(e.type){case o.CONNECT:this.onconnect();break;case o.EVENT:this.onevent(e);break;case o.BINARY_EVENT:this.onevent(e);break;case o.ACK:this.onack(e);break;case o.BINARY_ACK:this.onack(e);break;case o.DISCONNECT:this.ondisconnect();break;case o.ERROR:this.emit("error",e.data)}},r.prototype.onevent=function(e){var t=e.data||[];c("emitting event %j",t),null!=e.id&&(c("attaching ack callback to event"),t.push(this.ack(e.id))),this.connected?d.apply(this,t):this.receiveBuffer.push(t)},r.prototype.ack=function(e){var t=this,n=!1;return function(){if(!n){n=!0;var r=s(arguments);c("sending ack %j",r);var i=l(r)?o.BINARY_ACK:o.ACK;t.packet({type:i,id:e,data:r})}}},r.prototype.onack=function(e){c("calling ack %s with %j",e.id,e.data);var t=this.acks[e.id];t.apply(this,e.data),delete this.acks[e.id]},r.prototype.onconnect=function(){this.connected=!0,this.disconnected=!1,this.emit("connect"),this.emitBuffered()},r.prototype.emitBuffered=function(){var e;for(e=0;e<this.receiveBuffer.length;e++)d.apply(this,this.receiveBuffer[e]);for(this.receiveBuffer=[],e=0;e<this.sendBuffer.length;e++)this.packet(this.sendBuffer[e]);this.sendBuffer=[]},r.prototype.ondisconnect=function(){c("server disconnect (%s)",this.nsp),this.destroy(),this.onclose("io server disconnect")},r.prototype.destroy=function(){if(this.subs){for(var e=0;e<this.subs.length;e++)this.subs[e].destroy();this.subs=null}this.io.destroy(this)},r.prototype.close=r.prototype.disconnect=function(){return this.connected&&(c("performing disconnect (%s)",this.nsp),this.packet({type:o.DISCONNECT})),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}},{"./on":270,"component-bind":132,"component-emitter":133,debug:274,"has-binary":290,"socket.io-parser":297,"to-array":300}],272:[function(e,t,n){(function(n){function r(e,t){var r=e,t=t||n.location;return null==e&&(e=t.protocol+"//"+t.host),"string"==typeof e&&("/"==e.charAt(0)&&(e="/"==e.charAt(1)?t.protocol+e:t.hostname+e),/^(https?|wss?):\/\//.test(e)||(i("protocol-less url %s",e),e="undefined"!=typeof t?t.protocol+"//"+e:"https://"+e),i("parse %s",e),r=o(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/",r.id=r.protocol+"://"+r.host+":"+r.port,r.href=r.protocol+"://"+r.host+(t&&t.port==r.port?"":":"+r.port),r}var o=e("parseuri"),i=e("debug")("socket.io-client:url");t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{debug:274,parseuri:293}],273:[function(e,t,n){(function(e){function n(e,t){t=t||{};for(var n=new r,o=0;o<e.length;o++)n.append(e[o]);return t.type?n.getBlob(t.type):n.getBlob()}var r=e.BlobBuilder||e.WebKitBlobBuilder||e.MSBlobBuilder||e.MozBlobBuilder,o=function(){try{var e=new Blob(["hi"]);return 2==e.size}catch(t){return!1}}(),i=r&&r.prototype.append&&r.prototype.getBlob;t.exports=function(){return o?e.Blob:i?n:void 0}()}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],274:[function(e,t,n){function r(e){return r.enabled(e)?function(t){t=o(t);var n=new Date,i=n-(r[e]||n);r[e]=n,t=e+" "+t+" +"+r.humanize(i),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function o(e){return e instanceof Error?e.stack||e.message:e}t.exports=r,r.names=[],r.skips=[],r.enable=function(e){try{localStorage.debug=e}catch(t){}for(var n=(e||"").split(/[\s,]+/),o=n.length,i=0;o>i;i++)e=n[i].replace("*",".*?"),"-"===e[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$"))},r.disable=function(){r.enable("")},r.humanize=function(e){var t=1e3,n=6e4,r=60*n;return e>=r?(e/r).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(e/t|0)+"s":e+"ms"},r.enabled=function(e){for(var t=0,n=r.skips.length;n>t;t++)if(r.skips[t].test(e))return!1;for(var t=0,n=r.names.length;n>t;t++)if(r.names[t].test(e))return!0;return!1};try{window.localStorage&&r.enable(localStorage.debug)}catch(i){}},{}],275:[function(e,t,n){t.exports=e("./lib/")},{"./lib/":276}],276:[function(e,t,n){t.exports=e("./socket"),t.exports.parser=e("engine.io-parser")},{"./socket":277,"engine.io-parser":288}],277:[function(e,t,n){(function(n){function r(e,t){if(!(this instanceof r))return new r(e,t);if(t=t||{},e&&"object"==typeof e&&(t=e,e=null),e&&(e=l(e),t.host=e.host,t.secure="https"==e.protocol||"wss"==e.protocol,t.port=e.port,e.query&&(t.query=e.query)),this.secure=null!=t.secure?t.secure:n.location&&"https:"==location.protocol,t.host){var o=t.host.split(":");t.hostname=o.shift(),o.length?t.port=o.pop():t.port||(t.port=this.secure?"443":"80")}this.agent=t.agent||!1,this.hostname=t.hostname||(n.location?location.hostname:"localhost"),this.port=t.port||(n.location&&location.port?location.port:this.secure?443:80),this.query=t.query||{},"string"==typeof this.query&&(this.query=d.decode(this.query)),this.upgrade=!1!==t.upgrade,this.path=(t.path||"/engine.io").replace(/\/$/,"")+"/",this.forceJSONP=!!t.forceJSONP,this.jsonp=!1!==t.jsonp,this.forceBase64=!!t.forceBase64,this.enablesXDR=!!t.enablesXDR,this.timestampParam=t.timestampParam||"t",this.timestampRequests=t.timestampRequests,this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.callbackBuffer=[],this.policyPort=t.policyPort||843,this.rememberUpgrade=t.rememberUpgrade||!1,this.binaryType=null,this.onlyBinaryUpgrades=t.onlyBinaryUpgrades,this.pfx=t.pfx||null,this.key=t.key||null,this.passphrase=t.passphrase||null,this.cert=t.cert||null,this.ca=t.ca||null,this.ciphers=t.ciphers||null,this.rejectUnauthorized=t.rejectUnauthorized||null,this.open()}function o(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}var i=e("./transports"),s=e("component-emitter"),a=e("debug")("engine.io-client:socket"),u=e("indexof"),c=e("engine.io-parser"),l=e("parseuri"),f=e("parsejson"),d=e("parseqs");t.exports=r,r.priorWebsocketSuccess=!1,s(r.prototype),r.protocol=c.protocol,r.Socket=r,r.Transport=e("./transport"),r.transports=e("./transports"),r.parser=e("engine.io-parser"),r.prototype.createTransport=function(e){a('creating transport "%s"',e);var t=o(this.query);t.EIO=c.protocol,t.transport=e,this.id&&(t.sid=this.id);var n=new i[e]({agent:this.agent,hostname:this.hostname,port:this.port,secure:this.secure,path:this.path,query:t,forceJSONP:this.forceJSONP,jsonp:this.jsonp,forceBase64:this.forceBase64,enablesXDR:this.enablesXDR,timestampRequests:this.timestampRequests,timestampParam:this.timestampParam,policyPort:this.policyPort,socket:this,pfx:this.pfx,key:this.key,passphrase:this.passphrase,cert:this.cert,ca:this.ca,ciphers:this.ciphers,rejectUnauthorized:this.rejectUnauthorized});return n},r.prototype.open=function(){var e;if(this.rememberUpgrade&&r.priorWebsocketSuccess&&-1!=this.transports.indexOf("websocket"))e="websocket";else{if(0==this.transports.length){var t=this;return void setTimeout(function(){t.emit("error","No transports available")},0)}e=this.transports[0]}this.readyState="opening";var e;try{e=this.createTransport(e)}catch(n){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)},r.prototype.setTransport=function(e){a("setting transport %s",e.name);var t=this;this.transport&&(a("clearing existing transport %s",this.transport.name),this.transport.removeAllListeners()),this.transport=e,e.on("drain",function(){t.onDrain()}).on("packet",function(e){t.onPacket(e)}).on("error",function(e){t.onError(e)}).on("close",function(){t.onClose("transport close")})},r.prototype.probe=function(e){function t(){if(d.onlyBinaryUpgrades){var t=!this.supportsBinary&&d.transport.supportsBinary;f=f||t}f||(a('probe transport "%s" opened',e),l.send([{type:"ping",data:"probe"}]),l.once("packet",function(t){if(!f)if("pong"==t.type&&"probe"==t.data){if(a('probe transport "%s" pong',e),d.upgrading=!0,d.emit("upgrading",l),!l)return;r.priorWebsocketSuccess="websocket"==l.name,a('pausing current transport "%s"',d.transport.name),d.transport.pause(function(){f||"closed"!=d.readyState&&(a("changing transport and sending upgrade packet"),c(),d.setTransport(l),l.send([{type:"upgrade"}]),d.emit("upgrade",l),l=null,d.upgrading=!1,d.flush())})}else{a('probe transport "%s" failed',e);var n=new Error("probe error");n.transport=l.name,d.emit("upgradeError",n)}}))}function n(){f||(f=!0,c(),l.close(),l=null)}function o(t){var r=new Error("probe error: "+t);r.transport=l.name,n(),a('probe transport "%s" failed because of error: %s',e,t),d.emit("upgradeError",r)}function i(){o("transport closed")}function s(){o("socket closed")}function u(e){l&&e.name!=l.name&&(a('"%s" works - aborting "%s"',e.name,l.name),n())}function c(){l.removeListener("open",t),l.removeListener("error",o),l.removeListener("close",i),d.removeListener("close",s),d.removeListener("upgrading",u)}a('probing transport "%s"',e);var l=this.createTransport(e,{probe:1}),f=!1,d=this;r.priorWebsocketSuccess=!1,l.once("open",t),l.once("error",o),l.once("close",i),this.once("close",s),this.once("upgrading",u),l.open()},r.prototype.onOpen=function(){if(a("socket open"),this.readyState="open",r.priorWebsocketSuccess="websocket"==this.transport.name,this.emit("open"),this.flush(),"open"==this.readyState&&this.upgrade&&this.transport.pause){a("starting upgrade probes");for(var e=0,t=this.upgrades.length;t>e;e++)this.probe(this.upgrades[e])}},r.prototype.onPacket=function(e){if("opening"==this.readyState||"open"==this.readyState)switch(a('socket receive: type "%s", data "%s"',e.type,e.data),this.emit("packet",e),this.emit("heartbeat"),e.type){case"open":this.onHandshake(f(e.data));break;case"pong":this.setPing();break;case"error":var t=new Error("server error");t.code=e.data,this.emit("error",t);break;case"message":this.emit("data",e.data),this.emit("message",e.data)}else a('packet received with socket readyState "%s"',this.readyState)},r.prototype.onHandshake=function(e){this.emit("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.onOpen(),"closed"!=this.readyState&&(this.setPing(),this.removeListener("heartbeat",this.onHeartbeat),this.on("heartbeat",this.onHeartbeat))},r.prototype.onHeartbeat=function(e){clearTimeout(this.pingTimeoutTimer);var t=this;t.pingTimeoutTimer=setTimeout(function(){"closed"!=t.readyState&&t.onClose("ping timeout")},e||t.pingInterval+t.pingTimeout)},r.prototype.setPing=function(){var e=this;clearTimeout(e.pingIntervalTimer),e.pingIntervalTimer=setTimeout(function(){a("writing ping packet - expecting pong within %sms",e.pingTimeout),e.ping(),e.onHeartbeat(e.pingTimeout)},e.pingInterval)},r.prototype.ping=function(){this.sendPacket("ping")},r.prototype.onDrain=function(){for(var e=0;e<this.prevBufferLen;e++)this.callbackBuffer[e]&&this.callbackBuffer[e]();this.writeBuffer.splice(0,this.prevBufferLen),this.callbackBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0==this.writeBuffer.length?this.emit("drain"):this.flush()},r.prototype.flush=function(){"closed"!=this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length&&(a("flushing %d packets in socket",this.writeBuffer.length),this.transport.send(this.writeBuffer),this.prevBufferLen=this.writeBuffer.length,this.emit("flush"))},r.prototype.write=r.prototype.send=function(e,t){return this.sendPacket("message",e,t),this},r.prototype.sendPacket=function(e,t,n){if("closing"!=this.readyState&&"closed"!=this.readyState){var r={type:e,data:t};this.emit("packetCreate",r),this.writeBuffer.push(r),this.callbackBuffer.push(n),this.flush()}},r.prototype.close=function(){function e(){r.onClose("forced close"),a("socket closing - telling transport to close"),r.transport.close()}function t(){r.removeListener("upgrade",t),r.removeListener("upgradeError",t),e()}function n(){r.once("upgrade",t),r.once("upgradeError",t)}if("opening"==this.readyState||"open"==this.readyState){this.readyState="closing";var r=this;this.writeBuffer.length?this.once("drain",function(){this.upgrading?n():e()}):this.upgrading?n():e()}return this},r.prototype.onError=function(e){a("socket error %j",e),r.priorWebsocketSuccess=!1,this.emit("error",e),this.onClose("transport error",e)},r.prototype.onClose=function(e,t){if("opening"==this.readyState||"open"==this.readyState||"closing"==this.readyState){a('socket close with reason: "%s"',e);var n=this;clearTimeout(this.pingIntervalTimer),clearTimeout(this.pingTimeoutTimer),setTimeout(function(){n.writeBuffer=[],n.callbackBuffer=[],n.prevBufferLen=0},0),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),this.readyState="closed",this.id=null,this.emit("close",e,t)}},r.prototype.filterUpgrades=function(e){for(var t=[],n=0,r=e.length;r>n;n++)~u(this.transports,e[n])&&t.push(e[n]);return t}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./transport":278,"./transports":279,"component-emitter":133,debug:285,"engine.io-parser":288,indexof:257,parsejson:261,parseqs:262,parseuri:287}],278:[function(e,t,n){function r(e){this.path=e.path,this.hostname=e.hostname,this.port=e.port,this.secure=e.secure,this.query=e.query,this.timestampParam=e.timestampParam,this.timestampRequests=e.timestampRequests,this.readyState="",this.agent=e.agent||!1,this.socket=e.socket,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized}var o=e("engine.io-parser"),i=e("component-emitter");t.exports=r,i(r.prototype),r.timestamps=0,r.prototype.onError=function(e,t){var n=new Error(e);return n.type="TransportError",n.description=t,this.emit("error",n),this},r.prototype.open=function(){return"closed"!=this.readyState&&""!=this.readyState||(this.readyState="opening",this.doOpen()),this},r.prototype.close=function(){return"opening"!=this.readyState&&"open"!=this.readyState||(this.doClose(),this.onClose()),this},r.prototype.send=function(e){if("open"!=this.readyState)throw new Error("Transport not open");this.write(e)},r.prototype.onOpen=function(){this.readyState="open",this.writable=!0,this.emit("open")},r.prototype.onData=function(e){var t=o.decodePacket(e,this.socket.binaryType);this.onPacket(t)},r.prototype.onPacket=function(e){this.emit("packet",e)},r.prototype.onClose=function(){this.readyState="closed",this.emit("close")}},{"component-emitter":133,"engine.io-parser":288}],279:[function(e,t,n){(function(t){function r(e){var n,r=!1,a=!1,u=!1!==e.jsonp;if(t.location){var c="https:"==location.protocol,l=location.port;l||(l=c?443:80),r=e.hostname!=location.hostname||l!=e.port,a=e.secure!=c}if(e.xdomain=r,e.xscheme=a,n=new o(e),"open"in n&&!e.forceJSONP)return new i(e);if(!u)throw new Error("JSONP disabled");return new s(e)}var o=e("xmlhttprequest"),i=e("./polling-xhr"),s=e("./polling-jsonp"),a=e("./websocket");
n.polling=r,n.websocket=a}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling-jsonp":280,"./polling-xhr":281,"./websocket":283,xmlhttprequest:284}],280:[function(e,t,n){(function(n){function r(){}function o(e){i.call(this,e),this.query=this.query||{},a||(n.___eio||(n.___eio=[]),a=n.___eio),this.index=a.length;var t=this;a.push(function(e){t.onData(e)}),this.query.j=this.index,n.document&&n.addEventListener&&n.addEventListener("beforeunload",function(){t.script&&(t.script.onerror=r)},!1)}var i=e("./polling"),s=e("component-inherit");t.exports=o;var a,u=/\n/g,c=/\\n/g;s(o,i),o.prototype.supportsBinary=!1,o.prototype.doClose=function(){this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),this.form&&(this.form.parentNode.removeChild(this.form),this.form=null,this.iframe=null),i.prototype.doClose.call(this)},o.prototype.doPoll=function(){var e=this,t=document.createElement("script");this.script&&(this.script.parentNode.removeChild(this.script),this.script=null),t.async=!0,t.src=this.uri(),t.onerror=function(t){e.onError("jsonp poll error",t)};var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n),this.script=t;var r="undefined"!=typeof navigator&&/gecko/i.test(navigator.userAgent);r&&setTimeout(function(){var e=document.createElement("iframe");document.body.appendChild(e),document.body.removeChild(e)},100)},o.prototype.doWrite=function(e,t){function n(){r(),t()}function r(){if(o.iframe)try{o.form.removeChild(o.iframe)}catch(e){o.onError("jsonp polling iframe removal error",e)}try{var t='<iframe src="javascript:0" name="'+o.iframeId+'">';i=document.createElement(t)}catch(e){i=document.createElement("iframe"),i.name=o.iframeId,i.src="javascript:0"}i.id=o.iframeId,o.form.appendChild(i),o.iframe=i}var o=this;if(!this.form){var i,s=document.createElement("form"),a=document.createElement("textarea"),l=this.iframeId="eio_iframe_"+this.index;s.className="socketio",s.style.position="absolute",s.style.top="-1000px",s.style.left="-1000px",s.target=l,s.method="POST",s.setAttribute("accept-charset","utf-8"),a.name="d",s.appendChild(a),document.body.appendChild(s),this.form=s,this.area=a}this.form.action=this.uri(),r(),e=e.replace(c,"\\\n"),this.area.value=e.replace(u,"\\n");try{this.form.submit()}catch(f){}this.iframe.attachEvent?this.iframe.onreadystatechange=function(){"complete"==o.iframe.readyState&&n()}:this.iframe.onload=n}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":282,"component-inherit":134}],281:[function(e,t,n){(function(n){function r(){}function o(e){if(u.call(this,e),n.location){var t="https:"==location.protocol,r=location.port;r||(r=t?443:80),this.xd=e.hostname!=n.location.hostname||r!=e.port,this.xs=e.secure!=t}}function i(e){this.method=e.method||"GET",this.uri=e.uri,this.xd=!!e.xd,this.xs=!!e.xs,this.async=!1!==e.async,this.data=void 0!=e.data?e.data:null,this.agent=e.agent,this.isBinary=e.isBinary,this.supportsBinary=e.supportsBinary,this.enablesXDR=e.enablesXDR,this.pfx=e.pfx,this.key=e.key,this.passphrase=e.passphrase,this.cert=e.cert,this.ca=e.ca,this.ciphers=e.ciphers,this.rejectUnauthorized=e.rejectUnauthorized,this.create()}function s(){for(var e in i.requests)i.requests.hasOwnProperty(e)&&i.requests[e].abort()}var a=e("xmlhttprequest"),u=e("./polling"),c=e("component-emitter"),l=e("component-inherit"),f=e("debug")("engine.io-client:polling-xhr");t.exports=o,t.exports.Request=i,l(o,u),o.prototype.supportsBinary=!0,o.prototype.request=function(e){return e=e||{},e.uri=this.uri(),e.xd=this.xd,e.xs=this.xs,e.agent=this.agent||!1,e.supportsBinary=this.supportsBinary,e.enablesXDR=this.enablesXDR,e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized,new i(e)},o.prototype.doWrite=function(e,t){var n="string"!=typeof e&&void 0!==e,r=this.request({method:"POST",data:e,isBinary:n}),o=this;r.on("success",t),r.on("error",function(e){o.onError("xhr post error",e)}),this.sendXhr=r},o.prototype.doPoll=function(){f("xhr poll");var e=this.request(),t=this;e.on("data",function(e){t.onData(e)}),e.on("error",function(e){t.onError("xhr poll error",e)}),this.pollXhr=e},c(i.prototype),i.prototype.create=function(){var e={agent:this.agent,xdomain:this.xd,xscheme:this.xs,enablesXDR:this.enablesXDR};e.pfx=this.pfx,e.key=this.key,e.passphrase=this.passphrase,e.cert=this.cert,e.ca=this.ca,e.ciphers=this.ciphers,e.rejectUnauthorized=this.rejectUnauthorized;var t=this.xhr=new a(e),r=this;try{if(f("xhr open %s: %s",this.method,this.uri),t.open(this.method,this.uri,this.async),this.supportsBinary&&(t.responseType="arraybuffer"),"POST"==this.method)try{this.isBinary?t.setRequestHeader("Content-type","application/octet-stream"):t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(o){}"withCredentials"in t&&(t.withCredentials=!0),this.hasXDR()?(t.onload=function(){r.onLoad()},t.onerror=function(){r.onError(t.responseText)}):t.onreadystatechange=function(){4==t.readyState&&(200==t.status||1223==t.status?r.onLoad():setTimeout(function(){r.onError(t.status)},0))},f("xhr data %s",this.data),t.send(this.data)}catch(o){return void setTimeout(function(){r.onError(o)},0)}n.document&&(this.index=i.requestsCount++,i.requests[this.index]=this)},i.prototype.onSuccess=function(){this.emit("success"),this.cleanup()},i.prototype.onData=function(e){this.emit("data",e),this.onSuccess()},i.prototype.onError=function(e){this.emit("error",e),this.cleanup(!0)},i.prototype.cleanup=function(e){if("undefined"!=typeof this.xhr&&null!==this.xhr){if(this.hasXDR()?this.xhr.onload=this.xhr.onerror=r:this.xhr.onreadystatechange=r,e)try{this.xhr.abort()}catch(t){}n.document&&delete i.requests[this.index],this.xhr=null}},i.prototype.onLoad=function(){var e;try{var t;try{t=this.xhr.getResponseHeader("Content-Type").split(";")[0]}catch(n){}e="application/octet-stream"===t?this.xhr.response:this.supportsBinary?"ok":this.xhr.responseText}catch(n){this.onError(n)}null!=e&&this.onData(e)},i.prototype.hasXDR=function(){return"undefined"!=typeof n.XDomainRequest&&!this.xs&&this.enablesXDR},i.prototype.abort=function(){this.cleanup()},n.document&&(i.requestsCount=0,i.requests={},n.attachEvent?n.attachEvent("onunload",s):n.addEventListener&&n.addEventListener("beforeunload",s,!1))}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./polling":282,"component-emitter":133,"component-inherit":134,debug:285,xmlhttprequest:284}],282:[function(e,t,n){function r(e){var t=e&&e.forceBase64;c&&!t||(this.supportsBinary=!1),o.call(this,e)}var o=e("../transport"),i=e("parseqs"),s=e("engine.io-parser"),a=e("component-inherit"),u=e("debug")("engine.io-client:polling");t.exports=r;var c=function(){var t=e("xmlhttprequest"),n=new t({xdomain:!1});return null!=n.responseType}();a(r,o),r.prototype.name="polling",r.prototype.doOpen=function(){this.poll()},r.prototype.pause=function(e){function t(){u("paused"),n.readyState="paused",e()}var n=this;if(this.readyState="pausing",this.polling||!this.writable){var r=0;this.polling&&(u("we are currently polling - waiting to pause"),r++,this.once("pollComplete",function(){u("pre-pause polling complete"),--r||t()})),this.writable||(u("we are currently writing - waiting to pause"),r++,this.once("drain",function(){u("pre-pause writing complete"),--r||t()}))}else t()},r.prototype.poll=function(){u("polling"),this.polling=!0,this.doPoll(),this.emit("poll")},r.prototype.onData=function(e){var t=this;u("polling got data %s",e);var n=function(e,n,r){return"opening"==t.readyState&&t.onOpen(),"close"==e.type?(t.onClose(),!1):void t.onPacket(e)};s.decodePayload(e,this.socket.binaryType,n),"closed"!=this.readyState&&(this.polling=!1,this.emit("pollComplete"),"open"==this.readyState?this.poll():u('ignoring poll - transport state "%s"',this.readyState))},r.prototype.doClose=function(){function e(){u("writing close packet"),t.write([{type:"close"}])}var t=this;"open"==this.readyState?(u("transport open - closing"),e()):(u("transport not open - deferring close"),this.once("open",e))},r.prototype.write=function(e){var t=this;this.writable=!1;var n=function(){t.writable=!0,t.emit("drain")},t=this;s.encodePayload(e,this.supportsBinary,function(e){t.doWrite(e,n)})},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"https":"http",n="";return!1!==this.timestampRequests&&(e[this.timestampParam]=+new Date+"-"+o.timestamps++),this.supportsBinary||e.sid||(e.b64=1),e=i.encode(e),this.port&&("https"==t&&443!=this.port||"http"==t&&80!=this.port)&&(n=":"+this.port),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e}},{"../transport":278,"component-inherit":134,debug:285,"engine.io-parser":288,parseqs:262,xmlhttprequest:284}],283:[function(e,t,n){function r(e){var t=e&&e.forceBase64;t&&(this.supportsBinary=!1),o.call(this,e)}var o=e("../transport"),i=e("engine.io-parser"),s=e("parseqs"),a=e("component-inherit"),u=e("debug")("engine.io-client:websocket"),c=e("ws");t.exports=r,a(r,o),r.prototype.name="websocket",r.prototype.supportsBinary=!0,r.prototype.doOpen=function(){if(this.check()){var e=this.uri(),t=void 0,n={agent:this.agent};n.pfx=this.pfx,n.key=this.key,n.passphrase=this.passphrase,n.cert=this.cert,n.ca=this.ca,n.ciphers=this.ciphers,n.rejectUnauthorized=this.rejectUnauthorized,this.ws=new c(e,t,n),void 0===this.ws.binaryType&&(this.supportsBinary=!1),this.ws.binaryType="arraybuffer",this.addEventListeners()}},r.prototype.addEventListeners=function(){var e=this;this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(){e.onClose()},this.ws.onmessage=function(t){e.onData(t.data)},this.ws.onerror=function(t){e.onError("websocket error",t)}},"undefined"!=typeof navigator&&/iPad|iPhone|iPod/i.test(navigator.userAgent)&&(r.prototype.onData=function(e){var t=this;setTimeout(function(){o.prototype.onData.call(t,e)},0)}),r.prototype.write=function(e){function t(){n.writable=!0,n.emit("drain")}var n=this;this.writable=!1;for(var r=0,o=e.length;o>r;r++)i.encodePacket(e[r],this.supportsBinary,function(e){try{n.ws.send(e)}catch(t){u("websocket closed before onclose event")}});setTimeout(t,0)},r.prototype.onClose=function(){o.prototype.onClose.call(this)},r.prototype.doClose=function(){"undefined"!=typeof this.ws&&this.ws.close()},r.prototype.uri=function(){var e=this.query||{},t=this.secure?"wss":"ws",n="";return this.port&&("wss"==t&&443!=this.port||"ws"==t&&80!=this.port)&&(n=":"+this.port),this.timestampRequests&&(e[this.timestampParam]=+new Date),this.supportsBinary||(e.b64=1),e=s.encode(e),e.length&&(e="?"+e),t+"://"+this.hostname+n+this.path+e},r.prototype.check=function(){return!(!c||"__initialize"in c&&this.name===r.prototype.name)}},{"../transport":278,"component-inherit":134,debug:285,"engine.io-parser":288,parseqs:262,ws:295}],284:[function(e,t,n){var r=e("has-cors");t.exports=function(e){var t=e.xdomain,n=e.xscheme,o=e.enablesXDR;try{if("undefined"!=typeof XMLHttpRequest&&(!t||r))return new XMLHttpRequest}catch(i){}try{if("undefined"!=typeof XDomainRequest&&!n&&o)return new XDomainRequest}catch(i){}if(!t)try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(i){}}},{"has-cors":291}],285:[function(e,t,n){function r(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31}function o(){var e=arguments,t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),!t)return e;var r="color: "+this.color;e=[e[0],r,"color: inherit"].concat(Array.prototype.slice.call(e,1));var o=0,i=0;return e[0].replace(/%[a-z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(i=o))}),e.splice(i,0,r),e}function i(){return"object"==typeof console&&"function"==typeof console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?localStorage.removeItem("debug"):localStorage.debug=e}catch(t){}}function a(){var e;try{e=localStorage.debug}catch(t){}return e}n=t.exports=e("./debug"),n.log=i,n.formatArgs=o,n.save=s,n.load=a,n.useColors=r,n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){return JSON.stringify(e)},n.enable(a())},{"./debug":286}],286:[function(e,t,n){function r(){return n.colors[l++%n.colors.length]}function o(e){function t(){}function o(){var e=o,t=+new Date,i=t-(c||t);e.diff=i,e.prev=c,e.curr=t,c=t,null==e.useColors&&(e.useColors=n.useColors()),null==e.color&&e.useColors&&(e.color=r());var s=Array.prototype.slice.call(arguments);s[0]=n.coerce(s[0]),"string"!=typeof s[0]&&(s=["%o"].concat(s));var a=0;s[0]=s[0].replace(/%([a-z%])/g,function(t,r){if("%%"===t)return t;a++;var o=n.formatters[r];if("function"==typeof o){var i=s[a];t=o.call(e,i),s.splice(a,1),a--}return t}),"function"==typeof n.formatArgs&&(s=n.formatArgs.apply(e,s));var u=o.log||n.log||void 0;u.apply(e,s)}t.enabled=!1,o.enabled=!0;var i=n.enabled(e)?o:t;return i.namespace=e,i}function i(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,o=0;r>o;o++)t[o]&&(e=t[o].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function s(){n.enable("")}function a(e){var t,r;for(t=0,r=n.skips.length;r>t;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;r>t;t++)if(n.names[t].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=o,n.coerce=u,n.disable=s,n.enable=i,n.enabled=a,n.humanize=e("ms"),n.names=[],n.skips=[],n.formatters={};var c,l=0},{ms:292}],287:[function(e,t,n){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){var t=e,n=e.indexOf("["),i=e.indexOf("]");-1!=n&&-1!=i&&(e=e.substring(0,n)+e.substring(n,i).replace(/:/g,";")+e.substring(i,e.length));for(var s=r.exec(e||""),a={},u=14;u--;)a[o[u]]=s[u]||"";return-1!=n&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a}},{}],288:[function(e,t,n){(function(t){function r(e,t){var r="b"+n.packets[e.type]+e.data.data;return t(r)}function o(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var o=e.data,i=new Uint8Array(o),s=new Uint8Array(1+o.byteLength);s[0]=b[e.type];for(var a=0;a<i.length;a++)s[a+1]=i[a];return r(s.buffer)}function i(e,t,r){if(!t)return n.encodeBase64Packet(e,r);var o=new FileReader;return o.onload=function(){e.data=o.result,n.encodePacket(e,t,!0,r)},o.readAsArrayBuffer(e.data)}function s(e,t,r){if(!t)return n.encodeBase64Packet(e,r);if(m)return i(e,t,r);var o=new Uint8Array(1);o[0]=b[e.type];var s=new y([o.buffer,e.data]);return r(s)}function a(e,t,n){for(var r=new Array(e.length),o=d(e.length,n),i=function(e,n,o){t(n,function(t,n){r[e]=n,o(t,r)})},s=0;s<e.length;s++)i(s,e[s],o)}var u=e("./keys"),c=e("has-binary"),l=e("arraybuffer.slice"),f=e("base64-arraybuffer"),d=e("after"),h=e("utf8"),p=navigator.userAgent.match(/Android/i),_=/PhantomJS/i.test(navigator.userAgent),m=p||_;n.protocol=3;var b=n.packets={open:0,close:1,ping:2,pong:3,message:4,upgrade:5,noop:6},v=u(b),g={type:"error",data:"parser error"},y=e("blob");n.encodePacket=function(e,n,i,a){"function"==typeof n&&(a=n,n=!1),"function"==typeof i&&(a=i,i=null);var u=void 0===e.data?void 0:e.data.buffer||e.data;if(t.ArrayBuffer&&u instanceof ArrayBuffer)return o(e,n,a);if(y&&u instanceof t.Blob)return s(e,n,a);if(u&&u.base64)return r(e,a);var c=b[e.type];return void 0!==e.data&&(c+=i?h.encode(String(e.data)):String(e.data)),a(""+c)},n.encodeBase64Packet=function(e,r){var o="b"+n.packets[e.type];if(y&&e.data instanceof y){var i=new FileReader;return i.onload=function(){var e=i.result.split(",")[1];r(o+e)},i.readAsDataURL(e.data)}var s;try{s=String.fromCharCode.apply(null,new Uint8Array(e.data))}catch(a){for(var u=new Uint8Array(e.data),c=new Array(u.length),l=0;l<u.length;l++)c[l]=u[l];s=String.fromCharCode.apply(null,c)}return o+=t.btoa(s),r(o)},n.decodePacket=function(e,t,r){if("string"==typeof e||void 0===e){if("b"==e.charAt(0))return n.decodeBase64Packet(e.substr(1),t);if(r)try{e=h.decode(e)}catch(o){return g}var i=e.charAt(0);return Number(i)==i&&v[i]?e.length>1?{type:v[i],data:e.substring(1)}:{type:v[i]}:g}var s=new Uint8Array(e),i=s[0],a=l(e,1);return y&&"blob"===t&&(a=new y([a])),{type:v[i],data:a}},n.decodeBase64Packet=function(e,n){var r=v[e.charAt(0)];if(!t.ArrayBuffer)return{type:r,data:{base64:!0,data:e.substr(1)}};var o=f.decode(e.substr(1));return"blob"===n&&y&&(o=new y([o])),{type:r,data:o}},n.encodePayload=function(e,t,r){function o(e){return e.length+":"+e}function i(e,r){n.encodePacket(e,s?t:!1,!0,function(e){r(null,o(e))})}"function"==typeof t&&(r=t,t=null);var s=c(e);return t&&s?y&&!m?n.encodePayloadAsBlob(e,r):n.encodePayloadAsArrayBuffer(e,r):e.length?void a(e,i,function(e,t){return r(t.join(""))}):r("0:")},n.decodePayload=function(e,t,r){if("string"!=typeof e)return n.decodePayloadAsBinary(e,t,r);"function"==typeof t&&(r=t,t=null);var o;if(""==e)return r(g,0,1);for(var i,s,a="",u=0,c=e.length;c>u;u++){var l=e.charAt(u);if(":"!=l)a+=l;else{if(""==a||a!=(i=Number(a)))return r(g,0,1);if(s=e.substr(u+1,i),a!=s.length)return r(g,0,1);if(s.length){if(o=n.decodePacket(s,t,!0),g.type==o.type&&g.data==o.data)return r(g,0,1);var f=r(o,u+i,c);if(!1===f)return}u+=i,a=""}}return""!=a?r(g,0,1):void 0},n.encodePayloadAsArrayBuffer=function(e,t){function r(e,t){n.encodePacket(e,!0,!0,function(e){return t(null,e)})}return e.length?void a(e,r,function(e,n){var r=n.reduce(function(e,t){var n;return n="string"==typeof t?t.length:t.byteLength,e+n.toString().length+n+2},0),o=new Uint8Array(r),i=0;return n.forEach(function(e){var t="string"==typeof e,n=e;if(t){for(var r=new Uint8Array(e.length),s=0;s<e.length;s++)r[s]=e.charCodeAt(s);n=r.buffer}t?o[i++]=0:o[i++]=1;for(var a=n.byteLength.toString(),s=0;s<a.length;s++)o[i++]=parseInt(a[s]);o[i++]=255;for(var r=new Uint8Array(n),s=0;s<r.length;s++)o[i++]=r[s]}),t(o.buffer)}):t(new ArrayBuffer(0))},n.encodePayloadAsBlob=function(e,t){function r(e,t){n.encodePacket(e,!0,!0,function(e){var n=new Uint8Array(1);if(n[0]=1,"string"==typeof e){for(var r=new Uint8Array(e.length),o=0;o<e.length;o++)r[o]=e.charCodeAt(o);e=r.buffer,n[0]=0}for(var i=e instanceof ArrayBuffer?e.byteLength:e.size,s=i.toString(),a=new Uint8Array(s.length+1),o=0;o<s.length;o++)a[o]=parseInt(s[o]);if(a[s.length]=255,y){var u=new y([n.buffer,a.buffer,e]);t(null,u)}})}a(e,r,function(e,n){return t(new y(n))})},n.decodePayloadAsBinary=function(e,t,r){"function"==typeof t&&(r=t,t=null);for(var o=e,i=[],s=!1;o.byteLength>0;){for(var a=new Uint8Array(o),u=0===a[0],c="",f=1;255!=a[f];f++){if(c.length>310){s=!0;break}c+=a[f]}if(s)return r(g,0,1);o=l(o,2+c.length),c=parseInt(c);var d=l(o,0,c);if(u)try{d=String.fromCharCode.apply(null,new Uint8Array(d))}catch(h){var p=new Uint8Array(d);d="";for(var f=0;f<p.length;f++)d+=String.fromCharCode(p[f])}i.push(d),o=l(o,c)}var _=i.length;i.forEach(function(e,o){r(n.decodePacket(e,t,!0),o,_)})}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./keys":289,after:101,"arraybuffer.slice":102,"base64-arraybuffer":130,blob:273,"has-binary":290,utf8:294}],289:[function(e,t,n){t.exports=Object.keys||function(e){var t=[],n=Object.prototype.hasOwnProperty;for(var r in e)n.call(e,r)&&t.push(r);return t}},{}],290:[function(e,t,n){(function(n){function r(e){function t(e){if(!e)return!1;if(n.Buffer&&n.Buffer.isBuffer(e)||n.ArrayBuffer&&e instanceof ArrayBuffer||n.Blob&&e instanceof Blob||n.File&&e instanceof File)return!0;if(o(e)){for(var r=0;r<e.length;r++)if(t(e[r]))return!0}else if(e&&"object"==typeof e){e.toJSON&&(e=e.toJSON());for(var i in e)if(e.hasOwnProperty(i)&&t(e[i]))return!0}return!1}return t(e)}var o=e("isarray");t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{isarray:258}],291:[function(e,t,n){var r=e("global");try{t.exports="XMLHttpRequest"in r&&"withCredentials"in new r.XMLHttpRequest}catch(o){t.exports=!1}},{global:256}],292:[function(e,t,n){function r(e){var t=/^((?:\d+)?\.?\d+) *(ms|seconds?|s|minutes?|m|hours?|h|days?|d|years?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"y":return n*f;case"days":case"day":case"d":return n*l;case"hours":case"hour":case"h":return n*c;case"minutes":case"minute":case"m":return n*u;case"seconds":case"second":case"s":return n*a;case"ms":return n}}}function o(e){return e>=l?Math.round(e/l)+"d":e>=c?Math.round(e/c)+"h":e>=u?Math.round(e/u)+"m":e>=a?Math.round(e/a)+"s":e+"ms"}function i(e){return s(e,l,"day")||s(e,c,"hour")||s(e,u,"minute")||s(e,a,"second")||e+" ms"}function s(e,t,n){return t>e?void 0:1.5*t>e?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var a=1e3,u=60*a,c=60*u,l=24*c,f=365.25*l;t.exports=function(e,t){return t=t||{},"string"==typeof e?r(e):t["long"]?i(e):o(e)}},{}],293:[function(e,t,n){var r=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,o=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];t.exports=function(e){for(var t=r.exec(e||""),n={},i=14;i--;)n[o[i]]=t[i]||"";return n}},{}],294:[function(t,n,r){(function(t){!function(o){function i(e){for(var t,n,r=[],o=0,i=e.length;i>o;)t=e.charCodeAt(o++),t>=55296&&56319>=t&&i>o?(n=e.charCodeAt(o++),56320==(64512&n)?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),o--)):r.push(t);return r}function s(e){for(var t,n=e.length,r=-1,o="";++r<n;)t=e[r],t>65535&&(t-=65536,o+=g(t>>>10&1023|55296),t=56320|1023&t),o+=g(t);return o}function a(e,t){return g(e>>t&63|128)}function u(e){if(0==(4294967168&e))return g(e);var t="";return 0==(4294965248&e)?t=g(e>>6&31|192):0==(4294901760&e)?(t=g(e>>12&15|224),t+=a(e,6)):0==(4292870144&e)&&(t=g(e>>18&7|240),t+=a(e,12),t+=a(e,6)),t+=g(63&e|128)}function c(e){for(var t,n=i(e),r=n.length,o=-1,s="";++o<r;)t=n[o],s+=u(t);return s}function l(){if(v>=b)throw Error("Invalid byte index");var e=255&m[v];if(v++,128==(192&e))return 63&e;throw Error("Invalid continuation byte")}function f(){var e,t,n,r,o;if(v>b)throw Error("Invalid byte index");if(v==b)return!1;if(e=255&m[v],v++,0==(128&e))return e;if(192==(224&e)){var t=l();if(o=(31&e)<<6|t,o>=128)return o;throw Error("Invalid continuation byte")}if(224==(240&e)){if(t=l(),n=l(),o=(15&e)<<12|t<<6|n,o>=2048)return o;throw Error("Invalid continuation byte")}if(240==(248&e)&&(t=l(),n=l(),r=l(),o=(15&e)<<18|t<<12|n<<6|r,o>=65536&&1114111>=o))return o;throw Error("Invalid UTF-8 detected")}function d(e){m=i(e),b=m.length,v=0;for(var t,n=[];(t=f())!==!1;)n.push(t);return s(n)}var h="object"==typeof r&&r,p="object"==typeof n&&n&&n.exports==h&&n,_="object"==typeof t&&t;_.global!==_&&_.window!==_||(o=_);var m,b,v,g=String.fromCharCode,y={version:"2.0.0",encode:c,decode:d};if("function"==typeof e&&"object"==typeof e.amd&&e.amd)e(function(){return y});else if(h&&!h.nodeType)if(p)p.exports=y;else{var w={},C=w.hasOwnProperty;for(var k in y)C.call(y,k)&&(h[k]=y[k])}else o.utf8=y}(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],295:[function(e,t,n){function r(e,t,n){var r;return r=t?new i(e,t):new i(e)}var o=function(){return this}(),i=o.WebSocket||o.MozWebSocket;t.exports=i?r:null,i&&(r.prototype=i.prototype)},{}],296:[function(e,t,n){(function(t){var r=e("isarray"),o=e("./is-buffer");n.deconstructPacket=function(e){function t(e){if(!e)return e;if(o(e)){var i={_placeholder:!0,num:n.length};return n.push(e),i}if(r(e)){for(var s=new Array(e.length),a=0;a<e.length;a++)s[a]=t(e[a]);return s}if("object"==typeof e&&!(e instanceof Date)){var s={};for(var u in e)s[u]=t(e[u]);return s}return e}var n=[],i=e.data,s=e;return s.data=t(i),s.attachments=n.length,{packet:s,buffers:n}},n.reconstructPacket=function(e,t){function n(e){if(e&&e._placeholder){var o=t[e.num];return o}if(r(e)){for(var i=0;i<e.length;i++)e[i]=n(e[i]);return e}if(e&&"object"==typeof e){for(var s in e)e[s]=n(e[s]);return e}return e}return e.data=n(e.data),e.attachments=void 0,e},n.removeBlobs=function(e,n){function i(e,u,c){if(!e)return e;if(t.Blob&&e instanceof Blob||t.File&&e instanceof File){s++;var l=new FileReader;l.onload=function(){c?c[u]=this.result:a=this.result,--s||n(a)},l.readAsArrayBuffer(e)}else if(r(e))for(var f=0;f<e.length;f++)i(e[f],f,e);else if(e&&"object"==typeof e&&!o(e))for(var d in e)i(e[d],d,e)}var s=0,a=e;i(a),s||n(a)}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./is-buffer":298,isarray:258}],297:[function(e,t,n){function r(){}function o(e){var t="",r=!1;return t+=e.type,n.BINARY_EVENT!=e.type&&n.BINARY_ACK!=e.type||(t+=e.attachments,t+="-"),e.nsp&&"/"!=e.nsp&&(r=!0,t+=e.nsp),null!=e.id&&(r&&(t+=",",r=!1),t+=e.id),null!=e.data&&(r&&(t+=","),t+=f.stringify(e.data)),l("encoded %j as %s",e,t),t}function i(e,t){function n(e){var n=h.deconstructPacket(e),r=o(n.packet),i=n.buffers;i.unshift(r),t(i)}h.removeBlobs(e,n)}function s(){this.reconstructor=null}function a(e){var t={},r=0;if(t.type=Number(e.charAt(0)),null==n.types[t.type])return c();if(n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type){for(t.attachments="";"-"!=e.charAt(++r);)t.attachments+=e.charAt(r);t.attachments=Number(t.attachments)}if("/"==e.charAt(r+1))for(t.nsp="";++r;){var o=e.charAt(r);if(","==o)break;if(t.nsp+=o,r+1==e.length)break}else t.nsp="/";var i=e.charAt(r+1);if(""!=i&&Number(i)==i){for(t.id="";++r;){var o=e.charAt(r);if(null==o||Number(o)!=o){--r;break}if(t.id+=e.charAt(r),r+1==e.length)break}t.id=Number(t.id)}if(e.charAt(++r))try{t.data=f.parse(e.substr(r))}catch(s){return c()}return l("decoded %s as %j",e,t),t}function u(e){this.reconPack=e,this.buffers=[]}function c(e){return{type:n.ERROR,data:"parser error"}}var l=e("debug")("socket.io-parser"),f=e("json3"),d=(e("isarray"),e("component-emitter")),h=e("./binary"),p=e("./is-buffer");n.protocol=4,n.types=["CONNECT","DISCONNECT","EVENT","BINARY_EVENT","ACK","BINARY_ACK","ERROR"],n.CONNECT=0,n.DISCONNECT=1,n.EVENT=2,n.ACK=3,n.ERROR=4,n.BINARY_EVENT=5,n.BINARY_ACK=6,n.Encoder=r,n.Decoder=s,r.prototype.encode=function(e,t){if(l("encoding packet %j",e),n.BINARY_EVENT==e.type||n.BINARY_ACK==e.type)i(e,t);else{var r=o(e);t([r])}},d(s.prototype),s.prototype.add=function(e){var t;if("string"==typeof e)t=a(e),n.BINARY_EVENT==t.type||n.BINARY_ACK==t.type?(this.reconstructor=new u(t),0==this.reconstructor.reconPack.attachments&&this.emit("decoded",t)):this.emit("decoded",t);else{if(!p(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,this.emit("decoded",t))}},s.prototype.destroy=function(){this.reconstructor&&this.reconstructor.finishedReconstruction()},u.prototype.takeBinaryData=function(e){if(this.buffers.push(e),this.buffers.length==this.reconPack.attachments){var t=h.reconstructPacket(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null},u.prototype.finishedReconstruction=function(){this.reconPack=null,this.buffers=[]}},{"./binary":296,"./is-buffer":298,"component-emitter":133,debug:299,isarray:258,json3:259}],298:[function(e,t,n){(function(e){function n(t){return e.Buffer&&e.Buffer.isBuffer(t)||e.ArrayBuffer&&t instanceof ArrayBuffer}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],299:[function(e,t,n){function r(e){return r.enabled(e)?function(t){t=o(t);var n=new Date,i=n-(r[e]||n);r[e]=n,t=e+" "+t+" +"+r.humanize(i),window.console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}:function(){}}function o(e){return e instanceof Error?e.stack||e.message:e}t.exports=r,r.names=[],r.skips=[],r.enable=function(e){try{localStorage.debug=e}catch(t){}for(var n=(e||"").split(/[\s,]+/),o=n.length,i=0;o>i;i++)e=n[i].replace("*",".*?"),"-"===e[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$"))},r.disable=function(){r.enable("")},r.humanize=function(e){var t=1e3,n=6e4,r=60*n;return e>=r?(e/r).toFixed(1)+"h":e>=n?(e/n).toFixed(1)+"m":e>=t?(e/t|0)+"s":e+"ms"},r.enabled=function(e){for(var t=0,n=r.skips.length;n>t;t++)if(r.skips[t].test(e))return!1;for(var t=0,n=r.names.length;n>t;t++)if(r.names[t].test(e))return!0;return!1};try{window.localStorage&&r.enable(localStorage.debug)}catch(i){}},{}],300:[function(e,t,n){function r(e,t){var n=[];t=t||0;for(var r=t||0;r<e.length;r++)n[r-t]=e[r];return n}t.exports=r},{}],301:[function(t,n,r){!function(t,o){"use strict";var i="0.7.9",s="",a="?",u="function",c="undefined",l="object",f="string",d="major",h="model",p="name",_="type",m="vendor",b="version",v="architecture",g="console",y="mobile",w="tablet",C="smarttv",k="wearable",S="embedded",E={extend:function(e,t){for(var n in t)-1!=="browser cpu device engine os".indexOf(n)&&t[n].length%2===0&&(e[n]=t[n].concat(e[n]));return e},has:function(e,t){return"string"==typeof e?-1!==t.toLowerCase().indexOf(e.toLowerCase()):!1},lowerize:function(e){return e.toLowerCase()},major:function(e){return typeof e===f?e.split(".")[0]:o}},T={rgx:function(){for(var e,t,n,r,i,s,a,f=0,d=arguments;f<d.length&&!s;){var h=d[f],p=d[f+1];if(typeof e===c){e={};for(r in p)i=p[r],typeof i===l?e[i[0]]=o:e[i]=o}for(t=n=0;t<h.length&&!s;)if(s=h[t++].exec(this.getUA()))for(r=0;r<p.length;r++)a=s[++n],i=p[r],typeof i===l&&i.length>0?2==i.length?typeof i[1]==u?e[i[0]]=i[1].call(this,a):e[i[0]]=i[1]:3==i.length?typeof i[1]!==u||i[1].exec&&i[1].test?e[i[0]]=a?a.replace(i[1],i[2]):o:e[i[0]]=a?i[1].call(this,a,i[2]):o:4==i.length&&(e[i[0]]=a?i[3].call(this,a.replace(i[1],i[2])):o):e[i]=a?a:o;f+=2}return e},str:function(e,t){for(var n in t)if(typeof t[n]===l&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(E.has(t[n][r],e))return n===a?o:n}else if(E.has(t[n],e))return n===a?o:n;return e}},j={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},A={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[p,b],[/\s(opr)\/([\w\.]+)/i],[[p,"Opera"],b],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium)\/([\w\.-]+)/i],[p,b],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[p,"IE"],b],[/(edge)\/((\d+)?[\w\.]+)/i],[p,b],[/(yabrowser)\/([\w\.]+)/i],[[p,"Yandex"],b],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],b],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?([\w\.]+)/i],[p,b],[/(dolfin)\/([\w\.]+)/i],[[p,"Dolphin"],b],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[p,"Chrome"],b],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[b,[p,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[b,[p,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[b,[p,"Facebook"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[b,[p,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[b,p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[p,[b,T.str,j.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[p,b],[/(navigator|netscape)\/([\w\.-]+)/i],[[p,"Netscape"],b],[/fxios\/([\w\.-]+)/i],[b,[p,"Firefox"]],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[p,b]],
cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,E.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[v,/ower/,"",E.lowerize]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[v,E.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[h,m,[_,w]],[/applecoremedia\/[\w\.]+ \((ipad)/],[h,[m,"Apple"],[_,w]],[/(apple\s{0,1}tv)/i],[[h,"Apple TV"],[m,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[m,h,[_,w]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[h,[m,"Amazon"],[_,w]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[h,T.str,j.device.amazon.model],[m,"Amazon"],[_,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[h,m,[_,y]],[/\((ip[honed|\s\w*]+);/i],[h,[m,"Apple"],[_,y]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[m,h,[_,y]],[/\(bb10;\s(\w+)/i],[h,[m,"BlackBerry"],[_,y]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[h,[m,"Asus"],[_,w]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[m,"Sony"],[h,"Xperia Tablet"],[_,w]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[m,"Sony"],[h,"Xperia Phone"],[_,y]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[m,h,[_,g]],[/android.+;\s(shield)\sbuild/i],[h,[m,"Nvidia"],[_,g]],[/(playstation\s[3portablevi]+)/i],[h,[m,"Sony"],[_,g]],[/(sprint\s(\w+))/i],[[m,T.str,j.device.sprint.vendor],[h,T.str,j.device.sprint.model],[_,y]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[m,h,[_,w]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[m,[h,/_/g," "],[_,y]],[/(nexus\s9)/i],[h,[m,"HTC"],[_,w]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[h,[m,"Microsoft"],[_,g]],[/(kin\.[onetw]{3})/i],[[h,/\./g," "],[m,"Microsoft"],[_,y]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i],[h,[m,"Motorola"],[_,y]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[h,[m,"Motorola"],[_,w]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[m,"Samsung"],h,[_,w]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[m,"Samsung"],h,[_,y]],[/(samsung);smarttv/i],[m,h,[_,C]],[/\(dtv[\);].+(aquos)/i],[h,[m,"Sharp"],[_,C]],[/sie-(\w+)*/i],[h,[m,"Siemens"],[_,y]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[m,"Nokia"],h,[_,y]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[h,[m,"Acer"],[_,w]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[m,"LG"],h,[_,w]],[/(lg) netcast\.tv/i],[m,h,[_,C]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[h,[m,"LG"],[_,y]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[h,[m,"Lenovo"],[_,w]],[/linux;.+((jolla));/i],[m,h,[_,y]],[/((pebble))app\/[\d\.]+\s/i],[m,h,[_,k]],[/android.+;\s(glass)\s\d/i],[h,[m,"Google"],[_,k]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[h,/_/g," "],[m,"Xiaomi"],[_,y]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[_,E.lowerize],m,h]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[b,[p,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[p,b],[/rv\:([\w\.]+).*(gecko)/i],[b,p]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[p,b],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[p,[b,T.str,j.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[p,"Windows"],[b,T.str,j.os.windows.version]],[/\((bb)(10);/i],[[p,"BlackBerry"],b],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[p,b],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[p,"Symbian"],b],[/\((series40);/i],[p],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[p,"Firefox OS"],b],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[p,b],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[p,"Chromium OS"],b],[/(sunos)\s?([\w\.]+\d)*/i],[[p,"Solaris"],b],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[p,b],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[p,"iOS"],[b,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[p,"Mac OS"],[b,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[p,b]]},P=function(e,n){if(!(this instanceof P))return new P(e,n).getResult();var r=e||(t&&t.navigator&&t.navigator.userAgent?t.navigator.userAgent:s),o=n?E.extend(A,n):A;return this.getBrowser=function(){var e=T.rgx.apply(this,o.browser);return e.major=E.major(e.version),e},this.getCPU=function(){return T.rgx.apply(this,o.cpu)},this.getDevice=function(){return T.rgx.apply(this,o.device)},this.getEngine=function(){return T.rgx.apply(this,o.engine)},this.getOS=function(){return T.rgx.apply(this,o.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=e,this},this.setUA(r),this};P.VERSION=i,P.BROWSER={NAME:p,MAJOR:d,VERSION:b},P.CPU={ARCHITECTURE:v},P.DEVICE={MODEL:h,VENDOR:m,TYPE:_,CONSOLE:g,MOBILE:y,SMARTTV:C,TABLET:w,WEARABLE:k,EMBEDDED:S},P.ENGINE={NAME:p,VERSION:b},P.OS={NAME:p,VERSION:b},typeof r!==c?(typeof n!==c&&n.exports&&(r=n.exports=P),r.UAParser=P):typeof e===u&&e.amd?e(function(){return P}):t.UAParser=P;var x=t.jQuery||t.Zepto;if(typeof x!==c){var D=new P;x.ua=D.getResult(),x.ua.get=function(){return D.getUA()},x.ua.set=function(e){D.setUA(e);var t=D.getResult();for(var n in t)x.ua[n]=t[n]}}}("object"==typeof window?window:this)},{}],302:[function(t,n,r){(function(){var t=this,o=t._,i={},s=Array.prototype,a=Object.prototype,u=Function.prototype,c=s.push,l=s.slice,f=s.concat,d=a.toString,h=a.hasOwnProperty,p=s.forEach,_=s.map,m=s.reduce,b=s.reduceRight,v=s.filter,g=s.every,y=s.some,w=s.indexOf,C=s.lastIndexOf,k=Array.isArray,S=Object.keys,E=u.bind,T=function(e){return e instanceof T?e:this instanceof T?void(this._wrapped=e):new T(e)};"undefined"!=typeof r?("undefined"!=typeof n&&n.exports&&(r=n.exports=T),r._=T):t._=T,T.VERSION="1.6.0";var j=T.each=T.forEach=function(e,t,n){if(null==e)return e;if(p&&e.forEach===p)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(n,e[r],r,e)===i)return}else for(var s=T.keys(e),r=0,o=s.length;o>r;r++)if(t.call(n,e[s[r]],s[r],e)===i)return;return e};T.map=T.collect=function(e,t,n){var r=[];return null==e?r:_&&e.map===_?e.map(t,n):(j(e,function(e,o,i){r.push(t.call(n,e,o,i))}),r)};var A="Reduce of empty array with no initial value";T.reduce=T.foldl=T.inject=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),m&&e.reduce===m)return r&&(t=T.bind(t,r)),o?e.reduce(t,n):e.reduce(t);if(j(e,function(e,i,s){o?n=t.call(r,n,e,i,s):(n=e,o=!0)}),!o)throw new TypeError(A);return n},T.reduceRight=T.foldr=function(e,t,n,r){var o=arguments.length>2;if(null==e&&(e=[]),b&&e.reduceRight===b)return r&&(t=T.bind(t,r)),o?e.reduceRight(t,n):e.reduceRight(t);var i=e.length;if(i!==+i){var s=T.keys(e);i=s.length}if(j(e,function(a,u,c){u=s?s[--i]:--i,o?n=t.call(r,n,e[u],u,c):(n=e[u],o=!0)}),!o)throw new TypeError(A);return n},T.find=T.detect=function(e,t,n){var r;return P(e,function(e,o,i){return t.call(n,e,o,i)?(r=e,!0):void 0}),r},T.filter=T.select=function(e,t,n){var r=[];return null==e?r:v&&e.filter===v?e.filter(t,n):(j(e,function(e,o,i){t.call(n,e,o,i)&&r.push(e)}),r)},T.reject=function(e,t,n){return T.filter(e,function(e,r,o){return!t.call(n,e,r,o)},n)},T.every=T.all=function(e,t,n){t||(t=T.identity);var r=!0;return null==e?r:g&&e.every===g?e.every(t,n):(j(e,function(e,o,s){return(r=r&&t.call(n,e,o,s))?void 0:i}),!!r)};var P=T.some=T.any=function(e,t,n){t||(t=T.identity);var r=!1;return null==e?r:y&&e.some===y?e.some(t,n):(j(e,function(e,o,s){return r||(r=t.call(n,e,o,s))?i:void 0}),!!r)};T.contains=T.include=function(e,t){return null==e?!1:w&&e.indexOf===w?-1!=e.indexOf(t):P(e,function(e){return e===t})},T.invoke=function(e,t){var n=l.call(arguments,2),r=T.isFunction(t);return T.map(e,function(e){return(r?t:e[t]).apply(e,n)})},T.pluck=function(e,t){return T.map(e,T.property(t))},T.where=function(e,t){return T.filter(e,T.matches(t))},T.findWhere=function(e,t){return T.find(e,T.matches(t))},T.max=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);var r=-(1/0),o=-(1/0);return j(e,function(e,i,s){var a=t?t.call(n,e,i,s):e;a>o&&(r=e,o=a)}),r},T.min=function(e,t,n){if(!t&&T.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);var r=1/0,o=1/0;return j(e,function(e,i,s){var a=t?t.call(n,e,i,s):e;o>a&&(r=e,o=a)}),r},T.shuffle=function(e){var t,n=0,r=[];return j(e,function(e){t=T.random(n++),r[n-1]=r[t],r[t]=e}),r},T.sample=function(e,t,n){return null==t||n?(e.length!==+e.length&&(e=T.values(e)),e[T.random(e.length-1)]):T.shuffle(e).slice(0,Math.max(0,t))};var x=function(e){return null==e?T.identity:T.isFunction(e)?e:T.property(e)};T.sortBy=function(e,t,n){return t=x(t),T.pluck(T.map(e,function(e,r,o){return{value:e,index:r,criteria:t.call(n,e,r,o)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(r>n||void 0===r)return-1}return e.index-t.index}),"value")};var D=function(e){return function(t,n,r){var o={};return n=x(n),j(t,function(i,s){var a=n.call(r,i,s,t);e(o,a,i)}),o}};T.groupBy=D(function(e,t,n){T.has(e,t)?e[t].push(n):e[t]=[n]}),T.indexBy=D(function(e,t,n){e[t]=n}),T.countBy=D(function(e,t){T.has(e,t)?e[t]++:e[t]=1}),T.sortedIndex=function(e,t,n,r){n=x(n);for(var o=n.call(r,t),i=0,s=e.length;s>i;){var a=i+s>>>1;n.call(r,e[a])<o?i=a+1:s=a}return i},T.toArray=function(e){return e?T.isArray(e)?l.call(e):e.length===+e.length?T.map(e,T.identity):T.values(e):[]},T.size=function(e){return null==e?0:e.length===+e.length?e.length:T.keys(e).length},T.first=T.head=T.take=function(e,t,n){return null!=e?null==t||n?e[0]:0>t?[]:l.call(e,0,t):void 0},T.initial=function(e,t,n){return l.call(e,0,e.length-(null==t||n?1:t))},T.last=function(e,t,n){return null!=e?null==t||n?e[e.length-1]:l.call(e,Math.max(e.length-t,0)):void 0},T.rest=T.tail=T.drop=function(e,t,n){return l.call(e,null==t||n?1:t)},T.compact=function(e){return T.filter(e,T.identity)};var I=function(e,t,n){return t&&T.every(e,T.isArray)?f.apply(n,e):(j(e,function(e){T.isArray(e)||T.isArguments(e)?t?c.apply(n,e):I(e,t,n):n.push(e)}),n)};T.flatten=function(e,t){return I(e,t,[])},T.without=function(e){return T.difference(e,l.call(arguments,1))},T.partition=function(e,t){var n=[],r=[];return j(e,function(e){(t(e)?n:r).push(e)}),[n,r]},T.uniq=T.unique=function(e,t,n,r){T.isFunction(t)&&(r=n,n=t,t=!1);var o=n?T.map(e,n,r):e,i=[],s=[];return j(o,function(n,r){(t?r&&s[s.length-1]===n:T.contains(s,n))||(s.push(n),i.push(e[r]))}),i},T.union=function(){return T.uniq(T.flatten(arguments,!0))},T.intersection=function(e){var t=l.call(arguments,1);return T.filter(T.uniq(e),function(e){return T.every(t,function(t){return T.contains(t,e)})})},T.difference=function(e){var t=f.apply(s,l.call(arguments,1));return T.filter(e,function(e){return!T.contains(t,e)})},T.zip=function(){for(var e=T.max(T.pluck(arguments,"length").concat(0)),t=new Array(e),n=0;e>n;n++)t[n]=T.pluck(arguments,""+n);return t},T.object=function(e,t){if(null==e)return{};for(var n={},r=0,o=e.length;o>r;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n},T.indexOf=function(e,t,n){if(null==e)return-1;var r=0,o=e.length;if(n){if("number"!=typeof n)return r=T.sortedIndex(e,t),e[r]===t?r:-1;r=0>n?Math.max(0,o+n):n}if(w&&e.indexOf===w)return e.indexOf(t,n);for(;o>r;r++)if(e[r]===t)return r;return-1},T.lastIndexOf=function(e,t,n){if(null==e)return-1;var r=null!=n;if(C&&e.lastIndexOf===C)return r?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var o=r?n:e.length;o--;)if(e[o]===t)return o;return-1},T.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var r=Math.max(Math.ceil((t-e)/n),0),o=0,i=new Array(r);r>o;)i[o++]=e,e+=n;return i};var R=function(){};T.bind=function(e,t){var n,r;if(E&&e.bind===E)return E.apply(e,l.call(arguments,1));if(!T.isFunction(e))throw new TypeError;return n=l.call(arguments,2),r=function(){if(!(this instanceof r))return e.apply(t,n.concat(l.call(arguments)));R.prototype=e.prototype;var o=new R;R.prototype=null;var i=e.apply(o,n.concat(l.call(arguments)));return Object(i)===i?i:o}},T.partial=function(e){var t=l.call(arguments,1);return function(){for(var n=0,r=t.slice(),o=0,i=r.length;i>o;o++)r[o]===T&&(r[o]=arguments[n++]);for(;n<arguments.length;)r.push(arguments[n++]);return e.apply(this,r)}},T.bindAll=function(e){var t=l.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return j(t,function(t){e[t]=T.bind(e[t],e)}),e},T.memoize=function(e,t){var n={};return t||(t=T.identity),function(){var r=t.apply(this,arguments);return T.has(n,r)?n[r]:n[r]=e.apply(this,arguments)}},T.delay=function(e,t){var n=l.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},T.defer=function(e){return T.delay.apply(T,[e,1].concat(l.call(arguments,1)))},T.throttle=function(e,t,n){var r,o,i,s=null,a=0;n||(n={});var u=function(){a=n.leading===!1?0:T.now(),s=null,i=e.apply(r,o),r=o=null};return function(){var c=T.now();a||n.leading!==!1||(a=c);var l=t-(c-a);return r=this,o=arguments,0>=l?(clearTimeout(s),s=null,a=c,i=e.apply(r,o),r=o=null):s||n.trailing===!1||(s=setTimeout(u,l)),i}},T.debounce=function(e,t,n){var r,o,i,s,a,u=function(){var c=T.now()-s;t>c?r=setTimeout(u,t-c):(r=null,n||(a=e.apply(i,o),i=o=null))};return function(){i=this,o=arguments,s=T.now();var c=n&&!r;return r||(r=setTimeout(u,t)),c&&(a=e.apply(i,o),i=o=null),a}},T.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},T.wrap=function(e,t){return T.partial(t,e)},T.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},T.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},T.keys=function(e){if(!T.isObject(e))return[];if(S)return S(e);var t=[];for(var n in e)T.has(e,n)&&t.push(n);return t},T.values=function(e){for(var t=T.keys(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=e[t[o]];return r},T.pairs=function(e){for(var t=T.keys(e),n=t.length,r=new Array(n),o=0;n>o;o++)r[o]=[t[o],e[t[o]]];return r},T.invert=function(e){for(var t={},n=T.keys(e),r=0,o=n.length;o>r;r++)t[e[n[r]]]=n[r];return t},T.functions=T.methods=function(e){var t=[];for(var n in e)T.isFunction(e[n])&&t.push(n);return t.sort()},T.extend=function(e){return j(l.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},T.pick=function(e){var t={},n=f.apply(s,l.call(arguments,1));return j(n,function(n){n in e&&(t[n]=e[n])}),t},T.omit=function(e){var t={},n=f.apply(s,l.call(arguments,1));for(var r in e)T.contains(n,r)||(t[r]=e[r]);return t},T.defaults=function(e){return j(l.call(arguments,1),function(t){if(t)for(var n in t)void 0===e[n]&&(e[n]=t[n])}),e},T.clone=function(e){return T.isObject(e)?T.isArray(e)?e.slice():T.extend({},e):e},T.tap=function(e,t){return t(e),e};var M=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof T&&(e=e._wrapped),t instanceof T&&(t=t._wrapped);var o=d.call(e);if(o!=d.call(t))return!1;switch(o){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var i=n.length;i--;)if(n[i]==e)return r[i]==t;var s=e.constructor,a=t.constructor;if(s!==a&&!(T.isFunction(s)&&s instanceof s&&T.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1;n.push(e),r.push(t);var u=0,c=!0;if("[object Array]"==o){if(u=e.length,c=u==t.length)for(;u--&&(c=M(e[u],t[u],n,r)););}else{for(var l in e)if(T.has(e,l)&&(u++,!(c=T.has(t,l)&&M(e[l],t[l],n,r))))break;if(c){for(l in t)if(T.has(t,l)&&!u--)break;c=!u}}return n.pop(),r.pop(),c};T.isEqual=function(e,t){return M(e,t,[],[])},T.isEmpty=function(e){if(null==e)return!0;if(T.isArray(e)||T.isString(e))return 0===e.length;for(var t in e)if(T.has(e,t))return!1;return!0},T.isElement=function(e){return!(!e||1!==e.nodeType)},T.isArray=k||function(e){return"[object Array]"==d.call(e)},T.isObject=function(e){return e===Object(e)},j(["Arguments","Function","String","Number","Date","RegExp"],function(e){T["is"+e]=function(t){return d.call(t)=="[object "+e+"]"}}),T.isArguments(arguments)||(T.isArguments=function(e){return!(!e||!T.has(e,"callee"))}),"function"!=typeof/./&&(T.isFunction=function(e){return"function"==typeof e}),T.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},T.isNaN=function(e){return T.isNumber(e)&&e!=+e},T.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==d.call(e)},T.isNull=function(e){return null===e},T.isUndefined=function(e){return void 0===e},T.has=function(e,t){return h.call(e,t)},T.noConflict=function(){return t._=o,this},T.identity=function(e){return e},T.constant=function(e){return function(){return e}},T.property=function(e){return function(t){return t[e]}},T.matches=function(e){return function(t){if(t===e)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0}},T.times=function(e,t,n){for(var r=Array(Math.max(0,e)),o=0;e>o;o++)r[o]=t.call(n,o);return r},T.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},T.now=Date.now||function(){return(new Date).getTime()};var O={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};O.unescape=T.invert(O.escape);var N={escape:new RegExp("["+T.keys(O.escape).join("")+"]","g"),unescape:new RegExp("("+T.keys(O.unescape).join("|")+")","g")};T.each(["escape","unescape"],function(e){T[e]=function(t){return null==t?"":(""+t).replace(N[e],function(t){return O[e][t]})}}),T.result=function(e,t){if(null!=e){var n=e[t];return T.isFunction(n)?n.call(e):n}},T.mixin=function(e){j(T.functions(e),function(t){var n=T[t]=e[t];T.prototype[t]=function(){var e=[this._wrapped];return c.apply(e,arguments),q.call(this,n.apply(T,e))}})};var L=0;T.uniqueId=function(e){var t=++L+"";return e?e+t:t},T.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var U=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},H=/\\|'|\r|\n|\t|\u2028|\u2029/g;T.template=function(e,t,n){var r;n=T.defaults({},n,T.templateSettings);var o=new RegExp([(n.escape||U).source,(n.interpolate||U).source,(n.evaluate||U).source].join("|")+"|$","g"),i=0,s="__p+='";e.replace(o,function(t,n,r,o,a){return s+=e.slice(i,a).replace(H,function(e){return"\\"+B[e]}),n&&(s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),r&&(s+="'+\n((__t=("+r+"))==null?'':__t)+\n'"),o&&(s+="';\n"+o+"\n__p+='"),i=a+t.length,t}),s+="';\n",n.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(n.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(t)return r(t,T);var u=function(e){return r.call(this,e,T)};return u.source="function("+(n.variable||"obj")+"){\n"+s+"}",u},T.chain=function(e){return T(e).chain()};var q=function(e){return this._chain?T(e).chain():e};T.mixin(T),j(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];T.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],q.call(this,n)}}),j(["concat","join","slice"],function(e){var t=s[e];T.prototype[e]=function(){return q.call(this,t.apply(this._wrapped,arguments))}}),T.extend(T.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof e&&e.amd&&e("underscore",[],function(){return T})}).call(this)},{}],303:[function(e,t,n){(function(e){var n;if(e.crypto&&crypto.getRandomValues){var r=new Uint8Array(16);n=function(){return crypto.getRandomValues(r),r}}if(!n){var o=new Array(16);n=function(){for(var e,t=0;16>t;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}t.exports=n}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],304:[function(e,t,n){function r(e,t,n){var r=t&&n||0,o=0;for(t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){16>o&&(t[r+o++]=c[e])});16>o;)t[r+o++]=0;return t}function o(e,t){var n=t||0,r=u;return r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+"-"+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]+r[e[n++]]}function i(e,t,n){var r=t&&n||0,i=t||[];e=e||{};var s=void 0!==e.clockseq?e.clockseq:h,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:_+1,c=a-p+(u-_)/1e4;if(0>c&&void 0===e.clockseq&&(s=s+1&16383),(0>c||a>p)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");p=a,_=u,h=s,a+=122192928e5;var l=(1e4*(268435455&a)+u)%4294967296;i[r++]=l>>>24&255,i[r++]=l>>>16&255,i[r++]=l>>>8&255,i[r++]=255&l;var f=a/4294967296*1e4&268435455;i[r++]=f>>>8&255,i[r++]=255&f,i[r++]=f>>>24&15|16,i[r++]=f>>>16&255,i[r++]=s>>>8|128,i[r++]=255&s;for(var m=e.node||d,b=0;6>b;b++)i[r+b]=m[b];return t?t:o(i)}function s(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"==e?new Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||a)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;16>s;s++)t[r+s]=i[s];return t||o(i)}for(var a=e("./rng"),u=[],c={},l=0;256>l;l++)u[l]=(l+256).toString(16).substr(1),c[u[l]]=l;var f=a(),d=[1|f[0],f[1],f[2],f[3],f[4],f[5]],h=16383&(f[6]<<8|f[7]),p=0,_=0,m=s;m.v1=i,m.v4=s,m.parse=r,m.unparse=o,t.exports=m},{"./rng":303}]},{},[31])(31)})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],57:[function(_dereq_,module,exports){!function(i,s){"use strict";var e="0.7.10",o="",r="?",n="function",a="undefined",t="object",w="string",l="major",d="model",p="name",c="type",u="vendor",m="version",f="architecture",b="console",g="mobile",h="tablet",v="smarttv",x="wearable",y="embedded",k={extend:function(i,s){for(var e in s)-1!=="browser cpu device engine os".indexOf(e)&&s[e].length%2===0&&(i[e]=s[e].concat(i[e]));return i},has:function(i,s){return"string"==typeof i?-1!==s.toLowerCase().indexOf(i.toLowerCase()):!1},lowerize:function(i){return i.toLowerCase()},major:function(i){return typeof i===w?i.split(".")[0]:s}},A={rgx:function(){for(var i,e,o,r,w,l,d,p=0,c=arguments;p<c.length&&!l;){var u=c[p],m=c[p+1];if(typeof i===a){i={};for(r in m)m.hasOwnProperty(r)&&(w=m[r],typeof w===t?i[w[0]]=s:i[w]=s)}for(e=o=0;e<u.length&&!l;)if(l=u[e++].exec(this.getUA()))for(r=0;r<m.length;r++)d=l[++o],w=m[r],typeof w===t&&w.length>0?2==w.length?typeof w[1]==n?i[w[0]]=w[1].call(this,d):i[w[0]]=w[1]:3==w.length?typeof w[1]!==n||w[1].exec&&w[1].test?i[w[0]]=d?d.replace(w[1],w[2]):s:i[w[0]]=d?w[1].call(this,d,w[2]):s:4==w.length&&(i[w[0]]=d?w[3].call(this,d.replace(w[1],w[2])):s):i[w]=d?d:s;p+=2}return i},str:function(i,e){for(var o in e)if(typeof e[o]===t&&e[o].length>0){for(var n=0;n<e[o].length;n++)if(k.has(e[o][n],i))return o===r?s:o}else if(k.has(e[o],i))return o===r?s:o;return i}},E={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},S={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[p,m],[/\s(opr)\/([\w\.]+)/i],[[p,"Opera"],m],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[p,m],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[p,"IE"],m],[/(edge)\/((\d+)?[\w\.]+)/i],[p,m],[/(yabrowser)\/([\w\.]+)/i],[[p,"Yandex"],m],[/(comodo_dragon)\/([\w\.]+)/i],[[p,/_/g," "],m],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[p,m],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/JUC.+(ucweb)[\/\s]?([\w\.]+)/i],[[p,"UCBrowser"],m],[/(dolfin)\/([\w\.]+)/i],[[p,"Dolphin"],m],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[p,"Chrome"],m],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[m,[p,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[m,[p,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[m,[p,"Facebook"]],[/fxios\/([\w\.-]+)/i],[m,[p,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[m,[p,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[m,p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[p,[m,A.str,E.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[p,m],[/(navigator|netscape)\/([\w\.-]+)/i],[[p,"Netscape"],m],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[p,m]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[f,"amd64"]],[/(ia32(?=;))/i],[[f,k.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[f,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[f,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[f,/ower/,"",k.lowerize]],[/(sun4\w)[;\)]/i],[[f,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[f,k.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[d,u,[c,h]],[/applecoremedia\/[\w\.]+ \((ipad)/],[d,[u,"Apple"],[c,h]],[/(apple\s{0,1}tv)/i],[[d,"Apple TV"],[u,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[u,d,[c,h]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[d,[u,"Amazon"],[c,h]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[d,A.str,E.device.amazon.model],[u,"Amazon"],[c,g]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[d,u,[c,g]],[/\((ip[honed|\s\w*]+);/i],[d,[u,"Apple"],[c,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[u,d,[c,g]],[/\(bb10;\s(\w+)/i],[d,[u,"BlackBerry"],[c,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[d,[u,"Asus"],[c,h]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[u,"Sony"],[d,"Xperia Tablet"],[c,h]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[u,"Sony"],[d,"Xperia Phone"],[c,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[u,d,[c,b]],[/android.+;\s(shield)\sbuild/i],[d,[u,"Nvidia"],[c,b]],[/(playstation\s[34portablevi]+)/i],[d,[u,"Sony"],[c,b]],[/(sprint\s(\w+))/i],[[u,A.str,E.device.sprint.vendor],[d,A.str,E.device.sprint.model],[c,g]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[u,d,[c,h]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[u,[d,/_/g," "],[c,g]],[/(nexus\s9)/i],[d,[u,"HTC"],[c,h]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[d,[u,"Microsoft"],[c,b]],[/(kin\.[onetw]{3})/i],[[d,/\./g," "],[u,"Microsoft"],[c,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s[6])/i],[d,[u,"Motorola"],[c,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[d,[u,"Motorola"],[c,h]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[u,"Samsung"],d,[c,h]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[u,"Samsung"],d,[c,g]],[/(samsung);smarttv/i],[u,d,[c,v]],[/\(dtv[\);].+(aquos)/i],[d,[u,"Sharp"],[c,v]],[/sie-(\w+)*/i],[d,[u,"Siemens"],[c,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[u,"Nokia"],d,[c,g]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[d,[u,"Acer"],[c,h]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[u,"LG"],d,[c,h]],[/(lg) netcast\.tv/i],[u,d,[c,v]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[d,[u,"LG"],[c,g]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[d,[u,"Lenovo"],[c,h]],[/linux;.+((jolla));/i],[u,d,[c,g]],[/((pebble))app\/[\d\.]+\s/i],[u,d,[c,x]],[/android.+;\s(glass)\s\d/i],[d,[u,"Google"],[c,x]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[d,/_/g," "],[u,"Xiaomi"],[c,g]],[/\s(tablet)[;\/\s]/i,/\s(mobile)[;\/\s]/i],[[c,k.lowerize],u,d]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[m,[p,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[p,m],[/rv\:([\w\.]+).*(gecko)/i],[m,p]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[p,m],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[p,[m,A.str,E.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[p,"Windows"],[m,A.str,E.os.windows.version]],[/\((bb)(10);/i],[[p,"BlackBerry"],m],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[p,m],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[p,"Symbian"],m],[/\((series40);/i],[p],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[p,"Firefox OS"],m],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[p,m],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[p,"Chromium OS"],m],[/(sunos)\s?([\w\.]+\d)*/i],[[p,"Solaris"],m],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[p,m],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[p,"iOS"],[m,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[p,"Mac OS"],[m,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[p,m]]
},T=function(s,e){if(!(this instanceof T))return new T(s,e).getResult();var r=s||(i&&i.navigator&&i.navigator.userAgent?i.navigator.userAgent:o),n=e?k.extend(S,e):S;return this.getBrowser=function(){var i=A.rgx.apply(this,n.browser);return i.major=k.major(i.version),i},this.getCPU=function(){return A.rgx.apply(this,n.cpu)},this.getDevice=function(){return A.rgx.apply(this,n.device)},this.getEngine=function(){return A.rgx.apply(this,n.engine)},this.getOS=function(){return A.rgx.apply(this,n.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(i){return r=i,this},this.setUA(r),this};T.VERSION=e,T.BROWSER={NAME:p,MAJOR:l,VERSION:m},T.CPU={ARCHITECTURE:f},T.DEVICE={MODEL:d,VENDOR:u,TYPE:c,CONSOLE:b,MOBILE:g,SMARTTV:v,TABLET:h,WEARABLE:x,EMBEDDED:y},T.ENGINE={NAME:p,VERSION:m},T.OS={NAME:p,VERSION:m},typeof exports!==a?(typeof module!==a&&module.exports&&(exports=module.exports=T),exports.UAParser=T):typeof define===n&&define.amd?define(function(){return T}):i.UAParser=T;var N=i.jQuery||i.Zepto;if(typeof N!==a){var O=new T;N.ua=O.getResult(),N.ua.get=function(){return O.getUA()},N.ua.set=function(i){O.setUA(i);var s=O.getResult();for(var e in s)N.ua[e]=s[e]}}}("object"==typeof window?window:this)},{}]},{},[1])(1)})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],2:[function(require,module,exports){(function(global){"use strict";var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol?"symbol":typeof obj};(function(f){if((typeof exports==="undefined"?"undefined":_typeof(exports))==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.VideoEventPolyfill=f()}})(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++){s(r[o])}return s}({1:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.default={WAITING:"polyfillWaiting",PLAYING:"polyfillPlaying",ENDED:"polyfillEnded"};module.exports=exports["default"]},{}],2:[function(_dereq_,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();var _events=_dereq_("events");var _events2=_interopRequireDefault(_events);var _eventStruct=_dereq_("./eventStruct");var _eventStruct2=_interopRequireDefault(_eventStruct);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return call&&((typeof call==="undefined"?"undefined":_typeof(call))==="object"||typeof call==="function")?call:self}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+(typeof superClass==="undefined"?"undefined":_typeof(superClass)))}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass}var VideoEventPolyfill=function(_EventEmitter){_inherits(VideoEventPolyfill,_EventEmitter);_createClass(VideoEventPolyfill,null,[{key:"Events",get:function get(){return _eventStruct2.default}}]);function VideoEventPolyfill(video){_classCallCheck(this,VideoEventPolyfill);var _this=_possibleConstructorReturn(this,Object.getPrototypeOf(VideoEventPolyfill).call(this));_this.video=video;_this.IDLE=0;_this.BUFFERING=1;_this.PLAYING=2;_this.TOLERANCE=.1;_this.state=_this.IDLE;_this.onPl=_this.onPlay.bind(_this);_this.onPling=_this.onPlaying.bind(_this);if(_this.video.paused){_this.start()}else{_this.onPlay()}return _this}_createClass(VideoEventPolyfill,[{key:"start",value:function start(){this.video.addEventListener("play",this.onPl)}},{key:"onPlay",value:function onPlay(){this.state=this.BUFFERING;this.emit(_eventStruct2.default.WAITING);this.tickInterval=setInterval(this.tick.bind(this),200);this.video.removeEventListener("play",this.onPl)}},{key:"onPlaying",value:function onPlaying(){this.emit(_eventStruct2.default.PLAYING);this.video.removeEventListener("playing",this.onPling)}},{key:"onEnded",value:function onEnded(){clearInterval(this.tickInterval);this.state=this.IDLE;this.emit(_eventStruct2.default.ENDED);if(this.video){this.video.addEventListener("play",this.onPl)}}},{key:"getBufferLength",value:function getBufferLength(){for(var i=0;i<this.video.buffered.length;i++){if(this.video.buffered.start(i)<=this.video.currentTime&&this.video.currentTime<=this.video.buffered.end(i)){return this.video.buffered.end(i)-this.video.currentTime}}return 0}},{key:"tick",value:function tick(){if(this.isLive!==undefined&&!this.isLive){if(this.video.duration&&(this.video.duration-this.video.currentTime<.5||this.video.duration-this.video.currentTime<1&&this.lastCurrentTime-this.video.currentTime<.01&&!this.video.paused&&this.video.playbackRate>0||this.video.currentTime>0&&isNaN(this.video.duration))){this.onEnded();return}else{this.lastCurrentTime=this.video.currentTime}}var bufferLength=this.getBufferLength();switch(this.state){case this.BUFFERING:if(bufferLength>this.TOLERANCE){this.state=this.PLAYING;if(!this.video.paused){this.emit(_eventStruct2.default.PLAYING)}else{this.video.addEventListener("playing",this.onPling)}}break;case this.PLAYING:if(bufferLength<this.TOLERANCE){this.state=this.BUFFERING;if(!this.video.paused){this.emit(_eventStruct2.default.WAITING)}}else if(this.video.paused){this.video.addEventListener("playing",this.onPling)}break;case this.IDLE:default:return}}},{key:"setLive",value:function setLive(isLive){this.isLive=isLive}},{key:"dispose",value:function dispose(){clearInterval(this.tickInterval);if(this.video){this.video.removeEventListener("play",this.onPl);this.video.removeEventListener("playing",this.onPling);delete this.video}this.removeAllListeners()}}]);return VideoEventPolyfill}(_events2.default);exports.default=VideoEventPolyfill;module.exports=exports["default"]},{"./eventStruct":1,events:3}],3:[function(_dereq_,module,exports){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}module.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=undefined;EventEmitter.prototype._maxListeners=undefined;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}throw TypeError('Uncaught, unspecified "error" event.')}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i=0;i<len;i++){listeners[i].apply(this,args)}}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory "+"leak detected. %d listeners added. "+"Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i=length;i-- >0;){if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length){this.removeListener(type,listeners[listeners.length-1])}}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return(typeof arg==="undefined"?"undefined":_typeof(arg))==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},{}]},{},[2])(2)})}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],3:[function(require,module,exports){"use strict";var _streamrootHlsjsP2pBundle=require("streamroot-hlsjs-p2p-bundle");var _streamrootHlsjsP2pBundle2=_interopRequireDefault(_streamrootHlsjsP2pBundle);var _streamrootVideoEventPolyfill=require("streamroot-video-event-polyfill");var _streamrootVideoEventPolyfill2=_interopRequireDefault(_streamrootVideoEventPolyfill);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}var MEDIA_TYPE={VOD:0,LIVE:1,DVR:2};var attachJWStreamrootProvider=function attachJWStreamrootProvider(jwplayer){var utils=jwplayer.utils,events=jwplayer.events,states=events.state;function StreamrootProvider(playerId,playerConfig){var playerInstance=jwplayer(playerId);var self=this;var _container;var element=document.getElementById(playerId);var _video=element&&element.querySelector("video")?element.querySelector("video"):document.createElement("video");var _position=0;var _levels=[];var _currentQuality=-1;var _bufferInterval;var _bufferPercent=-1;var _mediaType=MEDIA_TYPE.VOD;var _dvrWindow=0;var _attached=true;this.name="streamrootHLS";var _hls;utils.css.style(_video,{height:"100%",width:"100%"});var Events=playerInstance.Events;playerInstance._.extend(this,Events,{load:load,mute:mute,pause:pause,getQualityLevels:getQualityLevels,getCurrentQuality:getCurrentQuality,play:play,seek:seek,remove:remove,setContainer:setContainer,getContainer:getContainer,setCurrentQuality:setCurrentQuality.bind(this),setVisibility:setVisibility,stop:stop,volume:volume,supportsFullscreen:supportsFullscreen,getName:getName,detachMedia:detachMedia,attachMedia:attachMedia});_video.addEventListener("timeupdate",_timeListener);function _loadHls(url){if(_hls===undefined||_hls.url!==url){var onLevelLoaded=function onLevelLoaded(event,data){_mediaType=MEDIA_TYPE.VOD;if(data.details.live){_mediaType=data.details.totalduration>120?MEDIA_TYPE.DVR:MEDIA_TYPE.LIVE;_dvrWindow=data.details.totalduration}polyfill.setLive(data.details.live)};_dvrWindow=0;if(_hls){_hls.destroy()}var p2pConfig=playerConfig.p2pConfig||{};var hlsjsConfig=playerConfig.hlsjsConfig||{};var hlsjsConfigCopy=playerInstance._.extend({},hlsjsConfig);_hls=new _streamrootHlsjsP2pBundle2.default(hlsjsConfigCopy,p2pConfig);_hls.on(_streamrootHlsjsP2pBundle2.default.Events.MANIFEST_PARSED,_onMetaData);_hls.on(_streamrootHlsjsP2pBundle2.default.Events.ERROR,function(event,data){console.error("HLS.js error: "+data.type+" - fatal: "+data.fatal+" - "+data.details);if(data.fatal){self.trigger(events.JWPLAYER_MEDIA_ERROR,{message:data.details})}});var polyfill=new _streamrootVideoEventPolyfill2.default(_video);polyfill.on(_streamrootVideoEventPolyfill2.default.Events.WAITING,function(){self.setState(states.BUFFERING)});polyfill.on(_streamrootVideoEventPolyfill2.default.Events.PLAYING,function(){self.setState(states.PLAYING)});polyfill.on(_streamrootVideoEventPolyfill2.default.Events.ENDED,function(){self.trigger(events.JWPLAYER_MEDIA_BEFORECOMPLETE);if(_attached){seek(0);self.pause();self.setState(states.COMPLETE);self.trigger(events.JWPLAYER_MEDIA_COMPLETE)}else{}});_hls.on(_streamrootHlsjsP2pBundle2.default.Events.LEVEL_LOADED,onLevelLoaded);_hls.on(_streamrootHlsjsP2pBundle2.default.Events.DESTROYING,function(){polyfill.dispose()});_hls.loadSource(url);_hls.attachMedia(_video)}else{}}function load(item){this.setState(states.BUFFERING);var url=item.file;if(_streamrootHlsjsP2pBundle2.default!==undefined){_loadHls(url)}else{console.error("Hls is not defined. Import Hls.js library")}if(item.starttime){this.seek(item.starttime)}this.trigger(events.JWPLAYER_MEDIA_BUFFER_FULL);_bufferInterval=setInterval(_sendBufferUpdate,100)}function mute(s){_video.muted=s}function pause(){_video.pause();this.setState(states.PAUSED)}function getQualityLevels(){return _levels}function getCurrentQuality(){return _currentQuality}function play(){_video.play();this.setState(states.BUFFERING);this.setVisibility(true)}function seek(time){if(!_attached){return}if(_mediaType===MEDIA_TYPE.DVR){if(time<0){time+=_video.duration}}_video.currentTime=time}function remove(){if(_container===_video.parentNode){_container.removeChild(_video)}}function setContainer(element){_container=element;_container.appendChild(_video)}function getContainer(){return _container}function setCurrentQuality(jwIndex){var l=jwIndex-1;_hls.nextLevel=l;setCurrentQualitySkin(jwIndex)}function setCurrentQualitySkin(jwIndex){self._currentQuality=jwIndex;self.trigger(events.JWPLAYER_MEDIA_LEVEL_CHANGED,{currentQuality:jwIndex,levels:_levels})}function setVisibility(state){state=!!state;if(state){utils.css.style(_container,{visibility:"visible",opacity:1})}else{utils.css.style(_container,{visibility:"",opacity:0})}}function stop(){_video.pause();this.setState(states.IDLE)}function volume(v){_video.volume=v/100}function supportsFullscreen(){return true}function getName(){return{name:this.name}}function detachMedia(){if(_attached){_attached=false;if(_hls){_hls.detachMedia()}clearInterval(_bufferInterval);return _video}}function attachMedia(){_attached=true;if(_hls){_hls.attachMedia(_video)}}function _timeListener(){if(!_attached){return}var p=_video.currentTime;var duration=_video.duration;_position=p;if(_mediaType===MEDIA_TYPE.LIVE){duration=Infinity}if(_mediaType===MEDIA_TYPE.DVR){p=-(_video.duration-_video.currentTime);duration=-_dvrWindow}self.trigger(events.JWPLAYER_MEDIA_TIME,{position:p,duration:duration})}function _sendBufferUpdate(){var newBuffer=_getBuffer();if(newBuffer!=_bufferPercent){_bufferPercent=newBuffer;self.trigger(events.JWPLAYER_MEDIA_BUFFER,{bufferPercent:_bufferPercent*100})}if(newBuffer>=1){clearInterval(_bufferInterval)}}function _getDashMaxTime(buf){for(var i=0;i<buf.length;i++){if(buf.start(i)<=_video.currentTime&&_video.currentTime<=buf.end(i)){return buf.end(i)}}return _position}function _getBuffer(){var r=_video.buffered;var max_time=_getDashMaxTime(r);if(_video.duration<=0){return 0}else{return max_time/_video.duration}}function _onMetaData(event,data){console.log("metadata received",data);var cleanTracklist=[];var videoIndex=0;if(data.levels.length>1){var autoLevel={jwIndex:-1,label:"auto"};cleanTracklist.push(autoLevel)}data.levels.forEach(function(level){var jwLevel={};jwLevel.jwIndex=videoIndex;jwLevel.bitrate=level.bitrate;cleanTracklist.push(jwLevel);videoIndex++;jwLevel.label=_levelLabel(level)});_levels=cleanTracklist;self.trigger(events.JWPLAYER_MEDIA_LEVELS,{levels:_levels,currentQuality:_currentQuality});setCurrentQualitySkin(_hls.manualLevel+1);function _levelLabel(level){if(level.height)return level.height+"p";else if(level.width)return Math.round(level.width*9/16)+"p";else if(level.bitrate)return level.bitrate/1e3+"kbps";else return 0}}}StreamrootProvider.getName=function getName(){return{name:"StreamrootProviderHLS"}};StreamrootProvider.supports=function(i){var extSupported;var isIEorEdge=_streamrootHlsjsP2pBundle2.default&&(_streamrootHlsjsP2pBundle2.default.getBrowserName()==="IE"||_streamrootHlsjsP2pBundle2.default.getBrowserName()==="Edge");if(i.file){extSupported=i.file.indexOf(".m3u8")!==-1}return extSupported&&!isIEorEdge&&_streamrootHlsjsP2pBundle2.default&&_streamrootHlsjsP2pBundle2.default.isSupported()};jwplayer.api.registerProvider(StreamrootProvider)};attachJWStreamrootProvider(window.jwplayer)},{"streamroot-hlsjs-p2p-bundle":1,"streamroot-video-event-polyfill":2}]},{},[3]);
